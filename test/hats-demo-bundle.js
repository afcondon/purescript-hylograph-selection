/* Generated by Spago v0.93.45 */
(() => {
  // output/Test.HATSDemo/foreign.js
  var unsafeIndex = (arr) => (i) => arr[i];
  var unsafeSlice = (start2) => (end) => (arr) => arr.slice(start2, end);
  var length = (arr) => arr.length;
  var setupGUPButtons = (addHandler) => (removeHandler) => (shuffleHandler) => () => {
    const addBtn = document.getElementById("gup-add");
    const removeBtn = document.getElementById("gup-remove");
    const shuffleBtn = document.getElementById("gup-shuffle");
    if (addBtn) {
      addBtn.addEventListener("click", () => addHandler()());
    }
    if (removeBtn) {
      removeBtn.addEventListener("click", () => removeHandler()());
    }
    if (shuffleBtn) {
      shuffleBtn.addEventListener("click", () => shuffleHandler()());
    }
  };
  var startForceSimulation = () => {
    const circles = document.querySelectorAll(".force-node");
    if (circles.length === 0) {
      console.log("No force nodes found");
      return;
    }
    const nodes = Array.from(circles).map((el, i) => ({
      id: i,
      x: parseFloat(el.getAttribute("cx")),
      y: parseFloat(el.getAttribute("cy")),
      element: el
    }));
    const simulation = d3.forceSimulation(nodes).force("charge", d3.forceManyBody().strength(-80)).force("center", d3.forceCenter(150, 75)).force("collision", d3.forceCollide().radius(20)).alphaDecay(0.02);
    simulation.on("tick", () => {
      nodes.forEach((node) => {
        node.element.setAttribute("cx", node.x);
        node.element.setAttribute("cy", node.y);
      });
    });
    simulation.on("end", () => {
      console.log("Force simulation complete");
    });
  };

  // output/Data.Functor/foreign.js
  var arrayMap = function(f) {
    return function(arr) {
      var l = arr.length;
      var result = new Array(l);
      for (var i = 0; i < l; i++) {
        result[i] = f(arr[i]);
      }
      return result;
    };
  };

  // output/Control.Semigroupoid/index.js
  var semigroupoidFn = {
    compose: function(f) {
      return function(g) {
        return function(x) {
          return f(g(x));
        };
      };
    }
  };

  // output/Control.Category/index.js
  var identity = function(dict) {
    return dict.identity;
  };
  var categoryFn = {
    identity: function(x) {
      return x;
    },
    Semigroupoid0: function() {
      return semigroupoidFn;
    }
  };

  // output/Data.Boolean/index.js
  var otherwise = true;

  // output/Data.Function/index.js
  var flip = function(f) {
    return function(b) {
      return function(a) {
        return f(a)(b);
      };
    };
  };
  var $$const = function(a) {
    return function(v) {
      return a;
    };
  };

  // output/Data.Unit/foreign.js
  var unit = void 0;

  // output/Data.Functor/index.js
  var map = function(dict) {
    return dict.map;
  };
  var $$void = function(dictFunctor) {
    return map(dictFunctor)($$const(unit));
  };
  var functorArray = {
    map: arrayMap
  };

  // output/Data.Semigroup/foreign.js
  var concatArray = function(xs) {
    return function(ys) {
      if (xs.length === 0) return ys;
      if (ys.length === 0) return xs;
      return xs.concat(ys);
    };
  };

  // output/Data.Semigroup/index.js
  var semigroupArray = {
    append: concatArray
  };
  var append = function(dict) {
    return dict.append;
  };

  // output/Control.Apply/foreign.js
  var arrayApply = function(fs) {
    return function(xs) {
      var l = fs.length;
      var k = xs.length;
      var result = new Array(l * k);
      var n = 0;
      for (var i = 0; i < l; i++) {
        var f = fs[i];
        for (var j = 0; j < k; j++) {
          result[n++] = f(xs[j]);
        }
      }
      return result;
    };
  };

  // output/Control.Apply/index.js
  var applyArray = {
    apply: arrayApply,
    Functor0: function() {
      return functorArray;
    }
  };
  var apply = function(dict) {
    return dict.apply;
  };
  var lift2 = function(dictApply) {
    var apply1 = apply(dictApply);
    var map8 = map(dictApply.Functor0());
    return function(f) {
      return function(a) {
        return function(b) {
          return apply1(map8(f)(a))(b);
        };
      };
    };
  };

  // output/Control.Applicative/index.js
  var pure = function(dict) {
    return dict.pure;
  };
  var liftA1 = function(dictApplicative) {
    var apply3 = apply(dictApplicative.Apply0());
    var pure1 = pure(dictApplicative);
    return function(f) {
      return function(a) {
        return apply3(pure1(f))(a);
      };
    };
  };

  // output/Control.Bind/foreign.js
  var arrayBind = typeof Array.prototype.flatMap === "function" ? function(arr) {
    return function(f) {
      return arr.flatMap(f);
    };
  } : function(arr) {
    return function(f) {
      var result = [];
      var l = arr.length;
      for (var i = 0; i < l; i++) {
        var xs = f(arr[i]);
        var k = xs.length;
        for (var j = 0; j < k; j++) {
          result.push(xs[j]);
        }
      }
      return result;
    };
  };

  // output/Control.Bind/index.js
  var bindArray = {
    bind: arrayBind,
    Apply0: function() {
      return applyArray;
    }
  };
  var bind = function(dict) {
    return dict.bind;
  };

  // output/Control.Monad/index.js
  var ap = function(dictMonad) {
    var bind3 = bind(dictMonad.Bind1());
    var pure3 = pure(dictMonad.Applicative0());
    return function(f) {
      return function(a) {
        return bind3(f)(function(f$prime) {
          return bind3(a)(function(a$prime) {
            return pure3(f$prime(a$prime));
          });
        });
      };
    };
  };

  // output/Data.Bounded/foreign.js
  var topChar = String.fromCharCode(65535);
  var bottomChar = String.fromCharCode(0);
  var topNumber = Number.POSITIVE_INFINITY;
  var bottomNumber = Number.NEGATIVE_INFINITY;

  // output/Data.Ord/foreign.js
  var unsafeCompareImpl = function(lt) {
    return function(eq3) {
      return function(gt) {
        return function(x) {
          return function(y) {
            return x < y ? lt : x === y ? eq3 : gt;
          };
        };
      };
    };
  };
  var ordNumberImpl = unsafeCompareImpl;
  var ordStringImpl = unsafeCompareImpl;

  // output/Data.Eq/foreign.js
  var refEq = function(r1) {
    return function(r2) {
      return r1 === r2;
    };
  };
  var eqNumberImpl = refEq;
  var eqStringImpl = refEq;

  // output/Data.Eq/index.js
  var eqString = {
    eq: eqStringImpl
  };
  var eqNumber = {
    eq: eqNumberImpl
  };
  var eq = function(dict) {
    return dict.eq;
  };

  // output/Data.Ordering/index.js
  var LT = /* @__PURE__ */ (function() {
    function LT2() {
    }
    ;
    LT2.value = new LT2();
    return LT2;
  })();
  var GT = /* @__PURE__ */ (function() {
    function GT2() {
    }
    ;
    GT2.value = new GT2();
    return GT2;
  })();
  var EQ = /* @__PURE__ */ (function() {
    function EQ2() {
    }
    ;
    EQ2.value = new EQ2();
    return EQ2;
  })();
  var eqOrdering = {
    eq: function(v) {
      return function(v1) {
        if (v instanceof LT && v1 instanceof LT) {
          return true;
        }
        ;
        if (v instanceof GT && v1 instanceof GT) {
          return true;
        }
        ;
        if (v instanceof EQ && v1 instanceof EQ) {
          return true;
        }
        ;
        return false;
      };
    }
  };

  // output/Data.Ring/foreign.js
  var intSub = function(x) {
    return function(y) {
      return x - y | 0;
    };
  };

  // output/Data.Semiring/foreign.js
  var intAdd = function(x) {
    return function(y) {
      return x + y | 0;
    };
  };
  var intMul = function(x) {
    return function(y) {
      return x * y | 0;
    };
  };
  var numAdd = function(n1) {
    return function(n2) {
      return n1 + n2;
    };
  };
  var numMul = function(n1) {
    return function(n2) {
      return n1 * n2;
    };
  };

  // output/Data.Semiring/index.js
  var semiringNumber = {
    add: numAdd,
    zero: 0,
    mul: numMul,
    one: 1
  };
  var semiringInt = {
    add: intAdd,
    zero: 0,
    mul: intMul,
    one: 1
  };
  var add = function(dict) {
    return dict.add;
  };

  // output/Data.Ring/index.js
  var ringInt = {
    sub: intSub,
    Semiring0: function() {
      return semiringInt;
    }
  };

  // output/Data.Ord/index.js
  var ordString = /* @__PURE__ */ (function() {
    return {
      compare: ordStringImpl(LT.value)(EQ.value)(GT.value),
      Eq0: function() {
        return eqString;
      }
    };
  })();
  var ordNumber = /* @__PURE__ */ (function() {
    return {
      compare: ordNumberImpl(LT.value)(EQ.value)(GT.value),
      Eq0: function() {
        return eqNumber;
      }
    };
  })();
  var compare = function(dict) {
    return dict.compare;
  };
  var max = function(dictOrd) {
    var compare3 = compare(dictOrd);
    return function(x) {
      return function(y) {
        var v = compare3(x)(y);
        if (v instanceof LT) {
          return y;
        }
        ;
        if (v instanceof EQ) {
          return x;
        }
        ;
        if (v instanceof GT) {
          return x;
        }
        ;
        throw new Error("Failed pattern match at Data.Ord (line 181, column 3 - line 184, column 12): " + [v.constructor.name]);
      };
    };
  };

  // output/Data.Show/foreign.js
  var showIntImpl = function(n) {
    return n.toString();
  };
  var showNumberImpl = function(n) {
    var str = n.toString();
    return isNaN(str + ".0") ? str : str + ".0";
  };
  var showStringImpl = function(s) {
    var l = s.length;
    return '"' + s.replace(
      /[\0-\x1F\x7F"\\]/g,
      // eslint-disable-line no-control-regex
      function(c, i) {
        switch (c) {
          case '"':
          case "\\":
            return "\\" + c;
          case "\x07":
            return "\\a";
          case "\b":
            return "\\b";
          case "\f":
            return "\\f";
          case "\n":
            return "\\n";
          case "\r":
            return "\\r";
          case "	":
            return "\\t";
          case "\v":
            return "\\v";
        }
        var k = i + 1;
        var empty7 = k < l && s[k] >= "0" && s[k] <= "9" ? "\\&" : "";
        return "\\" + c.charCodeAt(0).toString(10) + empty7;
      }
    ) + '"';
  };
  var showArrayImpl = function(f) {
    return function(xs) {
      var ss = [];
      for (var i = 0, l = xs.length; i < l; i++) {
        ss[i] = f(xs[i]);
      }
      return "[" + ss.join(",") + "]";
    };
  };

  // output/Data.Show/index.js
  var showString = {
    show: showStringImpl
  };
  var showNumber = {
    show: showNumberImpl
  };
  var showInt = {
    show: showIntImpl
  };
  var show = function(dict) {
    return dict.show;
  };
  var showArray = function(dictShow) {
    return {
      show: showArrayImpl(show(dictShow))
    };
  };

  // output/Data.Maybe/index.js
  var identity2 = /* @__PURE__ */ identity(categoryFn);
  var Nothing = /* @__PURE__ */ (function() {
    function Nothing2() {
    }
    ;
    Nothing2.value = new Nothing2();
    return Nothing2;
  })();
  var Just = /* @__PURE__ */ (function() {
    function Just2(value0) {
      this.value0 = value0;
    }
    ;
    Just2.create = function(value0) {
      return new Just2(value0);
    };
    return Just2;
  })();
  var maybe = function(v) {
    return function(v1) {
      return function(v2) {
        if (v2 instanceof Nothing) {
          return v;
        }
        ;
        if (v2 instanceof Just) {
          return v1(v2.value0);
        }
        ;
        throw new Error("Failed pattern match at Data.Maybe (line 237, column 1 - line 237, column 51): " + [v.constructor.name, v1.constructor.name, v2.constructor.name]);
      };
    };
  };
  var isNothing = /* @__PURE__ */ maybe(true)(/* @__PURE__ */ $$const(false));
  var functorMaybe = {
    map: function(v) {
      return function(v1) {
        if (v1 instanceof Just) {
          return new Just(v(v1.value0));
        }
        ;
        return Nothing.value;
      };
    }
  };
  var map2 = /* @__PURE__ */ map(functorMaybe);
  var fromMaybe = function(a) {
    return maybe(a)(identity2);
  };
  var fromJust = function() {
    return function(v) {
      if (v instanceof Just) {
        return v.value0;
      }
      ;
      throw new Error("Failed pattern match at Data.Maybe (line 288, column 1 - line 288, column 46): " + [v.constructor.name]);
    };
  };
  var applyMaybe = {
    apply: function(v) {
      return function(v1) {
        if (v instanceof Just) {
          return map2(v.value0)(v1);
        }
        ;
        if (v instanceof Nothing) {
          return Nothing.value;
        }
        ;
        throw new Error("Failed pattern match at Data.Maybe (line 67, column 1 - line 69, column 30): " + [v.constructor.name, v1.constructor.name]);
      };
    },
    Functor0: function() {
      return functorMaybe;
    }
  };

  // output/Data.EuclideanRing/foreign.js
  var intDegree = function(x) {
    return Math.min(Math.abs(x), 2147483647);
  };
  var intDiv = function(x) {
    return function(y) {
      if (y === 0) return 0;
      return y > 0 ? Math.floor(x / y) : -Math.floor(x / -y);
    };
  };
  var intMod = function(x) {
    return function(y) {
      if (y === 0) return 0;
      var yy = Math.abs(y);
      return (x % yy + yy) % yy;
    };
  };

  // output/Data.CommutativeRing/index.js
  var commutativeRingInt = {
    Ring0: function() {
      return ringInt;
    }
  };

  // output/Data.EuclideanRing/index.js
  var mod = function(dict) {
    return dict.mod;
  };
  var euclideanRingInt = {
    degree: intDegree,
    div: intDiv,
    mod: intMod,
    CommutativeRing0: function() {
      return commutativeRingInt;
    }
  };
  var div = function(dict) {
    return dict.div;
  };

  // output/Data.Monoid/index.js
  var mempty = function(dict) {
    return dict.mempty;
  };

  // output/Effect/foreign.js
  var pureE = function(a) {
    return function() {
      return a;
    };
  };
  var bindE = function(a) {
    return function(f) {
      return function() {
        return f(a())();
      };
    };
  };

  // output/Effect/index.js
  var $runtime_lazy = function(name15, moduleName, init2) {
    var state3 = 0;
    var val;
    return function(lineNumber) {
      if (state3 === 2) return val;
      if (state3 === 1) throw new ReferenceError(name15 + " was needed before it finished initializing (module " + moduleName + ", line " + lineNumber + ")", moduleName, lineNumber);
      state3 = 1;
      val = init2();
      state3 = 2;
      return val;
    };
  };
  var monadEffect = {
    Applicative0: function() {
      return applicativeEffect;
    },
    Bind1: function() {
      return bindEffect;
    }
  };
  var bindEffect = {
    bind: bindE,
    Apply0: function() {
      return $lazy_applyEffect(0);
    }
  };
  var applicativeEffect = {
    pure: pureE,
    Apply0: function() {
      return $lazy_applyEffect(0);
    }
  };
  var $lazy_functorEffect = /* @__PURE__ */ $runtime_lazy("functorEffect", "Effect", function() {
    return {
      map: liftA1(applicativeEffect)
    };
  });
  var $lazy_applyEffect = /* @__PURE__ */ $runtime_lazy("applyEffect", "Effect", function() {
    return {
      apply: ap(monadEffect),
      Functor0: function() {
        return $lazy_functorEffect(0);
      }
    };
  });

  // output/Effect.Ref/foreign.js
  var _new = function(val) {
    return function() {
      return { value: val };
    };
  };
  var read = function(ref) {
    return function() {
      return ref.value;
    };
  };
  var write = function(val) {
    return function(ref) {
      return function() {
        ref.value = val;
      };
    };
  };

  // output/Effect.Ref/index.js
  var $$new = _new;

  // output/Data.Foldable/foreign.js
  var foldrArray = function(f) {
    return function(init2) {
      return function(xs) {
        var acc = init2;
        var len = xs.length;
        for (var i = len - 1; i >= 0; i--) {
          acc = f(xs[i])(acc);
        }
        return acc;
      };
    };
  };
  var foldlArray = function(f) {
    return function(init2) {
      return function(xs) {
        var acc = init2;
        var len = xs.length;
        for (var i = 0; i < len; i++) {
          acc = f(acc)(xs[i]);
        }
        return acc;
      };
    };
  };

  // output/Data.Tuple/index.js
  var Tuple = /* @__PURE__ */ (function() {
    function Tuple2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    Tuple2.create = function(value0) {
      return function(value1) {
        return new Tuple2(value0, value1);
      };
    };
    return Tuple2;
  })();
  var snd = function(v) {
    return v.value1;
  };
  var fst = function(v) {
    return v.value0;
  };

  // output/Unsafe.Coerce/foreign.js
  var unsafeCoerce2 = function(x) {
    return x;
  };

  // output/Safe.Coerce/index.js
  var coerce = function() {
    return unsafeCoerce2;
  };

  // output/Data.Foldable/index.js
  var eq12 = /* @__PURE__ */ eq(eqOrdering);
  var foldr = function(dict) {
    return dict.foldr;
  };
  var foldl = function(dict) {
    return dict.foldl;
  };
  var maximumBy = function(dictFoldable) {
    var foldl22 = foldl(dictFoldable);
    return function(cmp) {
      var max$prime = function(v) {
        return function(v1) {
          if (v instanceof Nothing) {
            return new Just(v1);
          }
          ;
          if (v instanceof Just) {
            return new Just((function() {
              var $303 = eq12(cmp(v.value0)(v1))(GT.value);
              if ($303) {
                return v.value0;
              }
              ;
              return v1;
            })());
          }
          ;
          throw new Error("Failed pattern match at Data.Foldable (line 441, column 3 - line 441, column 27): " + [v.constructor.name, v1.constructor.name]);
        };
      };
      return foldl22(max$prime)(Nothing.value);
    };
  };
  var maximum = function(dictOrd) {
    var compare2 = compare(dictOrd);
    return function(dictFoldable) {
      return maximumBy(dictFoldable)(compare2);
    };
  };
  var minimumBy = function(dictFoldable) {
    var foldl22 = foldl(dictFoldable);
    return function(cmp) {
      var min$prime = function(v) {
        return function(v1) {
          if (v instanceof Nothing) {
            return new Just(v1);
          }
          ;
          if (v instanceof Just) {
            return new Just((function() {
              var $307 = eq12(cmp(v.value0)(v1))(LT.value);
              if ($307) {
                return v.value0;
              }
              ;
              return v1;
            })());
          }
          ;
          throw new Error("Failed pattern match at Data.Foldable (line 454, column 3 - line 454, column 27): " + [v.constructor.name, v1.constructor.name]);
        };
      };
      return foldl22(min$prime)(Nothing.value);
    };
  };
  var minimum = function(dictOrd) {
    var compare2 = compare(dictOrd);
    return function(dictFoldable) {
      return minimumBy(dictFoldable)(compare2);
    };
  };
  var foldMapDefaultR = function(dictFoldable) {
    var foldr2 = foldr(dictFoldable);
    return function(dictMonoid) {
      var append3 = append(dictMonoid.Semigroup0());
      var mempty2 = mempty(dictMonoid);
      return function(f) {
        return foldr2(function(x) {
          return function(acc) {
            return append3(f(x))(acc);
          };
        })(mempty2);
      };
    };
  };
  var foldableArray = {
    foldr: foldrArray,
    foldl: foldlArray,
    foldMap: function(dictMonoid) {
      return foldMapDefaultR(foldableArray)(dictMonoid);
    }
  };
  var foldMap = function(dict) {
    return dict.foldMap;
  };

  // output/Data.FunctorWithIndex/foreign.js
  var mapWithIndexArray = function(f) {
    return function(xs) {
      var l = xs.length;
      var result = Array(l);
      for (var i = 0; i < l; i++) {
        result[i] = f(i)(xs[i]);
      }
      return result;
    };
  };

  // output/Data.FunctorWithIndex/index.js
  var mapWithIndex = function(dict) {
    return dict.mapWithIndex;
  };
  var functorWithIndexArray = {
    mapWithIndex: mapWithIndexArray,
    Functor0: function() {
      return functorArray;
    }
  };

  // output/Data.FoldableWithIndex/index.js
  var foldr8 = /* @__PURE__ */ foldr(foldableArray);
  var mapWithIndex2 = /* @__PURE__ */ mapWithIndex(functorWithIndexArray);
  var foldl8 = /* @__PURE__ */ foldl(foldableArray);
  var foldrWithIndex = function(dict) {
    return dict.foldrWithIndex;
  };
  var foldMapWithIndexDefaultR = function(dictFoldableWithIndex) {
    var foldrWithIndex1 = foldrWithIndex(dictFoldableWithIndex);
    return function(dictMonoid) {
      var append3 = append(dictMonoid.Semigroup0());
      var mempty2 = mempty(dictMonoid);
      return function(f) {
        return foldrWithIndex1(function(i) {
          return function(x) {
            return function(acc) {
              return append3(f(i)(x))(acc);
            };
          };
        })(mempty2);
      };
    };
  };
  var foldableWithIndexArray = {
    foldrWithIndex: function(f) {
      return function(z) {
        var $291 = foldr8(function(v) {
          return function(y) {
            return f(v.value0)(v.value1)(y);
          };
        })(z);
        var $292 = mapWithIndex2(Tuple.create);
        return function($293) {
          return $291($292($293));
        };
      };
    },
    foldlWithIndex: function(f) {
      return function(z) {
        var $294 = foldl8(function(y) {
          return function(v) {
            return f(v.value0)(y)(v.value1);
          };
        })(z);
        var $295 = mapWithIndex2(Tuple.create);
        return function($296) {
          return $294($295($296));
        };
      };
    },
    foldMapWithIndex: function(dictMonoid) {
      return foldMapWithIndexDefaultR(foldableWithIndexArray)(dictMonoid);
    },
    Foldable0: function() {
      return foldableArray;
    }
  };

  // output/Data.Traversable/foreign.js
  var traverseArrayImpl = /* @__PURE__ */ (function() {
    function array1(a) {
      return [a];
    }
    function array2(a) {
      return function(b) {
        return [a, b];
      };
    }
    function array3(a) {
      return function(b) {
        return function(c) {
          return [a, b, c];
        };
      };
    }
    function concat2(xs) {
      return function(ys) {
        return xs.concat(ys);
      };
    }
    return function(apply3) {
      return function(map8) {
        return function(pure3) {
          return function(f) {
            return function(array) {
              function go2(bot, top2) {
                switch (top2 - bot) {
                  case 0:
                    return pure3([]);
                  case 1:
                    return map8(array1)(f(array[bot]));
                  case 2:
                    return apply3(map8(array2)(f(array[bot])))(f(array[bot + 1]));
                  case 3:
                    return apply3(apply3(map8(array3)(f(array[bot])))(f(array[bot + 1])))(f(array[bot + 2]));
                  default:
                    var pivot = bot + Math.floor((top2 - bot) / 4) * 2;
                    return apply3(map8(concat2)(go2(bot, pivot)))(go2(pivot, top2));
                }
              }
              return go2(0, array.length);
            };
          };
        };
      };
    };
  })();

  // output/Data.Traversable.Accum.Internal/index.js
  var stateL = function(v) {
    return v;
  };
  var functorStateL = {
    map: function(f) {
      return function(k) {
        return function(s) {
          var v = stateL(k)(s);
          return {
            accum: v.accum,
            value: f(v.value)
          };
        };
      };
    }
  };
  var applyStateL = {
    apply: function(f) {
      return function(x) {
        return function(s) {
          var v = stateL(f)(s);
          var v1 = stateL(x)(v.accum);
          return {
            accum: v1.accum,
            value: v.value(v1.value)
          };
        };
      };
    },
    Functor0: function() {
      return functorStateL;
    }
  };
  var applicativeStateL = {
    pure: function(a) {
      return function(s) {
        return {
          accum: s,
          value: a
        };
      };
    },
    Apply0: function() {
      return applyStateL;
    }
  };

  // output/Data.Traversable/index.js
  var identity3 = /* @__PURE__ */ identity(categoryFn);
  var traverse = function(dict) {
    return dict.traverse;
  };
  var sequenceDefault = function(dictTraversable) {
    var traverse22 = traverse(dictTraversable);
    return function(dictApplicative) {
      return traverse22(dictApplicative)(identity3);
    };
  };
  var traversableArray = {
    traverse: function(dictApplicative) {
      var Apply0 = dictApplicative.Apply0();
      return traverseArrayImpl(apply(Apply0))(map(Apply0.Functor0()))(pure(dictApplicative));
    },
    sequence: function(dictApplicative) {
      return sequenceDefault(traversableArray)(dictApplicative);
    },
    Functor0: function() {
      return functorArray;
    },
    Foldable1: function() {
      return foldableArray;
    }
  };
  var sequence = function(dict) {
    return dict.sequence;
  };
  var mapAccumL = function(dictTraversable) {
    var traverse22 = traverse(dictTraversable)(applicativeStateL);
    return function(f) {
      return function(s0) {
        return function(xs) {
          return stateL(traverse22(function(a) {
            return function(s) {
              return f(s)(a);
            };
          })(xs))(s0);
        };
      };
    };
  };
  var scanl = function(dictTraversable) {
    var mapAccumL1 = mapAccumL(dictTraversable);
    return function(f) {
      return function(b0) {
        return function(xs) {
          return mapAccumL1(function(b) {
            return function(a) {
              var b$prime = f(b)(a);
              return {
                accum: b$prime,
                value: b$prime
              };
            };
          })(b0)(xs).value;
        };
      };
    };
  };

  // output/Data.TraversableWithIndex/index.js
  var traverseWithIndexDefault = function(dictTraversableWithIndex) {
    var sequence2 = sequence(dictTraversableWithIndex.Traversable2());
    var mapWithIndex4 = mapWithIndex(dictTraversableWithIndex.FunctorWithIndex0());
    return function(dictApplicative) {
      var sequence12 = sequence2(dictApplicative);
      return function(f) {
        var $174 = mapWithIndex4(f);
        return function($175) {
          return sequence12($174($175));
        };
      };
    };
  };
  var traverseWithIndex = function(dict) {
    return dict.traverseWithIndex;
  };
  var traversableWithIndexArray = {
    traverseWithIndex: function(dictApplicative) {
      return traverseWithIndexDefault(traversableWithIndexArray)(dictApplicative);
    },
    FunctorWithIndex0: function() {
      return functorWithIndexArray;
    },
    FoldableWithIndex1: function() {
      return foldableWithIndexArray;
    },
    Traversable2: function() {
      return traversableArray;
    }
  };

  // output/Data.Unfoldable/foreign.js
  var unfoldrArrayImpl = function(isNothing2) {
    return function(fromJust4) {
      return function(fst2) {
        return function(snd2) {
          return function(f) {
            return function(b) {
              var result = [];
              var value12 = b;
              while (true) {
                var maybe2 = f(value12);
                if (isNothing2(maybe2)) return result;
                var tuple = fromJust4(maybe2);
                result.push(fst2(tuple));
                value12 = snd2(tuple);
              }
            };
          };
        };
      };
    };
  };

  // output/Data.Unfoldable1/foreign.js
  var unfoldr1ArrayImpl = function(isNothing2) {
    return function(fromJust4) {
      return function(fst2) {
        return function(snd2) {
          return function(f) {
            return function(b) {
              var result = [];
              var value12 = b;
              while (true) {
                var tuple = f(value12);
                result.push(fst2(tuple));
                var maybe2 = snd2(tuple);
                if (isNothing2(maybe2)) return result;
                value12 = fromJust4(maybe2);
              }
            };
          };
        };
      };
    };
  };

  // output/Data.Unfoldable1/index.js
  var fromJust2 = /* @__PURE__ */ fromJust();
  var unfoldable1Array = {
    unfoldr1: /* @__PURE__ */ unfoldr1ArrayImpl(isNothing)(fromJust2)(fst)(snd)
  };

  // output/Data.Unfoldable/index.js
  var fromJust3 = /* @__PURE__ */ fromJust();
  var unfoldr = function(dict) {
    return dict.unfoldr;
  };
  var unfoldableArray = {
    unfoldr: /* @__PURE__ */ unfoldrArrayImpl(isNothing)(fromJust3)(fst)(snd),
    Unfoldable10: function() {
      return unfoldable1Array;
    }
  };

  // output/Data.List.Types/index.js
  var identity4 = /* @__PURE__ */ identity(categoryFn);
  var Nil = /* @__PURE__ */ (function() {
    function Nil2() {
    }
    ;
    Nil2.value = new Nil2();
    return Nil2;
  })();
  var Cons = /* @__PURE__ */ (function() {
    function Cons2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    Cons2.create = function(value0) {
      return function(value1) {
        return new Cons2(value0, value1);
      };
    };
    return Cons2;
  })();
  var listMap = function(f) {
    var chunkedRevMap = function($copy_v) {
      return function($copy_v1) {
        var $tco_var_v = $copy_v;
        var $tco_done = false;
        var $tco_result;
        function $tco_loop(v, v1) {
          if (v1 instanceof Cons && (v1.value1 instanceof Cons && v1.value1.value1 instanceof Cons)) {
            $tco_var_v = new Cons(v1, v);
            $copy_v1 = v1.value1.value1.value1;
            return;
          }
          ;
          var unrolledMap = function(v2) {
            if (v2 instanceof Cons && (v2.value1 instanceof Cons && v2.value1.value1 instanceof Nil)) {
              return new Cons(f(v2.value0), new Cons(f(v2.value1.value0), Nil.value));
            }
            ;
            if (v2 instanceof Cons && v2.value1 instanceof Nil) {
              return new Cons(f(v2.value0), Nil.value);
            }
            ;
            return Nil.value;
          };
          var reverseUnrolledMap = function($copy_v2) {
            return function($copy_v3) {
              var $tco_var_v2 = $copy_v2;
              var $tco_done1 = false;
              var $tco_result2;
              function $tco_loop2(v2, v3) {
                if (v2 instanceof Cons && (v2.value0 instanceof Cons && (v2.value0.value1 instanceof Cons && v2.value0.value1.value1 instanceof Cons))) {
                  $tco_var_v2 = v2.value1;
                  $copy_v3 = new Cons(f(v2.value0.value0), new Cons(f(v2.value0.value1.value0), new Cons(f(v2.value0.value1.value1.value0), v3)));
                  return;
                }
                ;
                $tco_done1 = true;
                return v3;
              }
              ;
              while (!$tco_done1) {
                $tco_result2 = $tco_loop2($tco_var_v2, $copy_v3);
              }
              ;
              return $tco_result2;
            };
          };
          $tco_done = true;
          return reverseUnrolledMap(v)(unrolledMap(v1));
        }
        ;
        while (!$tco_done) {
          $tco_result = $tco_loop($tco_var_v, $copy_v1);
        }
        ;
        return $tco_result;
      };
    };
    return chunkedRevMap(Nil.value);
  };
  var functorList = {
    map: listMap
  };
  var foldableList = {
    foldr: function(f) {
      return function(b) {
        var rev3 = (function() {
          var go2 = function($copy_v) {
            return function($copy_v1) {
              var $tco_var_v = $copy_v;
              var $tco_done = false;
              var $tco_result;
              function $tco_loop(v, v1) {
                if (v1 instanceof Nil) {
                  $tco_done = true;
                  return v;
                }
                ;
                if (v1 instanceof Cons) {
                  $tco_var_v = new Cons(v1.value0, v);
                  $copy_v1 = v1.value1;
                  return;
                }
                ;
                throw new Error("Failed pattern match at Data.List.Types (line 107, column 7 - line 107, column 23): " + [v.constructor.name, v1.constructor.name]);
              }
              ;
              while (!$tco_done) {
                $tco_result = $tco_loop($tco_var_v, $copy_v1);
              }
              ;
              return $tco_result;
            };
          };
          return go2(Nil.value);
        })();
        var $284 = foldl(foldableList)(flip(f))(b);
        return function($285) {
          return $284(rev3($285));
        };
      };
    },
    foldl: function(f) {
      var go2 = function($copy_b) {
        return function($copy_v) {
          var $tco_var_b = $copy_b;
          var $tco_done1 = false;
          var $tco_result;
          function $tco_loop(b, v) {
            if (v instanceof Nil) {
              $tco_done1 = true;
              return b;
            }
            ;
            if (v instanceof Cons) {
              $tco_var_b = f(b)(v.value0);
              $copy_v = v.value1;
              return;
            }
            ;
            throw new Error("Failed pattern match at Data.List.Types (line 111, column 12 - line 113, column 30): " + [v.constructor.name]);
          }
          ;
          while (!$tco_done1) {
            $tco_result = $tco_loop($tco_var_b, $copy_v);
          }
          ;
          return $tco_result;
        };
      };
      return go2;
    },
    foldMap: function(dictMonoid) {
      var append23 = append(dictMonoid.Semigroup0());
      var mempty2 = mempty(dictMonoid);
      return function(f) {
        return foldl(foldableList)(function(acc) {
          var $286 = append23(acc);
          return function($287) {
            return $286(f($287));
          };
        })(mempty2);
      };
    }
  };
  var foldl2 = /* @__PURE__ */ foldl(foldableList);
  var traversableList = {
    traverse: function(dictApplicative) {
      var Apply0 = dictApplicative.Apply0();
      var map12 = map(Apply0.Functor0());
      var lift22 = lift2(Apply0);
      var pure1 = pure(dictApplicative);
      return function(f) {
        var $301 = map12(foldl2(flip(Cons.create))(Nil.value));
        var $302 = foldl2(function(acc) {
          var $304 = lift22(flip(Cons.create))(acc);
          return function($305) {
            return $304(f($305));
          };
        })(pure1(Nil.value));
        return function($303) {
          return $301($302($303));
        };
      };
    },
    sequence: function(dictApplicative) {
      return traverse(traversableList)(dictApplicative)(identity4);
    },
    Functor0: function() {
      return functorList;
    },
    Foldable1: function() {
      return foldableList;
    }
  };

  // output/Data.List/index.js
  var map3 = /* @__PURE__ */ map(functorMaybe);
  var foldl3 = /* @__PURE__ */ foldl(foldableList);
  var uncons = function(v) {
    if (v instanceof Nil) {
      return Nothing.value;
    }
    ;
    if (v instanceof Cons) {
      return new Just({
        head: v.value0,
        tail: v.value1
      });
    }
    ;
    throw new Error("Failed pattern match at Data.List (line 259, column 1 - line 259, column 66): " + [v.constructor.name]);
  };
  var toUnfoldable = function(dictUnfoldable) {
    return unfoldr(dictUnfoldable)(function(xs) {
      return map3(function(rec) {
        return new Tuple(rec.head, rec.tail);
      })(uncons(xs));
    });
  };
  var reverse = /* @__PURE__ */ (function() {
    var go2 = function($copy_v) {
      return function($copy_v1) {
        var $tco_var_v = $copy_v;
        var $tco_done = false;
        var $tco_result;
        function $tco_loop(v, v1) {
          if (v1 instanceof Nil) {
            $tco_done = true;
            return v;
          }
          ;
          if (v1 instanceof Cons) {
            $tco_var_v = new Cons(v1.value0, v);
            $copy_v1 = v1.value1;
            return;
          }
          ;
          throw new Error("Failed pattern match at Data.List (line 368, column 3 - line 368, column 19): " + [v.constructor.name, v1.constructor.name]);
        }
        ;
        while (!$tco_done) {
          $tco_result = $tco_loop($tco_var_v, $copy_v1);
        }
        ;
        return $tco_result;
      };
    };
    return go2(Nil.value);
  })();
  var zipWith = function(f) {
    return function(xs) {
      return function(ys) {
        var go2 = function($copy_v) {
          return function($copy_v1) {
            return function($copy_v2) {
              var $tco_var_v = $copy_v;
              var $tco_var_v1 = $copy_v1;
              var $tco_done = false;
              var $tco_result;
              function $tco_loop(v, v1, v2) {
                if (v instanceof Nil) {
                  $tco_done = true;
                  return v2;
                }
                ;
                if (v1 instanceof Nil) {
                  $tco_done = true;
                  return v2;
                }
                ;
                if (v instanceof Cons && v1 instanceof Cons) {
                  $tco_var_v = v.value1;
                  $tco_var_v1 = v1.value1;
                  $copy_v2 = new Cons(f(v.value0)(v1.value0), v2);
                  return;
                }
                ;
                throw new Error("Failed pattern match at Data.List (line 779, column 3 - line 779, column 21): " + [v.constructor.name, v1.constructor.name, v2.constructor.name]);
              }
              ;
              while (!$tco_done) {
                $tco_result = $tco_loop($tco_var_v, $tco_var_v1, $copy_v2);
              }
              ;
              return $tco_result;
            };
          };
        };
        return reverse(go2(xs)(ys)(Nil.value));
      };
    };
  };
  var length2 = /* @__PURE__ */ foldl3(function(acc) {
    return function(v) {
      return acc + 1 | 0;
    };
  })(0);
  var fromFoldable = function(dictFoldable) {
    return foldr(dictFoldable)(Cons.create)(Nil.value);
  };

  // output/Data.Lazy/foreign.js
  var defer2 = function(thunk) {
    var v = null;
    return function() {
      if (thunk === void 0) return v;
      v = thunk();
      thunk = void 0;
      return v;
    };
  };
  var force = function(l) {
    return l();
  };

  // output/Control.Comonad.Cofree/index.js
  var tail = function(v) {
    return snd(force(v));
  };
  var mkCofree = function(a) {
    return function(t) {
      return defer2(function(v) {
        return new Tuple(a, t);
      });
    };
  };
  var head = function(v) {
    return fst(force(v));
  };
  var foldableCofree = function(dictFoldable) {
    var foldr2 = foldr(dictFoldable);
    var foldl5 = foldl(dictFoldable);
    var foldMap2 = foldMap(dictFoldable);
    return {
      foldr: function(f) {
        var go2 = function(fa) {
          return function(b) {
            return f(head(fa))(foldr2(go2)(b)(tail(fa)));
          };
        };
        return flip(go2);
      },
      foldl: function(f) {
        var go2 = function(b) {
          return function(fa) {
            return foldl5(go2)(f(b)(head(fa)))(tail(fa));
          };
        };
        return go2;
      },
      foldMap: function(dictMonoid) {
        var append3 = append(dictMonoid.Semigroup0());
        var foldMap1 = foldMap2(dictMonoid);
        return function(f) {
          var go2 = function(fa) {
            return append3(f(head(fa)))(foldMap1(go2)(tail(fa)));
          };
          return go2;
        };
      }
    };
  };

  // output/Data.Array/foreign.js
  var replicateFill = function(count, value12) {
    if (count < 1) {
      return [];
    }
    var result = new Array(count);
    return result.fill(value12);
  };
  var replicatePolyfill = function(count, value12) {
    var result = [];
    var n = 0;
    for (var i = 0; i < count; i++) {
      result[n++] = value12;
    }
    return result;
  };
  var replicateImpl = typeof Array.prototype.fill === "function" ? replicateFill : replicatePolyfill;
  var fromFoldableImpl = /* @__PURE__ */ (function() {
    function Cons2(head3, tail2) {
      this.head = head3;
      this.tail = tail2;
    }
    var emptyList = {};
    function curryCons(head3) {
      return function(tail2) {
        return new Cons2(head3, tail2);
      };
    }
    function listToArray(list) {
      var result = [];
      var count = 0;
      var xs = list;
      while (xs !== emptyList) {
        result[count++] = xs.head;
        xs = xs.tail;
      }
      return result;
    }
    return function(foldr2, xs) {
      return listToArray(foldr2(curryCons)(emptyList)(xs));
    };
  })();
  var length4 = function(xs) {
    return xs.length;
  };
  var unconsImpl = function(empty7, next, xs) {
    return xs.length === 0 ? empty7({}) : next(xs[0])(xs.slice(1));
  };
  var indexImpl = function(just, nothing, xs, i) {
    return i < 0 || i >= xs.length ? nothing : just(xs[i]);
  };
  var findIndexImpl = function(just, nothing, f, xs) {
    for (var i = 0, l = xs.length; i < l; i++) {
      if (f(xs[i])) return just(i);
    }
    return nothing;
  };
  var reverse2 = function(l) {
    return l.slice().reverse();
  };
  var concat = function(xss) {
    if (xss.length <= 1e4) {
      return Array.prototype.concat.apply([], xss);
    }
    var result = [];
    for (var i = 0, l = xss.length; i < l; i++) {
      var xs = xss[i];
      for (var j = 0, m = xs.length; j < m; j++) {
        result.push(xs[j]);
      }
    }
    return result;
  };
  var filterImpl = function(f, xs) {
    return xs.filter(f);
  };
  var sliceImpl = function(s, e, l) {
    return l.slice(s, e);
  };
  var unsafeIndexImpl = function(xs, n) {
    return xs[n];
  };

  // output/Data.Function.Uncurried/foreign.js
  var runFn2 = function(fn) {
    return function(a) {
      return function(b) {
        return fn(a, b);
      };
    };
  };
  var runFn3 = function(fn) {
    return function(a) {
      return function(b) {
        return function(c) {
          return fn(a, b, c);
        };
      };
    };
  };
  var runFn4 = function(fn) {
    return function(a) {
      return function(b) {
        return function(c) {
          return function(d) {
            return fn(a, b, c, d);
          };
        };
      };
    };
  };

  // output/Data.Array/index.js
  var apply2 = /* @__PURE__ */ apply(applyMaybe);
  var map4 = /* @__PURE__ */ map(functorMaybe);
  var unsafeIndex2 = function() {
    return runFn2(unsafeIndexImpl);
  };
  var unsafeIndex1 = /* @__PURE__ */ unsafeIndex2();
  var uncons4 = /* @__PURE__ */ (function() {
    return runFn3(unconsImpl)($$const(Nothing.value))(function(x) {
      return function(xs) {
        return new Just({
          head: x,
          tail: xs
        });
      };
    });
  })();
  var slice = /* @__PURE__ */ runFn3(sliceImpl);
  var singleton3 = function(a) {
    return [a];
  };
  var $$null2 = function(xs) {
    return length4(xs) === 0;
  };
  var init = function(xs) {
    if ($$null2(xs)) {
      return Nothing.value;
    }
    ;
    if (otherwise) {
      return new Just(slice(0)(length4(xs) - 1 | 0)(xs));
    }
    ;
    throw new Error("Failed pattern match at Data.Array (line 351, column 1 - line 351, column 45): " + [xs.constructor.name]);
  };
  var index = /* @__PURE__ */ (function() {
    return runFn4(indexImpl)(Just.create)(Nothing.value);
  })();
  var last = function(xs) {
    return index(xs)(length4(xs) - 1 | 0);
  };
  var unsnoc = function(xs) {
    return apply2(map4(function(v) {
      return function(v1) {
        return {
          init: v,
          last: v1
        };
      };
    })(init(xs)))(last(xs));
  };
  var head2 = function(xs) {
    return index(xs)(0);
  };
  var fromFoldable2 = function(dictFoldable) {
    return runFn2(fromFoldableImpl)(foldr(dictFoldable));
  };
  var foldl4 = /* @__PURE__ */ foldl(foldableArray);
  var findIndex = /* @__PURE__ */ (function() {
    return runFn4(findIndexImpl)(Just.create)(Nothing.value);
  })();
  var find2 = function(f) {
    return function(xs) {
      return map4(unsafeIndex1(xs))(findIndex(f)(xs));
    };
  };
  var filter = /* @__PURE__ */ runFn2(filterImpl);
  var concatMap = /* @__PURE__ */ flip(/* @__PURE__ */ bind(bindArray));
  var mapMaybe = function(f) {
    return concatMap((function() {
      var $189 = maybe([])(singleton3);
      return function($190) {
        return $189(f($190));
      };
    })());
  };

  // output/Data.Int/foreign.js
  var toNumber = function(n) {
    return n;
  };

  // output/Data.Map.Internal/index.js
  var $runtime_lazy2 = function(name15, moduleName, init2) {
    var state3 = 0;
    var val;
    return function(lineNumber) {
      if (state3 === 2) return val;
      if (state3 === 1) throw new ReferenceError(name15 + " was needed before it finished initializing (module " + moduleName + ", line " + lineNumber + ")", moduleName, lineNumber);
      state3 = 1;
      val = init2();
      state3 = 2;
      return val;
    };
  };
  var Leaf = /* @__PURE__ */ (function() {
    function Leaf2() {
    }
    ;
    Leaf2.value = new Leaf2();
    return Leaf2;
  })();
  var Node = /* @__PURE__ */ (function() {
    function Node2(value0, value1, value22, value32, value42, value52) {
      this.value0 = value0;
      this.value1 = value1;
      this.value2 = value22;
      this.value3 = value32;
      this.value4 = value42;
      this.value5 = value52;
    }
    ;
    Node2.create = function(value0) {
      return function(value1) {
        return function(value22) {
          return function(value32) {
            return function(value42) {
              return function(value52) {
                return new Node2(value0, value1, value22, value32, value42, value52);
              };
            };
          };
        };
      };
    };
    return Node2;
  })();
  var Split = /* @__PURE__ */ (function() {
    function Split2(value0, value1, value22) {
      this.value0 = value0;
      this.value1 = value1;
      this.value2 = value22;
    }
    ;
    Split2.create = function(value0) {
      return function(value1) {
        return function(value22) {
          return new Split2(value0, value1, value22);
        };
      };
    };
    return Split2;
  })();
  var SplitLast = /* @__PURE__ */ (function() {
    function SplitLast2(value0, value1, value22) {
      this.value0 = value0;
      this.value1 = value1;
      this.value2 = value22;
    }
    ;
    SplitLast2.create = function(value0) {
      return function(value1) {
        return function(value22) {
          return new SplitLast2(value0, value1, value22);
        };
      };
    };
    return SplitLast2;
  })();
  var unsafeNode = function(k, v, l, r) {
    if (l instanceof Leaf) {
      if (r instanceof Leaf) {
        return new Node(1, 1, k, v, l, r);
      }
      ;
      if (r instanceof Node) {
        return new Node(1 + r.value0 | 0, 1 + r.value1 | 0, k, v, l, r);
      }
      ;
      throw new Error("Failed pattern match at Data.Map.Internal (line 702, column 5 - line 706, column 39): " + [r.constructor.name]);
    }
    ;
    if (l instanceof Node) {
      if (r instanceof Leaf) {
        return new Node(1 + l.value0 | 0, 1 + l.value1 | 0, k, v, l, r);
      }
      ;
      if (r instanceof Node) {
        return new Node(1 + (function() {
          var $280 = l.value0 > r.value0;
          if ($280) {
            return l.value0;
          }
          ;
          return r.value0;
        })() | 0, (1 + l.value1 | 0) + r.value1 | 0, k, v, l, r);
      }
      ;
      throw new Error("Failed pattern match at Data.Map.Internal (line 708, column 5 - line 712, column 68): " + [r.constructor.name]);
    }
    ;
    throw new Error("Failed pattern match at Data.Map.Internal (line 700, column 32 - line 712, column 68): " + [l.constructor.name]);
  };
  var singleton4 = function(k) {
    return function(v) {
      return new Node(1, 1, k, v, Leaf.value, Leaf.value);
    };
  };
  var unsafeBalancedNode = /* @__PURE__ */ (function() {
    var height8 = function(v) {
      if (v instanceof Leaf) {
        return 0;
      }
      ;
      if (v instanceof Node) {
        return v.value0;
      }
      ;
      throw new Error("Failed pattern match at Data.Map.Internal (line 757, column 12 - line 759, column 26): " + [v.constructor.name]);
    };
    var rotateLeft = function(k, v, l, rk, rv, rl, rr) {
      if (rl instanceof Node && rl.value0 > height8(rr)) {
        return unsafeNode(rl.value2, rl.value3, unsafeNode(k, v, l, rl.value4), unsafeNode(rk, rv, rl.value5, rr));
      }
      ;
      return unsafeNode(rk, rv, unsafeNode(k, v, l, rl), rr);
    };
    var rotateRight = function(k, v, lk, lv, ll, lr, r) {
      if (lr instanceof Node && height8(ll) <= lr.value0) {
        return unsafeNode(lr.value2, lr.value3, unsafeNode(lk, lv, ll, lr.value4), unsafeNode(k, v, lr.value5, r));
      }
      ;
      return unsafeNode(lk, lv, ll, unsafeNode(k, v, lr, r));
    };
    return function(k, v, l, r) {
      if (l instanceof Leaf) {
        if (r instanceof Leaf) {
          return singleton4(k)(v);
        }
        ;
        if (r instanceof Node && r.value0 > 1) {
          return rotateLeft(k, v, l, r.value2, r.value3, r.value4, r.value5);
        }
        ;
        return unsafeNode(k, v, l, r);
      }
      ;
      if (l instanceof Node) {
        if (r instanceof Node) {
          if (r.value0 > (l.value0 + 1 | 0)) {
            return rotateLeft(k, v, l, r.value2, r.value3, r.value4, r.value5);
          }
          ;
          if (l.value0 > (r.value0 + 1 | 0)) {
            return rotateRight(k, v, l.value2, l.value3, l.value4, l.value5, r);
          }
          ;
        }
        ;
        if (r instanceof Leaf && l.value0 > 1) {
          return rotateRight(k, v, l.value2, l.value3, l.value4, l.value5, r);
        }
        ;
        return unsafeNode(k, v, l, r);
      }
      ;
      throw new Error("Failed pattern match at Data.Map.Internal (line 717, column 40 - line 738, column 34): " + [l.constructor.name]);
    };
  })();
  var $lazy_unsafeSplit = /* @__PURE__ */ $runtime_lazy2("unsafeSplit", "Data.Map.Internal", function() {
    return function(comp, k, m) {
      if (m instanceof Leaf) {
        return new Split(Nothing.value, Leaf.value, Leaf.value);
      }
      ;
      if (m instanceof Node) {
        var v = comp(k)(m.value2);
        if (v instanceof LT) {
          var v1 = $lazy_unsafeSplit(793)(comp, k, m.value4);
          return new Split(v1.value0, v1.value1, unsafeBalancedNode(m.value2, m.value3, v1.value2, m.value5));
        }
        ;
        if (v instanceof GT) {
          var v1 = $lazy_unsafeSplit(796)(comp, k, m.value5);
          return new Split(v1.value0, unsafeBalancedNode(m.value2, m.value3, m.value4, v1.value1), v1.value2);
        }
        ;
        if (v instanceof EQ) {
          return new Split(new Just(m.value3), m.value4, m.value5);
        }
        ;
        throw new Error("Failed pattern match at Data.Map.Internal (line 791, column 5 - line 799, column 30): " + [v.constructor.name]);
      }
      ;
      throw new Error("Failed pattern match at Data.Map.Internal (line 787, column 34 - line 799, column 30): " + [m.constructor.name]);
    };
  });
  var unsafeSplit = /* @__PURE__ */ $lazy_unsafeSplit(786);
  var $lazy_unsafeSplitLast = /* @__PURE__ */ $runtime_lazy2("unsafeSplitLast", "Data.Map.Internal", function() {
    return function(k, v, l, r) {
      if (r instanceof Leaf) {
        return new SplitLast(k, v, l);
      }
      ;
      if (r instanceof Node) {
        var v1 = $lazy_unsafeSplitLast(779)(r.value2, r.value3, r.value4, r.value5);
        return new SplitLast(v1.value0, v1.value1, unsafeBalancedNode(k, v, l, v1.value2));
      }
      ;
      throw new Error("Failed pattern match at Data.Map.Internal (line 776, column 37 - line 780, column 57): " + [r.constructor.name]);
    };
  });
  var unsafeSplitLast = /* @__PURE__ */ $lazy_unsafeSplitLast(775);
  var unsafeJoinNodes = function(v, v1) {
    if (v instanceof Leaf) {
      return v1;
    }
    ;
    if (v instanceof Node) {
      var v2 = unsafeSplitLast(v.value2, v.value3, v.value4, v.value5);
      return unsafeBalancedNode(v2.value0, v2.value1, v2.value2, v1);
    }
    ;
    throw new Error("Failed pattern match at Data.Map.Internal (line 764, column 25 - line 768, column 38): " + [v.constructor.name, v1.constructor.name]);
  };
  var $lazy_unsafeDifference = /* @__PURE__ */ $runtime_lazy2("unsafeDifference", "Data.Map.Internal", function() {
    return function(comp, l, r) {
      if (l instanceof Leaf) {
        return Leaf.value;
      }
      ;
      if (r instanceof Leaf) {
        return l;
      }
      ;
      if (r instanceof Node) {
        var v = unsafeSplit(comp, r.value2, l);
        var l$prime = $lazy_unsafeDifference(841)(comp, v.value1, r.value4);
        var r$prime = $lazy_unsafeDifference(842)(comp, v.value2, r.value5);
        return unsafeJoinNodes(l$prime, r$prime);
      }
      ;
      throw new Error("Failed pattern match at Data.Map.Internal (line 836, column 39 - line 843, column 33): " + [l.constructor.name, r.constructor.name]);
    };
  });
  var unsafeDifference = /* @__PURE__ */ $lazy_unsafeDifference(835);
  var $lazy_unsafeIntersectionWith = /* @__PURE__ */ $runtime_lazy2("unsafeIntersectionWith", "Data.Map.Internal", function() {
    return function(comp, app, l, r) {
      if (l instanceof Leaf) {
        return Leaf.value;
      }
      ;
      if (r instanceof Leaf) {
        return Leaf.value;
      }
      ;
      if (r instanceof Node) {
        var v = unsafeSplit(comp, r.value2, l);
        var l$prime = $lazy_unsafeIntersectionWith(825)(comp, app, v.value1, r.value4);
        var r$prime = $lazy_unsafeIntersectionWith(826)(comp, app, v.value2, r.value5);
        if (v.value0 instanceof Just) {
          return unsafeBalancedNode(r.value2, app(v.value0.value0)(r.value3), l$prime, r$prime);
        }
        ;
        if (v.value0 instanceof Nothing) {
          return unsafeJoinNodes(l$prime, r$prime);
        }
        ;
        throw new Error("Failed pattern match at Data.Map.Internal (line 827, column 5 - line 831, column 37): " + [v.value0.constructor.name]);
      }
      ;
      throw new Error("Failed pattern match at Data.Map.Internal (line 820, column 49 - line 831, column 37): " + [l.constructor.name, r.constructor.name]);
    };
  });
  var unsafeIntersectionWith = /* @__PURE__ */ $lazy_unsafeIntersectionWith(819);
  var $lazy_unsafeUnionWith = /* @__PURE__ */ $runtime_lazy2("unsafeUnionWith", "Data.Map.Internal", function() {
    return function(comp, app, l, r) {
      if (l instanceof Leaf) {
        return r;
      }
      ;
      if (r instanceof Leaf) {
        return l;
      }
      ;
      if (r instanceof Node) {
        var v = unsafeSplit(comp, r.value2, l);
        var l$prime = $lazy_unsafeUnionWith(809)(comp, app, v.value1, r.value4);
        var r$prime = $lazy_unsafeUnionWith(810)(comp, app, v.value2, r.value5);
        if (v.value0 instanceof Just) {
          return unsafeBalancedNode(r.value2, app(v.value0.value0)(r.value3), l$prime, r$prime);
        }
        ;
        if (v.value0 instanceof Nothing) {
          return unsafeBalancedNode(r.value2, r.value3, l$prime, r$prime);
        }
        ;
        throw new Error("Failed pattern match at Data.Map.Internal (line 811, column 5 - line 815, column 46): " + [v.value0.constructor.name]);
      }
      ;
      throw new Error("Failed pattern match at Data.Map.Internal (line 804, column 42 - line 815, column 46): " + [l.constructor.name, r.constructor.name]);
    };
  });
  var unsafeUnionWith = /* @__PURE__ */ $lazy_unsafeUnionWith(803);
  var unionWith = function(dictOrd) {
    var compare2 = compare(dictOrd);
    return function(app) {
      return function(m1) {
        return function(m2) {
          return unsafeUnionWith(compare2, app, m1, m2);
        };
      };
    };
  };
  var union = function(dictOrd) {
    return unionWith(dictOrd)($$const);
  };
  var member = function(dictOrd) {
    var compare2 = compare(dictOrd);
    return function(k) {
      var go2 = function($copy_v) {
        var $tco_done = false;
        var $tco_result;
        function $tco_loop(v) {
          if (v instanceof Leaf) {
            $tco_done = true;
            return false;
          }
          ;
          if (v instanceof Node) {
            var v1 = compare2(k)(v.value2);
            if (v1 instanceof LT) {
              $copy_v = v.value4;
              return;
            }
            ;
            if (v1 instanceof GT) {
              $copy_v = v.value5;
              return;
            }
            ;
            if (v1 instanceof EQ) {
              $tco_done = true;
              return true;
            }
            ;
            throw new Error("Failed pattern match at Data.Map.Internal (line 459, column 7 - line 462, column 19): " + [v1.constructor.name]);
          }
          ;
          throw new Error("Failed pattern match at Data.Map.Internal (line 456, column 8 - line 462, column 19): " + [v.constructor.name]);
        }
        ;
        while (!$tco_done) {
          $tco_result = $tco_loop($copy_v);
        }
        ;
        return $tco_result;
      };
      return go2;
    };
  };
  var intersectionWith = function(dictOrd) {
    var compare2 = compare(dictOrd);
    return function(app) {
      return function(m1) {
        return function(m2) {
          return unsafeIntersectionWith(compare2, app, m1, m2);
        };
      };
    };
  };
  var intersection = function(dictOrd) {
    return intersectionWith(dictOrd)($$const);
  };
  var insert = function(dictOrd) {
    var compare2 = compare(dictOrd);
    return function(k) {
      return function(v) {
        var go2 = function(v1) {
          if (v1 instanceof Leaf) {
            return singleton4(k)(v);
          }
          ;
          if (v1 instanceof Node) {
            var v2 = compare2(k)(v1.value2);
            if (v2 instanceof LT) {
              return unsafeBalancedNode(v1.value2, v1.value3, go2(v1.value4), v1.value5);
            }
            ;
            if (v2 instanceof GT) {
              return unsafeBalancedNode(v1.value2, v1.value3, v1.value4, go2(v1.value5));
            }
            ;
            if (v2 instanceof EQ) {
              return new Node(v1.value0, v1.value1, k, v, v1.value4, v1.value5);
            }
            ;
            throw new Error("Failed pattern match at Data.Map.Internal (line 471, column 7 - line 474, column 35): " + [v2.constructor.name]);
          }
          ;
          throw new Error("Failed pattern match at Data.Map.Internal (line 468, column 8 - line 474, column 35): " + [v1.constructor.name]);
        };
        return go2;
      };
    };
  };
  var functorMap = {
    map: function(f) {
      var go2 = function(v) {
        if (v instanceof Leaf) {
          return Leaf.value;
        }
        ;
        if (v instanceof Node) {
          return new Node(v.value0, v.value1, v.value2, f(v.value3), go2(v.value4), go2(v.value5));
        }
        ;
        throw new Error("Failed pattern match at Data.Map.Internal (line 147, column 10 - line 150, column 39): " + [v.constructor.name]);
      };
      return go2;
    }
  };
  var foldableMap = {
    foldr: function(f) {
      return function(z) {
        var $lazy_go = $runtime_lazy2("go", "Data.Map.Internal", function() {
          return function(m$prime, z$prime) {
            if (m$prime instanceof Leaf) {
              return z$prime;
            }
            ;
            if (m$prime instanceof Node) {
              return $lazy_go(172)(m$prime.value4, f(m$prime.value3)($lazy_go(172)(m$prime.value5, z$prime)));
            }
            ;
            throw new Error("Failed pattern match at Data.Map.Internal (line 169, column 26 - line 172, column 43): " + [m$prime.constructor.name]);
          };
        });
        var go2 = $lazy_go(169);
        return function(m) {
          return go2(m, z);
        };
      };
    },
    foldl: function(f) {
      return function(z) {
        var $lazy_go = $runtime_lazy2("go", "Data.Map.Internal", function() {
          return function(z$prime, m$prime) {
            if (m$prime instanceof Leaf) {
              return z$prime;
            }
            ;
            if (m$prime instanceof Node) {
              return $lazy_go(178)(f($lazy_go(178)(z$prime, m$prime.value4))(m$prime.value3), m$prime.value5);
            }
            ;
            throw new Error("Failed pattern match at Data.Map.Internal (line 175, column 26 - line 178, column 43): " + [m$prime.constructor.name]);
          };
        });
        var go2 = $lazy_go(175);
        return function(m) {
          return go2(z, m);
        };
      };
    },
    foldMap: function(dictMonoid) {
      var mempty2 = mempty(dictMonoid);
      var append12 = append(dictMonoid.Semigroup0());
      return function(f) {
        var go2 = function(v) {
          if (v instanceof Leaf) {
            return mempty2;
          }
          ;
          if (v instanceof Node) {
            return append12(go2(v.value4))(append12(f(v.value3))(go2(v.value5)));
          }
          ;
          throw new Error("Failed pattern match at Data.Map.Internal (line 181, column 10 - line 184, column 28): " + [v.constructor.name]);
        };
        return go2;
      };
    }
  };
  var foldableWithIndexMap = {
    foldrWithIndex: function(f) {
      return function(z) {
        var $lazy_go = $runtime_lazy2("go", "Data.Map.Internal", function() {
          return function(m$prime, z$prime) {
            if (m$prime instanceof Leaf) {
              return z$prime;
            }
            ;
            if (m$prime instanceof Node) {
              return $lazy_go(192)(m$prime.value4, f(m$prime.value2)(m$prime.value3)($lazy_go(192)(m$prime.value5, z$prime)));
            }
            ;
            throw new Error("Failed pattern match at Data.Map.Internal (line 189, column 26 - line 192, column 45): " + [m$prime.constructor.name]);
          };
        });
        var go2 = $lazy_go(189);
        return function(m) {
          return go2(m, z);
        };
      };
    },
    foldlWithIndex: function(f) {
      return function(z) {
        var $lazy_go = $runtime_lazy2("go", "Data.Map.Internal", function() {
          return function(z$prime, m$prime) {
            if (m$prime instanceof Leaf) {
              return z$prime;
            }
            ;
            if (m$prime instanceof Node) {
              return $lazy_go(198)(f(m$prime.value2)($lazy_go(198)(z$prime, m$prime.value4))(m$prime.value3), m$prime.value5);
            }
            ;
            throw new Error("Failed pattern match at Data.Map.Internal (line 195, column 26 - line 198, column 45): " + [m$prime.constructor.name]);
          };
        });
        var go2 = $lazy_go(195);
        return function(m) {
          return go2(z, m);
        };
      };
    },
    foldMapWithIndex: function(dictMonoid) {
      var mempty2 = mempty(dictMonoid);
      var append12 = append(dictMonoid.Semigroup0());
      return function(f) {
        var go2 = function(v) {
          if (v instanceof Leaf) {
            return mempty2;
          }
          ;
          if (v instanceof Node) {
            return append12(go2(v.value4))(append12(f(v.value2)(v.value3))(go2(v.value5)));
          }
          ;
          throw new Error("Failed pattern match at Data.Map.Internal (line 201, column 10 - line 204, column 30): " + [v.constructor.name]);
        };
        return go2;
      };
    },
    Foldable0: function() {
      return foldableMap;
    }
  };
  var keys = /* @__PURE__ */ (function() {
    return foldrWithIndex(foldableWithIndexMap)(function(k) {
      return function(v) {
        return function(acc) {
          return new Cons(k, acc);
        };
      };
    })(Nil.value);
  })();
  var empty4 = /* @__PURE__ */ (function() {
    return Leaf.value;
  })();
  var difference = function(dictOrd) {
    var compare2 = compare(dictOrd);
    return function(m1) {
      return function(m2) {
        return unsafeDifference(compare2, m1, m2);
      };
    };
  };

  // output/Data.Set/index.js
  var coerce2 = /* @__PURE__ */ coerce();
  var $$Set = function(x) {
    return x;
  };
  var toList = function(v) {
    return keys(v);
  };
  var toUnfoldable2 = function(dictUnfoldable) {
    var $96 = toUnfoldable(dictUnfoldable);
    return function($97) {
      return $96(toList($97));
    };
  };
  var toUnfoldable1 = /* @__PURE__ */ toUnfoldable2(unfoldableArray);
  var showSet = function(dictShow) {
    var show4 = show(showArray(dictShow));
    return {
      show: function(s) {
        return "(fromFoldable " + (show4(toUnfoldable1(s)) + ")");
      }
    };
  };
  var member2 = function(dictOrd) {
    return coerce2(member(dictOrd));
  };
  var intersection2 = function(dictOrd) {
    return coerce2(intersection(dictOrd));
  };
  var insert2 = function(dictOrd) {
    var insert1 = insert(dictOrd);
    return function(a) {
      return function(v) {
        return insert1(a)(unit)(v);
      };
    };
  };
  var fromMap = $$Set;
  var empty5 = empty4;
  var fromFoldable3 = function(dictFoldable) {
    var foldl22 = foldl(dictFoldable);
    return function(dictOrd) {
      var insert1 = insert2(dictOrd);
      return foldl22(function(m) {
        return function(a) {
          return insert1(a)(m);
        };
      })(empty5);
    };
  };
  var difference2 = function(dictOrd) {
    return coerce2(difference(dictOrd));
  };

  // output/Data.Map/index.js
  var keys2 = /* @__PURE__ */ (function() {
    var $38 = $$void(functorMap);
    return function($39) {
      return fromMap($38($39));
    };
  })();

  // output/Data.String.CodeUnits/foreign.js
  var take = function(n) {
    return function(s) {
      return s.substr(0, n);
    };
  };

  // output/Data.Tree/index.js
  var mkTree = mkCofree;

  // output/DataViz.Layout.Hierarchy.Tree/index.js
  var map5 = /* @__PURE__ */ map(functorList);
  var fromFoldable5 = /* @__PURE__ */ fromFoldable2(foldableList);
  var add2 = /* @__PURE__ */ add(semiringNumber);
  var fromFoldable22 = /* @__PURE__ */ fromFoldable2(/* @__PURE__ */ foldableCofree(foldableList));
  var map1 = /* @__PURE__ */ map(functorArray);
  var maximum2 = /* @__PURE__ */ maximum(ordNumber)(foldableArray);
  var minimum2 = /* @__PURE__ */ minimum(ordNumber)(foldableArray);
  var scanl2 = /* @__PURE__ */ scanl(traversableList);
  var Contours = /* @__PURE__ */ (function() {
    function Contours2(value0) {
      this.value0 = value0;
    }
    ;
    Contours2.create = function(value0) {
      return new Contours2(value0);
    };
    return Contours2;
  })();
  var singletonContours = /* @__PURE__ */ (function() {
    return new Contours({
      left: new Cons(0, Nil.value),
      right: new Cons(0, Nil.value)
    });
  })();
  var scanContoursWithBase = function(baseSep) {
    return function(v) {
      return function(v1) {
        var go2 = function($copy_v2) {
          return function($copy_v3) {
            return function($copy_v4) {
              return function($copy_v5) {
                return function($copy_v6) {
                  var $tco_var_v2 = $copy_v2;
                  var $tco_var_v3 = $copy_v3;
                  var $tco_var_v4 = $copy_v4;
                  var $tco_var_v5 = $copy_v5;
                  var $tco_done = false;
                  var $tco_result;
                  function $tco_loop(v2, v3, v4, v5, v6) {
                    if (v5 instanceof Nil && v6 instanceof Nil) {
                      $tco_done = true;
                      return v2;
                    }
                    ;
                    if (v5 instanceof Nil && v6 instanceof Cons) {
                      var actualSep = v2 + v6.value0 - v3;
                      var neededSep = (function() {
                        var $96 = actualSep < baseSep;
                        if ($96) {
                          return v2 + (baseSep - actualSep);
                        }
                        ;
                        return v2;
                      })();
                      $tco_var_v2 = neededSep;
                      $tco_var_v3 = v3;
                      $tco_var_v4 = v6.value0;
                      $tco_var_v5 = Nil.value;
                      $copy_v6 = v6.value1;
                      return;
                    }
                    ;
                    if (v5 instanceof Cons && v6 instanceof Nil) {
                      var actualSep = v2 + v4 - v5.value0;
                      var neededSep = (function() {
                        var $99 = actualSep < baseSep;
                        if ($99) {
                          return v2 + (baseSep - actualSep);
                        }
                        ;
                        return v2;
                      })();
                      $tco_var_v2 = neededSep;
                      $tco_var_v3 = v5.value0;
                      $tco_var_v4 = v4;
                      $tco_var_v5 = v5.value1;
                      $copy_v6 = Nil.value;
                      return;
                    }
                    ;
                    if (v5 instanceof Cons && v6 instanceof Cons) {
                      var actualSep = v2 + v6.value0 - v5.value0;
                      var neededSep = (function() {
                        var $102 = actualSep < baseSep;
                        if ($102) {
                          return v2 + (baseSep - actualSep);
                        }
                        ;
                        return v2;
                      })();
                      $tco_var_v2 = neededSep;
                      $tco_var_v3 = v5.value0;
                      $tco_var_v4 = v6.value0;
                      $tco_var_v5 = v5.value1;
                      $copy_v6 = v6.value1;
                      return;
                    }
                    ;
                    throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 313, column 3 - line 313, column 67): " + [v2.constructor.name, v3.constructor.name, v4.constructor.name, v5.constructor.name, v6.constructor.name]);
                  }
                  ;
                  while (!$tco_done) {
                    $tco_result = $tco_loop($tco_var_v2, $tco_var_v3, $tco_var_v4, $tco_var_v5, $copy_v6);
                  }
                  ;
                  return $tco_result;
                };
              };
            };
          };
        };
        return go2(baseSep)(0)(0)(v.value0.right)(v1.value0.left);
      };
    };
  };
  var scaleToPixels = function(config) {
    return function(inputTree) {
      var layerScaleFn = fromMaybe(toNumber)(config.layerScale);
      var allNodes = fromFoldable22(inputTree);
      var allX = map1(function(n) {
        return n.x;
      })(allNodes);
      var maxX = fromMaybe(1)(maximum2(allX));
      var minX = fromMaybe(0)(minimum2(allX));
      var xRange = (function() {
        var $135 = maxX - minX === 0;
        if ($135) {
          return 1;
        }
        ;
        return maxX - minX;
      })();
      var scaleX = function(x) {
        return (x - minX) / xRange * config.size.width;
      };
      var scaledDepths = map1(function(n) {
        return layerScaleFn(n.depth);
      })(allNodes);
      var maxScaledDepth = fromMaybe(1)(maximum2(scaledDepths));
      var scaleY = function(depth) {
        if (config.layerSeparation instanceof Just) {
          return toNumber(depth) * config.layerSeparation.value0;
        }
        ;
        if (config.layerSeparation instanceof Nothing) {
          var scaledDepth = layerScaleFn(depth);
          return scaledDepth / maxScaledDepth * config.size.height;
        }
        ;
        throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 526, column 20 - line 532, column 63): " + [config.layerSeparation.constructor.name]);
      };
      var go2 = function(tr) {
        var val = head(tr);
        var cs = tail(tr);
        return mkTree((function() {
          var $138 = {};
          for (var $139 in val) {
            if ({}.hasOwnProperty.call(val, $139)) {
              $138[$139] = val[$139];
            }
            ;
          }
          ;
          $138.x = scaleX(val.x);
          $138.y = scaleY(val.depth);
          return $138;
        })())(map5(go2)(cs));
      };
      return go2(inputTree);
    };
  };
  var petrify = function(parentX) {
    return function(t) {
      var v = head(t);
      var nodeY = toNumber(v.value1.depth);
      var nodeX = parentX + v.value0.offset;
      var children2 = tail(t);
      var childrenWithCoords = map5(petrify(nodeX))(children2);
      return mkTree((function() {
        var $142 = {};
        for (var $143 in v.value1) {
          if ({}.hasOwnProperty.call(v.value1, $143)) {
            $142[$143] = v["value1"][$143];
          }
          ;
        }
        ;
        $142.x = nodeX;
        $142.y = nodeY;
        return $142;
      })())(childrenWithCoords);
    };
  };
  var mergeContoursRight = function(contours) {
    var mergeLevel = function(cs) {
      var currentLevels = mapMaybe(function(c) {
        if (c instanceof Cons) {
          return new Just(c.value0);
        }
        ;
        if (c instanceof Nil) {
          return Nothing.value;
        }
        ;
        throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 458, column 17 - line 460, column 27): " + [c.constructor.name]);
      })(cs);
      var v = head2(currentLevels);
      if (v instanceof Nothing) {
        return Nil.value;
      }
      ;
      if (v instanceof Just) {
        var restContours = mapMaybe(function(c) {
          if (c instanceof Cons) {
            return new Just(c.value1);
          }
          ;
          if (c instanceof Nil) {
            return Nothing.value;
          }
          ;
          throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 471, column 23 - line 473, column 33): " + [c.constructor.name]);
        })(cs);
        var maxVal = fromMaybe(0)(maximum2(currentLevels));
        return new Cons(maxVal, mergeLevel(restContours));
      }
      ;
      throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 464, column 7 - line 477, column 50): " + [v.constructor.name]);
    };
    if (contours.length === 0) {
      return Nil.value;
    }
    ;
    return mergeLevel(contours);
  };
  var mergeContoursLeft = function(contours) {
    var mergeLevel = function(cs) {
      var currentLevels = mapMaybe(function(c) {
        if (c instanceof Cons) {
          return new Just(c.value0);
        }
        ;
        if (c instanceof Nil) {
          return Nothing.value;
        }
        ;
        throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 425, column 17 - line 427, column 27): " + [c.constructor.name]);
      })(cs);
      var v = head2(currentLevels);
      if (v instanceof Nothing) {
        return Nil.value;
      }
      ;
      if (v instanceof Just) {
        var restContours = mapMaybe(function(c) {
          if (c instanceof Cons) {
            return new Just(c.value1);
          }
          ;
          if (c instanceof Nil) {
            return Nothing.value;
          }
          ;
          throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 438, column 23 - line 440, column 33): " + [c.constructor.name]);
        })(cs);
        var minVal = fromMaybe(0)(minimum2(currentLevels));
        return new Cons(minVal, mergeLevel(restContours));
      }
      ;
      throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 431, column 7 - line 444, column 50): " + [v.constructor.name]);
    };
    if (contours.length === 0) {
      return Nil.value;
    }
    ;
    return mergeLevel(contours);
  };
  var spliceContours = function(offsets) {
    return function(contours) {
      var v = fromFoldable5(zipWith(Tuple.create)(offsets)(contours));
      if (v.length === 0) {
        return singletonContours;
      }
      ;
      if (v.length === 1) {
        return new Contours({
          left: new Cons(0, map5(function(x) {
            return x + v[0].value0;
          })(v[0].value1.value0.left)),
          right: new Cons(0, map5(function(x) {
            return x + v[0].value0;
          })(v[0].value1.value0.right))
        });
      }
      ;
      var shiftedContours = map1(function(v1) {
        return new Contours({
          left: map5(function(x) {
            return x + v1.value0;
          })(v1.value1.value0.left),
          right: map5(function(x) {
            return x + v1.value0;
          })(v1.value1.value0.right)
        });
      })(v);
      var mergedRight = mergeContoursRight(map1(function(v1) {
        return v1.value0.right;
      })(shiftedContours));
      var mergedLeft = mergeContoursLeft(map1(function(v1) {
        return v1.value0.left;
      })(shiftedContours));
      return new Contours({
        left: new Cons(0, mergedLeft),
        right: new Cons(0, mergedRight)
      });
    };
  };
  var getRootData = function(t) {
    var v = head(t);
    return v.value1;
  };
  var defaultTreeConfig = /* @__PURE__ */ (function() {
    return {
      size: {
        width: 800,
        height: 600
      },
      minSeparation: 1,
      separation: Nothing.value,
      layerScale: Nothing.value,
      layerSeparation: Nothing.value
    };
  })();
  var computeSeparationsWithBase = function(baseSeps) {
    return function(contours) {
      var tailSafe = function(v2) {
        if (v2 instanceof Nil) {
          return Nil.value;
        }
        ;
        if (v2 instanceof Cons) {
          return v2.value1;
        }
        ;
        throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 301, column 3 - line 301, column 41): " + [v2.constructor.name]);
      };
      var applyBase = function(base) {
        return function(v2) {
          return scanContoursWithBase(base)(v2.value0)(v2.value1);
        };
      };
      var v = new Tuple(baseSeps, contours);
      if (v.value0 instanceof Nil) {
        return Nil.value;
      }
      ;
      if (v.value1 instanceof Nil) {
        return Nil.value;
      }
      ;
      if (v.value1 instanceof Cons && v.value1.value1 instanceof Nil) {
        return Nil.value;
      }
      ;
      var contourPairs = zipWith(Tuple.create)(contours)(tailSafe(contours));
      return zipWith(applyBase)(baseSeps)(contourPairs);
    };
  };
  var computeBaseSeparations = function(minSep) {
    return function(separationFn) {
      return function(nodes) {
        var tailSafe = function(v) {
          if (v instanceof Nil) {
            return Nil.value;
          }
          ;
          if (v instanceof Cons) {
            return v.value1;
          }
          ;
          throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 279, column 3 - line 279, column 41): " + [v.constructor.name]);
        };
        var getSep = function(v) {
          return function(v1) {
            return function(v2) {
              return function(v3) {
                if (v instanceof Nothing) {
                  return v1;
                }
                ;
                if (v instanceof Just) {
                  return v.value0(v2)(v3) + v1;
                }
                ;
                throw new Error("Failed pattern match at DataViz.Layout.Hierarchy.Tree (line 275, column 3 - line 275, column 67): " + [v.constructor.name, v1.constructor.name, v2.constructor.name, v3.constructor.name]);
              };
            };
          };
        };
        if (nodes instanceof Nil) {
          return Nil.value;
        }
        ;
        if (nodes instanceof Cons && nodes.value1 instanceof Nil) {
          return Nil.value;
        }
        ;
        return zipWith(getSep(separationFn)(minSep))(nodes)(tailSafe(nodes));
      };
    };
  };
  var render = function(minSep) {
    return function(separationFn) {
      return function(inputTree) {
        var updateOffset = function(tr) {
          return function(newOffset) {
            var v2 = head(tr);
            var children2 = tail(tr);
            return mkTree(new Tuple({
              offset: newOffset
            }, v2.value1))(children2);
          };
        };
        var renderWithContours = function(t) {
          var val = head(t);
          var children2 = tail(t);
          var childCount = length2(children2);
          if (childCount === 0) {
            return new Tuple(mkTree(new Tuple({
              offset: 0
            }, val))(Nil.value), singletonContours);
          }
          ;
          var childResults = map5(renderWithContours)(children2);
          var childTrees = map5(function(v2) {
            return v2.value0;
          })(childResults);
          var childRootData = map5(getRootData)(childTrees);
          var childContours = map5(function(v2) {
            return v2.value1;
          })(childResults);
          var baseSeparations = computeBaseSeparations(minSep)(separationFn)(childRootData);
          var separations = computeSeparationsWithBase(baseSeparations)(childContours);
          var childAbsoluteOffsets = new Cons(0, scanl2(add2)(0)(separations));
          var leftmostOffset = fromMaybe(0)(head2(fromFoldable5(childAbsoluteOffsets)));
          var rightmostOffset = fromMaybe(0)(last(fromFoldable5(childAbsoluteOffsets)));
          var parentOffset = (leftmostOffset + rightmostOffset) / 2;
          var childRelativeOffsets = map5(function(absOffset) {
            return absOffset - parentOffset;
          })(childAbsoluteOffsets);
          var childrenWithOffsets = zipWith(updateOffset)(childTrees)(childRelativeOffsets);
          var parentContours = spliceContours(childRelativeOffsets)(childContours);
          var resultTree = mkTree(new Tuple({
            offset: parentOffset
          }, val))(childrenWithOffsets);
          return new Tuple(resultTree, parentContours);
        };
        var v = renderWithContours(inputTree);
        return v.value0;
      };
    };
  };
  var addDepth = function(currentDepth) {
    return function(t) {
      var val = head(t);
      var children2 = tail(t);
      return mkTree((function() {
        var $279 = {};
        for (var $280 in val) {
          if ({}.hasOwnProperty.call(val, $280)) {
            $279[$280] = val[$280];
          }
          ;
        }
        ;
        $279.depth = currentDepth;
        return $279;
      })())(map5(addDepth(currentDepth + 1 | 0))(children2));
    };
  };
  var tree = function(config) {
    return function(inputTree) {
      var withDepth = addDepth(0)(inputTree);
      var rendered = render(config.minSeparation)(config.separation)(withDepth);
      var withCoords = petrify(0)(rendered);
      var scaled = scaleToPixels(config)(withCoords);
      return scaled;
    };
  };

  // output/Effect.Console/foreign.js
  var log2 = function(s) {
    return function() {
      console.log(s);
    };
  };

  // output/PSD3.Internal.Selection.Types/index.js
  var SVGContext = /* @__PURE__ */ (function() {
    function SVGContext2() {
    }
    ;
    SVGContext2.value = new SVGContext2();
    return SVGContext2;
  })();
  var HTMLContext = /* @__PURE__ */ (function() {
    function HTMLContext2() {
    }
    ;
    HTMLContext2.value = new HTMLContext2();
    return HTMLContext2;
  })();
  var Circle = /* @__PURE__ */ (function() {
    function Circle2() {
    }
    ;
    Circle2.value = new Circle2();
    return Circle2;
  })();
  var Rect = /* @__PURE__ */ (function() {
    function Rect2() {
    }
    ;
    Rect2.value = new Rect2();
    return Rect2;
  })();
  var Path = /* @__PURE__ */ (function() {
    function Path2() {
    }
    ;
    Path2.value = new Path2();
    return Path2;
  })();
  var Line = /* @__PURE__ */ (function() {
    function Line2() {
    }
    ;
    Line2.value = new Line2();
    return Line2;
  })();
  var Polygon = /* @__PURE__ */ (function() {
    function Polygon2() {
    }
    ;
    Polygon2.value = new Polygon2();
    return Polygon2;
  })();
  var Text = /* @__PURE__ */ (function() {
    function Text2() {
    }
    ;
    Text2.value = new Text2();
    return Text2;
  })();
  var Group = /* @__PURE__ */ (function() {
    function Group2() {
    }
    ;
    Group2.value = new Group2();
    return Group2;
  })();
  var SVG = /* @__PURE__ */ (function() {
    function SVG2() {
    }
    ;
    SVG2.value = new SVG2();
    return SVG2;
  })();
  var Defs = /* @__PURE__ */ (function() {
    function Defs2() {
    }
    ;
    Defs2.value = new Defs2();
    return Defs2;
  })();
  var LinearGradient = /* @__PURE__ */ (function() {
    function LinearGradient2() {
    }
    ;
    LinearGradient2.value = new LinearGradient2();
    return LinearGradient2;
  })();
  var Stop = /* @__PURE__ */ (function() {
    function Stop2() {
    }
    ;
    Stop2.value = new Stop2();
    return Stop2;
  })();
  var PatternFill = /* @__PURE__ */ (function() {
    function PatternFill2() {
    }
    ;
    PatternFill2.value = new PatternFill2();
    return PatternFill2;
  })();
  var Div = /* @__PURE__ */ (function() {
    function Div2() {
    }
    ;
    Div2.value = new Div2();
    return Div2;
  })();
  var Span = /* @__PURE__ */ (function() {
    function Span2() {
    }
    ;
    Span2.value = new Span2();
    return Span2;
  })();
  var Table = /* @__PURE__ */ (function() {
    function Table2() {
    }
    ;
    Table2.value = new Table2();
    return Table2;
  })();
  var Tr = /* @__PURE__ */ (function() {
    function Tr2() {
    }
    ;
    Tr2.value = new Tr2();
    return Tr2;
  })();
  var Td = /* @__PURE__ */ (function() {
    function Td2() {
    }
    ;
    Td2.value = new Td2();
    return Td2;
  })();
  var Th = /* @__PURE__ */ (function() {
    function Th2() {
    }
    ;
    Th2.value = new Th2();
    return Th2;
  })();
  var Tbody = /* @__PURE__ */ (function() {
    function Tbody2() {
    }
    ;
    Tbody2.value = new Tbody2();
    return Tbody2;
  })();
  var Thead = /* @__PURE__ */ (function() {
    function Thead2() {
    }
    ;
    Thead2.value = new Thead2();
    return Thead2;
  })();
  var eqElementType = {
    eq: function(x) {
      return function(y) {
        if (x instanceof Circle && y instanceof Circle) {
          return true;
        }
        ;
        if (x instanceof Rect && y instanceof Rect) {
          return true;
        }
        ;
        if (x instanceof Path && y instanceof Path) {
          return true;
        }
        ;
        if (x instanceof Line && y instanceof Line) {
          return true;
        }
        ;
        if (x instanceof Polygon && y instanceof Polygon) {
          return true;
        }
        ;
        if (x instanceof Text && y instanceof Text) {
          return true;
        }
        ;
        if (x instanceof Group && y instanceof Group) {
          return true;
        }
        ;
        if (x instanceof SVG && y instanceof SVG) {
          return true;
        }
        ;
        if (x instanceof Defs && y instanceof Defs) {
          return true;
        }
        ;
        if (x instanceof LinearGradient && y instanceof LinearGradient) {
          return true;
        }
        ;
        if (x instanceof Stop && y instanceof Stop) {
          return true;
        }
        ;
        if (x instanceof PatternFill && y instanceof PatternFill) {
          return true;
        }
        ;
        if (x instanceof Div && y instanceof Div) {
          return true;
        }
        ;
        if (x instanceof Span && y instanceof Span) {
          return true;
        }
        ;
        if (x instanceof Table && y instanceof Table) {
          return true;
        }
        ;
        if (x instanceof Tr && y instanceof Tr) {
          return true;
        }
        ;
        if (x instanceof Td && y instanceof Td) {
          return true;
        }
        ;
        if (x instanceof Th && y instanceof Th) {
          return true;
        }
        ;
        if (x instanceof Tbody && y instanceof Tbody) {
          return true;
        }
        ;
        if (x instanceof Thead && y instanceof Thead) {
          return true;
        }
        ;
        return false;
      };
    }
  };
  var elementContext = function(v) {
    if (v instanceof Circle) {
      return SVGContext.value;
    }
    ;
    if (v instanceof Rect) {
      return SVGContext.value;
    }
    ;
    if (v instanceof Path) {
      return SVGContext.value;
    }
    ;
    if (v instanceof Line) {
      return SVGContext.value;
    }
    ;
    if (v instanceof Polygon) {
      return SVGContext.value;
    }
    ;
    if (v instanceof Text) {
      return SVGContext.value;
    }
    ;
    if (v instanceof Group) {
      return SVGContext.value;
    }
    ;
    if (v instanceof SVG) {
      return SVGContext.value;
    }
    ;
    if (v instanceof Defs) {
      return SVGContext.value;
    }
    ;
    if (v instanceof LinearGradient) {
      return SVGContext.value;
    }
    ;
    if (v instanceof Stop) {
      return SVGContext.value;
    }
    ;
    if (v instanceof PatternFill) {
      return SVGContext.value;
    }
    ;
    if (v instanceof Div) {
      return HTMLContext.value;
    }
    ;
    if (v instanceof Span) {
      return HTMLContext.value;
    }
    ;
    if (v instanceof Table) {
      return HTMLContext.value;
    }
    ;
    if (v instanceof Tr) {
      return HTMLContext.value;
    }
    ;
    if (v instanceof Td) {
      return HTMLContext.value;
    }
    ;
    if (v instanceof Th) {
      return HTMLContext.value;
    }
    ;
    if (v instanceof Tbody) {
      return HTMLContext.value;
    }
    ;
    if (v instanceof Thead) {
      return HTMLContext.value;
    }
    ;
    throw new Error("Failed pattern match at PSD3.Internal.Selection.Types (line 210, column 1 - line 210, column 47): " + [v.constructor.name]);
  };

  // output/PSD3.HATS/index.js
  var $runtime_lazy3 = function(name15, moduleName, init2) {
    var state3 = 0;
    var val;
    return function(lineNumber) {
      if (state3 === 2) return val;
      if (state3 === 1) throw new ReferenceError(name15 + " was needed before it finished initializing (module " + moduleName + ", line " + lineNumber + ")", moduleName, lineNumber);
      state3 = 1;
      val = init2();
      state3 = 2;
      return val;
    };
  };
  var eq2 = /* @__PURE__ */ eq(eqElementType);
  var DepthFirst = /* @__PURE__ */ (function() {
    function DepthFirst2() {
    }
    ;
    DepthFirst2.value = new DepthFirst2();
    return DepthFirst2;
  })();
  var BreadthFirst = /* @__PURE__ */ (function() {
    function BreadthFirst2() {
    }
    ;
    BreadthFirst2.value = new BreadthFirst2();
    return BreadthFirst2;
  })();
  var FromArray = /* @__PURE__ */ (function() {
    function FromArray2(value0) {
      this.value0 = value0;
    }
    ;
    FromArray2.create = function(value0) {
      return new FromArray2(value0);
    };
    return FromArray2;
  })();
  var FromTree = /* @__PURE__ */ (function() {
    function FromTree2(value0) {
      this.value0 = value0;
    }
    ;
    FromTree2.create = function(value0) {
      return new FromTree2(value0);
    };
    return FromTree2;
  })();
  var WithContext = /* @__PURE__ */ (function() {
    function WithContext2(value0) {
      this.value0 = value0;
    }
    ;
    WithContext2.create = function(value0) {
      return new WithContext2(value0);
    };
    return WithContext2;
  })();
  var Siblings = /* @__PURE__ */ (function() {
    function Siblings2() {
    }
    ;
    Siblings2.value = new Siblings2();
    return Siblings2;
  })();
  var Nested = /* @__PURE__ */ (function() {
    function Nested2() {
    }
    ;
    Nested2.value = new Nested2();
    return Nested2;
  })();
  var Elem = /* @__PURE__ */ (function() {
    function Elem2(value0) {
      this.value0 = value0;
    }
    ;
    Elem2.create = function(value0) {
      return new Elem2(value0);
    };
    return Elem2;
  })();
  var Fold = /* @__PURE__ */ (function() {
    function Fold2(value0) {
      this.value0 = value0;
    }
    ;
    Fold2.create = function(value0) {
      return new Fold2(value0);
    };
    return Fold2;
  })();
  var Empty = /* @__PURE__ */ (function() {
    function Empty3() {
    }
    ;
    Empty3.value = new Empty3();
    return Empty3;
  })();
  var siblings = function(trees) {
    var $lazy_flatten = $runtime_lazy3("flatten", "PSD3.HATS", function() {
      return concatMap(function(t) {
        if (t instanceof Empty) {
          return [];
        }
        ;
        var v2 = function(v1) {
          return [t];
        };
        if (t instanceof Elem) {
          var $10 = eq2(t.value0.elemType)(Group.value);
          if ($10) {
            var $11 = $$null2(t.value0.attrs);
            if ($11) {
              var $12 = $$null2(t.value0.behaviors);
              if ($12) {
                return $lazy_flatten(242)(t.value0.children);
              }
              ;
              return v2(true);
            }
            ;
            return v2(true);
          }
          ;
          return v2(true);
        }
        ;
        return v2(true);
      });
    });
    var flatten = $lazy_flatten(235);
    var v = flatten(trees);
    if (v.length === 0) {
      return Empty.value;
    }
    ;
    if (v.length === 1) {
      return v[0];
    }
    ;
    return new Elem({
      elemType: Group.value,
      attrs: [],
      children: v,
      behaviors: []
    });
  };
  var semigroupTree = {
    append: function(v) {
      return function(v1) {
        if (v instanceof Empty) {
          return v1;
        }
        ;
        if (v1 instanceof Empty) {
          return v;
        }
        ;
        return siblings([v, v1]);
      };
    }
  };
  var preserveTree = function(name15) {
    return function(root) {
      return function(children2) {
        return function(keyFn) {
          return function(template) {
            return new Fold({
              name: name15,
              enumerate: new FromTree({
                root,
                children: children2,
                order: DepthFirst.value,
                includeInternal: true
              }),
              assemble: Nested.value,
              keyFn,
              template,
              gup: Nothing.value
            });
          };
        };
      };
    };
  };
  var fromTree = function(name15) {
    return function(root) {
      return function(children2) {
        return function(keyFn) {
          return function(order) {
            return function(includeInternal) {
              return function(template) {
                return new Fold({
                  name: name15,
                  enumerate: new FromTree({
                    root,
                    children: children2,
                    order,
                    includeInternal
                  }),
                  assemble: Siblings.value,
                  keyFn,
                  template,
                  gup: Nothing.value
                });
              };
            };
          };
        };
      };
    };
  };
  var forEachWithGUP = function(name15) {
    return function(items) {
      return function(keyFn) {
        return function(template) {
          return function(gupSpec2) {
            return new Fold({
              name: name15,
              enumerate: new FromArray(items),
              assemble: Siblings.value,
              keyFn,
              template,
              gup: new Just(gupSpec2)
            });
          };
        };
      };
    };
  };
  var forEach = function(name15) {
    return function(items) {
      return function(keyFn) {
        return function(template) {
          return new Fold({
            name: name15,
            enumerate: new FromArray(items),
            assemble: Siblings.value,
            keyFn,
            template,
            gup: Nothing.value
          });
        };
      };
    };
  };
  var empty6 = /* @__PURE__ */ (function() {
    return Empty.value;
  })();

  // output/PSD3.Interaction.Pointer/foreign.js
  function attachSimpleDrag_(element) {
    return () => () => {
      let isDragging = false;
      let transform = { x: 0, y: 0 };
      function handlePointerDown(event) {
        if (event.button !== 0) return;
        isDragging = true;
        element.setPointerCapture(event.pointerId);
        event.preventDefault();
        event.stopPropagation();
        if (element.parentNode) {
          element.parentNode.appendChild(element);
        }
        element.style.cursor = "grabbing";
        console.log("[SimpleDrag] pointerdown, isDragging=true");
      }
      function handlePointerMove(event) {
        if (!isDragging) return;
        const svg = element.ownerSVGElement;
        if (svg) {
          const pt = svg.createSVGPoint();
          const ctm = svg.getScreenCTM();
          if (ctm) {
            pt.x = event.movementX;
            pt.y = event.movementY;
            const scale = ctm.a;
            transform.x += event.movementX / scale;
            transform.y += event.movementY / scale;
          } else {
            transform.x += event.movementX;
            transform.y += event.movementY;
          }
        } else {
          transform.x += event.movementX;
          transform.y += event.movementY;
        }
        element.setAttribute("transform", `translate(${transform.x},${transform.y})`);
      }
      function handlePointerUp(event) {
        console.log("[SimpleDrag] pointerup, isDragging was:", isDragging);
        if (!isDragging) return;
        isDragging = false;
        element.releasePointerCapture(event.pointerId);
        element.style.cursor = "grab";
        console.log("[SimpleDrag] drag ended");
      }
      function handlePointerCancel(event) {
        console.log("[SimpleDrag] pointercancel");
        if (!isDragging) return;
        isDragging = false;
        element.releasePointerCapture(event.pointerId);
        element.style.cursor = "grab";
      }
      function handleDragStart(event) {
        event.preventDefault();
      }
      element.addEventListener("pointerdown", handlePointerDown);
      element.addEventListener("pointermove", handlePointerMove);
      element.addEventListener("pointerup", handlePointerUp);
      element.addEventListener("pointercancel", handlePointerCancel);
      element.addEventListener("dragstart", handleDragStart);
      element.style.cursor = "grab";
      element.style.touchAction = "none";
      return element;
    };
  }
  var simulationRegistry = /* @__PURE__ */ new Map();
  function getSimulationReheat(simId) {
    const sim = simulationRegistry.get(simId);
    return sim ? sim.reheat : null;
  }
  function attachSimulationDragById_(element) {
    return (simId) => () => {
      let isDragging = false;
      function handlePointerDown(event) {
        if (event.button !== 0) return;
        isDragging = true;
        element.setPointerCapture(event.pointerId);
        event.preventDefault();
        const node = element.__data__;
        if (!node) {
          console.warn("[PointerDrag] No datum on element");
          return;
        }
        const reheat = getSimulationReheat(simId);
        if (reheat) {
          reheat();
        } else {
          console.warn(`[PointerDrag] No simulation registered with ID: ${simId}`);
        }
        node.fx = node.x;
        node.fy = node.y;
        element.style.cursor = "grabbing";
      }
      function handlePointerMove(event) {
        if (!isDragging) return;
        const node = element.__data__;
        if (!node) return;
        const svg = element.ownerSVGElement;
        if (svg) {
          const pt = svg.createSVGPoint();
          pt.x = event.clientX;
          pt.y = event.clientY;
          const parentGroup = element.parentElement;
          const ctm = parentGroup?.getScreenCTM?.() || svg.getScreenCTM();
          if (ctm) {
            const svgPt = pt.matrixTransform(ctm.inverse());
            node.fx = svgPt.x;
            node.fy = svgPt.y;
          }
        } else {
          node.fx = event.clientX;
          node.fy = event.clientY;
        }
      }
      function handlePointerUp(event) {
        if (!isDragging) return;
        isDragging = false;
        element.releasePointerCapture(event.pointerId);
        const node = element.__data__;
        if (node) {
          node.fx = null;
          node.fy = null;
        }
        element.style.cursor = "grab";
      }
      function handleDragStart(event) {
        event.preventDefault();
      }
      element.addEventListener("pointerdown", handlePointerDown);
      element.addEventListener("pointermove", handlePointerMove);
      element.addEventListener("pointerup", handlePointerUp);
      element.addEventListener("pointercancel", handlePointerUp);
      element.addEventListener("dragstart", handleDragStart);
      element.style.cursor = "grab";
      element.style.touchAction = "none";
      return element;
    };
  }
  function attachSimulationDragNestedById_(element) {
    return (simId) => () => {
      let isDragging = false;
      function handlePointerDown(event) {
        if (event.button !== 0) return;
        isDragging = true;
        element.setPointerCapture(event.pointerId);
        event.preventDefault();
        const datum = element.__data__;
        const node = datum?.node;
        if (!node) {
          console.warn("[PointerDragNested] No datum.node on element");
          return;
        }
        const reheat = getSimulationReheat(simId);
        if (reheat) {
          reheat();
        } else {
          console.warn(`[PointerDragNested] No simulation registered with ID: ${simId}`);
        }
        node.fx = node.x;
        node.fy = node.y;
        element.style.cursor = "grabbing";
      }
      function handlePointerMove(event) {
        if (!isDragging) return;
        const datum = element.__data__;
        const node = datum?.node;
        if (!node) return;
        const svg = element.ownerSVGElement;
        if (svg) {
          const pt = svg.createSVGPoint();
          pt.x = event.clientX;
          pt.y = event.clientY;
          const parentGroup = element.parentElement;
          const ctm = parentGroup?.getScreenCTM?.() || svg.getScreenCTM();
          if (ctm) {
            const svgPt = pt.matrixTransform(ctm.inverse());
            node.fx = svgPt.x;
            node.fy = svgPt.y;
          }
        } else {
          node.fx = event.clientX;
          node.fy = event.clientY;
        }
      }
      function handlePointerUp(event) {
        if (!isDragging) return;
        isDragging = false;
        element.releasePointerCapture(event.pointerId);
        const datum = element.__data__;
        const node = datum?.node;
        if (node) {
          node.fx = null;
          node.fy = null;
        }
        element.style.cursor = "grab";
      }
      function handleDragStart(event) {
        event.preventDefault();
      }
      element.addEventListener("pointerdown", handlePointerDown);
      element.addEventListener("pointermove", handlePointerMove);
      element.addEventListener("pointerup", handlePointerUp);
      element.addEventListener("pointercancel", handlePointerUp);
      element.addEventListener("dragstart", handleDragStart);
      element.style.cursor = "grab";
      element.style.touchAction = "none";
      return element;
    };
  }

  // output/PSD3.Interaction.Zoom/foreign.js
  var ZoomTransform = class _ZoomTransform {
    constructor(k, x, y) {
      this.k = k;
      this.x = x;
      this.y = y;
    }
    /**
     * Returns a new transform scaled by k
     */
    scale(k) {
      return k === 1 ? this : new _ZoomTransform(this.k * k, this.x, this.y);
    }
    /**
     * Returns a new transform translated by (x, y) in local coordinates
     */
    translate(x, y) {
      return x === 0 && y === 0 ? this : new _ZoomTransform(this.k, this.x + this.k * x, this.y + this.k * y);
    }
    /**
     * Apply transform to a point [x, y] -> [x', y']
     */
    apply(point) {
      return [point[0] * this.k + this.x, point[1] * this.k + this.y];
    }
    /**
     * Apply inverse transform to get original coordinates
     */
    applyX(x) {
      return x * this.k + this.x;
    }
    applyY(y) {
      return y * this.k + this.y;
    }
    /**
     * Invert: given transformed point, return original point
     */
    invert(point) {
      return [(point[0] - this.x) / this.k, (point[1] - this.y) / this.k];
    }
    invertX(x) {
      return (x - this.x) / this.k;
    }
    invertY(y) {
      return (y - this.y) / this.k;
    }
    /**
     * Rescale a scale's domain according to this transform
     */
    rescaleX(x) {
      return x.copy().domain(x.range().map(this.invertX, this).map(x.invert, x));
    }
    rescaleY(y) {
      return y.copy().domain(y.range().map(this.invertY, this).map(y.invert, y));
    }
    toString() {
      return `translate(${this.x},${this.y}) scale(${this.k})`;
    }
  };
  var identity5 = new ZoomTransform(1, 0, 0);
  function constrain(transform, extent, translateExtent) {
    const dx0 = transform.invertX(extent[0][0]) - translateExtent[0][0];
    const dx1 = transform.invertX(extent[1][0]) - translateExtent[1][0];
    const dy0 = transform.invertY(extent[0][1]) - translateExtent[0][1];
    const dy1 = transform.invertY(extent[1][1]) - translateExtent[1][1];
    let x = transform.x;
    let y = transform.y;
    if (dx1 > dx0) {
      x += (dx0 + dx1) / 2 * transform.k;
    } else if (dx0 < 0) {
      x -= dx0 * transform.k;
    } else if (dx1 > 0) {
      x -= dx1 * transform.k;
    }
    if (dy1 > dy0) {
      y += (dy0 + dy1) / 2 * transform.k;
    } else if (dy0 < 0) {
      y -= dy0 * transform.k;
    } else if (dy1 > 0) {
      y -= dy1 * transform.k;
    }
    return x === transform.x && y === transform.y ? transform : new ZoomTransform(transform.k, x, y);
  }
  function zoomAround(transform, point, newK) {
    const p = transform.invert(point);
    const t = transform.scale(newK / transform.k);
    return new ZoomTransform(
      t.k,
      point[0] - p[0] * t.k,
      point[1] - p[1] * t.k
    );
  }
  function attachNativeZoom_(element) {
    return (config) => () => {
      const scaleMin = config.scaleMin || 0.1;
      const scaleMax = config.scaleMax || 10;
      const targetSelector = config.targetSelector;
      let transform = config.initialTransform ? new ZoomTransform(
        config.initialTransform.k,
        config.initialTransform.x,
        config.initialTransform.y
      ) : identity5;
      let extent = null;
      function getExtent() {
        if (!extent) {
          const rect = element.getBoundingClientRect();
          extent = [[0, 0], [rect.width, rect.height]];
        }
        return extent;
      }
      function toSVGCoords(clientX, clientY) {
        const svg = element.ownerSVGElement || element;
        if (svg.createSVGPoint) {
          const pt = svg.createSVGPoint();
          pt.x = clientX;
          pt.y = clientY;
          const ctm = svg.getScreenCTM();
          if (ctm) {
            const inv = ctm.inverse();
            const svgPt = pt.matrixTransform(inv);
            return [svgPt.x, svgPt.y];
          }
        }
        const rect = element.getBoundingClientRect();
        return [clientX - rect.left, clientY - rect.top];
      }
      function toSVGDelta(screenDx, screenDy) {
        const svg = element.ownerSVGElement || element;
        if (svg.getScreenCTM) {
          const ctm = svg.getScreenCTM();
          if (ctm) {
            const scale = ctm.a;
            return [screenDx / scale, screenDy / scale];
          }
        }
        return [screenDx, screenDy];
      }
      let translateExtent = config.translateExtent || null;
      const infiniteExtent = [[-Infinity, -Infinity], [Infinity, Infinity]];
      function applyTransform() {
        const target5 = element.querySelector(targetSelector);
        if (target5) {
          target5.setAttribute("transform", transform.toString());
        }
        element.__zoom = transform;
        if (config.onZoom) {
          config.onZoom({ k: transform.k, x: transform.x, y: transform.y })();
        }
      }
      function setTransform(newTransform) {
        const k = Math.max(scaleMin, Math.min(scaleMax, newTransform.k));
        newTransform = new ZoomTransform(k, newTransform.x, newTransform.y);
        if (translateExtent) {
          newTransform = constrain(newTransform, getExtent(), translateExtent);
        }
        transform = newTransform;
        applyTransform();
      }
      function handleWheel(event) {
        event.preventDefault();
        const point = toSVGCoords(event.clientX, event.clientY);
        const factor = Math.pow(2, -event.deltaY * 2e-3);
        const newK = Math.max(scaleMin, Math.min(scaleMax, transform.k * factor));
        if (Math.abs(newK - transform.k) < 1e-3) return;
        const newTransform = zoomAround(transform, point, newK);
        setTransform(newTransform);
      }
      let isPanning = false;
      let panStart = null;
      let transformAtPanStart = null;
      function handlePointerDown(event) {
        if (event.button !== 0) return;
        const target5 = event.target;
        const isPanTarget = target5 === element || // SVG element itself
        target5.tagName === "svg" || target5.classList.contains("zoom-background") || target5.classList.contains("zoom-group");
        if (!isPanTarget) {
          return;
        }
        isPanning = true;
        panStart = [event.clientX, event.clientY];
        transformAtPanStart = transform;
        element.setPointerCapture(event.pointerId);
        element.style.cursor = "grabbing";
      }
      function handlePointerMove(event) {
        if (!isPanning) return;
        const screenDx = event.clientX - panStart[0];
        const screenDy = event.clientY - panStart[1];
        const [dx, dy] = toSVGDelta(screenDx, screenDy);
        const newTransform = new ZoomTransform(
          transformAtPanStart.k,
          transformAtPanStart.x + dx,
          transformAtPanStart.y + dy
        );
        setTransform(newTransform);
      }
      function handlePointerUp(event) {
        if (!isPanning) return;
        isPanning = false;
        element.releasePointerCapture(event.pointerId);
        element.style.cursor = "grab";
      }
      let gestureStartTransform = null;
      let gestureStartCenter = null;
      function handleGestureStart(event) {
        event.preventDefault();
        gestureStartTransform = transform;
        const rect = element.getBoundingClientRect();
        const screenCenterX = rect.left + rect.width / 2;
        const screenCenterY = rect.top + rect.height / 2;
        gestureStartCenter = toSVGCoords(screenCenterX, screenCenterY);
      }
      function handleGestureChange(event) {
        event.preventDefault();
        if (!gestureStartTransform) return;
        const newK = gestureStartTransform.k * event.scale;
        const newTransform = zoomAround(gestureStartTransform, gestureStartCenter, newK);
        setTransform(newTransform);
      }
      function handleGestureEnd(event) {
        event.preventDefault();
        gestureStartTransform = null;
      }
      element.addEventListener("wheel", handleWheel, { passive: false });
      element.addEventListener("pointerdown", handlePointerDown);
      element.addEventListener("pointermove", handlePointerMove);
      element.addEventListener("pointerup", handlePointerUp);
      element.addEventListener("pointercancel", handlePointerUp);
      element.addEventListener("gesturestart", handleGestureStart);
      element.addEventListener("gesturechange", handleGestureChange);
      element.addEventListener("gestureend", handleGestureEnd);
      element.style.cursor = "grab";
      element.style.touchAction = "none";
      if (config.initialTransform) {
        applyTransform();
      }
      const handle = {
        // Get current transform
        getTransform: () => ({ k: transform.k, x: transform.x, y: transform.y }),
        // Set transform directly
        setTransform: (t) => () => {
          setTransform(new ZoomTransform(t.k, t.x, t.y));
        },
        // Reset to identity
        resetZoom: () => {
          setTransform(identity5);
        },
        // Zoom to specific scale at point
        zoomTo: (k) => (point) => () => {
          const newTransform = zoomAround(transform, [point.x, point.y], k);
          setTransform(newTransform);
        },
        // Zoom in/out by factor at center
        zoomBy: (factor) => () => {
          const rect = element.getBoundingClientRect();
          const screenCenterX = rect.left + rect.width / 2;
          const screenCenterY = rect.top + rect.height / 2;
          const center = toSVGCoords(screenCenterX, screenCenterY);
          const newK = transform.k * factor;
          const newTransform = zoomAround(transform, center, newK);
          setTransform(newTransform);
        },
        // Cleanup
        destroy: () => {
          element.removeEventListener("wheel", handleWheel);
          element.removeEventListener("pointerdown", handlePointerDown);
          element.removeEventListener("pointermove", handlePointerMove);
          element.removeEventListener("pointerup", handlePointerUp);
          element.removeEventListener("pointercancel", handlePointerUp);
          element.removeEventListener("gesturestart", handleGestureStart);
          element.removeEventListener("gesturechange", handleGestureChange);
          element.removeEventListener("gestureend", handleGestureEnd);
          element.style.cursor = "";
          element.style.touchAction = "";
        }
      };
      return handle;
    };
  }
  function attachZoomNative_(element) {
    return (scaleMin) => (scaleMax) => (targetSelector) => () => {
      return attachNativeZoom_(element)({
        scaleMin,
        scaleMax,
        targetSelector,
        initialTransform: null,
        translateExtent: null,
        onZoom: null
      })();
    };
  }

  // output/PSD3.HATS.Interpreter/foreign.js
  var selectElement = (selector) => (doc) => () => {
    return doc.querySelector(selector);
  };
  var setAttribute = (el) => (name15) => (value12) => () => {
    if (name15 === "textContent") {
      el.textContent = value12;
    } else if (name15.startsWith("xlink:")) {
      el.setAttributeNS("http://www.w3.org/1999/xlink", name15, value12);
    } else if (name15.startsWith("xml:")) {
      el.setAttributeNS("http://www.w3.org/XML/1998/namespace", name15, value12);
    } else {
      el.setAttribute(name15, value12);
    }
  };
  var bindDatum = (el) => (datum) => () => {
    el.__data__ = datum;
  };
  var setKey = (el) => (key) => () => {
    el.setAttribute("data-hats-key", key);
  };
  var getKey = (el) => () => {
    return el.getAttribute("data-hats-key") || "";
  };
  var getChildElements = (parent2) => () => {
    return Array.from(parent2.children);
  };
  var removeElement = (el) => () => {
    if (el.parentNode) {
      el.parentNode.removeChild(el);
    }
  };
  var removeElementDelayed = (el) => (delayMs) => () => {
    setTimeout(() => {
      if (el.parentNode) {
        el.parentNode.removeChild(el);
      }
    }, delayMs);
  };
  var attachClick = (el) => (handler) => () => {
    el.addEventListener("click", function(event) {
      handler();
    });
    el.style.cursor = "pointer";
  };
  var attachClickWithDatum = (el) => (handler) => () => {
    el.addEventListener("click", function(event) {
      const d = this.__data__;
      handler(d)();
    });
    el.style.cursor = "pointer";
  };
  var attachMouseEnter = (el) => (handler) => () => {
    el.addEventListener("mouseenter", function(event) {
      const d = this.__data__;
      handler(d)();
    });
  };
  var attachMouseLeave = (el) => (handler) => () => {
    el.addEventListener("mouseleave", function(event) {
      const d = this.__data__;
      handler(d)();
    });
  };
  var attachMouseDown = (el) => (handler) => () => {
    el.addEventListener("mousedown", function(event) {
      handler();
    });
  };
  var attachHighlight = (el) => (enterStyles) => (leaveStyles) => () => {
    el.addEventListener("mouseenter", function(event) {
      enterStyles.forEach((style) => {
        this.setAttribute(style.attr, style.value);
      });
    });
    el.addEventListener("mouseleave", function(event) {
      leaveStyles.forEach((style) => {
        this.setAttribute(style.attr, style.value);
      });
    });
  };
  var attachZoom = (el) => (scaleMin) => (scaleMax) => (targetSelector) => () => {
    attachZoomNative_(el)(scaleMin)(scaleMax)(targetSelector)();
  };
  var attachSimpleDrag = (el) => () => {
    attachSimpleDrag_(el)()();
  };
  var attachSimulationDragById = (el) => (simId) => () => {
    attachSimulationDragById_(el)(simId)();
  };
  var attachSimulationDragNestedById = (el) => (simId) => () => {
    attachSimulationDragNestedById_(el)(simId)();
  };

  // output/PSD3.Internal.Attribute/index.js
  var StringValue = /* @__PURE__ */ (function() {
    function StringValue2(value0) {
      this.value0 = value0;
    }
    ;
    StringValue2.create = function(value0) {
      return new StringValue2(value0);
    };
    return StringValue2;
  })();
  var NumberValue = /* @__PURE__ */ (function() {
    function NumberValue2(value0) {
      this.value0 = value0;
    }
    ;
    NumberValue2.create = function(value0) {
      return new NumberValue2(value0);
    };
    return NumberValue2;
  })();
  var BooleanValue = /* @__PURE__ */ (function() {
    function BooleanValue2(value0) {
      this.value0 = value0;
    }
    ;
    BooleanValue2.create = function(value0) {
      return new BooleanValue2(value0);
    };
    return BooleanValue2;
  })();
  var UnknownSource = /* @__PURE__ */ (function() {
    function UnknownSource2() {
    }
    ;
    UnknownSource2.value = new UnknownSource2();
    return UnknownSource2;
  })();
  var StaticAttr = /* @__PURE__ */ (function() {
    function StaticAttr2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    StaticAttr2.create = function(value0) {
      return function(value1) {
        return new StaticAttr2(value0, value1);
      };
    };
    return StaticAttr2;
  })();
  var DataAttr = /* @__PURE__ */ (function() {
    function DataAttr2(value0, value1, value22) {
      this.value0 = value0;
      this.value1 = value1;
      this.value2 = value22;
    }
    ;
    DataAttr2.create = function(value0) {
      return function(value1) {
        return function(value22) {
          return new DataAttr2(value0, value1, value22);
        };
      };
    };
    return DataAttr2;
  })();
  var IndexedAttr = /* @__PURE__ */ (function() {
    function IndexedAttr2(value0, value1, value22) {
      this.value0 = value0;
      this.value1 = value1;
      this.value2 = value22;
    }
    ;
    IndexedAttr2.create = function(value0) {
      return function(value1) {
        return function(value22) {
          return new IndexedAttr2(value0, value1, value22);
        };
      };
    };
    return IndexedAttr2;
  })();
  var AnimatedAttr = /* @__PURE__ */ (function() {
    function AnimatedAttr2(value0) {
      this.value0 = value0;
    }
    ;
    AnimatedAttr2.create = function(value0) {
      return new AnimatedAttr2(value0);
    };
    return AnimatedAttr2;
  })();
  var AnimatedCompound = /* @__PURE__ */ (function() {
    function AnimatedCompound2(value0) {
      this.value0 = value0;
    }
    ;
    AnimatedCompound2.create = function(value0) {
      return new AnimatedCompound2(value0);
    };
    return AnimatedCompound2;
  })();

  // output/PSD3.Internal.Behavior.Types/index.js
  var ScaleExtent = /* @__PURE__ */ (function() {
    function ScaleExtent2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    ScaleExtent2.create = function(value0) {
      return function(value1) {
        return new ScaleExtent2(value0, value1);
      };
    };
    return ScaleExtent2;
  })();
  var SimpleDrag = /* @__PURE__ */ (function() {
    function SimpleDrag2() {
    }
    ;
    SimpleDrag2.value = new SimpleDrag2();
    return SimpleDrag2;
  })();
  var SimulationDrag = /* @__PURE__ */ (function() {
    function SimulationDrag2(value0) {
      this.value0 = value0;
    }
    ;
    SimulationDrag2.create = function(value0) {
      return new SimulationDrag2(value0);
    };
    return SimulationDrag2;
  })();
  var SimulationDragNested = /* @__PURE__ */ (function() {
    function SimulationDragNested2(value0) {
      this.value0 = value0;
    }
    ;
    SimulationDragNested2.create = function(value0) {
      return new SimulationDragNested2(value0);
    };
    return SimulationDragNested2;
  })();
  var Zoom = /* @__PURE__ */ (function() {
    function Zoom2(value0) {
      this.value0 = value0;
    }
    ;
    Zoom2.create = function(value0) {
      return new Zoom2(value0);
    };
    return Zoom2;
  })();
  var Drag = /* @__PURE__ */ (function() {
    function Drag2(value0) {
      this.value0 = value0;
    }
    ;
    Drag2.create = function(value0) {
      return new Drag2(value0);
    };
    return Drag2;
  })();
  var Click = /* @__PURE__ */ (function() {
    function Click2(value0) {
      this.value0 = value0;
    }
    ;
    Click2.create = function(value0) {
      return new Click2(value0);
    };
    return Click2;
  })();
  var ClickWithDatum = /* @__PURE__ */ (function() {
    function ClickWithDatum2(value0) {
      this.value0 = value0;
    }
    ;
    ClickWithDatum2.create = function(value0) {
      return new ClickWithDatum2(value0);
    };
    return ClickWithDatum2;
  })();
  var MouseEnter = /* @__PURE__ */ (function() {
    function MouseEnter2(value0) {
      this.value0 = value0;
    }
    ;
    MouseEnter2.create = function(value0) {
      return new MouseEnter2(value0);
    };
    return MouseEnter2;
  })();
  var MouseLeave = /* @__PURE__ */ (function() {
    function MouseLeave2(value0) {
      this.value0 = value0;
    }
    ;
    MouseLeave2.create = function(value0) {
      return new MouseLeave2(value0);
    };
    return MouseLeave2;
  })();
  var Highlight = /* @__PURE__ */ (function() {
    function Highlight2(value0) {
      this.value0 = value0;
    }
    ;
    Highlight2.create = function(value0) {
      return new Highlight2(value0);
    };
    return Highlight2;
  })();
  var CoordinatedHighlight = /* @__PURE__ */ (function() {
    function CoordinatedHighlight2(value0) {
      this.value0 = value0;
    }
    ;
    CoordinatedHighlight2.create = function(value0) {
      return new CoordinatedHighlight2(value0);
    };
    return CoordinatedHighlight2;
  })();
  var MouseMoveWithInfo = /* @__PURE__ */ (function() {
    function MouseMoveWithInfo2(value0) {
      this.value0 = value0;
    }
    ;
    MouseMoveWithInfo2.create = function(value0) {
      return new MouseMoveWithInfo2(value0);
    };
    return MouseMoveWithInfo2;
  })();
  var MouseEnterWithInfo = /* @__PURE__ */ (function() {
    function MouseEnterWithInfo2(value0) {
      this.value0 = value0;
    }
    ;
    MouseEnterWithInfo2.create = function(value0) {
      return new MouseEnterWithInfo2(value0);
    };
    return MouseEnterWithInfo2;
  })();
  var MouseLeaveWithInfo = /* @__PURE__ */ (function() {
    function MouseLeaveWithInfo2(value0) {
      this.value0 = value0;
    }
    ;
    MouseLeaveWithInfo2.create = function(value0) {
      return new MouseLeaveWithInfo2(value0);
    };
    return MouseLeaveWithInfo2;
  })();
  var MouseDown = /* @__PURE__ */ (function() {
    function MouseDown2(value0) {
      this.value0 = value0;
    }
    ;
    MouseDown2.create = function(value0) {
      return new MouseDown2(value0);
    };
    return MouseDown2;
  })();
  var MouseDownWithInfo = /* @__PURE__ */ (function() {
    function MouseDownWithInfo2(value0) {
      this.value0 = value0;
    }
    ;
    MouseDownWithInfo2.create = function(value0) {
      return new MouseDownWithInfo2(value0);
    };
    return MouseDownWithInfo2;
  })();
  var onHover = /* @__PURE__ */ (function() {
    return Highlight.create;
  })();
  var onClickWithDatum = /* @__PURE__ */ (function() {
    return ClickWithDatum.create;
  })();

  // output/PSD3.Internal.Selection.Operations.Conversions/index.js
  var elementTypeToString = function(v) {
    if (v instanceof Circle) {
      return "circle";
    }
    ;
    if (v instanceof Rect) {
      return "rect";
    }
    ;
    if (v instanceof Path) {
      return "path";
    }
    ;
    if (v instanceof Line) {
      return "line";
    }
    ;
    if (v instanceof Polygon) {
      return "polygon";
    }
    ;
    if (v instanceof Text) {
      return "text";
    }
    ;
    if (v instanceof Group) {
      return "g";
    }
    ;
    if (v instanceof SVG) {
      return "svg";
    }
    ;
    if (v instanceof Defs) {
      return "defs";
    }
    ;
    if (v instanceof LinearGradient) {
      return "linearGradient";
    }
    ;
    if (v instanceof Stop) {
      return "stop";
    }
    ;
    if (v instanceof PatternFill) {
      return "pattern";
    }
    ;
    if (v instanceof Div) {
      return "div";
    }
    ;
    if (v instanceof Span) {
      return "span";
    }
    ;
    if (v instanceof Table) {
      return "table";
    }
    ;
    if (v instanceof Tr) {
      return "tr";
    }
    ;
    if (v instanceof Td) {
      return "td";
    }
    ;
    if (v instanceof Th) {
      return "th";
    }
    ;
    if (v instanceof Tbody) {
      return "tbody";
    }
    ;
    if (v instanceof Thead) {
      return "thead";
    }
    ;
    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations.Conversions (line 100, column 1 - line 100, column 45): " + [v.constructor.name]);
  };

  // output/Web.DOM.Document/foreign.js
  var getEffProp = function(name15) {
    return function(doc) {
      return function() {
        return doc[name15];
      };
    };
  };
  var url = getEffProp("URL");
  var documentURI = getEffProp("documentURI");
  var origin = getEffProp("origin");
  var compatMode = getEffProp("compatMode");
  var characterSet = getEffProp("characterSet");
  var contentType = getEffProp("contentType");
  var _documentElement = getEffProp("documentElement");
  function createElement(localName2) {
    return function(doc) {
      return function() {
        return doc.createElement(localName2);
      };
    };
  }
  function _createElementNS(ns) {
    return function(qualifiedName) {
      return function(doc) {
        return function() {
          return doc.createElementNS(ns, qualifiedName);
        };
      };
    };
  }

  // output/Data.Nullable/foreign.js
  var nullImpl = null;
  function notNull(x) {
    return x;
  }

  // output/Data.Nullable/index.js
  var toNullable = /* @__PURE__ */ maybe(nullImpl)(notNull);

  // output/Web.DOM.Document/index.js
  var createElementNS = function($6) {
    return _createElementNS(toNullable($6));
  };

  // output/Web.DOM.Element/foreign.js
  var getProp = function(name15) {
    return function(doctype) {
      return doctype[name15];
    };
  };
  var _namespaceURI = getProp("namespaceURI");
  var _prefix = getProp("prefix");
  var localName = getProp("localName");
  var tagName = getProp("tagName");

  // output/Web.DOM.ParentNode/foreign.js
  var getEffProp2 = function(name15) {
    return function(node) {
      return function() {
        return node[name15];
      };
    };
  };
  var children = getEffProp2("children");
  var _firstElementChild = getEffProp2("firstElementChild");
  var _lastElementChild = getEffProp2("lastElementChild");
  var childElementCount = getEffProp2("childElementCount");

  // output/Web.DOM.Element/index.js
  var toNode = unsafeCoerce2;

  // output/PSD3.Internal.Selection.Operations.Helpers/index.js
  var createElementWithNS = function(elemType) {
    return function(doc) {
      var v = elementContext(elemType);
      if (v instanceof SVGContext) {
        return createElementNS(new Just("http://www.w3.org/2000/svg"))(elementTypeToString(elemType))(doc);
      }
      ;
      if (v instanceof HTMLContext) {
        return createElement(elementTypeToString(elemType))(doc);
      }
      ;
      throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations.Helpers (line 48, column 3 - line 54, column 64): " + [v.constructor.name]);
    };
  };

  // output/Web.DOM.Node/foreign.js
  var getEffProp3 = function(name15) {
    return function(node) {
      return function() {
        return node[name15];
      };
    };
  };
  var baseURI = getEffProp3("baseURI");
  var _ownerDocument = getEffProp3("ownerDocument");
  var _parentNode = getEffProp3("parentNode");
  var _parentElement = getEffProp3("parentElement");
  var childNodes = getEffProp3("childNodes");
  var _firstChild = getEffProp3("firstChild");
  var _lastChild = getEffProp3("lastChild");
  var _previousSibling = getEffProp3("previousSibling");
  var _nextSibling = getEffProp3("nextSibling");
  var _nodeValue = getEffProp3("nodeValue");
  var textContent = getEffProp3("textContent");
  function appendChild(node) {
    return function(parent2) {
      return function() {
        parent2.appendChild(node);
      };
    };
  }

  // output/Web.HTML/foreign.js
  var windowImpl = function() {
    return window;
  };

  // output/Web.HTML.HTMLDocument/index.js
  var toDocument = unsafeCoerce2;

  // output/Web.HTML.Window/foreign.js
  function document2(window2) {
    return function() {
      return window2.document;
    };
  }

  // output/PSD3.HATS.Interpreter/index.js
  var append2 = /* @__PURE__ */ append(semigroupArray);
  var map6 = /* @__PURE__ */ map(functorArray);
  var bind2 = /* @__PURE__ */ bind(bindEffect);
  var pure2 = /* @__PURE__ */ pure(applicativeEffect);
  var show2 = /* @__PURE__ */ show(showNumber);
  var traverse2 = /* @__PURE__ */ traverse(traversableArray)(applicativeEffect);
  var traverseWithIndex2 = /* @__PURE__ */ traverseWithIndex(traversableWithIndexArray)(applicativeEffect);
  var union2 = /* @__PURE__ */ union(ordString);
  var insert3 = /* @__PURE__ */ insert(ordString);
  var fromFoldable6 = /* @__PURE__ */ fromFoldable3(foldableArray)(ordString);
  var difference3 = /* @__PURE__ */ difference2(ordString);
  var intersection3 = /* @__PURE__ */ intersection2(ordString);
  var member3 = /* @__PURE__ */ member2(ordString);
  var enumerateDFS = function(root) {
    return function(getChildren) {
      return function(includeInternal) {
        var go2 = function(node) {
          var children2 = getChildren(node);
          var isLeaf2 = $$null2(children2);
          var childResults = concatMap(go2)(children2);
          var $53 = isLeaf2 || includeInternal;
          if ($53) {
            return append2([node])(childResults);
          }
          ;
          return childResults;
        };
        return go2(root);
      };
    };
  };
  var enumerateBFS = function(root) {
    return function(getChildren) {
      return function(includeInternal) {
        var go2 = function(queue) {
          var v = uncons4(queue);
          if (v instanceof Nothing) {
            return [];
          }
          ;
          if (v instanceof Just) {
            var children2 = getChildren(v.value0.head);
            var isLeaf2 = $$null2(children2);
            var include = isLeaf2 || includeInternal;
            var thisNode = (function() {
              if (include) {
                return [v.value0.head];
              }
              ;
              return [];
            })();
            return append2(thisNode)(go2(append2(v.value0.tail)(children2)));
          }
          ;
          throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 342, column 14 - line 349, column 43): " + [v.constructor.name]);
        };
        return go2([root]);
      };
    };
  };
  var runEnumeration = function(v) {
    if (v instanceof FromArray) {
      return v.value0;
    }
    ;
    if (v instanceof FromTree) {
      if (v.value0.order instanceof DepthFirst) {
        return enumerateDFS(v.value0.root)(v.value0.children)(v.value0.includeInternal);
      }
      ;
      if (v.value0.order instanceof BreadthFirst) {
        return enumerateBFS(v.value0.root)(v.value0.children)(v.value0.includeInternal);
      }
      ;
      throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 320, column 5 - line 322, column 80): " + [v.value0.order.constructor.name]);
    }
    ;
    if (v instanceof WithContext) {
      return map6(function(v1) {
        return v1.datum;
      })(v.value0);
    }
    ;
    throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 316, column 18 - line 324, column 41): " + [v.constructor.name]);
  };
  var appendTo = function(p) {
    return function(child) {
      return function __do3() {
        appendChild(toNode(child))(toNode(p))();
        return unit;
      };
    };
  };
  var interpretTree = function(doc) {
    return function(parent2) {
      return function(tree2) {
        var attrValueToString = function(v) {
          if (v instanceof StringValue) {
            return v.value0;
          }
          ;
          if (v instanceof NumberValue) {
            return show2(v.value0);
          }
          ;
          if (v instanceof BooleanValue) {
            if (v.value0) {
              return "true";
            }
            ;
            return "false";
          }
          ;
          throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 119, column 23 - line 122, column 52): " + [v.constructor.name]);
        };
        var applyBehaviorWithDatum = function(el) {
          return function(v) {
            if (v instanceof Click) {
              return attachClick(el)(v.value0);
            }
            ;
            if (v instanceof ClickWithDatum) {
              return attachClickWithDatum(el)(v.value0);
            }
            ;
            if (v instanceof MouseEnter) {
              return attachMouseEnter(el)(v.value0);
            }
            ;
            if (v instanceof MouseLeave) {
              return attachMouseLeave(el)(v.value0);
            }
            ;
            if (v instanceof Highlight) {
              return attachHighlight(el)(v.value0.enter)(v.value0.leave);
            }
            ;
            if (v instanceof Zoom) {
              return attachZoom(el)(v.value0.scaleExtent.value0)(v.value0.scaleExtent.value1)(v.value0.targetSelector);
            }
            ;
            if (v instanceof Drag && v.value0 instanceof SimpleDrag) {
              return attachSimpleDrag(el);
            }
            ;
            if (v instanceof Drag && v.value0 instanceof SimulationDrag) {
              return attachSimulationDragById(el)(v.value0.value0);
            }
            ;
            if (v instanceof Drag && v.value0 instanceof SimulationDragNested) {
              return attachSimulationDragNestedById(el)(v.value0.value0);
            }
            ;
            if (v instanceof MouseDown) {
              return attachMouseDown(el)(v.value0);
            }
            ;
            if (v instanceof CoordinatedHighlight) {
              return pure2(unit);
            }
            ;
            if (v instanceof MouseMoveWithInfo) {
              return pure2(unit);
            }
            ;
            if (v instanceof MouseEnterWithInfo) {
              return pure2(unit);
            }
            ;
            if (v instanceof MouseLeaveWithInfo) {
              return pure2(unit);
            }
            ;
            if (v instanceof MouseDownWithInfo) {
              return pure2(unit);
            }
            ;
            throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 158, column 31 - line 176, column 37): " + [v.constructor.name]);
          };
        };
        var applyBehaviorsWithDatum = function(el) {
          return function(behaviors) {
            return function __do3() {
              traverse2(applyBehaviorWithDatum(el))(behaviors)();
              return unit;
            };
          };
        };
        var applyBehaviorStatic = function(el) {
          return function(v) {
            if (v instanceof Click) {
              return attachClick(el)(v.value0);
            }
            ;
            if (v instanceof Zoom) {
              return attachZoom(el)(v.value0.scaleExtent.value0)(v.value0.scaleExtent.value1)(v.value0.targetSelector);
            }
            ;
            if (v instanceof Drag && v.value0 instanceof SimpleDrag) {
              return attachSimpleDrag(el);
            }
            ;
            if (v instanceof Drag && v.value0 instanceof SimulationDrag) {
              return attachSimulationDragById(el)(v.value0.value0);
            }
            ;
            if (v instanceof Drag && v.value0 instanceof SimulationDragNested) {
              return attachSimulationDragNestedById(el)(v.value0.value0);
            }
            ;
            if (v instanceof ClickWithDatum) {
              return pure2(unit);
            }
            ;
            if (v instanceof MouseEnter) {
              return pure2(unit);
            }
            ;
            if (v instanceof MouseLeave) {
              return pure2(unit);
            }
            ;
            if (v instanceof Highlight) {
              return pure2(unit);
            }
            ;
            if (v instanceof CoordinatedHighlight) {
              return pure2(unit);
            }
            ;
            if (v instanceof MouseMoveWithInfo) {
              return pure2(unit);
            }
            ;
            if (v instanceof MouseEnterWithInfo) {
              return pure2(unit);
            }
            ;
            if (v instanceof MouseLeaveWithInfo) {
              return pure2(unit);
            }
            ;
            if (v instanceof MouseDown) {
              return pure2(unit);
            }
            ;
            if (v instanceof MouseDownWithInfo) {
              return pure2(unit);
            }
            ;
            throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 131, column 28 - line 149, column 37): " + [v.constructor.name]);
          };
        };
        var applyBehaviorsStatic = function(el) {
          return function(behaviors) {
            return function __do3() {
              traverse2(applyBehaviorStatic(el))(behaviors)();
              return unit;
            };
          };
        };
        var applyAttrWithDatum = function(el) {
          return function(datum) {
            return function(idx) {
              return function(v) {
                if (v instanceof StaticAttr) {
                  return setAttribute(el)(v.value0)(attrValueToString(v.value1));
                }
                ;
                if (v instanceof DataAttr) {
                  return setAttribute(el)(v.value0)(attrValueToString(v.value2(datum)));
                }
                ;
                if (v instanceof IndexedAttr) {
                  return setAttribute(el)(v.value0)(attrValueToString(v.value2(datum)(idx)));
                }
                ;
                if (v instanceof AnimatedAttr) {
                  return pure2(unit);
                }
                ;
                if (v instanceof AnimatedCompound) {
                  return pure2(unit);
                }
                ;
                throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 103, column 37 - line 115, column 16): " + [v.constructor.name]);
              };
            };
          };
        };
        var applyAttrsWithDatum = function(el) {
          return function(attrs) {
            return function(datum) {
              return function(idx) {
                return function __do3() {
                  traverse2(applyAttrWithDatum(el)(datum)(idx))(attrs)();
                  return unit;
                };
              };
            };
          };
        };
        var applyAttrStatic = function(el) {
          return function(v) {
            if (v instanceof StaticAttr) {
              return setAttribute(el)(v.value0)(attrValueToString(v.value1));
            }
            ;
            if (v instanceof DataAttr) {
              return pure2(unit);
            }
            ;
            if (v instanceof IndexedAttr) {
              return pure2(unit);
            }
            ;
            if (v instanceof AnimatedAttr) {
              return pure2(unit);
            }
            ;
            if (v instanceof AnimatedCompound) {
              return pure2(unit);
            }
            ;
            throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 83, column 24 - line 94, column 16): " + [v.constructor.name]);
          };
        };
        var applyAttrsStatic = function(el) {
          return function(attrs) {
            return function __do3() {
              traverse2(applyAttrStatic(el))(attrs)();
              return unit;
            };
          };
        };
        var renderSiblings = function(p) {
          return function(spec) {
            return function(items) {
              return function __do3() {
                var results = traverseWithIndex2(renderItemWithKey(p)(spec.keyFn)(spec.template))(items)();
                var elements = map6(function(v) {
                  return v.element;
                })(results);
                var childMaps = foldl4(union2)(empty4)(map6(function(v) {
                  return v.childSelections;
                })(results));
                return insert3(spec.name)(elements)(childMaps);
              };
            };
          };
        };
        var renderNested = function(p) {
          return function(spec) {
            var goNested = function(parentEl) {
              return function(node) {
                return function(getChildren) {
                  return function(idx) {
                    var itemTree = spec.template(node);
                    return function __do3() {
                      var el = (function() {
                        if (itemTree instanceof Elem) {
                          var e = createElementWithNS(itemTree.value0.elemType)(doc)();
                          appendTo(parentEl)(e)();
                          bindDatum(e)(node)();
                          applyAttrsWithDatum(e)(itemTree.value0.attrs)(node)(idx)();
                          applyBehaviorsWithDatum(e)(itemTree.value0.behaviors)();
                          traverse2(go2(e))(itemTree.value0.children)();
                          return e;
                        }
                        ;
                        var e = createElementWithNS(Group.value)(doc)();
                        appendTo(parentEl)(e)();
                        bindDatum(e)(node)();
                        return e;
                      })();
                      var children2 = getChildren(node);
                      var childElements = traverseWithIndex2(function(i) {
                        return function(child) {
                          return goNested(el)(child)(getChildren)((idx + i | 0) + 1 | 0);
                        };
                      })(children2)();
                      return append2([el])(concat(childElements));
                    };
                  };
                };
              };
            };
            if (spec.enumerate instanceof FromTree) {
              return function __do3() {
                var allElements = goNested(p)(spec.enumerate.value0.root)(spec.enumerate.value0.children)(0)();
                return singleton4(spec.name)(allElements);
              };
            }
            ;
            var items = runEnumeration(spec.enumerate);
            return renderSiblings(p)(spec)(items);
          };
        };
        var renderItemWithKey = function(p) {
          return function(keyFn) {
            return function(template) {
              return function(idx) {
                return function(datum) {
                  var itemTree = template(datum);
                  var key = keyFn(datum);
                  if (itemTree instanceof Elem) {
                    return function __do3() {
                      var el = createElementWithNS(itemTree.value0.elemType)(doc)();
                      appendTo(p)(el)();
                      setKey(el)(key)();
                      bindDatum(el)(datum)();
                      applyAttrsWithDatum(el)(itemTree.value0.attrs)(datum)(idx)();
                      applyBehaviorsWithDatum(el)(itemTree.value0.behaviors)();
                      var childMaps = traverse2(goWithDatum(el)(datum)(idx))(itemTree.value0.children)();
                      return {
                        element: el,
                        childSelections: foldl4(union2)(empty4)(childMaps)
                      };
                    };
                  }
                  ;
                  if (itemTree instanceof Fold) {
                    return function __do3() {
                      var wrapper = createElementWithNS(Group.value)(doc)();
                      appendTo(p)(wrapper)();
                      setKey(wrapper)(key)();
                      bindDatum(wrapper)(datum)();
                      var innerMap = go2(wrapper)(itemTree)();
                      return {
                        element: wrapper,
                        childSelections: innerMap
                      };
                    };
                  }
                  ;
                  if (itemTree instanceof Empty) {
                    return function __do3() {
                      var el = createElementWithNS(Group.value)(doc)();
                      return {
                        element: el,
                        childSelections: empty4
                      };
                    };
                  }
                  ;
                  throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 207, column 5 - line 235, column 57): " + [itemTree.constructor.name]);
                };
              };
            };
          };
        };
        var goWithDatum = function(p) {
          return function(datum) {
            return function(idx) {
              return function(v) {
                if (v instanceof Empty) {
                  return pure2(empty4);
                }
                ;
                if (v instanceof Elem) {
                  return function __do3() {
                    var el = createElementWithNS(v.value0.elemType)(doc)();
                    appendTo(p)(el)();
                    bindDatum(el)(datum)();
                    applyAttrsWithDatum(el)(v.value0.attrs)(datum)(idx)();
                    applyBehaviorsWithDatum(el)(v.value0.behaviors)();
                    var childMaps = traverse2(goWithDatum(el)(datum)(idx))(v.value0.children)();
                    return foldl4(union2)(empty4)(childMaps);
                  };
                }
                ;
                if (v instanceof Fold) {
                  var items = runEnumeration(v.value0.enumerate);
                  if (v.value0.assemble instanceof Siblings) {
                    return renderSiblings(p)(v.value0)(items);
                  }
                  ;
                  if (v.value0.assemble instanceof Nested) {
                    return renderNested(p)(v.value0);
                  }
                  ;
                  throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 259, column 7 - line 261, column 38): " + [v.value0.assemble.constructor.name]);
                }
                ;
                throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 240, column 29 - line 261, column 38): " + [v.constructor.name]);
              };
            };
          };
        };
        var go2 = function(p) {
          return function(v) {
            if (v instanceof Empty) {
              return pure2(empty4);
            }
            ;
            if (v instanceof Elem) {
              return function __do3() {
                var el = createElementWithNS(v.value0.elemType)(doc)();
                appendTo(p)(el)();
                applyAttrsStatic(el)(v.value0.attrs)();
                applyBehaviorsStatic(el)(v.value0.behaviors)();
                var childMaps = traverse2(go2(el))(v.value0.children)();
                return foldl4(union2)(empty4)(childMaps);
              };
            }
            ;
            if (v instanceof Fold) {
              var items = runEnumeration(v.value0.enumerate);
              if (v.value0.assemble instanceof Siblings) {
                return renderSiblings(p)(v.value0)(items);
              }
              ;
              if (v.value0.assemble instanceof Nested) {
                return renderNested(p)(v.value0);
              }
              ;
              throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 72, column 7 - line 74, column 38): " + [v.value0.assemble.constructor.name]);
            }
            ;
            throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 57, column 10 - line 74, column 38): " + [v.constructor.name]);
          };
        };
        return go2(parent2)(tree2);
      };
    };
  };
  var render2 = function(selector) {
    return function(tree2) {
      return function __do3() {
        var doc = (function __do4() {
          var $239 = bind2(windowImpl)(document2)();
          return toDocument($239);
        })();
        var container = selectElement(selector)(doc)();
        return interpretTree(doc)(container)(tree2)();
      };
    };
  };
  var rerenderTree = function(doc) {
    return function(parent2) {
      return function(tree2) {
        var attrValueToString = function(v) {
          if (v instanceof StringValue) {
            return v.value0;
          }
          ;
          if (v instanceof NumberValue) {
            return show2(v.value0);
          }
          ;
          if (v instanceof BooleanValue) {
            if (v.value0) {
              return "true";
            }
            ;
            return "false";
          }
          ;
          throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 573, column 23 - line 576, column 52): " + [v.constructor.name]);
        };
        var applyBehaviorWithDatum = function(el) {
          return function(v) {
            if (v instanceof Click) {
              return attachClick(el)(v.value0);
            }
            ;
            if (v instanceof ClickWithDatum) {
              return attachClickWithDatum(el)(v.value0);
            }
            ;
            if (v instanceof MouseEnter) {
              return attachMouseEnter(el)(v.value0);
            }
            ;
            if (v instanceof MouseLeave) {
              return attachMouseLeave(el)(v.value0);
            }
            ;
            if (v instanceof Highlight) {
              return attachHighlight(el)(v.value0.enter)(v.value0.leave);
            }
            ;
            if (v instanceof Zoom) {
              return attachZoom(el)(v.value0.scaleExtent.value0)(v.value0.scaleExtent.value1)(v.value0.targetSelector);
            }
            ;
            if (v instanceof Drag && v.value0 instanceof SimpleDrag) {
              return attachSimpleDrag(el);
            }
            ;
            if (v instanceof Drag && v.value0 instanceof SimulationDrag) {
              return attachSimulationDragById(el)(v.value0.value0);
            }
            ;
            if (v instanceof Drag && v.value0 instanceof SimulationDragNested) {
              return attachSimulationDragNestedById(el)(v.value0.value0);
            }
            ;
            if (v instanceof MouseDown) {
              return attachMouseDown(el)(v.value0);
            }
            ;
            return pure2(unit);
          };
        };
        var applyBehaviorsWithDatum = function(el) {
          return function(behaviors) {
            return function __do3() {
              traverse2(applyBehaviorWithDatum(el))(behaviors)();
              return unit;
            };
          };
        };
        var applyBehaviorStatic = function(el) {
          return function(v) {
            if (v instanceof Click) {
              return attachClick(el)(v.value0);
            }
            ;
            if (v instanceof Zoom) {
              return attachZoom(el)(v.value0.scaleExtent.value0)(v.value0.scaleExtent.value1)(v.value0.targetSelector);
            }
            ;
            if (v instanceof Drag && v.value0 instanceof SimpleDrag) {
              return attachSimpleDrag(el);
            }
            ;
            if (v instanceof Drag && v.value0 instanceof SimulationDrag) {
              return attachSimulationDragById(el)(v.value0.value0);
            }
            ;
            if (v instanceof Drag && v.value0 instanceof SimulationDragNested) {
              return attachSimulationDragNestedById(el)(v.value0.value0);
            }
            ;
            return pure2(unit);
          };
        };
        var applyBehaviorsStatic = function(el) {
          return function(behaviors) {
            return function __do3() {
              traverse2(applyBehaviorStatic(el))(behaviors)();
              return unit;
            };
          };
        };
        var applyAttrWithDatum = function(el) {
          return function(datum) {
            return function(idx) {
              return function(v) {
                if (v instanceof StaticAttr) {
                  return setAttribute(el)(v.value0)(attrValueToString(v.value1));
                }
                ;
                if (v instanceof DataAttr) {
                  return setAttribute(el)(v.value0)(attrValueToString(v.value2(datum)));
                }
                ;
                if (v instanceof IndexedAttr) {
                  return setAttribute(el)(v.value0)(attrValueToString(v.value2(datum)(idx)));
                }
                ;
                if (v instanceof AnimatedAttr) {
                  return pure2(unit);
                }
                ;
                if (v instanceof AnimatedCompound) {
                  return pure2(unit);
                }
                ;
                throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 562, column 37 - line 570, column 36): " + [v.constructor.name]);
              };
            };
          };
        };
        var applyAttrsWithDatum = function(el) {
          return function(attrs) {
            return function(datum) {
              return function(idx) {
                return function __do3() {
                  traverse2(applyAttrWithDatum(el)(datum)(idx))(attrs)();
                  return unit;
                };
              };
            };
          };
        };
        var applyAttrStatic = function(el) {
          return function(v) {
            if (v instanceof StaticAttr) {
              return setAttribute(el)(v.value0)(attrValueToString(v.value1));
            }
            ;
            if (v instanceof DataAttr) {
              return pure2(unit);
            }
            ;
            if (v instanceof IndexedAttr) {
              return pure2(unit);
            }
            ;
            if (v instanceof AnimatedAttr) {
              return pure2(unit);
            }
            ;
            if (v instanceof AnimatedCompound) {
              return pure2(unit);
            }
            ;
            throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 547, column 24 - line 553, column 36): " + [v.constructor.name]);
          };
        };
        var applyAttrsStatic = function(el) {
          return function(attrs) {
            return function __do3() {
              traverse2(applyAttrStatic(el))(attrs)();
              return unit;
            };
          };
        };
        var applyPhaseAttrs = function(el) {
          return function(attrs) {
            return function __do3() {
              traverse2(applyAttrStatic(el))(attrs)();
              return unit;
            };
          };
        };
        var renderItemWithKeyAndPhase = function(p) {
          return function(keyFn) {
            return function(template) {
              return function(gupSpec2) {
                return function(idx) {
                  return function(datum) {
                    var itemTree = template(datum);
                    var key = keyFn(datum);
                    if (itemTree instanceof Elem) {
                      return function __do3() {
                        var el = createElementWithNS(itemTree.value0.elemType)(doc)();
                        appendTo(p)(el)();
                        setKey(el)(key)();
                        bindDatum(el)(datum)();
                        applyAttrsWithDatum(el)(itemTree.value0.attrs)(datum)(idx)();
                        applyBehaviorsWithDatum(el)(itemTree.value0.behaviors)();
                        (function() {
                          if (gupSpec2 instanceof Just) {
                            if (gupSpec2.value0.enter instanceof Just) {
                              return applyPhaseAttrs(el)(gupSpec2.value0.enter.value0.attrs)();
                            }
                            ;
                            if (gupSpec2.value0.enter instanceof Nothing) {
                              return unit;
                            }
                            ;
                            throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 523, column 22 - line 525, column 33): " + [gupSpec2.value0.enter.constructor.name]);
                          }
                          ;
                          if (gupSpec2 instanceof Nothing) {
                            return unit;
                          }
                          ;
                          throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 522, column 9 - line 526, column 31): " + [gupSpec2.constructor.name]);
                        })();
                        var childMaps = traverse2(goWithDatum(el)(datum)(idx))(itemTree.value0.children)();
                        return {
                          element: el,
                          childSelections: foldl4(union2)(empty4)(childMaps)
                        };
                      };
                    }
                    ;
                    return function __do3() {
                      var el = createElementWithNS(Group.value)(doc)();
                      return {
                        element: el,
                        childSelections: empty4
                      };
                    };
                  };
                };
              };
            };
          };
        };
        var goWithDatum = function(p) {
          return function(datum) {
            return function(idx) {
              return function(v) {
                if (v instanceof Empty) {
                  return pure2(empty4);
                }
                ;
                if (v instanceof Elem) {
                  return function __do3() {
                    var el = createElementWithNS(v.value0.elemType)(doc)();
                    appendTo(p)(el)();
                    bindDatum(el)(datum)();
                    applyAttrsWithDatum(el)(v.value0.attrs)(datum)(idx)();
                    applyBehaviorsWithDatum(el)(v.value0.behaviors)();
                    var childMaps = traverse2(goWithDatum(el)(datum)(idx))(v.value0.children)();
                    return foldl4(union2)(empty4)(childMaps);
                  };
                }
                ;
                if (v instanceof Fold) {
                  var items = runEnumeration(v.value0.enumerate);
                  if (v.value0.assemble instanceof Siblings) {
                    return function __do3() {
                      var results = traverseWithIndex2(renderItemWithKeyAndPhase(p)(v.value0.keyFn)(v.value0.template)(v.value0.gup))(items)();
                      var elements = map6(function(v1) {
                        return v1.element;
                      })(results);
                      var childMaps = foldl4(union2)(empty4)(map6(function(v1) {
                        return v1.childSelections;
                      })(results));
                      return insert3(v.value0.name)(elements)(childMaps);
                    };
                  }
                  ;
                  if (v.value0.assemble instanceof Nested) {
                    return pure2(empty4);
                  }
                  ;
                  throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 630, column 7 - line 636, column 33): " + [v.value0.assemble.constructor.name]);
                }
                ;
                throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 618, column 29 - line 636, column 33): " + [v.constructor.name]);
              };
            };
          };
        };
        var goWithIndex = function(p) {
          return function(childIdx) {
            return function(v) {
              if (v instanceof Empty) {
                return pure2(empty4);
              }
              ;
              if (v instanceof Elem) {
                return function __do3() {
                  var existingChildren = getChildElements(p)();
                  var el = (function() {
                    var v1 = index(existingChildren)(childIdx);
                    if (v1 instanceof Just) {
                      applyAttrsStatic(v1.value0)(v.value0.attrs)();
                      return v1.value0;
                    }
                    ;
                    if (v1 instanceof Nothing) {
                      var el2 = createElementWithNS(v.value0.elemType)(doc)();
                      appendTo(p)(el2)();
                      applyAttrsStatic(el2)(v.value0.attrs)();
                      applyBehaviorsStatic(el2)(v.value0.behaviors)();
                      return el2;
                    }
                    ;
                    throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 417, column 13 - line 428, column 18): " + [v1.constructor.name]);
                  })();
                  var childMaps = traverseWithIndex2(function(i) {
                    return function(child) {
                      return goWithIndex(el)(i)(child);
                    };
                  })(v.value0.children)();
                  return foldl4(union2)(empty4)(childMaps);
                };
              }
              ;
              if (v instanceof Fold) {
                var items = runEnumeration(v.value0.enumerate);
                var newKeys = fromFoldable6(map6(v.value0.keyFn)(items));
                return function __do3() {
                  var existingEls = getChildElements(p)();
                  var existingKeysAndEls = traverse2(function(el) {
                    return function __do4() {
                      var k = getKey(el)();
                      return {
                        key: k,
                        element: el
                      };
                    };
                  })(existingEls)();
                  var existingKeys = fromFoldable6(map6(function(v1) {
                    return v1.key;
                  })(existingKeysAndEls));
                  var enterKeys = difference3(newKeys)(existingKeys);
                  var updateKeys = intersection3(newKeys)(existingKeys);
                  var exitKeys = difference3(existingKeys)(newKeys);
                  traverse2(function(v1) {
                    var $217 = member3(v1.key)(exitKeys);
                    if ($217) {
                      if (v.value0.gup instanceof Just) {
                        if (v.value0.gup.value0.exit instanceof Just) {
                          return function __do4() {
                            applyPhaseAttrs(v1.element)(v.value0.gup.value0.exit.value0.attrs)();
                            return removeElementDelayed(v1.element)(300)();
                          };
                        }
                        ;
                        if (v.value0.gup.value0.exit instanceof Nothing) {
                          return removeElement(v1.element);
                        }
                        ;
                        throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 457, column 31 - line 462, column 49): " + [v.value0.gup.value0.exit.constructor.name]);
                      }
                      ;
                      if (v.value0.gup instanceof Nothing) {
                        return removeElement(v1.element);
                      }
                      ;
                      throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 456, column 13 - line 463, column 47): " + [v.value0.gup.constructor.name]);
                    }
                    ;
                    return pure2(unit);
                  })(existingKeysAndEls)();
                  traverse2(function(v1) {
                    var $225 = member3(v1.key)(updateKeys);
                    if ($225) {
                      var v2 = find2(function(d) {
                        return v.value0.keyFn(d) === v1.key;
                      })(items);
                      if (v2 instanceof Just) {
                        return function __do4() {
                          bindDatum(v1.element)(v2.value0)();
                          (function() {
                            var v3 = v.value0.template(v2.value0);
                            if (v3 instanceof Elem) {
                              return applyAttrsWithDatum(v1.element)(v3.value0.attrs)(v2.value0)(0)();
                            }
                            ;
                            return unit;
                          })();
                          if (v.value0.gup instanceof Just) {
                            if (v.value0.gup.value0.update instanceof Just) {
                              return applyPhaseAttrs(v1.element)(v.value0.gup.value0.update.value0.attrs)();
                            }
                            ;
                            if (v.value0.gup.value0.update instanceof Nothing) {
                              return unit;
                            }
                            ;
                            throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 481, column 35 - line 483, column 41): " + [v.value0.gup.value0.update.constructor.name]);
                          }
                          ;
                          if (v.value0.gup instanceof Nothing) {
                            return unit;
                          }
                          ;
                          throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 480, column 17 - line 484, column 39): " + [v.value0.gup.constructor.name]);
                        };
                      }
                      ;
                      if (v2 instanceof Nothing) {
                        return pure2(unit);
                      }
                      ;
                      throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 472, column 13 - line 485, column 35): " + [v2.constructor.name]);
                    }
                    ;
                    return pure2(unit);
                  })(existingKeysAndEls)();
                  var enterItems = filter(function(d) {
                    return member3(v.value0.keyFn(d))(enterKeys);
                  })(items);
                  var enterResults = traverseWithIndex2(renderItemWithKeyAndPhase(p)(v.value0.keyFn)(v.value0.template)(v.value0.gup))(enterItems)();
                  var updateElements = map6(function(v1) {
                    return v1.element;
                  })(filter(function(v1) {
                    return member3(v1.key)(updateKeys);
                  })(existingKeysAndEls));
                  var enterElements = map6(function(v1) {
                    return v1.element;
                  })(enterResults);
                  var allElements = append2(updateElements)(enterElements);
                  var childMaps = foldl4(union2)(empty4)(map6(function(v1) {
                    return v1.childSelections;
                  })(enterResults));
                  return insert3(v.value0.name)(allElements)(childMaps);
                };
              }
              ;
              throw new Error("Failed pattern match at PSD3.HATS.Interpreter (line 411, column 28 - line 499, column 56): " + [v.constructor.name]);
            };
          };
        };
        return goWithIndex(parent2)(0)(tree2);
      };
    };
  };
  var rerender = function(selector) {
    return function(tree2) {
      return function __do3() {
        var doc = (function __do4() {
          var $241 = bind2(windowImpl)(document2)();
          return toDocument($241);
        })();
        var container = selectElement(selector)(doc)();
        return rerenderTree(doc)(container)(tree2)();
      };
    };
  };

  // output/Test.HATSDemo/index.js
  var fromFoldable7 = /* @__PURE__ */ fromFoldable(foldableArray);
  var append1 = /* @__PURE__ */ append(semigroupArray);
  var fromFoldable1 = /* @__PURE__ */ fromFoldable2(foldableList);
  var map7 = /* @__PURE__ */ map(functorArray);
  var div2 = /* @__PURE__ */ div(euclideanRingInt);
  var mod2 = /* @__PURE__ */ mod(euclideanRingInt);
  var show3 = /* @__PURE__ */ show(showNumber);
  var show1 = /* @__PURE__ */ show(showInt);
  var max6 = /* @__PURE__ */ max(ordNumber);
  var append22 = /* @__PURE__ */ append(semigroupTree);
  var show22 = /* @__PURE__ */ show(/* @__PURE__ */ showSet(showString));
  var CircleShape = /* @__PURE__ */ (function() {
    function CircleShape2() {
    }
    ;
    CircleShape2.value = new CircleShape2();
    return CircleShape2;
  })();
  var SquareShape = /* @__PURE__ */ (function() {
    function SquareShape2() {
    }
    ;
    SquareShape2.value = new SquareShape2();
    return SquareShape2;
  })();
  var TriangleShape = /* @__PURE__ */ (function() {
    function TriangleShape2() {
    }
    ;
    TriangleShape2.value = new TriangleShape2();
    return TriangleShape2;
  })();
  var zoomPoints = [{
    id: 1,
    x: 40,
    y: 40
  }, {
    id: 2,
    x: 100,
    y: 70
  }, {
    id: 3,
    x: 160,
    y: 50
  }, {
    id: 4,
    x: 70,
    y: 100
  }, {
    id: 5,
    x: 130,
    y: 110
  }];
  var treeConfig = /* @__PURE__ */ (function() {
    return {
      separation: defaultTreeConfig.separation,
      layerScale: defaultTreeConfig.layerScale,
      layerSeparation: defaultTreeConfig.layerSeparation,
      size: {
        width: 260,
        height: 120
      },
      minSeparation: 1
    };
  })();
  var sudokuBoard = [[1, 2, 3, 4], [3, 4, 1, 2], [2, 1, 4, 3], [4, 3, 2, 1]];
  var staticNum = function(name15) {
    return function(val) {
      return new StaticAttr(name15, new NumberValue(val));
    };
  };
  var staticAttr = function(name15) {
    return function(val) {
      return new StaticAttr(name15, new StringValue(val));
    };
  };
  var shapedNodes = /* @__PURE__ */ (function() {
    return [{
      id: "c1",
      x: 40,
      y: 50,
      shape: CircleShape.value,
      size: 20
    }, {
      id: "s1",
      x: 100,
      y: 50,
      shape: SquareShape.value,
      size: 30
    }, {
      id: "t1",
      x: 160,
      y: 50,
      shape: TriangleShape.value,
      size: 25
    }, {
      id: "c2",
      x: 220,
      y: 50,
      shape: CircleShape.value,
      size: 15
    }, {
      id: "s2",
      x: 40,
      y: 110,
      shape: SquareShape.value,
      size: 25
    }, {
      id: "t2",
      x: 100,
      y: 110,
      shape: TriangleShape.value,
      size: 30
    }, {
      id: "c3",
      x: 160,
      y: 110,
      shape: CircleShape.value,
      size: 25
    }, {
      id: "s3",
      x: 220,
      y: 110,
      shape: SquareShape.value,
      size: 20
    }];
  })();
  var sampleTree = /* @__PURE__ */ (function() {
    var root = {
      name: "Root",
      x: 0,
      y: 0,
      depth: 0
    };
    var grandchild3 = {
      name: "GC3",
      x: 0,
      y: 0,
      depth: 0
    };
    var grandchild2 = {
      name: "GC2",
      x: 0,
      y: 0,
      depth: 0
    };
    var grandchild1 = {
      name: "GC1",
      x: 0,
      y: 0,
      depth: 0
    };
    var child3 = {
      name: "Child3",
      x: 0,
      y: 0,
      depth: 0
    };
    var child2 = {
      name: "Child2",
      x: 0,
      y: 0,
      depth: 0
    };
    var child1 = {
      name: "Child1",
      x: 0,
      y: 0,
      depth: 0
    };
    return mkTree(root)(fromFoldable7([mkTree(child1)(fromFoldable7([mkTree(grandchild1)(Nil.value), mkTree(grandchild2)(Nil.value)])), mkTree(child2)(fromFoldable7([mkTree(grandchild3)(Nil.value)])), mkTree(child3)(Nil.value)]));
  })();
  var samplePoints = [{
    id: 1,
    x: 50,
    y: 50,
    r: 15,
    name: "Alpha"
  }, {
    id: 2,
    x: 120,
    y: 80,
    r: 20,
    name: "Beta"
  }, {
    id: 3,
    x: 180,
    y: 40,
    r: 12,
    name: "Gamma"
  }, {
    id: 4,
    x: 250,
    y: 100,
    r: 25,
    name: "Delta"
  }];
  var sampleBars = [{
    label: "A",
    value: 80
  }, {
    label: "B",
    value: 120
  }, {
    label: "C",
    value: 60
  }, {
    label: "D",
    value: 100
  }, {
    label: "E",
    value: 45
  }];
  var positionedTree = /* @__PURE__ */ tree(treeConfig)(sampleTree);
  var mapWithIndex3 = function(f) {
    return function(arr) {
      var go2 = function(v) {
        return function(v1) {
          if (v1.length === 0) {
            return [];
          }
          ;
          if (v1.length === 0) {
            return [];
          }
          ;
          var t = unsafeSlice(1)(length(v1))(v1);
          var h = unsafeIndex(v1)(0);
          return append1([f(v)(h)])(go2(v + 1 | 0)(t));
        };
      };
      return go2(0)(arr);
    };
  };
  var lineData = [{
    x: 20,
    y: 100
  }, {
    x: 60,
    y: 40
  }, {
    x: 100,
    y: 80
  }, {
    x: 140,
    y: 20
  }, {
    x: 180,
    y: 60
  }, {
    x: 220,
    y: 30
  }, {
    x: 260,
    y: 70
  }];
  var initialGUPData = [{
    id: 1,
    x: 50,
    y: 75
  }, {
    id: 2,
    x: 100,
    y: 75
  }, {
    id: 3,
    x: 150,
    y: 75
  }];
  var indexedNum = function(name15) {
    return function(fn) {
      return new IndexedAttr(name15, UnknownSource.value, function(d) {
        return function(i) {
          return new NumberValue(fn(d)(i));
        };
      });
    };
  };
  var hierValue = function(v) {
    return v.value;
  };
  var hierName = function(v) {
    return v.name;
  };
  var hierData = {
    name: "root",
    value: 100,
    children: [{
      name: "A",
      value: 40,
      children: [{
        name: "A1",
        value: 15,
        children: []
      }, {
        name: "A2",
        value: 25,
        children: []
      }]
    }, {
      name: "B",
      value: 35,
      children: [{
        name: "B1",
        value: 20,
        children: []
      }, {
        name: "B2",
        value: 15,
        children: []
      }]
    }, {
      name: "C",
      value: 25,
      children: []
    }]
  };
  var hierChildren = function(v) {
    return v.children;
  };
  var isLeaf = function(n) {
    return $$null2(hierChildren(n));
  };
  var gupSpec = /* @__PURE__ */ (function() {
    return {
      enter: new Just({
        attrs: [staticAttr("fill")("#0f0")],
        transition: Nothing.value
      }),
      update: new Just({
        attrs: [staticAttr("fill")("#00f")],
        transition: Nothing.value
      }),
      exit: new Just({
        attrs: [staticAttr("fill")("#f00")],
        transition: Nothing.value
      })
    };
  })();
  var forceNodes = [{
    id: "A",
    x: 80,
    y: 75
  }, {
    id: "B",
    x: 120,
    y: 50
  }, {
    id: "C",
    x: 160,
    y: 75
  }, {
    id: "D",
    x: 200,
    y: 100
  }, {
    id: "E",
    x: 120,
    y: 100
  }];
  var flattenTree = function(t) {
    return append1([head(t)])(concatMap(flattenTree)(fromFoldable1(tail(t))));
  };
  var treeNodes = /* @__PURE__ */ flattenTree(positionedTree);
  var flattenBoard = function(rows4) {
    var indexed = mapWithIndex3(function(ri) {
      return function(cells2) {
        return mapWithIndex3(function(ci) {
          return function(v) {
            return {
              rowIdx: ri,
              colIdx: ci,
              value: v
            };
          };
        })(cells2);
      };
    })(rows4);
    return concat(indexed);
  };
  var extractLinks = function(t) {
    var parent2 = head(t);
    var children2 = fromFoldable1(tail(t));
    var directLinks = map7(function(child) {
      return {
        source: parent2,
        target: head(child)
      };
    })(children2);
    var childLinks = concatMap(extractLinks)(children2);
    return append1(directLinks)(childLinks);
  };
  var treeLinks = /* @__PURE__ */ extractLinks(positionedTree);
  var elemWithBehaviors = function(elemType) {
    return function(attrs) {
      return function(behaviors) {
        return function(children2) {
          return new Elem({
            elemType,
            attrs,
            children: children2,
            behaviors
          });
        };
      };
    };
  };
  var elemWithAttrs = function(elemType) {
    return function(attrs) {
      return function(children2) {
        return new Elem({
          elemType,
          attrs,
          children: children2,
          behaviors: []
        });
      };
    };
  };
  var dragPoints = [{
    id: 1,
    x: 50,
    y: 75,
    color: "#f00"
  }, {
    id: 2,
    x: 150,
    y: 75,
    color: "#0f0"
  }, {
    id: 3,
    x: 250,
    y: 75,
    color: "#00f"
  }];
  var demo10 = /* @__PURE__ */ (function() {
    var nodeIndex = function(name15) {
      if (name15 === "root") {
        return 0;
      }
      ;
      if (name15 === "A") {
        return 1;
      }
      ;
      if (name15 === "B") {
        return 2;
      }
      ;
      if (name15 === "C") {
        return 3;
      }
      ;
      if (name15 === "A1") {
        return 4;
      }
      ;
      if (name15 === "A2") {
        return 5;
      }
      ;
      if (name15 === "B1") {
        return 6;
      }
      ;
      if (name15 === "B2") {
        return 7;
      }
      ;
      return 0;
    };
    return elemWithAttrs(Group.value)([])([fromTree("hier-nodes")(hierData)(hierChildren)(hierName)(DepthFirst.value)(true)(function(node) {
      var idx = nodeIndex(hierName(node));
      var row = div2(idx)(5);
      var col = mod2(idx)(5);
      return elemWithBehaviors(Circle.value)([staticNum("cx")(30 + toNumber(col) * 50), staticNum("cy")(30 + toNumber(row) * 50), staticNum("r")((function() {
        var $103 = isLeaf(node);
        if ($103) {
          return 15;
        }
        ;
        return 10;
      })()), staticAttr("fill")((function() {
        var $104 = isLeaf(node);
        if ($104) {
          return "#0f0";
        }
        ;
        return "#f80";
      })()), staticAttr("stroke")("#fff"), staticNum("stroke-width")(2)])([onClickWithDatum(function(n) {
        return log2("Node: " + (hierName(n) + (" (value=" + (show3(hierValue(n)) + ")"))));
      }), onHover({
        enter: [{
          attr: "r",
          value: (function() {
            var $105 = isLeaf(node);
            if ($105) {
              return "18";
            }
            ;
            return "12";
          })()
        }],
        leave: [{
          attr: "r",
          value: (function() {
            var $106 = isLeaf(node);
            if ($106) {
              return "15";
            }
            ;
            return "10";
          })()
        }]
      })])([]);
    })]);
  })();
  var dataStr = function(name15) {
    return function(fn) {
      return new DataAttr(name15, UnknownSource.value, function($118) {
        return StringValue.create(fn($118));
      });
    };
  };
  var demo11 = /* @__PURE__ */ (function() {
    var nodeYIndex = function(name15) {
      if (name15 === "root") {
        return 0;
      }
      ;
      if (name15 === "A") {
        return 1;
      }
      ;
      if (name15 === "A1") {
        return 2;
      }
      ;
      if (name15 === "A2") {
        return 3;
      }
      ;
      if (name15 === "B") {
        return 4;
      }
      ;
      if (name15 === "B1") {
        return 5;
      }
      ;
      if (name15 === "B2") {
        return 6;
      }
      ;
      if (name15 === "C") {
        return 7;
      }
      ;
      return 0;
    };
    var nodeDepth = function(name15) {
      if (name15 === "root") {
        return 0;
      }
      ;
      if (name15 === "A") {
        return 1;
      }
      ;
      if (name15 === "B") {
        return 1;
      }
      ;
      if (name15 === "C") {
        return 1;
      }
      ;
      return 2;
    };
    var depthColor = function(d) {
      if (d === 0) {
        return "#666";
      }
      ;
      if (d === 1) {
        return "#888";
      }
      ;
      return "#aaa";
    };
    return elemWithAttrs(Group.value)([staticAttr("transform")("translate(10, 10)")])([preserveTree("nested-nodes")(hierData)(hierChildren)(hierName)(function(node) {
      var nodeName2 = hierName(node);
      var isRoot = nodeName2 === "root";
      var depth = nodeDepth(nodeName2);
      return elemWithBehaviors(Group.value)([staticAttr("transform")("translate(" + (show3(toNumber(depth) * 15) + ", 0)"))])([onClickWithDatum(function(n) {
        return log2("Nested node: " + hierName(n));
      })])([elemWithAttrs(Rect.value)([staticNum("x")(0), staticNum("y")(toNumber(nodeYIndex(nodeName2)) * 18), staticNum("width")((function() {
        if (isRoot) {
          return 120;
        }
        ;
        return 100 - toNumber(depth) * 15;
      })()), staticNum("height")(16), staticAttr("fill")(depthColor(depth)), staticAttr("stroke")("#333"), staticNum("stroke-width")(1)])([]), elemWithAttrs(Text.value)([staticNum("x")(4), staticNum("y")(toNumber(nodeYIndex(nodeName2)) * 18 + 12), staticAttr("fill")("#fff"), staticAttr("font-size")("10"), staticAttr("font-family")("monospace"), dataStr("textContent")(hierName)])([])]);
    })]);
  })();
  var dataNum = function(name15) {
    return function(fn) {
      return new DataAttr(name15, UnknownSource.value, function($119) {
        return NumberValue.create(fn($119));
      });
    };
  };
  var demo1 = /* @__PURE__ */ (function() {
    return elemWithAttrs(Group.value)([])([forEach("circles")(samplePoints)(function(p) {
      return show1(p.id);
    })(function(v) {
      return elemWithBehaviors(Circle.value)([dataNum("cx")(function(v1) {
        return v1.x;
      }), dataNum("cy")(function(v1) {
        return v1.y;
      }), dataNum("r")(function(v1) {
        return v1.r;
      }), staticAttr("fill")("#0ff"), staticAttr("stroke")("#fff"), staticNum("stroke-width")(2)])([onClickWithDatum(function(pt) {
        return log2("Clicked: " + (pt.name + (" (id=" + (show1(pt.id) + ")"))));
      }), onHover({
        enter: [{
          attr: "fill",
          value: "#ff0"
        }, {
          attr: "stroke-width",
          value: "4"
        }],
        leave: [{
          attr: "fill",
          value: "#0ff"
        }, {
          attr: "stroke-width",
          value: "2"
        }]
      })])([]);
    })]);
  })();
  var demo12 = /* @__PURE__ */ (function() {
    return elemWithAttrs(Group.value)([])([forEach("shaped-nodes")(shapedNodes)(function(v) {
      return v.id;
    })(function(node) {
      if (node.shape instanceof CircleShape) {
        return elemWithBehaviors(Circle.value)([dataNum("cx")(function(v) {
          return v.x;
        }), dataNum("cy")(function(v) {
          return v.y;
        }), dataNum("r")(function(v) {
          return v.size;
        }), staticAttr("fill")("#f0f"), staticAttr("stroke")("#fff"), staticNum("stroke-width")(2)])([onClickWithDatum(function(n) {
          return log2("Circle: " + n.id);
        }), onHover({
          enter: [{
            attr: "fill",
            value: "#ff0"
          }],
          leave: [{
            attr: "fill",
            value: "#f0f"
          }]
        })])([]);
      }
      ;
      if (node.shape instanceof SquareShape) {
        return elemWithBehaviors(Rect.value)([dataNum("x")(function(n) {
          return n.x - n.size / 2;
        }), dataNum("y")(function(n) {
          return n.y - n.size / 2;
        }), dataNum("width")(function(v) {
          return v.size;
        }), dataNum("height")(function(v) {
          return v.size;
        }), staticAttr("fill")("#0ff"), staticAttr("stroke")("#fff"), staticNum("stroke-width")(2)])([onClickWithDatum(function(n) {
          return log2("Square: " + n.id);
        }), onHover({
          enter: [{
            attr: "fill",
            value: "#ff0"
          }],
          leave: [{
            attr: "fill",
            value: "#0ff"
          }]
        })])([]);
      }
      ;
      if (node.shape instanceof TriangleShape) {
        return elemWithBehaviors(Polygon.value)([dataStr("points")(function(n) {
          return show3(n.x) + ("," + (show3(n.y - n.size) + (" " + (show3(n.x - n.size) + ("," + (show3(n.y + n.size * 0.7) + (" " + (show3(n.x + n.size) + ("," + show3(n.y + n.size * 0.7))))))))));
        }), staticAttr("fill")("#0f0"), staticAttr("stroke")("#fff"), staticNum("stroke-width")(2)])([onClickWithDatum(function(n) {
          return log2("Triangle: " + n.id);
        }), onHover({
          enter: [{
            attr: "fill",
            value: "#ff0"
          }],
          leave: [{
            attr: "fill",
            value: "#0f0"
          }]
        })])([]);
      }
      ;
      throw new Error("Failed pattern match at Test.HATSDemo (line 849, column 7 - line 904, column 15): " + [node.shape.constructor.name]);
    })]);
  })();
  var demo4 = /* @__PURE__ */ (function() {
    return elemWithAttrs(Group.value)([])([forEach("points")(lineData)(function(p) {
      return show3(p.x) + ("," + show3(p.y));
    })(function(v) {
      return elemWithBehaviors(Circle.value)([dataNum("cx")(function(v1) {
        return v1.x;
      }), dataNum("cy")(function(v1) {
        return v1.y;
      }), staticNum("r")(5), staticAttr("fill")("#0f0"), staticAttr("stroke")("#fff"), staticNum("stroke-width")(1)])([onClickWithDatum(function(pt) {
        return log2("Point: (" + (show3(pt.x) + (", " + (show3(pt.y) + ")"))));
      }), onHover({
        enter: [{
          attr: "r",
          value: "8"
        }, {
          attr: "fill",
          value: "#ff0"
        }],
        leave: [{
          attr: "r",
          value: "5"
        }, {
          attr: "fill",
          value: "#0f0"
        }]
      })])([]);
    })]);
  })();
  var demo5 = /* @__PURE__ */ (function() {
    return elemWithAttrs(Group.value)([])([forEach("draggable")(dragPoints)(function(p) {
      return show1(p.id);
    })(function(v) {
      return elemWithBehaviors(Circle.value)([dataNum("cx")(function(v1) {
        return v1.x;
      }), dataNum("cy")(function(v1) {
        return v1.y;
      }), staticNum("r")(25), dataStr("fill")(function(v1) {
        return v1.color;
      }), staticAttr("stroke")("#fff"), staticNum("stroke-width")(3)])([new Drag(SimpleDrag.value), onClickWithDatum(function(pt) {
        return log2("Circle " + (show1(pt.id) + " clicked"));
      }), onHover({
        enter: [{
          attr: "stroke-width",
          value: "5"
        }],
        leave: [{
          attr: "stroke-width",
          value: "3"
        }]
      })])([]);
    })]);
  })();
  var demo6 = /* @__PURE__ */ (function() {
    return elemWithBehaviors(Group.value)([staticAttr("class")("zoom-container")])([new Zoom({
      scaleExtent: new ScaleExtent(0.5, 4),
      targetSelector: ".zoom-content"
    })])([elemWithAttrs(Rect.value)([staticNum("x")(0), staticNum("y")(0), staticNum("width")(300), staticNum("height")(150), staticAttr("fill")("transparent"), staticAttr("class")("zoom-background")])([]), elemWithAttrs(Group.value)([staticAttr("class")("zoom-content")])([forEach("zoom-circles")(zoomPoints)(function(p) {
      return show1(p.id);
    })(function(v) {
      return elemWithBehaviors(Circle.value)([dataNum("cx")(function(v1) {
        return v1.x;
      }), dataNum("cy")(function(v1) {
        return v1.y;
      }), staticNum("r")(12), staticAttr("fill")("#f80"), staticAttr("stroke")("#fff"), staticNum("stroke-width")(2)])([onClickWithDatum(function(pt) {
        return log2("Zoom circle " + show1(pt.id));
      }), onHover({
        enter: [{
          attr: "r",
          value: "15"
        }, {
          attr: "fill",
          value: "#ff0"
        }],
        leave: [{
          attr: "r",
          value: "12"
        }, {
          attr: "fill",
          value: "#f80"
        }]
      })])([]);
    })])]);
  })();
  var demo8Links = /* @__PURE__ */ (function() {
    return elemWithAttrs(Group.value)([staticAttr("transform")("translate(20, 15)")])([forEach("tree-links")(treeLinks)(function(link) {
      return link.source.name + ("->" + link.target.name);
    })(function(v) {
      return elemWithAttrs(Line.value)([dataNum("x1")(function($120) {
        return (function(v1) {
          return v1.x;
        })((function(v1) {
          return v1.source;
        })($120));
      }), dataNum("y1")(function($121) {
        return (function(v1) {
          return v1.y;
        })((function(v1) {
          return v1.source;
        })($121));
      }), dataNum("x2")(function($122) {
        return (function(v1) {
          return v1.x;
        })((function(v1) {
          return v1.target;
        })($122));
      }), dataNum("y2")(function($123) {
        return (function(v1) {
          return v1.y;
        })((function(v1) {
          return v1.target;
        })($123));
      }), staticAttr("stroke")("#666"), staticNum("stroke-width")(2)])([]);
    })]);
  })();
  var demo8Nodes = /* @__PURE__ */ (function() {
    return elemWithAttrs(Group.value)([staticAttr("transform")("translate(20, 15)")])([forEach("tree-nodes")(treeNodes)(function(v) {
      return v.name;
    })(function(v) {
      return elemWithBehaviors(Group.value)([])([onClickWithDatum(function(node) {
        return log2("Node: " + (node.name + (" at (" + (show3(node.x) + (", " + (show3(node.y) + ")"))))));
      }), onHover({
        enter: [{
          attr: "opacity",
          value: "0.8"
        }],
        leave: [{
          attr: "opacity",
          value: "1"
        }]
      })])([elemWithAttrs(Circle.value)([dataNum("cx")(function(v1) {
        return v1.x;
      }), dataNum("cy")(function(v1) {
        return v1.y;
      }), staticNum("r")(12), staticAttr("fill")("#f0f"), staticAttr("stroke")("#fff"), staticNum("stroke-width")(2)])([]), elemWithAttrs(Text.value)([dataNum("x")(function(v1) {
        return v1.x;
      }), dataNum("y")(function(n) {
        return n.y + 4;
      }), staticAttr("text-anchor")("middle"), staticAttr("fill")("#fff"), staticAttr("font-size")("8"), staticAttr("font-family")("sans-serif"), staticAttr("pointer-events")("none"), dataStr("textContent")((function() {
        var $124 = take(4);
        return function($125) {
          return $124((function(v1) {
            return v1.name;
          })($125));
        };
      })())])([])]);
    })]);
  })();
  var demo9 = /* @__PURE__ */ (function() {
    return elemWithAttrs(Group.value)([])([forEach("force-nodes")(forceNodes)(function(v) {
      return v.id;
    })(function(v) {
      return elemWithBehaviors(Circle.value)([dataNum("cx")(function(v1) {
        return v1.x;
      }), dataNum("cy")(function(v1) {
        return v1.y;
      }), staticNum("r")(15), staticAttr("fill")("#0ff"), staticAttr("stroke")("#fff"), staticNum("stroke-width")(2), staticAttr("class")("force-node")])([onClickWithDatum(function(node) {
        return log2("Force node: " + node.id);
      }), onHover({
        enter: [{
          attr: "r",
          value: "18"
        }, {
          attr: "fill",
          value: "#ff0"
        }],
        leave: [{
          attr: "r",
          value: "15"
        }, {
          attr: "fill",
          value: "#0ff"
        }]
      })])([]);
    })]);
  })();
  var makeGUPTree = function(items) {
    var gupTemplate = function(v) {
      return elemWithBehaviors(Circle.value)([dataNum("cx")(function(v1) {
        return v1.x;
      }), dataNum("cy")(function(v1) {
        return v1.y;
      }), staticNum("r")(20), staticAttr("fill")("#888"), staticAttr("stroke")("#fff"), staticNum("stroke-width")(2)])([onClickWithDatum(function(pt) {
        return log2("GUP circle " + show1(pt.id));
      }), onHover({
        enter: [{
          attr: "stroke-width",
          value: "4"
        }],
        leave: [{
          attr: "stroke-width",
          value: "2"
        }]
      })])([]);
    };
    return elemWithAttrs(Group.value)([])([forEachWithGUP("gup-circles")(items)(function(p) {
      return show1(p.id);
    })(gupTemplate)(gupSpec)]);
  };
  var demo7 = function __do() {
    var dataRef = $$new(initialGUPData)();
    var nextIdRef = $$new(4)();
    render2("#demo7")(makeGUPTree(initialGUPData))();
    setupGUPButtons(function(v) {
      return function __do3() {
        var currentData = read(dataRef)();
        var nextId = read(nextIdRef)();
        var maxX = foldl4(function(acc) {
          return function(item) {
            return max6(acc)(item.x);
          };
        })(0)(currentData);
        var newItem = {
          id: nextId,
          x: maxX + 50,
          y: 75
        };
        var newData = append1(currentData)([newItem]);
        write(newData)(dataRef)();
        write(nextId + 1 | 0)(nextIdRef)();
        rerender("#demo7")(makeGUPTree(newData))();
        return log2("Added circle " + (show1(nextId) + (", now have " + show1(length4(newData)))))();
      };
    })(function(v) {
      return function __do3() {
        var currentData = read(dataRef)();
        var v1 = unsnoc(currentData);
        if (v1 instanceof Just) {
          write(v1.value0.init)(dataRef)();
          rerender("#demo7")(makeGUPTree(v1.value0.init))();
          return log2("Removed circle " + (show1(v1.value0.last.id) + (", now have " + show1(length4(v1.value0.init)))))();
        }
        ;
        if (v1 instanceof Nothing) {
          return log2("No circles to remove")();
        }
        ;
        throw new Error("Failed pattern match at Test.HATSDemo (line 443, column 7 - line 449, column 37): " + [v1.constructor.name]);
      };
    })(function(v) {
      return function __do3() {
        var currentData = read(dataRef)();
        var shuffled = map7(function(item) {
          return {
            id: item.id,
            y: item.y,
            x: 250 - item.x
          };
        })(reverse2(currentData));
        write(shuffled)(dataRef)();
        rerender("#demo7")(makeGUPTree(shuffled))();
        return log2("Shuffled circles")();
      };
    })();
    return unit;
  };
  var chartYAxis = /* @__PURE__ */ (function() {
    return elemWithAttrs(Line.value)([staticNum("x1")(30), staticNum("y1")(25), staticNum("x2")(30), staticNum("y2")(120), staticAttr("stroke")("#666"), staticNum("stroke-width")(1)])([]);
  })();
  var chartXAxis = function(dat) {
    return elemWithAttrs(Group.value)([staticAttr("transform")("translate(30, 125)")])([forEach("x-labels")(dat)(function(v) {
      return v.label;
    })(function(v) {
      return elemWithAttrs(Text.value)([indexedNum("x")(function(v1) {
        return function(i) {
          return toNumber(i) * 50 + 20;
        };
      }), staticNum("y")(0), staticAttr("text-anchor")("middle"), staticAttr("fill")("#888"), staticAttr("font-size")("10"), dataStr("textContent")(function(v1) {
        return v1.label;
      })])([]);
    })]);
  };
  var chartTitle = function(titleText) {
    return elemWithAttrs(Text.value)([staticNum("x")(140), staticNum("y")(15), staticAttr("text-anchor")("middle"), staticAttr("fill")("#fff"), staticAttr("font-size")("14"), staticAttr("font-weight")("bold"), staticAttr("textContent")(titleText)])([]);
  };
  var chartLegend = function(showIt) {
    if (showIt) {
      return elemWithAttrs(Group.value)([staticAttr("transform")("translate(240, 40)")])([elemWithAttrs(Rect.value)([staticNum("x")(0), staticNum("y")(0), staticNum("width")(12), staticNum("height")(12), staticAttr("fill")("#0ff")])([]), elemWithAttrs(Text.value)([staticNum("x")(18), staticNum("y")(10), staticAttr("fill")("#888"), staticAttr("font-size")("10"), staticAttr("textContent")("Value")])([])]);
    }
    ;
    return empty6;
  };
  var chartBarsData = [{
    value: 80,
    label: "A"
  }, {
    value: 120,
    label: "B"
  }, {
    value: 60,
    label: "C"
  }, {
    value: 100,
    label: "D"
  }, {
    value: 45,
    label: "E"
  }];
  var chartBars = function(dat) {
    return elemWithAttrs(Group.value)([staticAttr("transform")("translate(30, 120)")])([forEach("bars")(dat)(function(v) {
      return v.label;
    })(function(v) {
      return elemWithBehaviors(Rect.value)([indexedNum("x")(function(v1) {
        return function(i) {
          return toNumber(i) * 50 + 5;
        };
      }), staticNum("y")(0), staticNum("width")(30), dataNum("height")(function(v1) {
        return v1.value;
      }), staticAttr("fill")("#0ff"), staticAttr("transform")("scale(1, -1)")])([onClickWithDatum(function(d) {
        return log2("Bar " + (d.label + (" = " + show3(d.value))));
      }), onHover({
        enter: [{
          attr: "fill",
          value: "#ff0"
        }],
        leave: [{
          attr: "fill",
          value: "#0ff"
        }]
      })])([]);
    })]);
  };
  var demo13 = /* @__PURE__ */ append22(/* @__PURE__ */ chartTitle("Compositional Chart"))(/* @__PURE__ */ append22(chartYAxis)(/* @__PURE__ */ append22(/* @__PURE__ */ chartXAxis(chartBarsData))(/* @__PURE__ */ append22(/* @__PURE__ */ chartBars(chartBarsData))(/* @__PURE__ */ chartLegend(true)))));
  var cellSize = 30;
  var demo3 = /* @__PURE__ */ (function() {
    return elemWithAttrs(Group.value)([staticAttr("transform")("translate(10, 10)")])([forEach("cells")(flattenBoard(sudokuBoard))(function(c) {
      return show1(c.rowIdx) + ("-" + show1(c.colIdx));
    })(function(v) {
      return elemWithBehaviors(Group.value)([dataNum("transform-translate-x")(function(c) {
        return toNumber(c.colIdx) * cellSize;
      })])([onClickWithDatum(function(cell) {
        return log2("Cell [" + (show1(cell.rowIdx) + ("," + (show1(cell.colIdx) + ("] = " + show1(cell.value))))));
      })])([elemWithBehaviors(Rect.value)([dataNum("x")(function(c) {
        return toNumber(c.colIdx) * cellSize;
      }), dataNum("y")(function(c) {
        return toNumber(c.rowIdx) * cellSize;
      }), staticNum("width")(cellSize - 2), staticNum("height")(cellSize - 2), staticAttr("fill")("#234"), staticAttr("stroke")("#567"), staticNum("stroke-width")(1)])([onHover({
        enter: [{
          attr: "fill",
          value: "#456"
        }],
        leave: [{
          attr: "fill",
          value: "#234"
        }]
      })])([]), elemWithAttrs(Text.value)([dataNum("x")(function(c) {
        return toNumber(c.colIdx) * cellSize + cellSize / 2 - 1;
      }), dataNum("y")(function(c) {
        return toNumber(c.rowIdx) * cellSize + cellSize / 2 + 5;
      }), staticAttr("text-anchor")("middle"), staticAttr("fill")("#fff"), staticAttr("font-size")("16"), staticAttr("font-family")("monospace"), dataStr("textContent")(function(c) {
        return show1(c.value);
      })])([])]);
    })]);
  })();
  var barWidth = 40;
  var barGap = 10;
  var demo2 = /* @__PURE__ */ (function() {
    return elemWithAttrs(Group.value)([staticAttr("transform")("translate(20, 130)")])([forEach("bars")(sampleBars)(function(v) {
      return v.label;
    })(function(v) {
      return elemWithBehaviors(Rect.value)([indexedNum("x")(function(v1) {
        return function(i) {
          return toNumber(i) * (barWidth + barGap);
        };
      }), staticNum("y")(0), staticNum("width")(barWidth), dataNum("height")(function(v1) {
        return v1.value;
      }), staticAttr("fill")("#f0f"), staticAttr("stroke")("#fff"), staticNum("stroke-width")(1), staticAttr("transform")("scale(1, -1)")])([onClickWithDatum(function(bar) {
        return log2("Clicked bar: " + (bar.label + (" = " + show3(bar.value))));
      }), onHover({
        enter: [{
          attr: "fill",
          value: "#ff0"
        }],
        leave: [{
          attr: "fill",
          value: "#f0f"
        }]
      })])([]);
    })]);
  })();
  var main = function __do2() {
    log2("HATS Demo - Interactive Visualizations")();
    log2("=======================================")();
    log2("\nDemo 1: Interactive Scatter Plot (click circles, hover to highlight)")();
    var selectionMap1 = render2("#demo1")(demo1)();
    log2("  Created selections: " + show22(keys2(selectionMap1)))();
    log2("\nDemo 2: Bar Chart (click bars, hover to highlight)")();
    var selectionMap2 = render2("#demo2")(demo2)();
    log2("  Created selections: " + show22(keys2(selectionMap2)))();
    log2("\nDemo 3: Sudoku Board (flattened [[Int]] - click cells)")();
    var selectionMap3 = render2("#demo3")(demo3)();
    log2("  Created selections: " + show22(keys2(selectionMap3)))();
    log2("\nDemo 4: Line Chart Points (click points)")();
    var selectionMap4 = render2("#demo4")(demo4)();
    log2("  Created selections: " + show22(keys2(selectionMap4)))();
    log2("\nDemo 5: Draggable Circles (drag to move)")();
    var selectionMap5 = render2("#demo5")(demo5)();
    log2("  Created selections: " + show22(keys2(selectionMap5)))();
    log2("\nDemo 6: Zoom/Pan (scroll to zoom, drag to pan)")();
    var selectionMap6 = render2("#demo6")(demo6)();
    log2("  Created selections: " + show22(keys2(selectionMap6)))();
    log2("\nDemo 7: GUP (add/remove/shuffle circles)")();
    demo7();
    log2("  Use buttons to add, remove, or shuffle circles")();
    log2("  Enter=green, Update=blue, Exit=red (briefly visible)")();
    log2("\nDemo 8: Tree Layout (Reingold-Tilford algorithm)")();
    var selectionMap8a = render2("#demo8")(demo8Links)();
    var selectionMap8b = render2("#demo8")(demo8Nodes)();
    log2("  Link selections: " + show22(keys2(selectionMap8a)))();
    log2("  Node selections: " + show22(keys2(selectionMap8b)))();
    log2("  Nodes: " + (show1(length4(treeNodes)) + (", Links: " + show1(length4(treeLinks)))))();
    log2("\nDemo 9: Force-Directed Graph (nodes repel, settle into equilibrium)")();
    var selectionMap9 = render2("#demo9")(demo9)();
    log2("  Created selections: " + show22(keys2(selectionMap9)))();
    startForceSimulation();
    log2("  Simulation running...")();
    log2("\nDemo 10: FromTree with Siblings (coalgebraic enumeration, flat output)")();
    var selectionMap10 = render2("#demo10")(demo10)();
    log2("  Created selections: " + show22(keys2(selectionMap10)))();
    log2("  Tree unfolds via coalgebra, renders as flat siblings")();
    log2("\nDemo 11: FromTree with Nested (preserved hierarchy in DOM)")();
    var selectionMap11 = render2("#demo11")(demo11)();
    log2("  Created selections: " + show22(keys2(selectionMap11)))();
    log2("  Tree structure preserved in DOM nesting")();
    log2("\nDemo 12: Heterogeneous Nodes (circles, squares, triangles)")();
    var selectionMap12 = render2("#demo12")(demo12)();
    log2("  Created selections: " + show22(keys2(selectionMap12)))();
    log2("  Template produces different elements based on data")();
    log2("\nDemo 13: Compositional Chart Building (Monoid)")();
    var selectionMap13 = render2("#demo13")(demo13)();
    log2("  Created selections: " + show22(keys2(selectionMap13)))();
    log2("  Chart = title <> yAxis <> xAxis <> bars <> legend")();
    return log2("\nDone! Try interacting with all the demos.")();
  };

  // <stdin>
  main();
})();
