/* Generated by Spago v0.93.45 */
(() => {
  // output/Control.Bind/foreign.js
  var arrayBind = typeof Array.prototype.flatMap === "function" ? function(arr) {
    return function(f) {
      return arr.flatMap(f);
    };
  } : function(arr) {
    return function(f) {
      var result = [];
      var l = arr.length;
      for (var i = 0; i < l; i++) {
        var xs = f(arr[i]);
        var k = xs.length;
        for (var j = 0; j < k; j++) {
          result.push(xs[j]);
        }
      }
      return result;
    };
  };

  // output/Control.Apply/foreign.js
  var arrayApply = function(fs) {
    return function(xs) {
      var l = fs.length;
      var k = xs.length;
      var result = new Array(l * k);
      var n = 0;
      for (var i = 0; i < l; i++) {
        var f = fs[i];
        for (var j = 0; j < k; j++) {
          result[n++] = f(xs[j]);
        }
      }
      return result;
    };
  };

  // output/Control.Semigroupoid/index.js
  var semigroupoidFn = {
    compose: function(f) {
      return function(g) {
        return function(x) {
          return f(g(x));
        };
      };
    }
  };

  // output/Control.Category/index.js
  var identity = function(dict) {
    return dict.identity;
  };
  var categoryFn = {
    identity: function(x) {
      return x;
    },
    Semigroupoid0: function() {
      return semigroupoidFn;
    }
  };

  // output/Data.Function/index.js
  var flip = function(f) {
    return function(b) {
      return function(a) {
        return f(a)(b);
      };
    };
  };
  var $$const = function(a) {
    return function(v) {
      return a;
    };
  };

  // output/Data.Functor/foreign.js
  var arrayMap = function(f) {
    return function(arr) {
      var l = arr.length;
      var result = new Array(l);
      for (var i = 0; i < l; i++) {
        result[i] = f(arr[i]);
      }
      return result;
    };
  };

  // output/Data.Unit/foreign.js
  var unit = void 0;

  // output/Type.Proxy/index.js
  var $$Proxy = /* @__PURE__ */ (function() {
    function $$Proxy2() {
    }
    ;
    $$Proxy2.value = new $$Proxy2();
    return $$Proxy2;
  })();

  // output/Data.Functor/index.js
  var map = function(dict) {
    return dict.map;
  };
  var mapFlipped = function(dictFunctor) {
    var map12 = map(dictFunctor);
    return function(fa) {
      return function(f) {
        return map12(f)(fa);
      };
    };
  };
  var $$void = function(dictFunctor) {
    return map(dictFunctor)($$const(unit));
  };
  var functorArray = {
    map: arrayMap
  };

  // output/Control.Apply/index.js
  var identity2 = /* @__PURE__ */ identity(categoryFn);
  var applyArray = {
    apply: arrayApply,
    Functor0: function() {
      return functorArray;
    }
  };
  var apply = function(dict) {
    return dict.apply;
  };
  var applySecond = function(dictApply) {
    var apply1 = apply(dictApply);
    var map11 = map(dictApply.Functor0());
    return function(a) {
      return function(b) {
        return apply1(map11($$const(identity2))(a))(b);
      };
    };
  };

  // output/Control.Applicative/index.js
  var pure = function(dict) {
    return dict.pure;
  };
  var unless = function(dictApplicative) {
    var pure1 = pure(dictApplicative);
    return function(v) {
      return function(v1) {
        if (!v) {
          return v1;
        }
        ;
        if (v) {
          return pure1(unit);
        }
        ;
        throw new Error("Failed pattern match at Control.Applicative (line 68, column 1 - line 68, column 65): " + [v.constructor.name, v1.constructor.name]);
      };
    };
  };
  var when = function(dictApplicative) {
    var pure1 = pure(dictApplicative);
    return function(v) {
      return function(v1) {
        if (v) {
          return v1;
        }
        ;
        if (!v) {
          return pure1(unit);
        }
        ;
        throw new Error("Failed pattern match at Control.Applicative (line 63, column 1 - line 63, column 63): " + [v.constructor.name, v1.constructor.name]);
      };
    };
  };
  var liftA1 = function(dictApplicative) {
    var apply2 = apply(dictApplicative.Apply0());
    var pure1 = pure(dictApplicative);
    return function(f) {
      return function(a) {
        return apply2(pure1(f))(a);
      };
    };
  };

  // output/Control.Bind/index.js
  var identity3 = /* @__PURE__ */ identity(categoryFn);
  var discard = function(dict) {
    return dict.discard;
  };
  var bindArray = {
    bind: arrayBind,
    Apply0: function() {
      return applyArray;
    }
  };
  var bind = function(dict) {
    return dict.bind;
  };
  var discardUnit = {
    discard: function(dictBind) {
      return bind(dictBind);
    }
  };
  var join = function(dictBind) {
    var bind12 = bind(dictBind);
    return function(m) {
      return bind12(m)(identity3);
    };
  };

  // output/Data.Semigroup/foreign.js
  var concatArray = function(xs) {
    return function(ys) {
      if (xs.length === 0) return ys;
      if (ys.length === 0) return xs;
      return xs.concat(ys);
    };
  };

  // output/Data.Symbol/index.js
  var reflectSymbol = function(dict) {
    return dict.reflectSymbol;
  };

  // output/Record.Unsafe/foreign.js
  var unsafeGet = function(label4) {
    return function(rec) {
      return rec[label4];
    };
  };

  // output/Data.Semigroup/index.js
  var semigroupArray = {
    append: concatArray
  };
  var append = function(dict) {
    return dict.append;
  };

  // output/Control.Monad/index.js
  var ap = function(dictMonad) {
    var bind3 = bind(dictMonad.Bind1());
    var pure5 = pure(dictMonad.Applicative0());
    return function(f) {
      return function(a) {
        return bind3(f)(function(f$prime) {
          return bind3(a)(function(a$prime) {
            return pure5(f$prime(a$prime));
          });
        });
      };
    };
  };

  // output/Data.Bounded/foreign.js
  var topChar = String.fromCharCode(65535);
  var bottomChar = String.fromCharCode(0);
  var topNumber = Number.POSITIVE_INFINITY;
  var bottomNumber = Number.NEGATIVE_INFINITY;

  // output/Data.Ord/foreign.js
  var unsafeCompareImpl = function(lt) {
    return function(eq3) {
      return function(gt) {
        return function(x) {
          return function(y) {
            return x < y ? lt : x === y ? eq3 : gt;
          };
        };
      };
    };
  };
  var ordIntImpl = unsafeCompareImpl;
  var ordNumberImpl = unsafeCompareImpl;
  var ordStringImpl = unsafeCompareImpl;

  // output/Data.Eq/foreign.js
  var refEq = function(r1) {
    return function(r2) {
      return r1 === r2;
    };
  };
  var eqBooleanImpl = refEq;
  var eqIntImpl = refEq;
  var eqNumberImpl = refEq;
  var eqStringImpl = refEq;

  // output/Data.Eq/index.js
  var eqString = {
    eq: eqStringImpl
  };
  var eqRowNil = {
    eqRecord: function(v) {
      return function(v1) {
        return function(v2) {
          return true;
        };
      };
    }
  };
  var eqRecord = function(dict) {
    return dict.eqRecord;
  };
  var eqRec = function() {
    return function(dictEqRecord) {
      return {
        eq: eqRecord(dictEqRecord)($$Proxy.value)
      };
    };
  };
  var eqNumber = {
    eq: eqNumberImpl
  };
  var eqInt = {
    eq: eqIntImpl
  };
  var eqBoolean = {
    eq: eqBooleanImpl
  };
  var eq1 = function(dict) {
    return dict.eq1;
  };
  var eq = function(dict) {
    return dict.eq;
  };
  var eq2 = /* @__PURE__ */ eq(eqBoolean);
  var eqRowCons = function(dictEqRecord) {
    var eqRecord1 = eqRecord(dictEqRecord);
    return function() {
      return function(dictIsSymbol) {
        var reflectSymbol2 = reflectSymbol(dictIsSymbol);
        return function(dictEq) {
          var eq3 = eq(dictEq);
          return {
            eqRecord: function(v) {
              return function(ra) {
                return function(rb) {
                  var tail2 = eqRecord1($$Proxy.value)(ra)(rb);
                  var key = reflectSymbol2($$Proxy.value);
                  var get2 = unsafeGet(key);
                  return eq3(get2(ra))(get2(rb)) && tail2;
                };
              };
            }
          };
        };
      };
    };
  };
  var notEq = function(dictEq) {
    var eq3 = eq(dictEq);
    return function(x) {
      return function(y) {
        return eq2(eq3(x)(y))(false);
      };
    };
  };

  // output/Data.Ordering/index.js
  var LT = /* @__PURE__ */ (function() {
    function LT2() {
    }
    ;
    LT2.value = new LT2();
    return LT2;
  })();
  var GT = /* @__PURE__ */ (function() {
    function GT2() {
    }
    ;
    GT2.value = new GT2();
    return GT2;
  })();
  var EQ = /* @__PURE__ */ (function() {
    function EQ2() {
    }
    ;
    EQ2.value = new EQ2();
    return EQ2;
  })();
  var eqOrdering = {
    eq: function(v) {
      return function(v1) {
        if (v instanceof LT && v1 instanceof LT) {
          return true;
        }
        ;
        if (v instanceof GT && v1 instanceof GT) {
          return true;
        }
        ;
        if (v instanceof EQ && v1 instanceof EQ) {
          return true;
        }
        ;
        return false;
      };
    }
  };

  // output/Data.Ring/foreign.js
  var intSub = function(x) {
    return function(y) {
      return x - y | 0;
    };
  };

  // output/Data.Semiring/foreign.js
  var intAdd = function(x) {
    return function(y) {
      return x + y | 0;
    };
  };
  var intMul = function(x) {
    return function(y) {
      return x * y | 0;
    };
  };

  // output/Data.Semiring/index.js
  var semiringInt = {
    add: intAdd,
    zero: 0,
    mul: intMul,
    one: 1
  };

  // output/Data.Ring/index.js
  var ringInt = {
    sub: intSub,
    Semiring0: function() {
      return semiringInt;
    }
  };

  // output/Data.Ord/index.js
  var eqRec2 = /* @__PURE__ */ eqRec();
  var notEq2 = /* @__PURE__ */ notEq(eqOrdering);
  var ordString = /* @__PURE__ */ (function() {
    return {
      compare: ordStringImpl(LT.value)(EQ.value)(GT.value),
      Eq0: function() {
        return eqString;
      }
    };
  })();
  var ordRecordNil = {
    compareRecord: function(v) {
      return function(v1) {
        return function(v2) {
          return EQ.value;
        };
      };
    },
    EqRecord0: function() {
      return eqRowNil;
    }
  };
  var ordNumber = /* @__PURE__ */ (function() {
    return {
      compare: ordNumberImpl(LT.value)(EQ.value)(GT.value),
      Eq0: function() {
        return eqNumber;
      }
    };
  })();
  var ordInt = /* @__PURE__ */ (function() {
    return {
      compare: ordIntImpl(LT.value)(EQ.value)(GT.value),
      Eq0: function() {
        return eqInt;
      }
    };
  })();
  var compareRecord = function(dict) {
    return dict.compareRecord;
  };
  var ordRecord = function() {
    return function(dictOrdRecord) {
      var eqRec1 = eqRec2(dictOrdRecord.EqRecord0());
      return {
        compare: compareRecord(dictOrdRecord)($$Proxy.value),
        Eq0: function() {
          return eqRec1;
        }
      };
    };
  };
  var compare1 = function(dict) {
    return dict.compare1;
  };
  var compare = function(dict) {
    return dict.compare;
  };
  var max = function(dictOrd) {
    var compare3 = compare(dictOrd);
    return function(x) {
      return function(y) {
        var v = compare3(x)(y);
        if (v instanceof LT) {
          return y;
        }
        ;
        if (v instanceof EQ) {
          return x;
        }
        ;
        if (v instanceof GT) {
          return x;
        }
        ;
        throw new Error("Failed pattern match at Data.Ord (line 181, column 3 - line 184, column 12): " + [v.constructor.name]);
      };
    };
  };
  var min = function(dictOrd) {
    var compare3 = compare(dictOrd);
    return function(x) {
      return function(y) {
        var v = compare3(x)(y);
        if (v instanceof LT) {
          return x;
        }
        ;
        if (v instanceof EQ) {
          return x;
        }
        ;
        if (v instanceof GT) {
          return y;
        }
        ;
        throw new Error("Failed pattern match at Data.Ord (line 172, column 3 - line 175, column 12): " + [v.constructor.name]);
      };
    };
  };
  var ordRecordCons = function(dictOrdRecord) {
    var compareRecord1 = compareRecord(dictOrdRecord);
    var eqRowCons2 = eqRowCons(dictOrdRecord.EqRecord0())();
    return function() {
      return function(dictIsSymbol) {
        var reflectSymbol2 = reflectSymbol(dictIsSymbol);
        var eqRowCons1 = eqRowCons2(dictIsSymbol);
        return function(dictOrd) {
          var compare3 = compare(dictOrd);
          var eqRowCons22 = eqRowCons1(dictOrd.Eq0());
          return {
            compareRecord: function(v) {
              return function(ra) {
                return function(rb) {
                  var key = reflectSymbol2($$Proxy.value);
                  var left = compare3(unsafeGet(key)(ra))(unsafeGet(key)(rb));
                  var $95 = notEq2(left)(EQ.value);
                  if ($95) {
                    return left;
                  }
                  ;
                  return compareRecord1($$Proxy.value)(ra)(rb);
                };
              };
            },
            EqRecord0: function() {
              return eqRowCons22;
            }
          };
        };
      };
    };
  };

  // output/Data.Show/foreign.js
  var showIntImpl = function(n) {
    return n.toString();
  };
  var showNumberImpl = function(n) {
    var str = n.toString();
    return isNaN(str + ".0") ? str : str + ".0";
  };
  var showStringImpl = function(s) {
    var l = s.length;
    return '"' + s.replace(
      /[\0-\x1F\x7F"\\]/g,
      // eslint-disable-line no-control-regex
      function(c, i) {
        switch (c) {
          case '"':
          case "\\":
            return "\\" + c;
          case "\x07":
            return "\\a";
          case "\b":
            return "\\b";
          case "\f":
            return "\\f";
          case "\n":
            return "\\n";
          case "\r":
            return "\\r";
          case "	":
            return "\\t";
          case "\v":
            return "\\v";
        }
        var k = i + 1;
        var empty5 = k < l && s[k] >= "0" && s[k] <= "9" ? "\\&" : "";
        return "\\" + c.charCodeAt(0).toString(10) + empty5;
      }
    ) + '"';
  };
  var showArrayImpl = function(f) {
    return function(xs) {
      var ss = [];
      for (var i = 0, l = xs.length; i < l; i++) {
        ss[i] = f(xs[i]);
      }
      return "[" + ss.join(",") + "]";
    };
  };

  // output/Data.Show/index.js
  var showString = {
    show: showStringImpl
  };
  var showNumber = {
    show: showNumberImpl
  };
  var showInt = {
    show: showIntImpl
  };
  var showBoolean = {
    show: function(v) {
      if (v) {
        return "true";
      }
      ;
      if (!v) {
        return "false";
      }
      ;
      throw new Error("Failed pattern match at Data.Show (line 29, column 1 - line 31, column 23): " + [v.constructor.name]);
    }
  };
  var show = function(dict) {
    return dict.show;
  };
  var showArray = function(dictShow) {
    return {
      show: showArrayImpl(show(dictShow))
    };
  };

  // output/Data.Maybe/index.js
  var identity4 = /* @__PURE__ */ identity(categoryFn);
  var Nothing = /* @__PURE__ */ (function() {
    function Nothing2() {
    }
    ;
    Nothing2.value = new Nothing2();
    return Nothing2;
  })();
  var Just = /* @__PURE__ */ (function() {
    function Just2(value0) {
      this.value0 = value0;
    }
    ;
    Just2.create = function(value0) {
      return new Just2(value0);
    };
    return Just2;
  })();
  var maybe = function(v) {
    return function(v1) {
      return function(v2) {
        if (v2 instanceof Nothing) {
          return v;
        }
        ;
        if (v2 instanceof Just) {
          return v1(v2.value0);
        }
        ;
        throw new Error("Failed pattern match at Data.Maybe (line 237, column 1 - line 237, column 51): " + [v.constructor.name, v1.constructor.name, v2.constructor.name]);
      };
    };
  };
  var isNothing = /* @__PURE__ */ maybe(true)(/* @__PURE__ */ $$const(false));
  var functorMaybe = {
    map: function(v) {
      return function(v1) {
        if (v1 instanceof Just) {
          return new Just(v(v1.value0));
        }
        ;
        return Nothing.value;
      };
    }
  };
  var fromMaybe = function(a) {
    return maybe(a)(identity4);
  };
  var fromJust = function() {
    return function(v) {
      if (v instanceof Just) {
        return v.value0;
      }
      ;
      throw new Error("Failed pattern match at Data.Maybe (line 288, column 1 - line 288, column 46): " + [v.constructor.name]);
    };
  };

  // output/Data.EuclideanRing/foreign.js
  var intDegree = function(x) {
    return Math.min(Math.abs(x), 2147483647);
  };
  var intDiv = function(x) {
    return function(y) {
      if (y === 0) return 0;
      return y > 0 ? Math.floor(x / y) : -Math.floor(x / -y);
    };
  };
  var intMod = function(x) {
    return function(y) {
      if (y === 0) return 0;
      var yy = Math.abs(y);
      return (x % yy + yy) % yy;
    };
  };

  // output/Data.CommutativeRing/index.js
  var commutativeRingInt = {
    Ring0: function() {
      return ringInt;
    }
  };

  // output/Data.EuclideanRing/index.js
  var mod = function(dict) {
    return dict.mod;
  };
  var euclideanRingInt = {
    degree: intDegree,
    div: intDiv,
    mod: intMod,
    CommutativeRing0: function() {
      return commutativeRingInt;
    }
  };

  // output/Data.Monoid/index.js
  var mempty = function(dict) {
    return dict.mempty;
  };

  // output/Effect/foreign.js
  var pureE = function(a) {
    return function() {
      return a;
    };
  };
  var bindE = function(a) {
    return function(f) {
      return function() {
        return f(a())();
      };
    };
  };

  // output/Effect/index.js
  var $runtime_lazy = function(name15, moduleName, init) {
    var state3 = 0;
    var val;
    return function(lineNumber) {
      if (state3 === 2) return val;
      if (state3 === 1) throw new ReferenceError(name15 + " was needed before it finished initializing (module " + moduleName + ", line " + lineNumber + ")", moduleName, lineNumber);
      state3 = 1;
      val = init();
      state3 = 2;
      return val;
    };
  };
  var monadEffect = {
    Applicative0: function() {
      return applicativeEffect;
    },
    Bind1: function() {
      return bindEffect;
    }
  };
  var bindEffect = {
    bind: bindE,
    Apply0: function() {
      return $lazy_applyEffect(0);
    }
  };
  var applicativeEffect = {
    pure: pureE,
    Apply0: function() {
      return $lazy_applyEffect(0);
    }
  };
  var $lazy_functorEffect = /* @__PURE__ */ $runtime_lazy("functorEffect", "Effect", function() {
    return {
      map: liftA1(applicativeEffect)
    };
  });
  var $lazy_applyEffect = /* @__PURE__ */ $runtime_lazy("applyEffect", "Effect", function() {
    return {
      apply: ap(monadEffect),
      Functor0: function() {
        return $lazy_functorEffect(0);
      }
    };
  });
  var functorEffect = /* @__PURE__ */ $lazy_functorEffect(20);

  // output/Effect.Ref/foreign.js
  var _new = function(val) {
    return function() {
      return { value: val };
    };
  };
  var read = function(ref) {
    return function() {
      return ref.value;
    };
  };
  var modifyImpl = function(f) {
    return function(ref) {
      return function() {
        var t = f(ref.value);
        ref.value = t.state;
        return t.value;
      };
    };
  };
  var write = function(val) {
    return function(ref) {
      return function() {
        ref.value = val;
      };
    };
  };

  // output/Effect.Ref/index.js
  var $$void2 = /* @__PURE__ */ $$void(functorEffect);
  var $$new = _new;
  var modify$prime = modifyImpl;
  var modify = function(f) {
    return modify$prime(function(s) {
      var s$prime = f(s);
      return {
        state: s$prime,
        value: s$prime
      };
    });
  };
  var modify_ = function(f) {
    return function(s) {
      return $$void2(modify(f)(s));
    };
  };

  // output/Data.Foldable/foreign.js
  var foldrArray = function(f) {
    return function(init) {
      return function(xs) {
        var acc = init;
        var len = xs.length;
        for (var i = len - 1; i >= 0; i--) {
          acc = f(xs[i])(acc);
        }
        return acc;
      };
    };
  };
  var foldlArray = function(f) {
    return function(init) {
      return function(xs) {
        var acc = init;
        var len = xs.length;
        for (var i = 0; i < len; i++) {
          acc = f(acc)(xs[i]);
        }
        return acc;
      };
    };
  };

  // output/Data.Tuple/index.js
  var Tuple = /* @__PURE__ */ (function() {
    function Tuple2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    Tuple2.create = function(value0) {
      return function(value1) {
        return new Tuple2(value0, value1);
      };
    };
    return Tuple2;
  })();
  var snd = function(v) {
    return v.value1;
  };
  var fst = function(v) {
    return v.value0;
  };

  // output/Unsafe.Coerce/foreign.js
  var unsafeCoerce2 = function(x) {
    return x;
  };

  // output/Safe.Coerce/index.js
  var coerce = function() {
    return unsafeCoerce2;
  };

  // output/Data.Newtype/index.js
  var coerce2 = /* @__PURE__ */ coerce();
  var unwrap = function() {
    return coerce2;
  };

  // output/Data.Foldable/index.js
  var foldr = function(dict) {
    return dict.foldr;
  };
  var traverse_ = function(dictApplicative) {
    var applySecond2 = applySecond(dictApplicative.Apply0());
    var pure5 = pure(dictApplicative);
    return function(dictFoldable) {
      var foldr2 = foldr(dictFoldable);
      return function(f) {
        return foldr2(function($454) {
          return applySecond2(f($454));
        })(pure5(unit));
      };
    };
  };
  var for_ = function(dictApplicative) {
    var traverse_1 = traverse_(dictApplicative);
    return function(dictFoldable) {
      return flip(traverse_1(dictFoldable));
    };
  };
  var foldl = function(dict) {
    return dict.foldl;
  };
  var foldMapDefaultR = function(dictFoldable) {
    var foldr2 = foldr(dictFoldable);
    return function(dictMonoid) {
      var append7 = append(dictMonoid.Semigroup0());
      var mempty2 = mempty(dictMonoid);
      return function(f) {
        return foldr2(function(x) {
          return function(acc) {
            return append7(f(x))(acc);
          };
        })(mempty2);
      };
    };
  };
  var foldableArray = {
    foldr: foldrArray,
    foldl: foldlArray,
    foldMap: function(dictMonoid) {
      return foldMapDefaultR(foldableArray)(dictMonoid);
    }
  };

  // output/Data.FunctorWithIndex/foreign.js
  var mapWithIndexArray = function(f) {
    return function(xs) {
      var l = xs.length;
      var result = Array(l);
      for (var i = 0; i < l; i++) {
        result[i] = f(i)(xs[i]);
      }
      return result;
    };
  };

  // output/Data.FunctorWithIndex/index.js
  var mapWithIndex = function(dict) {
    return dict.mapWithIndex;
  };
  var functorWithIndexArray = {
    mapWithIndex: mapWithIndexArray,
    Functor0: function() {
      return functorArray;
    }
  };

  // output/Data.FoldableWithIndex/index.js
  var foldr8 = /* @__PURE__ */ foldr(foldableArray);
  var mapWithIndex2 = /* @__PURE__ */ mapWithIndex(functorWithIndexArray);
  var foldl8 = /* @__PURE__ */ foldl(foldableArray);
  var foldrWithIndex = function(dict) {
    return dict.foldrWithIndex;
  };
  var traverseWithIndex_ = function(dictApplicative) {
    var applySecond2 = applySecond(dictApplicative.Apply0());
    var pure5 = pure(dictApplicative);
    return function(dictFoldableWithIndex) {
      var foldrWithIndex1 = foldrWithIndex(dictFoldableWithIndex);
      return function(f) {
        return foldrWithIndex1(function(i) {
          var $289 = f(i);
          return function($290) {
            return applySecond2($289($290));
          };
        })(pure5(unit));
      };
    };
  };
  var foldlWithIndex = function(dict) {
    return dict.foldlWithIndex;
  };
  var foldMapWithIndexDefaultR = function(dictFoldableWithIndex) {
    var foldrWithIndex1 = foldrWithIndex(dictFoldableWithIndex);
    return function(dictMonoid) {
      var append7 = append(dictMonoid.Semigroup0());
      var mempty2 = mempty(dictMonoid);
      return function(f) {
        return foldrWithIndex1(function(i) {
          return function(x) {
            return function(acc) {
              return append7(f(i)(x))(acc);
            };
          };
        })(mempty2);
      };
    };
  };
  var foldableWithIndexArray = {
    foldrWithIndex: function(f) {
      return function(z) {
        var $291 = foldr8(function(v) {
          return function(y) {
            return f(v.value0)(v.value1)(y);
          };
        })(z);
        var $292 = mapWithIndex2(Tuple.create);
        return function($293) {
          return $291($292($293));
        };
      };
    },
    foldlWithIndex: function(f) {
      return function(z) {
        var $294 = foldl8(function(y) {
          return function(v) {
            return f(v.value0)(y)(v.value1);
          };
        })(z);
        var $295 = mapWithIndex2(Tuple.create);
        return function($296) {
          return $294($295($296));
        };
      };
    },
    foldMapWithIndex: function(dictMonoid) {
      return foldMapWithIndexDefaultR(foldableWithIndexArray)(dictMonoid);
    },
    Foldable0: function() {
      return foldableArray;
    }
  };

  // output/Data.Traversable/foreign.js
  var traverseArrayImpl = /* @__PURE__ */ (function() {
    function array1(a) {
      return [a];
    }
    function array2(a) {
      return function(b) {
        return [a, b];
      };
    }
    function array3(a) {
      return function(b) {
        return function(c) {
          return [a, b, c];
        };
      };
    }
    function concat2(xs) {
      return function(ys) {
        return xs.concat(ys);
      };
    }
    return function(apply2) {
      return function(map11) {
        return function(pure5) {
          return function(f) {
            return function(array) {
              function go2(bot, top2) {
                switch (top2 - bot) {
                  case 0:
                    return pure5([]);
                  case 1:
                    return map11(array1)(f(array[bot]));
                  case 2:
                    return apply2(map11(array2)(f(array[bot])))(f(array[bot + 1]));
                  case 3:
                    return apply2(apply2(map11(array3)(f(array[bot])))(f(array[bot + 1])))(f(array[bot + 2]));
                  default:
                    var pivot = bot + Math.floor((top2 - bot) / 4) * 2;
                    return apply2(map11(concat2)(go2(bot, pivot)))(go2(pivot, top2));
                }
              }
              return go2(0, array.length);
            };
          };
        };
      };
    };
  })();

  // output/Data.Traversable/index.js
  var identity5 = /* @__PURE__ */ identity(categoryFn);
  var traverse = function(dict) {
    return dict.traverse;
  };
  var sequenceDefault = function(dictTraversable) {
    var traverse22 = traverse(dictTraversable);
    return function(dictApplicative) {
      return traverse22(dictApplicative)(identity5);
    };
  };
  var traversableArray = {
    traverse: function(dictApplicative) {
      var Apply0 = dictApplicative.Apply0();
      return traverseArrayImpl(apply(Apply0))(map(Apply0.Functor0()))(pure(dictApplicative));
    },
    sequence: function(dictApplicative) {
      return sequenceDefault(traversableArray)(dictApplicative);
    },
    Functor0: function() {
      return functorArray;
    },
    Foldable1: function() {
      return foldableArray;
    }
  };
  var sequence = function(dict) {
    return dict.sequence;
  };
  var $$for = function(dictApplicative) {
    return function(dictTraversable) {
      var traverse22 = traverse(dictTraversable)(dictApplicative);
      return function(x) {
        return function(f) {
          return traverse22(f)(x);
        };
      };
    };
  };

  // output/Data.TraversableWithIndex/index.js
  var traverseWithIndexDefault = function(dictTraversableWithIndex) {
    var sequence2 = sequence(dictTraversableWithIndex.Traversable2());
    var mapWithIndex3 = mapWithIndex(dictTraversableWithIndex.FunctorWithIndex0());
    return function(dictApplicative) {
      var sequence12 = sequence2(dictApplicative);
      return function(f) {
        var $174 = mapWithIndex3(f);
        return function($175) {
          return sequence12($174($175));
        };
      };
    };
  };
  var traverseWithIndex = function(dict) {
    return dict.traverseWithIndex;
  };
  var traversableWithIndexArray = {
    traverseWithIndex: function(dictApplicative) {
      return traverseWithIndexDefault(traversableWithIndexArray)(dictApplicative);
    },
    FunctorWithIndex0: function() {
      return functorWithIndexArray;
    },
    FoldableWithIndex1: function() {
      return foldableWithIndexArray;
    },
    Traversable2: function() {
      return traversableArray;
    }
  };

  // output/Data.Unfoldable/foreign.js
  var unfoldrArrayImpl = function(isNothing2) {
    return function(fromJust4) {
      return function(fst2) {
        return function(snd2) {
          return function(f) {
            return function(b) {
              var result = [];
              var value12 = b;
              while (true) {
                var maybe2 = f(value12);
                if (isNothing2(maybe2)) return result;
                var tuple = fromJust4(maybe2);
                result.push(fst2(tuple));
                value12 = snd2(tuple);
              }
            };
          };
        };
      };
    };
  };

  // output/Data.Unfoldable1/foreign.js
  var unfoldr1ArrayImpl = function(isNothing2) {
    return function(fromJust4) {
      return function(fst2) {
        return function(snd2) {
          return function(f) {
            return function(b) {
              var result = [];
              var value12 = b;
              while (true) {
                var tuple = f(value12);
                result.push(fst2(tuple));
                var maybe2 = snd2(tuple);
                if (isNothing2(maybe2)) return result;
                value12 = fromJust4(maybe2);
              }
            };
          };
        };
      };
    };
  };

  // output/Data.Unfoldable1/index.js
  var fromJust2 = /* @__PURE__ */ fromJust();
  var unfoldable1Array = {
    unfoldr1: /* @__PURE__ */ unfoldr1ArrayImpl(isNothing)(fromJust2)(fst)(snd)
  };

  // output/Data.Unfoldable/index.js
  var fromJust3 = /* @__PURE__ */ fromJust();
  var unfoldr = function(dict) {
    return dict.unfoldr;
  };
  var unfoldableArray = {
    unfoldr: /* @__PURE__ */ unfoldrArrayImpl(isNothing)(fromJust3)(fst)(snd),
    Unfoldable10: function() {
      return unfoldable1Array;
    }
  };

  // output/Data.List.Types/index.js
  var Nil = /* @__PURE__ */ (function() {
    function Nil2() {
    }
    ;
    Nil2.value = new Nil2();
    return Nil2;
  })();
  var Cons = /* @__PURE__ */ (function() {
    function Cons2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    Cons2.create = function(value0) {
      return function(value1) {
        return new Cons2(value0, value1);
      };
    };
    return Cons2;
  })();
  var foldableList = {
    foldr: function(f) {
      return function(b) {
        var rev3 = (function() {
          var go2 = function($copy_v) {
            return function($copy_v1) {
              var $tco_var_v = $copy_v;
              var $tco_done = false;
              var $tco_result;
              function $tco_loop(v, v1) {
                if (v1 instanceof Nil) {
                  $tco_done = true;
                  return v;
                }
                ;
                if (v1 instanceof Cons) {
                  $tco_var_v = new Cons(v1.value0, v);
                  $copy_v1 = v1.value1;
                  return;
                }
                ;
                throw new Error("Failed pattern match at Data.List.Types (line 107, column 7 - line 107, column 23): " + [v.constructor.name, v1.constructor.name]);
              }
              ;
              while (!$tco_done) {
                $tco_result = $tco_loop($tco_var_v, $copy_v1);
              }
              ;
              return $tco_result;
            };
          };
          return go2(Nil.value);
        })();
        var $284 = foldl(foldableList)(flip(f))(b);
        return function($285) {
          return $284(rev3($285));
        };
      };
    },
    foldl: function(f) {
      var go2 = function($copy_b) {
        return function($copy_v) {
          var $tco_var_b = $copy_b;
          var $tco_done1 = false;
          var $tco_result;
          function $tco_loop(b, v) {
            if (v instanceof Nil) {
              $tco_done1 = true;
              return b;
            }
            ;
            if (v instanceof Cons) {
              $tco_var_b = f(b)(v.value0);
              $copy_v = v.value1;
              return;
            }
            ;
            throw new Error("Failed pattern match at Data.List.Types (line 111, column 12 - line 113, column 30): " + [v.constructor.name]);
          }
          ;
          while (!$tco_done1) {
            $tco_result = $tco_loop($tco_var_b, $copy_v);
          }
          ;
          return $tco_result;
        };
      };
      return go2;
    },
    foldMap: function(dictMonoid) {
      var append22 = append(dictMonoid.Semigroup0());
      var mempty2 = mempty(dictMonoid);
      return function(f) {
        return foldl(foldableList)(function(acc) {
          var $286 = append22(acc);
          return function($287) {
            return $286(f($287));
          };
        })(mempty2);
      };
    }
  };
  var eq1List = {
    eq1: function(dictEq) {
      var eq3 = eq(dictEq);
      return function(xs) {
        return function(ys) {
          var go2 = function($copy_v) {
            return function($copy_v1) {
              return function($copy_v2) {
                var $tco_var_v = $copy_v;
                var $tco_var_v1 = $copy_v1;
                var $tco_done = false;
                var $tco_result;
                function $tco_loop(v, v1, v2) {
                  if (!v2) {
                    $tco_done = true;
                    return false;
                  }
                  ;
                  if (v instanceof Nil && v1 instanceof Nil) {
                    $tco_done = true;
                    return v2;
                  }
                  ;
                  if (v instanceof Cons && v1 instanceof Cons) {
                    $tco_var_v = v.value1;
                    $tco_var_v1 = v1.value1;
                    $copy_v2 = v2 && eq3(v1.value0)(v.value0);
                    return;
                  }
                  ;
                  $tco_done = true;
                  return false;
                }
                ;
                while (!$tco_done) {
                  $tco_result = $tco_loop($tco_var_v, $tco_var_v1, $copy_v2);
                }
                ;
                return $tco_result;
              };
            };
          };
          return go2(xs)(ys)(true);
        };
      };
    }
  };
  var ord1List = {
    compare1: function(dictOrd) {
      var compare3 = compare(dictOrd);
      return function(xs) {
        return function(ys) {
          var go2 = function($copy_v) {
            return function($copy_v1) {
              var $tco_var_v = $copy_v;
              var $tco_done = false;
              var $tco_result;
              function $tco_loop(v, v1) {
                if (v instanceof Nil && v1 instanceof Nil) {
                  $tco_done = true;
                  return EQ.value;
                }
                ;
                if (v instanceof Nil) {
                  $tco_done = true;
                  return LT.value;
                }
                ;
                if (v1 instanceof Nil) {
                  $tco_done = true;
                  return GT.value;
                }
                ;
                if (v instanceof Cons && v1 instanceof Cons) {
                  var v2 = compare3(v.value0)(v1.value0);
                  if (v2 instanceof EQ) {
                    $tco_var_v = v.value1;
                    $copy_v1 = v1.value1;
                    return;
                  }
                  ;
                  $tco_done = true;
                  return v2;
                }
                ;
                throw new Error("Failed pattern match at Data.List.Types (line 60, column 5 - line 60, column 20): " + [v.constructor.name, v1.constructor.name]);
              }
              ;
              while (!$tco_done) {
                $tco_result = $tco_loop($tco_var_v, $copy_v1);
              }
              ;
              return $tco_result;
            };
          };
          return go2(xs)(ys);
        };
      };
    },
    Eq10: function() {
      return eq1List;
    }
  };

  // output/Data.List/index.js
  var map2 = /* @__PURE__ */ map(functorMaybe);
  var uncons = function(v) {
    if (v instanceof Nil) {
      return Nothing.value;
    }
    ;
    if (v instanceof Cons) {
      return new Just({
        head: v.value0,
        tail: v.value1
      });
    }
    ;
    throw new Error("Failed pattern match at Data.List (line 259, column 1 - line 259, column 66): " + [v.constructor.name]);
  };
  var toUnfoldable = function(dictUnfoldable) {
    return unfoldr(dictUnfoldable)(function(xs) {
      return map2(function(rec) {
        return new Tuple(rec.head, rec.tail);
      })(uncons(xs));
    });
  };

  // output/Effect.Class/index.js
  var monadEffectEffect = {
    liftEffect: /* @__PURE__ */ identity(categoryFn),
    Monad0: function() {
      return monadEffect;
    }
  };
  var liftEffect = function(dict) {
    return dict.liftEffect;
  };

  // output/Data.Lazy/foreign.js
  var defer2 = function(thunk) {
    var v = null;
    return function() {
      if (thunk === void 0) return v;
      v = thunk();
      thunk = void 0;
      return v;
    };
  };
  var force = function(l) {
    return l();
  };

  // output/Control.Comonad.Cofree/index.js
  var tail = function(v) {
    return snd(force(v));
  };
  var mkCofree = function(a) {
    return function(t) {
      return defer2(function(v) {
        return new Tuple(a, t);
      });
    };
  };
  var head = function(v) {
    return fst(force(v));
  };
  var eqCofree = function(dictEq1) {
    var eq12 = eq1(dictEq1);
    return function(dictEq) {
      var eq3 = eq(dictEq);
      return {
        eq: function(x) {
          return function(y) {
            return eq3(head(x))(head(y)) && eq12(eqCofree(dictEq1)(dictEq))(tail(x))(tail(y));
          };
        }
      };
    };
  };
  var ordCofree = function(dictOrd1) {
    var compare12 = compare1(dictOrd1);
    var eqCofree1 = eqCofree(dictOrd1.Eq10());
    return function(dictOrd) {
      var compare3 = compare(dictOrd);
      var eqCofree2 = eqCofree1(dictOrd.Eq0());
      return {
        compare: function(x) {
          return function(y) {
            var v = compare3(head(x))(head(y));
            if (v instanceof EQ) {
              return compare12(ordCofree(dictOrd1)(dictOrd))(tail(x))(tail(y));
            }
            ;
            return v;
          };
        },
        Eq0: function() {
          return eqCofree2;
        }
      };
    };
  };

  // output/Data.Array/foreign.js
  var rangeImpl = function(start3, end) {
    var step2 = start3 > end ? -1 : 1;
    var result = new Array(step2 * (end - start3) + 1);
    var i = start3, n = 0;
    while (i !== end) {
      result[n++] = i;
      i += step2;
    }
    result[n] = i;
    return result;
  };
  var replicateFill = function(count, value12) {
    if (count < 1) {
      return [];
    }
    var result = new Array(count);
    return result.fill(value12);
  };
  var replicatePolyfill = function(count, value12) {
    var result = [];
    var n = 0;
    for (var i = 0; i < count; i++) {
      result[n++] = value12;
    }
    return result;
  };
  var replicateImpl = typeof Array.prototype.fill === "function" ? replicateFill : replicatePolyfill;
  var fromFoldableImpl = /* @__PURE__ */ (function() {
    function Cons2(head3, tail2) {
      this.head = head3;
      this.tail = tail2;
    }
    var emptyList = {};
    function curryCons(head3) {
      return function(tail2) {
        return new Cons2(head3, tail2);
      };
    }
    function listToArray(list) {
      var result = [];
      var count = 0;
      var xs = list;
      while (xs !== emptyList) {
        result[count++] = xs.head;
        xs = xs.tail;
      }
      return result;
    }
    return function(foldr2, xs) {
      return listToArray(foldr2(curryCons)(emptyList)(xs));
    };
  })();
  var length3 = function(xs) {
    return xs.length;
  };
  var indexImpl = function(just, nothing, xs, i) {
    return i < 0 || i >= xs.length ? nothing : just(xs[i]);
  };
  var findIndexImpl = function(just, nothing, f, xs) {
    for (var i = 0, l = xs.length; i < l; i++) {
      if (f(xs[i])) return just(i);
    }
    return nothing;
  };
  var _deleteAt = function(just, nothing, i, l) {
    if (i < 0 || i >= l.length) return nothing;
    var l1 = l.slice();
    l1.splice(i, 1);
    return just(l1);
  };
  var reverse2 = function(l) {
    return l.slice().reverse();
  };
  var concat = function(xss) {
    if (xss.length <= 1e4) {
      return Array.prototype.concat.apply([], xss);
    }
    var result = [];
    for (var i = 0, l = xss.length; i < l; i++) {
      var xs = xss[i];
      for (var j = 0, m = xs.length; j < m; j++) {
        result.push(xs[j]);
      }
    }
    return result;
  };
  var filterImpl = function(f, xs) {
    return xs.filter(f);
  };
  var sortByImpl = /* @__PURE__ */ (function() {
    function mergeFromTo(compare3, fromOrdering, xs1, xs2, from2, to) {
      var mid;
      var i;
      var j;
      var k;
      var x;
      var y;
      var c;
      mid = from2 + (to - from2 >> 1);
      if (mid - from2 > 1) mergeFromTo(compare3, fromOrdering, xs2, xs1, from2, mid);
      if (to - mid > 1) mergeFromTo(compare3, fromOrdering, xs2, xs1, mid, to);
      i = from2;
      j = mid;
      k = from2;
      while (i < mid && j < to) {
        x = xs2[i];
        y = xs2[j];
        c = fromOrdering(compare3(x)(y));
        if (c > 0) {
          xs1[k++] = y;
          ++j;
        } else {
          xs1[k++] = x;
          ++i;
        }
      }
      while (i < mid) {
        xs1[k++] = xs2[i++];
      }
      while (j < to) {
        xs1[k++] = xs2[j++];
      }
    }
    return function(compare3, fromOrdering, xs) {
      var out;
      if (xs.length < 2) return xs;
      out = xs.slice(0);
      mergeFromTo(compare3, fromOrdering, out, xs.slice(0), 0, xs.length);
      return out;
    };
  })();
  var zipWithImpl = function(f, xs, ys) {
    var l = xs.length < ys.length ? xs.length : ys.length;
    var result = new Array(l);
    for (var i = 0; i < l; i++) {
      result[i] = f(xs[i])(ys[i]);
    }
    return result;
  };
  var anyImpl = function(p, xs) {
    var len = xs.length;
    for (var i = 0; i < len; i++) {
      if (p(xs[i])) return true;
    }
    return false;
  };
  var unsafeIndexImpl = function(xs, n) {
    return xs[n];
  };

  // output/Data.Function.Uncurried/foreign.js
  var runFn2 = function(fn) {
    return function(a) {
      return function(b) {
        return fn(a, b);
      };
    };
  };
  var runFn3 = function(fn) {
    return function(a) {
      return function(b) {
        return function(c) {
          return fn(a, b, c);
        };
      };
    };
  };
  var runFn4 = function(fn) {
    return function(a) {
      return function(b) {
        return function(c) {
          return function(d) {
            return fn(a, b, c, d);
          };
        };
      };
    };
  };

  // output/Data.Array/index.js
  var map3 = /* @__PURE__ */ map(functorMaybe);
  var append2 = /* @__PURE__ */ append(semigroupArray);
  var zipWith = /* @__PURE__ */ runFn3(zipWithImpl);
  var unsafeIndex = function() {
    return runFn2(unsafeIndexImpl);
  };
  var unsafeIndex1 = /* @__PURE__ */ unsafeIndex();
  var sortBy = function(comp) {
    return runFn3(sortByImpl)(comp)(function(v) {
      if (v instanceof GT) {
        return 1;
      }
      ;
      if (v instanceof EQ) {
        return 0;
      }
      ;
      if (v instanceof LT) {
        return -1 | 0;
      }
      ;
      throw new Error("Failed pattern match at Data.Array (line 897, column 38 - line 900, column 11): " + [v.constructor.name]);
    });
  };
  var singleton3 = function(a) {
    return [a];
  };
  var replicate = /* @__PURE__ */ runFn2(replicateImpl);
  var range2 = /* @__PURE__ */ runFn2(rangeImpl);
  var $$null2 = function(xs) {
    return length3(xs) === 0;
  };
  var index = /* @__PURE__ */ (function() {
    return runFn4(indexImpl)(Just.create)(Nothing.value);
  })();
  var head2 = function(xs) {
    return index(xs)(0);
  };
  var fromFoldable = function(dictFoldable) {
    return runFn2(fromFoldableImpl)(foldr(dictFoldable));
  };
  var foldl2 = /* @__PURE__ */ foldl(foldableArray);
  var findIndex = /* @__PURE__ */ (function() {
    return runFn4(findIndexImpl)(Just.create)(Nothing.value);
  })();
  var find2 = function(f) {
    return function(xs) {
      return map3(unsafeIndex1(xs))(findIndex(f)(xs));
    };
  };
  var filter = /* @__PURE__ */ runFn2(filterImpl);
  var deleteAt = /* @__PURE__ */ (function() {
    return runFn4(_deleteAt)(Just.create)(Nothing.value);
  })();
  var cons = function(x) {
    return function(xs) {
      return append2([x])(xs);
    };
  };
  var concatMap = /* @__PURE__ */ flip(/* @__PURE__ */ bind(bindArray));
  var mapMaybe = function(f) {
    return concatMap((function() {
      var $189 = maybe([])(singleton3);
      return function($190) {
        return $189(f($190));
      };
    })());
  };
  var catMaybes = /* @__PURE__ */ mapMaybe(/* @__PURE__ */ identity(categoryFn));
  var any2 = /* @__PURE__ */ runFn2(anyImpl);

  // output/Data.Map.Internal/index.js
  var $runtime_lazy2 = function(name15, moduleName, init) {
    var state3 = 0;
    var val;
    return function(lineNumber) {
      if (state3 === 2) return val;
      if (state3 === 1) throw new ReferenceError(name15 + " was needed before it finished initializing (module " + moduleName + ", line " + lineNumber + ")", moduleName, lineNumber);
      state3 = 1;
      val = init();
      state3 = 2;
      return val;
    };
  };
  var Leaf = /* @__PURE__ */ (function() {
    function Leaf2() {
    }
    ;
    Leaf2.value = new Leaf2();
    return Leaf2;
  })();
  var Node = /* @__PURE__ */ (function() {
    function Node3(value0, value1, value22, value32, value42, value52) {
      this.value0 = value0;
      this.value1 = value1;
      this.value2 = value22;
      this.value3 = value32;
      this.value4 = value42;
      this.value5 = value52;
    }
    ;
    Node3.create = function(value0) {
      return function(value1) {
        return function(value22) {
          return function(value32) {
            return function(value42) {
              return function(value52) {
                return new Node3(value0, value1, value22, value32, value42, value52);
              };
            };
          };
        };
      };
    };
    return Node3;
  })();
  var IterLeaf = /* @__PURE__ */ (function() {
    function IterLeaf2() {
    }
    ;
    IterLeaf2.value = new IterLeaf2();
    return IterLeaf2;
  })();
  var IterEmit = /* @__PURE__ */ (function() {
    function IterEmit2(value0, value1, value22) {
      this.value0 = value0;
      this.value1 = value1;
      this.value2 = value22;
    }
    ;
    IterEmit2.create = function(value0) {
      return function(value1) {
        return function(value22) {
          return new IterEmit2(value0, value1, value22);
        };
      };
    };
    return IterEmit2;
  })();
  var IterNode = /* @__PURE__ */ (function() {
    function IterNode2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    IterNode2.create = function(value0) {
      return function(value1) {
        return new IterNode2(value0, value1);
      };
    };
    return IterNode2;
  })();
  var Split = /* @__PURE__ */ (function() {
    function Split2(value0, value1, value22) {
      this.value0 = value0;
      this.value1 = value1;
      this.value2 = value22;
    }
    ;
    Split2.create = function(value0) {
      return function(value1) {
        return function(value22) {
          return new Split2(value0, value1, value22);
        };
      };
    };
    return Split2;
  })();
  var SplitLast = /* @__PURE__ */ (function() {
    function SplitLast2(value0, value1, value22) {
      this.value0 = value0;
      this.value1 = value1;
      this.value2 = value22;
    }
    ;
    SplitLast2.create = function(value0) {
      return function(value1) {
        return function(value22) {
          return new SplitLast2(value0, value1, value22);
        };
      };
    };
    return SplitLast2;
  })();
  var unsafeNode = function(k, v, l, r) {
    if (l instanceof Leaf) {
      if (r instanceof Leaf) {
        return new Node(1, 1, k, v, l, r);
      }
      ;
      if (r instanceof Node) {
        return new Node(1 + r.value0 | 0, 1 + r.value1 | 0, k, v, l, r);
      }
      ;
      throw new Error("Failed pattern match at Data.Map.Internal (line 702, column 5 - line 706, column 39): " + [r.constructor.name]);
    }
    ;
    if (l instanceof Node) {
      if (r instanceof Leaf) {
        return new Node(1 + l.value0 | 0, 1 + l.value1 | 0, k, v, l, r);
      }
      ;
      if (r instanceof Node) {
        return new Node(1 + (function() {
          var $280 = l.value0 > r.value0;
          if ($280) {
            return l.value0;
          }
          ;
          return r.value0;
        })() | 0, (1 + l.value1 | 0) + r.value1 | 0, k, v, l, r);
      }
      ;
      throw new Error("Failed pattern match at Data.Map.Internal (line 708, column 5 - line 712, column 68): " + [r.constructor.name]);
    }
    ;
    throw new Error("Failed pattern match at Data.Map.Internal (line 700, column 32 - line 712, column 68): " + [l.constructor.name]);
  };
  var toMapIter = /* @__PURE__ */ (function() {
    return flip(IterNode.create)(IterLeaf.value);
  })();
  var stepWith = function(f) {
    return function(next) {
      return function(done) {
        var go2 = function($copy_v) {
          var $tco_done = false;
          var $tco_result;
          function $tco_loop(v) {
            if (v instanceof IterLeaf) {
              $tco_done = true;
              return done(unit);
            }
            ;
            if (v instanceof IterEmit) {
              $tco_done = true;
              return next(v.value0, v.value1, v.value2);
            }
            ;
            if (v instanceof IterNode) {
              $copy_v = f(v.value1)(v.value0);
              return;
            }
            ;
            throw new Error("Failed pattern match at Data.Map.Internal (line 940, column 8 - line 946, column 20): " + [v.constructor.name]);
          }
          ;
          while (!$tco_done) {
            $tco_result = $tco_loop($copy_v);
          }
          ;
          return $tco_result;
        };
        return go2;
      };
    };
  };
  var size = function(v) {
    if (v instanceof Leaf) {
      return 0;
    }
    ;
    if (v instanceof Node) {
      return v.value1;
    }
    ;
    throw new Error("Failed pattern match at Data.Map.Internal (line 618, column 8 - line 620, column 24): " + [v.constructor.name]);
  };
  var singleton4 = function(k) {
    return function(v) {
      return new Node(1, 1, k, v, Leaf.value, Leaf.value);
    };
  };
  var unsafeBalancedNode = /* @__PURE__ */ (function() {
    var height8 = function(v) {
      if (v instanceof Leaf) {
        return 0;
      }
      ;
      if (v instanceof Node) {
        return v.value0;
      }
      ;
      throw new Error("Failed pattern match at Data.Map.Internal (line 757, column 12 - line 759, column 26): " + [v.constructor.name]);
    };
    var rotateLeft = function(k, v, l, rk, rv, rl, rr) {
      if (rl instanceof Node && rl.value0 > height8(rr)) {
        return unsafeNode(rl.value2, rl.value3, unsafeNode(k, v, l, rl.value4), unsafeNode(rk, rv, rl.value5, rr));
      }
      ;
      return unsafeNode(rk, rv, unsafeNode(k, v, l, rl), rr);
    };
    var rotateRight = function(k, v, lk, lv, ll, lr, r) {
      if (lr instanceof Node && height8(ll) <= lr.value0) {
        return unsafeNode(lr.value2, lr.value3, unsafeNode(lk, lv, ll, lr.value4), unsafeNode(k, v, lr.value5, r));
      }
      ;
      return unsafeNode(lk, lv, ll, unsafeNode(k, v, lr, r));
    };
    return function(k, v, l, r) {
      if (l instanceof Leaf) {
        if (r instanceof Leaf) {
          return singleton4(k)(v);
        }
        ;
        if (r instanceof Node && r.value0 > 1) {
          return rotateLeft(k, v, l, r.value2, r.value3, r.value4, r.value5);
        }
        ;
        return unsafeNode(k, v, l, r);
      }
      ;
      if (l instanceof Node) {
        if (r instanceof Node) {
          if (r.value0 > (l.value0 + 1 | 0)) {
            return rotateLeft(k, v, l, r.value2, r.value3, r.value4, r.value5);
          }
          ;
          if (l.value0 > (r.value0 + 1 | 0)) {
            return rotateRight(k, v, l.value2, l.value3, l.value4, l.value5, r);
          }
          ;
        }
        ;
        if (r instanceof Leaf && l.value0 > 1) {
          return rotateRight(k, v, l.value2, l.value3, l.value4, l.value5, r);
        }
        ;
        return unsafeNode(k, v, l, r);
      }
      ;
      throw new Error("Failed pattern match at Data.Map.Internal (line 717, column 40 - line 738, column 34): " + [l.constructor.name]);
    };
  })();
  var $lazy_unsafeSplit = /* @__PURE__ */ $runtime_lazy2("unsafeSplit", "Data.Map.Internal", function() {
    return function(comp, k, m) {
      if (m instanceof Leaf) {
        return new Split(Nothing.value, Leaf.value, Leaf.value);
      }
      ;
      if (m instanceof Node) {
        var v = comp(k)(m.value2);
        if (v instanceof LT) {
          var v1 = $lazy_unsafeSplit(793)(comp, k, m.value4);
          return new Split(v1.value0, v1.value1, unsafeBalancedNode(m.value2, m.value3, v1.value2, m.value5));
        }
        ;
        if (v instanceof GT) {
          var v1 = $lazy_unsafeSplit(796)(comp, k, m.value5);
          return new Split(v1.value0, unsafeBalancedNode(m.value2, m.value3, m.value4, v1.value1), v1.value2);
        }
        ;
        if (v instanceof EQ) {
          return new Split(new Just(m.value3), m.value4, m.value5);
        }
        ;
        throw new Error("Failed pattern match at Data.Map.Internal (line 791, column 5 - line 799, column 30): " + [v.constructor.name]);
      }
      ;
      throw new Error("Failed pattern match at Data.Map.Internal (line 787, column 34 - line 799, column 30): " + [m.constructor.name]);
    };
  });
  var unsafeSplit = /* @__PURE__ */ $lazy_unsafeSplit(786);
  var $lazy_unsafeSplitLast = /* @__PURE__ */ $runtime_lazy2("unsafeSplitLast", "Data.Map.Internal", function() {
    return function(k, v, l, r) {
      if (r instanceof Leaf) {
        return new SplitLast(k, v, l);
      }
      ;
      if (r instanceof Node) {
        var v1 = $lazy_unsafeSplitLast(779)(r.value2, r.value3, r.value4, r.value5);
        return new SplitLast(v1.value0, v1.value1, unsafeBalancedNode(k, v, l, v1.value2));
      }
      ;
      throw new Error("Failed pattern match at Data.Map.Internal (line 776, column 37 - line 780, column 57): " + [r.constructor.name]);
    };
  });
  var unsafeSplitLast = /* @__PURE__ */ $lazy_unsafeSplitLast(775);
  var unsafeJoinNodes = function(v, v1) {
    if (v instanceof Leaf) {
      return v1;
    }
    ;
    if (v instanceof Node) {
      var v2 = unsafeSplitLast(v.value2, v.value3, v.value4, v.value5);
      return unsafeBalancedNode(v2.value0, v2.value1, v2.value2, v1);
    }
    ;
    throw new Error("Failed pattern match at Data.Map.Internal (line 764, column 25 - line 768, column 38): " + [v.constructor.name, v1.constructor.name]);
  };
  var $lazy_unsafeUnionWith = /* @__PURE__ */ $runtime_lazy2("unsafeUnionWith", "Data.Map.Internal", function() {
    return function(comp, app, l, r) {
      if (l instanceof Leaf) {
        return r;
      }
      ;
      if (r instanceof Leaf) {
        return l;
      }
      ;
      if (r instanceof Node) {
        var v = unsafeSplit(comp, r.value2, l);
        var l$prime = $lazy_unsafeUnionWith(809)(comp, app, v.value1, r.value4);
        var r$prime = $lazy_unsafeUnionWith(810)(comp, app, v.value2, r.value5);
        if (v.value0 instanceof Just) {
          return unsafeBalancedNode(r.value2, app(v.value0.value0)(r.value3), l$prime, r$prime);
        }
        ;
        if (v.value0 instanceof Nothing) {
          return unsafeBalancedNode(r.value2, r.value3, l$prime, r$prime);
        }
        ;
        throw new Error("Failed pattern match at Data.Map.Internal (line 811, column 5 - line 815, column 46): " + [v.value0.constructor.name]);
      }
      ;
      throw new Error("Failed pattern match at Data.Map.Internal (line 804, column 42 - line 815, column 46): " + [l.constructor.name, r.constructor.name]);
    };
  });
  var unsafeUnionWith = /* @__PURE__ */ $lazy_unsafeUnionWith(803);
  var unionWith = function(dictOrd) {
    var compare3 = compare(dictOrd);
    return function(app) {
      return function(m1) {
        return function(m2) {
          return unsafeUnionWith(compare3, app, m1, m2);
        };
      };
    };
  };
  var union = function(dictOrd) {
    return unionWith(dictOrd)($$const);
  };
  var update = function(dictOrd) {
    var compare3 = compare(dictOrd);
    return function(f) {
      return function(k) {
        var go2 = function(v) {
          if (v instanceof Leaf) {
            return Leaf.value;
          }
          ;
          if (v instanceof Node) {
            var v1 = compare3(k)(v.value2);
            if (v1 instanceof LT) {
              return unsafeBalancedNode(v.value2, v.value3, go2(v.value4), v.value5);
            }
            ;
            if (v1 instanceof GT) {
              return unsafeBalancedNode(v.value2, v.value3, v.value4, go2(v.value5));
            }
            ;
            if (v1 instanceof EQ) {
              var v2 = f(v.value3);
              if (v2 instanceof Nothing) {
                return unsafeJoinNodes(v.value4, v.value5);
              }
              ;
              if (v2 instanceof Just) {
                return new Node(v.value0, v.value1, v.value2, v2.value0, v.value4, v.value5);
              }
              ;
              throw new Error("Failed pattern match at Data.Map.Internal (line 531, column 11 - line 535, column 38): " + [v2.constructor.name]);
            }
            ;
            throw new Error("Failed pattern match at Data.Map.Internal (line 527, column 7 - line 535, column 38): " + [v1.constructor.name]);
          }
          ;
          throw new Error("Failed pattern match at Data.Map.Internal (line 524, column 8 - line 535, column 38): " + [v.constructor.name]);
        };
        return go2;
      };
    };
  };
  var lookup = function(dictOrd) {
    var compare3 = compare(dictOrd);
    return function(k) {
      var go2 = function($copy_v) {
        var $tco_done = false;
        var $tco_result;
        function $tco_loop(v) {
          if (v instanceof Leaf) {
            $tco_done = true;
            return Nothing.value;
          }
          ;
          if (v instanceof Node) {
            var v1 = compare3(k)(v.value2);
            if (v1 instanceof LT) {
              $copy_v = v.value4;
              return;
            }
            ;
            if (v1 instanceof GT) {
              $copy_v = v.value5;
              return;
            }
            ;
            if (v1 instanceof EQ) {
              $tco_done = true;
              return new Just(v.value3);
            }
            ;
            throw new Error("Failed pattern match at Data.Map.Internal (line 283, column 7 - line 286, column 22): " + [v1.constructor.name]);
          }
          ;
          throw new Error("Failed pattern match at Data.Map.Internal (line 280, column 8 - line 286, column 22): " + [v.constructor.name]);
        }
        ;
        while (!$tco_done) {
          $tco_result = $tco_loop($copy_v);
        }
        ;
        return $tco_result;
      };
      return go2;
    };
  };
  var iterMapL = /* @__PURE__ */ (function() {
    var go2 = function($copy_iter) {
      return function($copy_v) {
        var $tco_var_iter = $copy_iter;
        var $tco_done = false;
        var $tco_result;
        function $tco_loop(iter, v) {
          if (v instanceof Leaf) {
            $tco_done = true;
            return iter;
          }
          ;
          if (v instanceof Node) {
            if (v.value5 instanceof Leaf) {
              $tco_var_iter = new IterEmit(v.value2, v.value3, iter);
              $copy_v = v.value4;
              return;
            }
            ;
            $tco_var_iter = new IterEmit(v.value2, v.value3, new IterNode(v.value5, iter));
            $copy_v = v.value4;
            return;
          }
          ;
          throw new Error("Failed pattern match at Data.Map.Internal (line 951, column 13 - line 958, column 48): " + [v.constructor.name]);
        }
        ;
        while (!$tco_done) {
          $tco_result = $tco_loop($tco_var_iter, $copy_v);
        }
        ;
        return $tco_result;
      };
    };
    return go2;
  })();
  var stepAscCps = /* @__PURE__ */ stepWith(iterMapL);
  var stepUnfoldr = /* @__PURE__ */ (function() {
    var step2 = function(k, v, next) {
      return new Just(new Tuple(new Tuple(k, v), next));
    };
    return stepAscCps(step2)(function(v) {
      return Nothing.value;
    });
  })();
  var toUnfoldable2 = function(dictUnfoldable) {
    var $784 = unfoldr(dictUnfoldable)(stepUnfoldr);
    return function($785) {
      return $784(toMapIter($785));
    };
  };
  var insert = function(dictOrd) {
    var compare3 = compare(dictOrd);
    return function(k) {
      return function(v) {
        var go2 = function(v1) {
          if (v1 instanceof Leaf) {
            return singleton4(k)(v);
          }
          ;
          if (v1 instanceof Node) {
            var v2 = compare3(k)(v1.value2);
            if (v2 instanceof LT) {
              return unsafeBalancedNode(v1.value2, v1.value3, go2(v1.value4), v1.value5);
            }
            ;
            if (v2 instanceof GT) {
              return unsafeBalancedNode(v1.value2, v1.value3, v1.value4, go2(v1.value5));
            }
            ;
            if (v2 instanceof EQ) {
              return new Node(v1.value0, v1.value1, k, v, v1.value4, v1.value5);
            }
            ;
            throw new Error("Failed pattern match at Data.Map.Internal (line 471, column 7 - line 474, column 35): " + [v2.constructor.name]);
          }
          ;
          throw new Error("Failed pattern match at Data.Map.Internal (line 468, column 8 - line 474, column 35): " + [v1.constructor.name]);
        };
        return go2;
      };
    };
  };
  var functorMap = {
    map: function(f) {
      var go2 = function(v) {
        if (v instanceof Leaf) {
          return Leaf.value;
        }
        ;
        if (v instanceof Node) {
          return new Node(v.value0, v.value1, v.value2, f(v.value3), go2(v.value4), go2(v.value5));
        }
        ;
        throw new Error("Failed pattern match at Data.Map.Internal (line 147, column 10 - line 150, column 39): " + [v.constructor.name]);
      };
      return go2;
    }
  };
  var foldableMap = {
    foldr: function(f) {
      return function(z) {
        var $lazy_go = $runtime_lazy2("go", "Data.Map.Internal", function() {
          return function(m$prime, z$prime) {
            if (m$prime instanceof Leaf) {
              return z$prime;
            }
            ;
            if (m$prime instanceof Node) {
              return $lazy_go(172)(m$prime.value4, f(m$prime.value3)($lazy_go(172)(m$prime.value5, z$prime)));
            }
            ;
            throw new Error("Failed pattern match at Data.Map.Internal (line 169, column 26 - line 172, column 43): " + [m$prime.constructor.name]);
          };
        });
        var go2 = $lazy_go(169);
        return function(m) {
          return go2(m, z);
        };
      };
    },
    foldl: function(f) {
      return function(z) {
        var $lazy_go = $runtime_lazy2("go", "Data.Map.Internal", function() {
          return function(z$prime, m$prime) {
            if (m$prime instanceof Leaf) {
              return z$prime;
            }
            ;
            if (m$prime instanceof Node) {
              return $lazy_go(178)(f($lazy_go(178)(z$prime, m$prime.value4))(m$prime.value3), m$prime.value5);
            }
            ;
            throw new Error("Failed pattern match at Data.Map.Internal (line 175, column 26 - line 178, column 43): " + [m$prime.constructor.name]);
          };
        });
        var go2 = $lazy_go(175);
        return function(m) {
          return go2(z, m);
        };
      };
    },
    foldMap: function(dictMonoid) {
      var mempty2 = mempty(dictMonoid);
      var append13 = append(dictMonoid.Semigroup0());
      return function(f) {
        var go2 = function(v) {
          if (v instanceof Leaf) {
            return mempty2;
          }
          ;
          if (v instanceof Node) {
            return append13(go2(v.value4))(append13(f(v.value3))(go2(v.value5)));
          }
          ;
          throw new Error("Failed pattern match at Data.Map.Internal (line 181, column 10 - line 184, column 28): " + [v.constructor.name]);
        };
        return go2;
      };
    }
  };
  var foldableWithIndexMap = {
    foldrWithIndex: function(f) {
      return function(z) {
        var $lazy_go = $runtime_lazy2("go", "Data.Map.Internal", function() {
          return function(m$prime, z$prime) {
            if (m$prime instanceof Leaf) {
              return z$prime;
            }
            ;
            if (m$prime instanceof Node) {
              return $lazy_go(192)(m$prime.value4, f(m$prime.value2)(m$prime.value3)($lazy_go(192)(m$prime.value5, z$prime)));
            }
            ;
            throw new Error("Failed pattern match at Data.Map.Internal (line 189, column 26 - line 192, column 45): " + [m$prime.constructor.name]);
          };
        });
        var go2 = $lazy_go(189);
        return function(m) {
          return go2(m, z);
        };
      };
    },
    foldlWithIndex: function(f) {
      return function(z) {
        var $lazy_go = $runtime_lazy2("go", "Data.Map.Internal", function() {
          return function(z$prime, m$prime) {
            if (m$prime instanceof Leaf) {
              return z$prime;
            }
            ;
            if (m$prime instanceof Node) {
              return $lazy_go(198)(f(m$prime.value2)($lazy_go(198)(z$prime, m$prime.value4))(m$prime.value3), m$prime.value5);
            }
            ;
            throw new Error("Failed pattern match at Data.Map.Internal (line 195, column 26 - line 198, column 45): " + [m$prime.constructor.name]);
          };
        });
        var go2 = $lazy_go(195);
        return function(m) {
          return go2(z, m);
        };
      };
    },
    foldMapWithIndex: function(dictMonoid) {
      var mempty2 = mempty(dictMonoid);
      var append13 = append(dictMonoid.Semigroup0());
      return function(f) {
        var go2 = function(v) {
          if (v instanceof Leaf) {
            return mempty2;
          }
          ;
          if (v instanceof Node) {
            return append13(go2(v.value4))(append13(f(v.value2)(v.value3))(go2(v.value5)));
          }
          ;
          throw new Error("Failed pattern match at Data.Map.Internal (line 201, column 10 - line 204, column 30): " + [v.constructor.name]);
        };
        return go2;
      };
    },
    Foldable0: function() {
      return foldableMap;
    }
  };
  var keys = /* @__PURE__ */ (function() {
    return foldrWithIndex(foldableWithIndexMap)(function(k) {
      return function(v) {
        return function(acc) {
          return new Cons(k, acc);
        };
      };
    })(Nil.value);
  })();
  var empty4 = /* @__PURE__ */ (function() {
    return Leaf.value;
  })();
  var $$delete = function(dictOrd) {
    var compare3 = compare(dictOrd);
    return function(k) {
      var go2 = function(v) {
        if (v instanceof Leaf) {
          return Leaf.value;
        }
        ;
        if (v instanceof Node) {
          var v1 = compare3(k)(v.value2);
          if (v1 instanceof LT) {
            return unsafeBalancedNode(v.value2, v.value3, go2(v.value4), v.value5);
          }
          ;
          if (v1 instanceof GT) {
            return unsafeBalancedNode(v.value2, v.value3, v.value4, go2(v.value5));
          }
          ;
          if (v1 instanceof EQ) {
            return unsafeJoinNodes(v.value4, v.value5);
          }
          ;
          throw new Error("Failed pattern match at Data.Map.Internal (line 498, column 7 - line 501, column 43): " + [v1.constructor.name]);
        }
        ;
        throw new Error("Failed pattern match at Data.Map.Internal (line 495, column 8 - line 501, column 43): " + [v.constructor.name]);
      };
      return go2;
    };
  };

  // output/Data.Set/index.js
  var $$Set = function(x) {
    return x;
  };
  var toList = function(v) {
    return keys(v);
  };
  var toUnfoldable3 = function(dictUnfoldable) {
    var $96 = toUnfoldable(dictUnfoldable);
    return function($97) {
      return $96(toList($97));
    };
  };
  var toUnfoldable1 = /* @__PURE__ */ toUnfoldable3(unfoldableArray);
  var showSet = function(dictShow) {
    var show7 = show(showArray(dictShow));
    return {
      show: function(s) {
        return "(fromFoldable " + (show7(toUnfoldable1(s)) + ")");
      }
    };
  };
  var fromMap = $$Set;

  // output/Data.Map/index.js
  var keys2 = /* @__PURE__ */ (function() {
    var $38 = $$void(functorMap);
    return function($39) {
      return fromMap($38($39));
    };
  })();

  // output/Data.Tree/index.js
  var mkTree = mkCofree;

  // output/Effect.Console/foreign.js
  var log = function(s) {
    return function() {
      console.log(s);
    };
  };

  // output/Effect.Class.Console/index.js
  var log2 = function(dictMonadEffect) {
    var $67 = liftEffect(dictMonadEffect);
    return function($68) {
      return $67(log($68));
    };
  };

  // output/Partial.Unsafe/foreign.js
  var _unsafePartial = function(f) {
    return f();
  };

  // output/Partial/foreign.js
  var _crashWith = function(msg) {
    throw new Error(msg);
  };

  // output/Partial/index.js
  var crashWith = function() {
    return _crashWith;
  };

  // output/Partial.Unsafe/index.js
  var crashWith2 = /* @__PURE__ */ crashWith();
  var unsafePartial = _unsafePartial;
  var unsafeCrashWith = function(msg) {
    return unsafePartial(function() {
      return crashWith2(msg);
    });
  };

  // output/PSD3.Internal.Selection.Types/index.js
  var show2 = /* @__PURE__ */ show(showInt);
  var EmptySelection = /* @__PURE__ */ (function() {
    function EmptySelection2(value0) {
      this.value0 = value0;
    }
    ;
    EmptySelection2.create = function(value0) {
      return new EmptySelection2(value0);
    };
    return EmptySelection2;
  })();
  var BoundSelection = /* @__PURE__ */ (function() {
    function BoundSelection2(value0) {
      this.value0 = value0;
    }
    ;
    BoundSelection2.create = function(value0) {
      return new BoundSelection2(value0);
    };
    return BoundSelection2;
  })();
  var PendingSelection = /* @__PURE__ */ (function() {
    function PendingSelection2(value0) {
      this.value0 = value0;
    }
    ;
    PendingSelection2.create = function(value0) {
      return new PendingSelection2(value0);
    };
    return PendingSelection2;
  })();
  var ExitingSelection = /* @__PURE__ */ (function() {
    function ExitingSelection2(value0) {
      this.value0 = value0;
    }
    ;
    ExitingSelection2.create = function(value0) {
      return new ExitingSelection2(value0);
    };
    return ExitingSelection2;
  })();
  var SVGContext = /* @__PURE__ */ (function() {
    function SVGContext2() {
    }
    ;
    SVGContext2.value = new SVGContext2();
    return SVGContext2;
  })();
  var HTMLContext = /* @__PURE__ */ (function() {
    function HTMLContext2() {
    }
    ;
    HTMLContext2.value = new HTMLContext2();
    return HTMLContext2;
  })();
  var JoinResult = /* @__PURE__ */ (function() {
    function JoinResult2(value0) {
      this.value0 = value0;
    }
    ;
    JoinResult2.create = function(value0) {
      return new JoinResult2(value0);
    };
    return JoinResult2;
  })();
  var Circle = /* @__PURE__ */ (function() {
    function Circle3() {
    }
    ;
    Circle3.value = new Circle3();
    return Circle3;
  })();
  var Rect = /* @__PURE__ */ (function() {
    function Rect2() {
    }
    ;
    Rect2.value = new Rect2();
    return Rect2;
  })();
  var Path = /* @__PURE__ */ (function() {
    function Path2() {
    }
    ;
    Path2.value = new Path2();
    return Path2;
  })();
  var Line = /* @__PURE__ */ (function() {
    function Line2() {
    }
    ;
    Line2.value = new Line2();
    return Line2;
  })();
  var Text = /* @__PURE__ */ (function() {
    function Text2() {
    }
    ;
    Text2.value = new Text2();
    return Text2;
  })();
  var Group = /* @__PURE__ */ (function() {
    function Group2() {
    }
    ;
    Group2.value = new Group2();
    return Group2;
  })();
  var SVG = /* @__PURE__ */ (function() {
    function SVG2() {
    }
    ;
    SVG2.value = new SVG2();
    return SVG2;
  })();
  var Defs = /* @__PURE__ */ (function() {
    function Defs2() {
    }
    ;
    Defs2.value = new Defs2();
    return Defs2;
  })();
  var LinearGradient = /* @__PURE__ */ (function() {
    function LinearGradient2() {
    }
    ;
    LinearGradient2.value = new LinearGradient2();
    return LinearGradient2;
  })();
  var Stop = /* @__PURE__ */ (function() {
    function Stop2() {
    }
    ;
    Stop2.value = new Stop2();
    return Stop2;
  })();
  var PatternFill = /* @__PURE__ */ (function() {
    function PatternFill2() {
    }
    ;
    PatternFill2.value = new PatternFill2();
    return PatternFill2;
  })();
  var Div = /* @__PURE__ */ (function() {
    function Div2() {
    }
    ;
    Div2.value = new Div2();
    return Div2;
  })();
  var Span = /* @__PURE__ */ (function() {
    function Span2() {
    }
    ;
    Span2.value = new Span2();
    return Span2;
  })();
  var Table = /* @__PURE__ */ (function() {
    function Table2() {
    }
    ;
    Table2.value = new Table2();
    return Table2;
  })();
  var Tr = /* @__PURE__ */ (function() {
    function Tr2() {
    }
    ;
    Tr2.value = new Tr2();
    return Tr2;
  })();
  var Td = /* @__PURE__ */ (function() {
    function Td2() {
    }
    ;
    Td2.value = new Td2();
    return Td2;
  })();
  var Th = /* @__PURE__ */ (function() {
    function Th2() {
    }
    ;
    Th2.value = new Th2();
    return Th2;
  })();
  var Tbody = /* @__PURE__ */ (function() {
    function Tbody2() {
    }
    ;
    Tbody2.value = new Tbody2();
    return Tbody2;
  })();
  var Thead = /* @__PURE__ */ (function() {
    function Thead2() {
    }
    ;
    Thead2.value = new Thead2();
    return Thead2;
  })();
  var mkExitingSelection = function(elements) {
    return function(dataArray) {
      return function(doc) {
        var $323 = length3(elements) !== length3(dataArray);
        if ($323) {
          return unsafeCrashWith("ExitingSelection invariant violated: " + (show2(length3(elements)) + (" elements vs " + (show2(length3(dataArray)) + " data items"))));
        }
        ;
        return new ExitingSelection({
          elements,
          data: dataArray,
          document: doc
        });
      };
    };
  };
  var mkBoundSelection = function(elements) {
    return function(dataArray) {
      return function(indices) {
        return function(doc) {
          var $324 = length3(elements) !== length3(dataArray);
          if ($324) {
            return unsafeCrashWith("BoundSelection invariant violated: " + (show2(length3(elements)) + (" elements vs " + (show2(length3(dataArray)) + " data items"))));
          }
          ;
          return new BoundSelection({
            elements,
            data: dataArray,
            indices,
            document: doc
          });
        };
      };
    };
  };
  var elementContext = function(v) {
    if (v instanceof Circle) {
      return SVGContext.value;
    }
    ;
    if (v instanceof Rect) {
      return SVGContext.value;
    }
    ;
    if (v instanceof Path) {
      return SVGContext.value;
    }
    ;
    if (v instanceof Line) {
      return SVGContext.value;
    }
    ;
    if (v instanceof Text) {
      return SVGContext.value;
    }
    ;
    if (v instanceof Group) {
      return SVGContext.value;
    }
    ;
    if (v instanceof SVG) {
      return SVGContext.value;
    }
    ;
    if (v instanceof Defs) {
      return SVGContext.value;
    }
    ;
    if (v instanceof LinearGradient) {
      return SVGContext.value;
    }
    ;
    if (v instanceof Stop) {
      return SVGContext.value;
    }
    ;
    if (v instanceof PatternFill) {
      return SVGContext.value;
    }
    ;
    if (v instanceof Div) {
      return HTMLContext.value;
    }
    ;
    if (v instanceof Span) {
      return HTMLContext.value;
    }
    ;
    if (v instanceof Table) {
      return HTMLContext.value;
    }
    ;
    if (v instanceof Tr) {
      return HTMLContext.value;
    }
    ;
    if (v instanceof Td) {
      return HTMLContext.value;
    }
    ;
    if (v instanceof Th) {
      return HTMLContext.value;
    }
    ;
    if (v instanceof Tbody) {
      return HTMLContext.value;
    }
    ;
    if (v instanceof Thead) {
      return HTMLContext.value;
    }
    ;
    throw new Error("Failed pattern match at PSD3.Internal.Selection.Types (line 209, column 1 - line 209, column 47): " + [v.constructor.name]);
  };

  // output/PSD3.AST/index.js
  var append3 = /* @__PURE__ */ append(semigroupArray);
  var Node2 = /* @__PURE__ */ (function() {
    function Node3(value0) {
      this.value0 = value0;
    }
    ;
    Node3.create = function(value0) {
      return new Node3(value0);
    };
    return Node3;
  })();
  var Join = /* @__PURE__ */ (function() {
    function Join2(value0) {
      this.value0 = value0;
    }
    ;
    Join2.create = function(value0) {
      return new Join2(value0);
    };
    return Join2;
  })();
  var NestedJoin = /* @__PURE__ */ (function() {
    function NestedJoin2(value0) {
      this.value0 = value0;
    }
    ;
    NestedJoin2.create = function(value0) {
      return new NestedJoin2(value0);
    };
    return NestedJoin2;
  })();
  var UpdateJoin = /* @__PURE__ */ (function() {
    function UpdateJoin2(value0) {
      this.value0 = value0;
    }
    ;
    UpdateJoin2.create = function(value0) {
      return new UpdateJoin2(value0);
    };
    return UpdateJoin2;
  })();
  var UpdateNestedJoin = /* @__PURE__ */ (function() {
    function UpdateNestedJoin2(value0) {
      this.value0 = value0;
    }
    ;
    UpdateNestedJoin2.create = function(value0) {
      return new UpdateNestedJoin2(value0);
    };
    return UpdateNestedJoin2;
  })();
  var ConditionalRender = /* @__PURE__ */ (function() {
    function ConditionalRender2(value0) {
      this.value0 = value0;
    }
    ;
    ConditionalRender2.create = function(value0) {
      return new ConditionalRender2(value0);
    };
    return ConditionalRender2;
  })();
  var LocalCoordSpace = /* @__PURE__ */ (function() {
    function LocalCoordSpace2(value0) {
      this.value0 = value0;
    }
    ;
    LocalCoordSpace2.create = function(value0) {
      return new LocalCoordSpace2(value0);
    };
    return LocalCoordSpace2;
  })();
  var HierarchicalJoin = /* @__PURE__ */ (function() {
    function HierarchicalJoin2(value0) {
      this.value0 = value0;
    }
    ;
    HierarchicalJoin2.create = function(value0) {
      return new HierarchicalJoin2(value0);
    };
    return HierarchicalJoin2;
  })();
  var RecursiveJoin = /* @__PURE__ */ (function() {
    function RecursiveJoin2(value0) {
      this.value0 = value0;
    }
    ;
    RecursiveJoin2.create = function(value0) {
      return new RecursiveJoin2(value0);
    };
    return RecursiveJoin2;
  })();
  var withChild = function(parent2) {
    return function(child) {
      if (parent2 instanceof Node2) {
        return new Node2({
          name: parent2.value0.name,
          elemType: parent2.value0.elemType,
          attrs: parent2.value0.attrs,
          behaviors: parent2.value0.behaviors,
          children: append3(parent2.value0.children)([child])
        });
      }
      ;
      if (parent2 instanceof Join) {
        return new Join(parent2.value0);
      }
      ;
      if (parent2 instanceof NestedJoin) {
        return new NestedJoin(parent2.value0);
      }
      ;
      if (parent2 instanceof UpdateJoin) {
        return new UpdateJoin(parent2.value0);
      }
      ;
      if (parent2 instanceof UpdateNestedJoin) {
        return new UpdateNestedJoin(parent2.value0);
      }
      ;
      if (parent2 instanceof ConditionalRender) {
        return new ConditionalRender(parent2.value0);
      }
      ;
      if (parent2 instanceof LocalCoordSpace) {
        return new LocalCoordSpace(parent2.value0);
      }
      ;
      if (parent2 instanceof HierarchicalJoin) {
        return new HierarchicalJoin(parent2.value0);
      }
      ;
      if (parent2 instanceof RecursiveJoin) {
        return new RecursiveJoin(parent2.value0);
      }
      ;
      throw new Error("Failed pattern match at PSD3.AST (line 358, column 26 - line 367, column 39): " + [parent2.constructor.name]);
    };
  };
  var withBehaviors = function(tree) {
    return function(newBehaviors) {
      if (tree instanceof Node2) {
        return new Node2({
          name: tree.value0.name,
          elemType: tree.value0.elemType,
          attrs: tree.value0.attrs,
          children: tree.value0.children,
          behaviors: append3(tree.value0.behaviors)(newBehaviors)
        });
      }
      ;
      if (tree instanceof Join) {
        return new Join(tree.value0);
      }
      ;
      if (tree instanceof NestedJoin) {
        return new NestedJoin(tree.value0);
      }
      ;
      if (tree instanceof UpdateJoin) {
        return new UpdateJoin(tree.value0);
      }
      ;
      if (tree instanceof UpdateNestedJoin) {
        return new UpdateNestedJoin(tree.value0);
      }
      ;
      if (tree instanceof ConditionalRender) {
        return new ConditionalRender(tree.value0);
      }
      ;
      if (tree instanceof LocalCoordSpace) {
        return new LocalCoordSpace(tree.value0);
      }
      ;
      if (tree instanceof HierarchicalJoin) {
        return new HierarchicalJoin(tree.value0);
      }
      ;
      if (tree instanceof RecursiveJoin) {
        return new RecursiveJoin(tree.value0);
      }
      ;
      throw new Error("Failed pattern match at PSD3.AST (line 402, column 35 - line 411, column 39): " + [tree.constructor.name]);
    };
  };
  var recursiveJoin = function(config) {
    return function(rootData) {
      return function(keyFn) {
        return function(getChildren) {
          return function(template) {
            return new RecursiveJoin({
              name: config.name,
              key: config.key,
              rootData,
              getChildren,
              keyFn,
              template
            });
          };
        };
      };
    };
  };
  var named = function(elemType) {
    return function(name15) {
      return function(attrs) {
        return new Node2({
          name: new Just(name15),
          elemType,
          attrs,
          behaviors: [],
          children: []
        });
      };
    };
  };
  var elem2 = function(elemType) {
    return function(attrs) {
      return new Node2({
        name: Nothing.value,
        elemType,
        attrs,
        behaviors: [],
        children: []
      });
    };
  };

  // output/PSD3.Internal.Behavior.Types/index.js
  var OnHover = /* @__PURE__ */ (function() {
    function OnHover2() {
    }
    ;
    OnHover2.value = new OnHover2();
    return OnHover2;
  })();
  var WhenPrimary = /* @__PURE__ */ (function() {
    function WhenPrimary2() {
    }
    ;
    WhenPrimary2.value = new WhenPrimary2();
    return WhenPrimary2;
  })();
  var WhenRelated = /* @__PURE__ */ (function() {
    function WhenRelated2() {
    }
    ;
    WhenRelated2.value = new WhenRelated2();
    return WhenRelated2;
  })();
  var Primary = /* @__PURE__ */ (function() {
    function Primary2() {
    }
    ;
    Primary2.value = new Primary2();
    return Primary2;
  })();
  var Related = /* @__PURE__ */ (function() {
    function Related2() {
    }
    ;
    Related2.value = new Related2();
    return Related2;
  })();
  var Dimmed = /* @__PURE__ */ (function() {
    function Dimmed2() {
    }
    ;
    Dimmed2.value = new Dimmed2();
    return Dimmed2;
  })();
  var Neutral = /* @__PURE__ */ (function() {
    function Neutral2() {
    }
    ;
    Neutral2.value = new Neutral2();
    return Neutral2;
  })();
  var SimpleDrag = /* @__PURE__ */ (function() {
    function SimpleDrag2() {
    }
    ;
    SimpleDrag2.value = new SimpleDrag2();
    return SimpleDrag2;
  })();
  var SimulationDrag = /* @__PURE__ */ (function() {
    function SimulationDrag2(value0) {
      this.value0 = value0;
    }
    ;
    SimulationDrag2.create = function(value0) {
      return new SimulationDrag2(value0);
    };
    return SimulationDrag2;
  })();
  var SimulationDragNested = /* @__PURE__ */ (function() {
    function SimulationDragNested2(value0) {
      this.value0 = value0;
    }
    ;
    SimulationDragNested2.create = function(value0) {
      return new SimulationDragNested2(value0);
    };
    return SimulationDragNested2;
  })();
  var Zoom = /* @__PURE__ */ (function() {
    function Zoom2(value0) {
      this.value0 = value0;
    }
    ;
    Zoom2.create = function(value0) {
      return new Zoom2(value0);
    };
    return Zoom2;
  })();
  var Drag = /* @__PURE__ */ (function() {
    function Drag2(value0) {
      this.value0 = value0;
    }
    ;
    Drag2.create = function(value0) {
      return new Drag2(value0);
    };
    return Drag2;
  })();
  var Click = /* @__PURE__ */ (function() {
    function Click2(value0) {
      this.value0 = value0;
    }
    ;
    Click2.create = function(value0) {
      return new Click2(value0);
    };
    return Click2;
  })();
  var ClickWithDatum = /* @__PURE__ */ (function() {
    function ClickWithDatum2(value0) {
      this.value0 = value0;
    }
    ;
    ClickWithDatum2.create = function(value0) {
      return new ClickWithDatum2(value0);
    };
    return ClickWithDatum2;
  })();
  var MouseEnter = /* @__PURE__ */ (function() {
    function MouseEnter2(value0) {
      this.value0 = value0;
    }
    ;
    MouseEnter2.create = function(value0) {
      return new MouseEnter2(value0);
    };
    return MouseEnter2;
  })();
  var MouseLeave = /* @__PURE__ */ (function() {
    function MouseLeave2(value0) {
      this.value0 = value0;
    }
    ;
    MouseLeave2.create = function(value0) {
      return new MouseLeave2(value0);
    };
    return MouseLeave2;
  })();
  var Highlight = /* @__PURE__ */ (function() {
    function Highlight2(value0) {
      this.value0 = value0;
    }
    ;
    Highlight2.create = function(value0) {
      return new Highlight2(value0);
    };
    return Highlight2;
  })();
  var CoordinatedHighlight = /* @__PURE__ */ (function() {
    function CoordinatedHighlight2(value0) {
      this.value0 = value0;
    }
    ;
    CoordinatedHighlight2.create = function(value0) {
      return new CoordinatedHighlight2(value0);
    };
    return CoordinatedHighlight2;
  })();
  var MouseMoveWithInfo = /* @__PURE__ */ (function() {
    function MouseMoveWithInfo2(value0) {
      this.value0 = value0;
    }
    ;
    MouseMoveWithInfo2.create = function(value0) {
      return new MouseMoveWithInfo2(value0);
    };
    return MouseMoveWithInfo2;
  })();
  var MouseEnterWithInfo = /* @__PURE__ */ (function() {
    function MouseEnterWithInfo2(value0) {
      this.value0 = value0;
    }
    ;
    MouseEnterWithInfo2.create = function(value0) {
      return new MouseEnterWithInfo2(value0);
    };
    return MouseEnterWithInfo2;
  })();
  var MouseLeaveWithInfo = /* @__PURE__ */ (function() {
    function MouseLeaveWithInfo2(value0) {
      this.value0 = value0;
    }
    ;
    MouseLeaveWithInfo2.create = function(value0) {
      return new MouseLeaveWithInfo2(value0);
    };
    return MouseLeaveWithInfo2;
  })();
  var MouseDown = /* @__PURE__ */ (function() {
    function MouseDown2(value0) {
      this.value0 = value0;
    }
    ;
    MouseDown2.create = function(value0) {
      return new MouseDown2(value0);
    };
    return MouseDown2;
  })();
  var MouseDownWithInfo = /* @__PURE__ */ (function() {
    function MouseDownWithInfo2(value0) {
      this.value0 = value0;
    }
    ;
    MouseDownWithInfo2.create = function(value0) {
      return new MouseDownWithInfo2(value0);
    };
    return MouseDownWithInfo2;
  })();
  var onMouseLeave = /* @__PURE__ */ (function() {
    return MouseLeave.create;
  })();
  var onMouseEnter = /* @__PURE__ */ (function() {
    return MouseEnter.create;
  })();
  var onClickWithDatum = /* @__PURE__ */ (function() {
    return ClickWithDatum.create;
  })();

  // output/PSD3.Internal.Capabilities.Selection/index.js
  var select = function(dict) {
    return dict.select;
  };
  var renderTree = function(dict) {
    return dict.renderTree;
  };

  // output/Data.Nullable/foreign.js
  var nullImpl = null;
  function nullable(a, r, f) {
    return a == null ? r : f(a);
  }
  function notNull(x) {
    return x;
  }

  // output/Data.Nullable/index.js
  var toNullable = /* @__PURE__ */ maybe(nullImpl)(notNull);
  var toMaybe = function(n) {
    return nullable(n, Nothing.value, Just.create);
  };

  // output/PSD3.Internal.Attribute/index.js
  var Linear = /* @__PURE__ */ (function() {
    function Linear3() {
    }
    ;
    Linear3.value = new Linear3();
    return Linear3;
  })();
  var QuadIn = /* @__PURE__ */ (function() {
    function QuadIn3() {
    }
    ;
    QuadIn3.value = new QuadIn3();
    return QuadIn3;
  })();
  var QuadOut = /* @__PURE__ */ (function() {
    function QuadOut3() {
    }
    ;
    QuadOut3.value = new QuadOut3();
    return QuadOut3;
  })();
  var QuadInOut = /* @__PURE__ */ (function() {
    function QuadInOut3() {
    }
    ;
    QuadInOut3.value = new QuadInOut3();
    return QuadInOut3;
  })();
  var CubicIn = /* @__PURE__ */ (function() {
    function CubicIn3() {
    }
    ;
    CubicIn3.value = new CubicIn3();
    return CubicIn3;
  })();
  var CubicOut = /* @__PURE__ */ (function() {
    function CubicOut3() {
    }
    ;
    CubicOut3.value = new CubicOut3();
    return CubicOut3;
  })();
  var CubicInOut = /* @__PURE__ */ (function() {
    function CubicInOut3() {
    }
    ;
    CubicInOut3.value = new CubicInOut3();
    return CubicInOut3;
  })();
  var SinIn = /* @__PURE__ */ (function() {
    function SinIn3() {
    }
    ;
    SinIn3.value = new SinIn3();
    return SinIn3;
  })();
  var SinOut = /* @__PURE__ */ (function() {
    function SinOut3() {
    }
    ;
    SinOut3.value = new SinOut3();
    return SinOut3;
  })();
  var SinInOut = /* @__PURE__ */ (function() {
    function SinInOut3() {
    }
    ;
    SinInOut3.value = new SinInOut3();
    return SinInOut3;
  })();
  var ExpIn = /* @__PURE__ */ (function() {
    function ExpIn3() {
    }
    ;
    ExpIn3.value = new ExpIn3();
    return ExpIn3;
  })();
  var ExpOut = /* @__PURE__ */ (function() {
    function ExpOut3() {
    }
    ;
    ExpOut3.value = new ExpOut3();
    return ExpOut3;
  })();
  var ExpInOut = /* @__PURE__ */ (function() {
    function ExpInOut3() {
    }
    ;
    ExpInOut3.value = new ExpInOut3();
    return ExpInOut3;
  })();
  var CircleIn = /* @__PURE__ */ (function() {
    function CircleIn3() {
    }
    ;
    CircleIn3.value = new CircleIn3();
    return CircleIn3;
  })();
  var CircleOut = /* @__PURE__ */ (function() {
    function CircleOut3() {
    }
    ;
    CircleOut3.value = new CircleOut3();
    return CircleOut3;
  })();
  var CircleInOut = /* @__PURE__ */ (function() {
    function CircleInOut3() {
    }
    ;
    CircleInOut3.value = new CircleInOut3();
    return CircleInOut3;
  })();
  var BackIn = /* @__PURE__ */ (function() {
    function BackIn3() {
    }
    ;
    BackIn3.value = new BackIn3();
    return BackIn3;
  })();
  var BackOut = /* @__PURE__ */ (function() {
    function BackOut3() {
    }
    ;
    BackOut3.value = new BackOut3();
    return BackOut3;
  })();
  var BackInOut = /* @__PURE__ */ (function() {
    function BackInOut3() {
    }
    ;
    BackInOut3.value = new BackInOut3();
    return BackInOut3;
  })();
  var ElasticIn = /* @__PURE__ */ (function() {
    function ElasticIn3() {
    }
    ;
    ElasticIn3.value = new ElasticIn3();
    return ElasticIn3;
  })();
  var ElasticOut = /* @__PURE__ */ (function() {
    function ElasticOut3() {
    }
    ;
    ElasticOut3.value = new ElasticOut3();
    return ElasticOut3;
  })();
  var ElasticInOut = /* @__PURE__ */ (function() {
    function ElasticInOut3() {
    }
    ;
    ElasticInOut3.value = new ElasticInOut3();
    return ElasticInOut3;
  })();
  var BounceIn = /* @__PURE__ */ (function() {
    function BounceIn3() {
    }
    ;
    BounceIn3.value = new BounceIn3();
    return BounceIn3;
  })();
  var BounceOut = /* @__PURE__ */ (function() {
    function BounceOut3() {
    }
    ;
    BounceOut3.value = new BounceOut3();
    return BounceOut3;
  })();
  var BounceInOut = /* @__PURE__ */ (function() {
    function BounceInOut3() {
    }
    ;
    BounceInOut3.value = new BounceInOut3();
    return BounceInOut3;
  })();
  var StringValue = /* @__PURE__ */ (function() {
    function StringValue2(value0) {
      this.value0 = value0;
    }
    ;
    StringValue2.create = function(value0) {
      return new StringValue2(value0);
    };
    return StringValue2;
  })();
  var NumberValue = /* @__PURE__ */ (function() {
    function NumberValue2(value0) {
      this.value0 = value0;
    }
    ;
    NumberValue2.create = function(value0) {
      return new NumberValue2(value0);
    };
    return NumberValue2;
  })();
  var BooleanValue = /* @__PURE__ */ (function() {
    function BooleanValue2(value0) {
      this.value0 = value0;
    }
    ;
    BooleanValue2.create = function(value0) {
      return new BooleanValue2(value0);
    };
    return BooleanValue2;
  })();
  var StaticAnimValue = /* @__PURE__ */ (function() {
    function StaticAnimValue2(value0) {
      this.value0 = value0;
    }
    ;
    StaticAnimValue2.create = function(value0) {
      return new StaticAnimValue2(value0);
    };
    return StaticAnimValue2;
  })();
  var DataAnimValue = /* @__PURE__ */ (function() {
    function DataAnimValue2(value0) {
      this.value0 = value0;
    }
    ;
    DataAnimValue2.create = function(value0) {
      return new DataAnimValue2(value0);
    };
    return DataAnimValue2;
  })();
  var IndexedAnimValue = /* @__PURE__ */ (function() {
    function IndexedAnimValue2(value0) {
      this.value0 = value0;
    }
    ;
    IndexedAnimValue2.create = function(value0) {
      return new IndexedAnimValue2(value0);
    };
    return IndexedAnimValue2;
  })();
  var StaticAttr = /* @__PURE__ */ (function() {
    function StaticAttr2(value0, value1) {
      this.value0 = value0;
      this.value1 = value1;
    }
    ;
    StaticAttr2.create = function(value0) {
      return function(value1) {
        return new StaticAttr2(value0, value1);
      };
    };
    return StaticAttr2;
  })();
  var DataAttr = /* @__PURE__ */ (function() {
    function DataAttr2(value0, value1, value22) {
      this.value0 = value0;
      this.value1 = value1;
      this.value2 = value22;
    }
    ;
    DataAttr2.create = function(value0) {
      return function(value1) {
        return function(value22) {
          return new DataAttr2(value0, value1, value22);
        };
      };
    };
    return DataAttr2;
  })();
  var IndexedAttr = /* @__PURE__ */ (function() {
    function IndexedAttr2(value0, value1, value22) {
      this.value0 = value0;
      this.value1 = value1;
      this.value2 = value22;
    }
    ;
    IndexedAttr2.create = function(value0) {
      return function(value1) {
        return function(value22) {
          return new IndexedAttr2(value0, value1, value22);
        };
      };
    };
    return IndexedAttr2;
  })();
  var AnimatedAttr = /* @__PURE__ */ (function() {
    function AnimatedAttr2(value0) {
      this.value0 = value0;
    }
    ;
    AnimatedAttr2.create = function(value0) {
      return new AnimatedAttr2(value0);
    };
    return AnimatedAttr2;
  })();
  var AnimatedCompound = /* @__PURE__ */ (function() {
    function AnimatedCompound2(value0) {
      this.value0 = value0;
    }
    ;
    AnimatedCompound2.create = function(value0) {
      return new AnimatedCompound2(value0);
    };
    return AnimatedCompound2;
  })();

  // output/PSD3.Internal.Selection.Operations/foreign.js
  function getElementData_(element) {
    return function() {
      return element.__data__;
    };
  }
  function setElementData_(datum) {
    return function(element) {
      return function() {
        element.__data__ = datum;
      };
    };
  }
  function setTextContent_(text5) {
    return function(element) {
      return function() {
        element.textContent = text5;
      };
    };
  }
  function offsetX(event) {
    return event.offsetX;
  }
  function offsetY(event) {
    return event.offsetY;
  }
  function clearElement_(selector) {
    return function() {
      const el = document.querySelector(selector);
      if (el) {
        el.innerHTML = "";
      }
    };
  }
  function jsonStringify_(value12) {
    return JSON.stringify(value12);
  }
  function setTimeout_(delayMs) {
    return function(effect) {
      return function() {
        setTimeout(effect, delayMs);
      };
    };
  }

  // output/Data.Int/foreign.js
  var toNumber = function(n) {
    return n;
  };

  // output/Effect.Unsafe/foreign.js
  var unsafePerformEffect = function(f) {
    return f();
  };

  // output/PSD3.Interaction.Pointer/foreign.js
  function attachSimpleDrag_(element) {
    return () => () => {
      let isDragging = false;
      let transform = { x: 0, y: 0 };
      function handlePointerDown(event) {
        if (event.button !== 0) return;
        isDragging = true;
        element.setPointerCapture(event.pointerId);
        event.preventDefault();
        if (element.parentNode) {
          element.parentNode.appendChild(element);
        }
        element.style.cursor = "grabbing";
      }
      function handlePointerMove(event) {
        if (!isDragging) return;
        const svg = element.ownerSVGElement;
        if (svg) {
          const pt = svg.createSVGPoint();
          const ctm = svg.getScreenCTM();
          if (ctm) {
            pt.x = event.movementX;
            pt.y = event.movementY;
            const scale = ctm.a;
            transform.x += event.movementX / scale;
            transform.y += event.movementY / scale;
          } else {
            transform.x += event.movementX;
            transform.y += event.movementY;
          }
        } else {
          transform.x += event.movementX;
          transform.y += event.movementY;
        }
        element.setAttribute("transform", `translate(${transform.x},${transform.y})`);
      }
      function handlePointerUp(event) {
        if (!isDragging) return;
        isDragging = false;
        element.releasePointerCapture(event.pointerId);
        element.style.cursor = "grab";
      }
      function handleDragStart(event) {
        event.preventDefault();
      }
      element.addEventListener("pointerdown", handlePointerDown);
      element.addEventListener("pointermove", handlePointerMove);
      element.addEventListener("pointerup", handlePointerUp);
      element.addEventListener("pointercancel", handlePointerUp);
      element.addEventListener("dragstart", handleDragStart);
      element.style.cursor = "grab";
      element.style.touchAction = "none";
      return element;
    };
  }
  var simulationRegistry = /* @__PURE__ */ new Map();
  function getSimulationReheat(simId) {
    const sim = simulationRegistry.get(simId);
    return sim ? sim.reheat : null;
  }
  function attachSimulationDragById_(element) {
    return (simId) => () => {
      let isDragging = false;
      function handlePointerDown(event) {
        if (event.button !== 0) return;
        isDragging = true;
        element.setPointerCapture(event.pointerId);
        event.preventDefault();
        const node = element.__data__;
        if (!node) {
          console.warn("[PointerDrag] No datum on element");
          return;
        }
        const reheat = getSimulationReheat(simId);
        if (reheat) {
          reheat();
        } else {
          console.warn(`[PointerDrag] No simulation registered with ID: ${simId}`);
        }
        node.fx = node.x;
        node.fy = node.y;
        element.style.cursor = "grabbing";
      }
      function handlePointerMove(event) {
        if (!isDragging) return;
        const node = element.__data__;
        if (!node) return;
        const svg = element.ownerSVGElement;
        if (svg) {
          const pt = svg.createSVGPoint();
          pt.x = event.clientX;
          pt.y = event.clientY;
          const parentGroup = element.parentElement;
          const ctm = parentGroup?.getScreenCTM?.() || svg.getScreenCTM();
          if (ctm) {
            const svgPt = pt.matrixTransform(ctm.inverse());
            node.fx = svgPt.x;
            node.fy = svgPt.y;
          }
        } else {
          node.fx = event.clientX;
          node.fy = event.clientY;
        }
      }
      function handlePointerUp(event) {
        if (!isDragging) return;
        isDragging = false;
        element.releasePointerCapture(event.pointerId);
        const node = element.__data__;
        if (node) {
          node.fx = null;
          node.fy = null;
        }
        element.style.cursor = "grab";
      }
      function handleDragStart(event) {
        event.preventDefault();
      }
      element.addEventListener("pointerdown", handlePointerDown);
      element.addEventListener("pointermove", handlePointerMove);
      element.addEventListener("pointerup", handlePointerUp);
      element.addEventListener("pointercancel", handlePointerUp);
      element.addEventListener("dragstart", handleDragStart);
      element.style.cursor = "grab";
      element.style.touchAction = "none";
      return element;
    };
  }
  function attachSimulationDragNestedById_(element) {
    return (simId) => () => {
      let isDragging = false;
      function handlePointerDown(event) {
        if (event.button !== 0) return;
        isDragging = true;
        element.setPointerCapture(event.pointerId);
        event.preventDefault();
        const datum = element.__data__;
        const node = datum?.node;
        if (!node) {
          console.warn("[PointerDragNested] No datum.node on element");
          return;
        }
        const reheat = getSimulationReheat(simId);
        if (reheat) {
          reheat();
        } else {
          console.warn(`[PointerDragNested] No simulation registered with ID: ${simId}`);
        }
        node.fx = node.x;
        node.fy = node.y;
        element.style.cursor = "grabbing";
      }
      function handlePointerMove(event) {
        if (!isDragging) return;
        const datum = element.__data__;
        const node = datum?.node;
        if (!node) return;
        const svg = element.ownerSVGElement;
        if (svg) {
          const pt = svg.createSVGPoint();
          pt.x = event.clientX;
          pt.y = event.clientY;
          const parentGroup = element.parentElement;
          const ctm = parentGroup?.getScreenCTM?.() || svg.getScreenCTM();
          if (ctm) {
            const svgPt = pt.matrixTransform(ctm.inverse());
            node.fx = svgPt.x;
            node.fy = svgPt.y;
          }
        } else {
          node.fx = event.clientX;
          node.fy = event.clientY;
        }
      }
      function handlePointerUp(event) {
        if (!isDragging) return;
        isDragging = false;
        element.releasePointerCapture(event.pointerId);
        const datum = element.__data__;
        const node = datum?.node;
        if (node) {
          node.fx = null;
          node.fy = null;
        }
        element.style.cursor = "grab";
      }
      function handleDragStart(event) {
        event.preventDefault();
      }
      element.addEventListener("pointerdown", handlePointerDown);
      element.addEventListener("pointermove", handlePointerMove);
      element.addEventListener("pointerup", handlePointerUp);
      element.addEventListener("pointercancel", handlePointerUp);
      element.addEventListener("dragstart", handleDragStart);
      element.style.cursor = "grab";
      element.style.touchAction = "none";
      return element;
    };
  }

  // output/PSD3.Interaction.Pointer/index.js
  var attachSimulationDragNestedById = attachSimulationDragNestedById_;
  var attachSimulationDragById = attachSimulationDragById_;
  var attachSimpleDrag = attachSimpleDrag_;

  // output/PSD3.Interaction.Zoom/foreign.js
  var ZoomTransform = class _ZoomTransform {
    constructor(k, x, y) {
      this.k = k;
      this.x = x;
      this.y = y;
    }
    /**
     * Returns a new transform scaled by k
     */
    scale(k) {
      return k === 1 ? this : new _ZoomTransform(this.k * k, this.x, this.y);
    }
    /**
     * Returns a new transform translated by (x, y) in local coordinates
     */
    translate(x, y) {
      return x === 0 && y === 0 ? this : new _ZoomTransform(this.k, this.x + this.k * x, this.y + this.k * y);
    }
    /**
     * Apply transform to a point [x, y] -> [x', y']
     */
    apply(point) {
      return [point[0] * this.k + this.x, point[1] * this.k + this.y];
    }
    /**
     * Apply inverse transform to get original coordinates
     */
    applyX(x) {
      return x * this.k + this.x;
    }
    applyY(y) {
      return y * this.k + this.y;
    }
    /**
     * Invert: given transformed point, return original point
     */
    invert(point) {
      return [(point[0] - this.x) / this.k, (point[1] - this.y) / this.k];
    }
    invertX(x) {
      return (x - this.x) / this.k;
    }
    invertY(y) {
      return (y - this.y) / this.k;
    }
    /**
     * Rescale a scale's domain according to this transform
     */
    rescaleX(x) {
      return x.copy().domain(x.range().map(this.invertX, this).map(x.invert, x));
    }
    rescaleY(y) {
      return y.copy().domain(y.range().map(this.invertY, this).map(y.invert, y));
    }
    toString() {
      return `translate(${this.x},${this.y}) scale(${this.k})`;
    }
  };
  var identity6 = new ZoomTransform(1, 0, 0);
  function constrain(transform, extent, translateExtent) {
    const dx0 = transform.invertX(extent[0][0]) - translateExtent[0][0];
    const dx1 = transform.invertX(extent[1][0]) - translateExtent[1][0];
    const dy0 = transform.invertY(extent[0][1]) - translateExtent[0][1];
    const dy1 = transform.invertY(extent[1][1]) - translateExtent[1][1];
    let x = transform.x;
    let y = transform.y;
    if (dx1 > dx0) {
      x += (dx0 + dx1) / 2 * transform.k;
    } else if (dx0 < 0) {
      x -= dx0 * transform.k;
    } else if (dx1 > 0) {
      x -= dx1 * transform.k;
    }
    if (dy1 > dy0) {
      y += (dy0 + dy1) / 2 * transform.k;
    } else if (dy0 < 0) {
      y -= dy0 * transform.k;
    } else if (dy1 > 0) {
      y -= dy1 * transform.k;
    }
    return x === transform.x && y === transform.y ? transform : new ZoomTransform(transform.k, x, y);
  }
  function zoomAround(transform, point, newK) {
    const p = transform.invert(point);
    const t = transform.scale(newK / transform.k);
    return new ZoomTransform(
      t.k,
      point[0] - p[0] * t.k,
      point[1] - p[1] * t.k
    );
  }
  function attachNativeZoom_(element) {
    return (config) => () => {
      const scaleMin = config.scaleMin || 0.1;
      const scaleMax = config.scaleMax || 10;
      const targetSelector = config.targetSelector;
      let transform = config.initialTransform ? new ZoomTransform(
        config.initialTransform.k,
        config.initialTransform.x,
        config.initialTransform.y
      ) : identity6;
      let extent = null;
      function getExtent() {
        if (!extent) {
          const rect = element.getBoundingClientRect();
          extent = [[0, 0], [rect.width, rect.height]];
        }
        return extent;
      }
      function toSVGCoords(clientX2, clientY2) {
        const svg = element.ownerSVGElement || element;
        if (svg.createSVGPoint) {
          const pt = svg.createSVGPoint();
          pt.x = clientX2;
          pt.y = clientY2;
          const ctm = svg.getScreenCTM();
          if (ctm) {
            const inv = ctm.inverse();
            const svgPt = pt.matrixTransform(inv);
            return [svgPt.x, svgPt.y];
          }
        }
        const rect = element.getBoundingClientRect();
        return [clientX2 - rect.left, clientY2 - rect.top];
      }
      function toSVGDelta(screenDx, screenDy) {
        const svg = element.ownerSVGElement || element;
        if (svg.getScreenCTM) {
          const ctm = svg.getScreenCTM();
          if (ctm) {
            const scale = ctm.a;
            return [screenDx / scale, screenDy / scale];
          }
        }
        return [screenDx, screenDy];
      }
      let translateExtent = config.translateExtent || null;
      const infiniteExtent = [[-Infinity, -Infinity], [Infinity, Infinity]];
      function applyTransform() {
        const target5 = element.querySelector(targetSelector);
        if (target5) {
          target5.setAttribute("transform", transform.toString());
        }
        element.__zoom = transform;
        if (config.onZoom) {
          config.onZoom({ k: transform.k, x: transform.x, y: transform.y })();
        }
      }
      function setTransform(newTransform) {
        const k = Math.max(scaleMin, Math.min(scaleMax, newTransform.k));
        newTransform = new ZoomTransform(k, newTransform.x, newTransform.y);
        if (translateExtent) {
          newTransform = constrain(newTransform, getExtent(), translateExtent);
        }
        transform = newTransform;
        applyTransform();
      }
      function handleWheel(event) {
        event.preventDefault();
        const point = toSVGCoords(event.clientX, event.clientY);
        const factor = Math.pow(2, -event.deltaY * 2e-3);
        const newK = Math.max(scaleMin, Math.min(scaleMax, transform.k * factor));
        if (Math.abs(newK - transform.k) < 1e-3) return;
        const newTransform = zoomAround(transform, point, newK);
        setTransform(newTransform);
      }
      let isPanning = false;
      let panStart = null;
      let transformAtPanStart = null;
      function handlePointerDown(event) {
        if (event.button !== 0) return;
        const target5 = event.target;
        const isPanTarget = target5 === element || // SVG element itself
        target5.tagName === "svg" || target5.classList.contains("zoom-background") || target5.classList.contains("zoom-group");
        if (!isPanTarget) {
          return;
        }
        isPanning = true;
        panStart = [event.clientX, event.clientY];
        transformAtPanStart = transform;
        element.setPointerCapture(event.pointerId);
        element.style.cursor = "grabbing";
      }
      function handlePointerMove(event) {
        if (!isPanning) return;
        const screenDx = event.clientX - panStart[0];
        const screenDy = event.clientY - panStart[1];
        const [dx, dy] = toSVGDelta(screenDx, screenDy);
        const newTransform = new ZoomTransform(
          transformAtPanStart.k,
          transformAtPanStart.x + dx,
          transformAtPanStart.y + dy
        );
        setTransform(newTransform);
      }
      function handlePointerUp(event) {
        if (!isPanning) return;
        isPanning = false;
        element.releasePointerCapture(event.pointerId);
        element.style.cursor = "grab";
      }
      let gestureStartTransform = null;
      let gestureStartCenter = null;
      function handleGestureStart(event) {
        event.preventDefault();
        gestureStartTransform = transform;
        const rect = element.getBoundingClientRect();
        const screenCenterX = rect.left + rect.width / 2;
        const screenCenterY = rect.top + rect.height / 2;
        gestureStartCenter = toSVGCoords(screenCenterX, screenCenterY);
      }
      function handleGestureChange(event) {
        event.preventDefault();
        if (!gestureStartTransform) return;
        const newK = gestureStartTransform.k * event.scale;
        const newTransform = zoomAround(gestureStartTransform, gestureStartCenter, newK);
        setTransform(newTransform);
      }
      function handleGestureEnd(event) {
        event.preventDefault();
        gestureStartTransform = null;
      }
      element.addEventListener("wheel", handleWheel, { passive: false });
      element.addEventListener("pointerdown", handlePointerDown);
      element.addEventListener("pointermove", handlePointerMove);
      element.addEventListener("pointerup", handlePointerUp);
      element.addEventListener("pointercancel", handlePointerUp);
      element.addEventListener("gesturestart", handleGestureStart);
      element.addEventListener("gesturechange", handleGestureChange);
      element.addEventListener("gestureend", handleGestureEnd);
      element.style.cursor = "grab";
      element.style.touchAction = "none";
      if (config.initialTransform) {
        applyTransform();
      }
      const handle = {
        // Get current transform
        getTransform: () => ({ k: transform.k, x: transform.x, y: transform.y }),
        // Set transform directly
        setTransform: (t) => () => {
          setTransform(new ZoomTransform(t.k, t.x, t.y));
        },
        // Reset to identity
        resetZoom: () => {
          setTransform(identity6);
        },
        // Zoom to specific scale at point
        zoomTo: (k) => (point) => () => {
          const newTransform = zoomAround(transform, [point.x, point.y], k);
          setTransform(newTransform);
        },
        // Zoom in/out by factor at center
        zoomBy: (factor) => () => {
          const rect = element.getBoundingClientRect();
          const screenCenterX = rect.left + rect.width / 2;
          const screenCenterY = rect.top + rect.height / 2;
          const center = toSVGCoords(screenCenterX, screenCenterY);
          const newK = transform.k * factor;
          const newTransform = zoomAround(transform, center, newK);
          setTransform(newTransform);
        },
        // Cleanup
        destroy: () => {
          element.removeEventListener("wheel", handleWheel);
          element.removeEventListener("pointerdown", handlePointerDown);
          element.removeEventListener("pointermove", handlePointerMove);
          element.removeEventListener("pointerup", handlePointerUp);
          element.removeEventListener("pointercancel", handlePointerUp);
          element.removeEventListener("gesturestart", handleGestureStart);
          element.removeEventListener("gesturechange", handleGestureChange);
          element.removeEventListener("gestureend", handleGestureEnd);
          element.style.cursor = "";
          element.style.touchAction = "";
        }
      };
      return handle;
    };
  }

  // output/PSD3.Interaction.Zoom/index.js
  var map4 = /* @__PURE__ */ map(functorMaybe);
  var pure2 = /* @__PURE__ */ pure(applicativeEffect);
  var attachNativeZoom = function(element) {
    return function(config) {
      var toJsExtent = function(bb) {
        return [[bb.x0, bb.y0], [bb.x1, bb.y1]];
      };
      var jsConfig = {
        scaleMin: config.scaleMin,
        scaleMax: config.scaleMax,
        targetSelector: config.targetSelector,
        initialTransform: toNullable(config.initialTransform),
        translateExtent: toNullable(map4(toJsExtent)(config.translateExtent)),
        onZoom: toNullable(config.onZoom)
      };
      return function __do2() {
        var jsHandle = attachNativeZoom_(element)(jsConfig)();
        return {
          getTransform: pure2(jsHandle.getTransform(unit)),
          setTransform: function(t) {
            return jsHandle.setTransform(t);
          },
          resetZoom: jsHandle.resetZoom,
          zoomTo: function(k) {
            return function(p) {
              return jsHandle.zoomTo(k)(p);
            };
          },
          zoomBy: function(f) {
            return jsHandle.zoomBy(f);
          },
          destroy: jsHandle.destroy
        };
      };
    };
  };
  var attachZoomNative = function(element) {
    return function(scaleMin) {
      return function(scaleMax) {
        return function(targetSelector) {
          return attachNativeZoom(element)({
            scaleMin,
            scaleMax,
            targetSelector,
            initialTransform: Nothing.value,
            translateExtent: Nothing.value,
            onZoom: Nothing.value
          });
        };
      };
    };
  };

  // output/PSD3.Internal.Behavior.FFI/foreign.js
  function attachClick_(element) {
    return (handler) => () => {
      element.addEventListener("click", function(event) {
        handler();
      });
      element.style.cursor = "pointer";
      return element;
    };
  }
  function attachClickWithDatum_(element) {
    return (handler) => () => {
      element.addEventListener("click", function(event) {
        const d = this.__data__;
        handler(d)();
      });
      element.style.cursor = "pointer";
      return element;
    };
  }
  function attachMouseEnter_(element) {
    return (handler) => () => {
      element.addEventListener("mouseenter", function(event) {
        const d = this.__data__;
        handler(d)();
      });
      return element;
    };
  }
  function attachMouseLeave_(element) {
    return (handler) => () => {
      element.addEventListener("mouseleave", function(event) {
        const d = this.__data__;
        handler(d)();
      });
      return element;
    };
  }
  function attachHighlight_(element) {
    return (enterStyles) => (leaveStyles) => () => {
      element.addEventListener("mouseenter", function(event) {
        if (this.parentNode) {
          this.parentNode.appendChild(this);
        }
        enterStyles.forEach((style) => {
          this.setAttribute(style.attr, style.value);
        });
      });
      element.addEventListener("mouseleave", function(event) {
        leaveStyles.forEach((style) => {
          this.setAttribute(style.attr, style.value);
        });
      });
      return element;
    };
  }
  function attachMouseMoveWithEvent_(element) {
    return (handler) => () => {
      element.addEventListener("mousemove", function(event) {
        const datum = this.__data__;
        handler(datum, event);
      });
      return element;
    };
  }
  function attachMouseEnterWithEvent_(element) {
    return (handler) => () => {
      element.addEventListener("mouseenter", function(event) {
        const datum = this.__data__;
        handler(datum, event);
      });
      return element;
    };
  }
  function attachMouseLeaveWithEvent_(element) {
    return (handler) => () => {
      element.addEventListener("mouseleave", function(event) {
        const datum = this.__data__;
        handler(datum, event);
      });
      return element;
    };
  }
  function attachMouseDown_(element) {
    return (handler) => () => {
      element.addEventListener("mousedown", function(event) {
        handler();
      });
      return element;
    };
  }
  function attachMouseDownWithEvent_(element) {
    return (handler) => () => {
      element.addEventListener("mousedown", function(event) {
        const datum = this.__data__;
        handler(datum, event);
      });
      return element;
    };
  }
  var highlightRegistry = /* @__PURE__ */ new Map();
  var HIGHLIGHT_PRIMARY = "highlight-primary";
  var HIGHLIGHT_RELATED = "highlight-related";
  var HIGHLIGHT_DIMMED = "highlight-dimmed";
  var ALL_HIGHLIGHT_CLASSES = [HIGHLIGHT_PRIMARY, HIGHLIGHT_RELATED, HIGHLIGHT_DIMMED];
  var HC_PRIMARY = 0;
  var HC_RELATED = 1;
  var HC_DIMMED = 2;
  var HC_NEUTRAL = 3;
  var TT_ON_HOVER = 0;
  var TT_WHEN_PRIMARY = 1;
  var TT_WHEN_RELATED = 2;
  var tooltipContainer = null;
  var elementTooltips = /* @__PURE__ */ new Map();
  function getTooltipContainer() {
    if (!tooltipContainer) {
      tooltipContainer = document.createElement("div");
      tooltipContainer.className = "coordinated-tooltip-container";
      tooltipContainer.style.cssText = "position: fixed; top: 0; left: 0; pointer-events: none; z-index: 10000;";
      document.body.appendChild(tooltipContainer);
    }
    return tooltipContainer;
  }
  function createTooltipElement() {
    const tooltip = document.createElement("div");
    tooltip.className = "coordinated-tooltip";
    tooltip.style.cssText = `
    position: absolute;
    background: rgba(15, 23, 42, 0.95);
    color: #e2e8f0;
    padding: 6px 10px;
    border-radius: 4px;
    font-size: 12px;
    font-family: system-ui, -apple-system, sans-serif;
    white-space: nowrap;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.15s ease-in-out;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    border: 1px solid rgba(148, 163, 184, 0.2);
  `;
    getTooltipContainer().appendChild(tooltip);
    return tooltip;
  }
  function positionTooltipNearElement(tooltip, targetElement) {
    const rect = targetElement.getBoundingClientRect();
    const tooltipRect = tooltip.getBoundingClientRect();
    let x = rect.left + rect.width / 2 - tooltipRect.width / 2;
    let y = rect.top - tooltipRect.height - 8;
    x = Math.max(8, Math.min(x, window.innerWidth - tooltipRect.width - 8));
    if (y < 8) {
      y = rect.bottom + 8;
    }
    tooltip.style.left = `${x}px`;
    tooltip.style.top = `${y}px`;
  }
  function positionTooltipAtMouse(tooltip, event) {
    const x = event.clientX + 12;
    const y = event.clientY - 8;
    tooltip.style.left = `${x}px`;
    tooltip.style.top = `${y}px`;
  }
  function showTooltip(tooltip, content3) {
    tooltip.textContent = content3;
    tooltip.style.opacity = "1";
  }
  function hideTooltip(tooltip) {
    if (tooltip) {
      tooltip.style.opacity = "0";
    }
  }
  function getHighlightGroup(groupName) {
    const key = groupName || "_global";
    if (!highlightRegistry.has(key)) {
      highlightRegistry.set(key, []);
    }
    return highlightRegistry.get(key);
  }
  function applyHighlights(groupName, hoveredId, triggerElement, event) {
    const group2 = getHighlightGroup(groupName);
    group2.forEach((entry) => {
      const { element, classifyFn, tooltipContentFn, tooltipTrigger } = entry;
      const datum = element.__data__;
      ALL_HIGHLIGHT_CLASSES.forEach((cls) => element.classList.remove(cls));
      if (!datum) {
        console.warn("[CoordHighlight] applyHighlights: No datum on element", element);
        return;
      }
      const classification = classifyFn(hoveredId)(datum);
      switch (classification) {
        case HC_PRIMARY:
          element.classList.add(HIGHLIGHT_PRIMARY);
          break;
        case HC_RELATED:
          element.classList.add(HIGHLIGHT_RELATED);
          break;
        case HC_DIMMED:
          element.classList.add(HIGHLIGHT_DIMMED);
          break;
        case HC_NEUTRAL:
        default:
          break;
      }
      if (tooltipContentFn) {
        const content3 = tooltipContentFn(datum);
        const shouldShow = tooltipTrigger === TT_ON_HOVER && element === triggerElement || tooltipTrigger === TT_WHEN_PRIMARY && classification === HC_PRIMARY || tooltipTrigger === TT_WHEN_RELATED && (classification === HC_PRIMARY || classification === HC_RELATED);
        if (shouldShow) {
          let tooltip = elementTooltips.get(element);
          if (!tooltip) {
            tooltip = createTooltipElement();
            elementTooltips.set(element, tooltip);
          }
          showTooltip(tooltip, content3);
          if (tooltipTrigger === TT_ON_HOVER && event) {
            positionTooltipAtMouse(tooltip, event);
          } else {
            positionTooltipNearElement(tooltip, element);
          }
        } else {
          const tooltip = elementTooltips.get(element);
          if (tooltip) {
            hideTooltip(tooltip);
          }
        }
      }
    });
  }
  function clearHighlightsInGroup(groupName) {
    const group2 = getHighlightGroup(groupName);
    group2.forEach((entry) => {
      ALL_HIGHLIGHT_CLASSES.forEach((cls) => entry.element.classList.remove(cls));
      const tooltip = elementTooltips.get(entry.element);
      if (tooltip) {
        hideTooltip(tooltip);
      }
    });
  }
  function attachCoordinatedHighlight_(element) {
    return (identifyFn) => (classifyFn) => (groupName) => (tooltipContentFn) => (tooltipTrigger) => () => {
      const group2 = groupName;
      const groupKey = group2 || "_global";
      const entry = { element, identifyFn, classifyFn, tooltipContentFn, tooltipTrigger };
      getHighlightGroup(group2).push(entry);
      element.addEventListener("mouseenter", function(event) {
        const d = this.__data__;
        if (!d) {
          console.warn("[CoordHighlight] mouseenter: No datum on element");
          return;
        }
        const id2 = identifyFn(d);
        applyHighlights(group2, id2, element, event);
      });
      element.addEventListener("mouseleave", function(event) {
        clearHighlightsInGroup(group2);
      });
      return element;
    };
  }

  // output/PSD3.Internal.Selection.Join/index.js
  var unsafeIndex2 = /* @__PURE__ */ unsafeIndex();
  var foldlWithIndex2 = /* @__PURE__ */ foldlWithIndex(foldableWithIndexArray);
  var computeJoinWithKey = function(dictEq) {
    var eq3 = eq(dictEq);
    return function(newData) {
      return function(oldBindings) {
        return function(keyFn) {
          var processNewDatum = function(newIndex) {
            return function(state3) {
              return function(datum) {
                var newKey = keyFn(datum);
                var v = findIndex(function(v1) {
                  return eq3(keyFn(v1.datum))(newKey);
                })(state3.remainingOld);
                if (v instanceof Nothing) {
                  var enterBinding = {
                    datum,
                    newIndex
                  };
                  return {
                    remainingOld: state3.remainingOld,
                    matchedIndices: state3.matchedIndices,
                    update: state3.update,
                    enter: cons(enterBinding)(state3.enter)
                  };
                }
                ;
                if (v instanceof Just) {
                  var newRemaining = fromMaybe(state3.remainingOld)(deleteAt(v.value0)(state3.remainingOld));
                  var matched = unsafeIndex2(state3.remainingOld)(v.value0);
                  var updateBinding = {
                    element: matched.element,
                    oldDatum: datum,
                    newDatum: datum,
                    newIndex
                  };
                  return {
                    enter: state3.enter,
                    update: cons(updateBinding)(state3.update),
                    remainingOld: newRemaining,
                    matchedIndices: cons(v.value0)(state3.matchedIndices)
                  };
                }
                ;
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Join (line 167, column 9 - line 189, column 18): " + [v.constructor.name]);
              };
            };
          };
          var matchResult = foldlWithIndex2(processNewDatum)({
            remainingOld: oldBindings,
            enter: [],
            update: [],
            matchedIndices: []
          })(newData);
          return {
            enter: reverse2(matchResult.enter),
            update: reverse2(matchResult.update),
            exit: matchResult.remainingOld
          };
        };
      };
    };
  };
  var computeJoin = function(dictEq) {
    var eq3 = eq(dictEq);
    return function(newData) {
      return function(oldBindings) {
        var processNewDatum = function(newIndex) {
          return function(state3) {
            return function(datum) {
              var v = findIndex(function(v1) {
                return eq3(v1.datum)(datum);
              })(state3.remainingOld);
              if (v instanceof Nothing) {
                var enterBinding = {
                  datum,
                  newIndex
                };
                return {
                  remainingOld: state3.remainingOld,
                  matchedIndices: state3.matchedIndices,
                  update: state3.update,
                  enter: cons(enterBinding)(state3.enter)
                };
              }
              ;
              if (v instanceof Just) {
                var newRemaining = fromMaybe(state3.remainingOld)(deleteAt(v.value0)(state3.remainingOld));
                var matched = unsafeIndex2(state3.remainingOld)(v.value0);
                var updateBinding = {
                  element: matched.element,
                  oldDatum: datum,
                  newDatum: datum,
                  newIndex
                };
                return {
                  enter: state3.enter,
                  update: cons(updateBinding)(state3.update),
                  remainingOld: newRemaining,
                  matchedIndices: cons(v.value0)(state3.matchedIndices)
                };
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Join (line 100, column 7 - line 122, column 16): " + [v.constructor.name]);
            };
          };
        };
        var matchResult = foldlWithIndex2(processNewDatum)({
          remainingOld: oldBindings,
          enter: [],
          update: [],
          matchedIndices: []
        })(newData);
        return {
          enter: reverse2(matchResult.enter),
          update: reverse2(matchResult.update),
          exit: matchResult.remainingOld
        };
      };
    };
  };

  // output/PSD3.Internal.Selection.Operations.Conversions/foreign.js
  var parseNumberOrZero = (s) => {
    const n = parseFloat(s);
    return isNaN(n) ? 0 : n;
  };
  var isNumericString = (s) => {
    return !isNaN(parseFloat(s)) && isFinite(s);
  };

  // output/PSD3.Internal.Transition.Types/index.js
  var Linear2 = /* @__PURE__ */ (function() {
    function Linear3() {
    }
    ;
    Linear3.value = new Linear3();
    return Linear3;
  })();
  var Cubic = /* @__PURE__ */ (function() {
    function Cubic2() {
    }
    ;
    Cubic2.value = new Cubic2();
    return Cubic2;
  })();
  var CubicIn2 = /* @__PURE__ */ (function() {
    function CubicIn3() {
    }
    ;
    CubicIn3.value = new CubicIn3();
    return CubicIn3;
  })();
  var CubicOut2 = /* @__PURE__ */ (function() {
    function CubicOut3() {
    }
    ;
    CubicOut3.value = new CubicOut3();
    return CubicOut3;
  })();
  var CubicInOut2 = /* @__PURE__ */ (function() {
    function CubicInOut3() {
    }
    ;
    CubicInOut3.value = new CubicInOut3();
    return CubicInOut3;
  })();
  var Quad = /* @__PURE__ */ (function() {
    function Quad2() {
    }
    ;
    Quad2.value = new Quad2();
    return Quad2;
  })();
  var QuadIn2 = /* @__PURE__ */ (function() {
    function QuadIn3() {
    }
    ;
    QuadIn3.value = new QuadIn3();
    return QuadIn3;
  })();
  var QuadOut2 = /* @__PURE__ */ (function() {
    function QuadOut3() {
    }
    ;
    QuadOut3.value = new QuadOut3();
    return QuadOut3;
  })();
  var QuadInOut2 = /* @__PURE__ */ (function() {
    function QuadInOut3() {
    }
    ;
    QuadInOut3.value = new QuadInOut3();
    return QuadInOut3;
  })();
  var Sin = /* @__PURE__ */ (function() {
    function Sin2() {
    }
    ;
    Sin2.value = new Sin2();
    return Sin2;
  })();
  var SinIn2 = /* @__PURE__ */ (function() {
    function SinIn3() {
    }
    ;
    SinIn3.value = new SinIn3();
    return SinIn3;
  })();
  var SinOut2 = /* @__PURE__ */ (function() {
    function SinOut3() {
    }
    ;
    SinOut3.value = new SinOut3();
    return SinOut3;
  })();
  var SinInOut2 = /* @__PURE__ */ (function() {
    function SinInOut3() {
    }
    ;
    SinInOut3.value = new SinInOut3();
    return SinInOut3;
  })();
  var Exp = /* @__PURE__ */ (function() {
    function Exp2() {
    }
    ;
    Exp2.value = new Exp2();
    return Exp2;
  })();
  var ExpIn2 = /* @__PURE__ */ (function() {
    function ExpIn3() {
    }
    ;
    ExpIn3.value = new ExpIn3();
    return ExpIn3;
  })();
  var ExpOut2 = /* @__PURE__ */ (function() {
    function ExpOut3() {
    }
    ;
    ExpOut3.value = new ExpOut3();
    return ExpOut3;
  })();
  var ExpInOut2 = /* @__PURE__ */ (function() {
    function ExpInOut3() {
    }
    ;
    ExpInOut3.value = new ExpInOut3();
    return ExpInOut3;
  })();
  var Circle2 = /* @__PURE__ */ (function() {
    function Circle3() {
    }
    ;
    Circle3.value = new Circle3();
    return Circle3;
  })();
  var CircleIn2 = /* @__PURE__ */ (function() {
    function CircleIn3() {
    }
    ;
    CircleIn3.value = new CircleIn3();
    return CircleIn3;
  })();
  var CircleOut2 = /* @__PURE__ */ (function() {
    function CircleOut3() {
    }
    ;
    CircleOut3.value = new CircleOut3();
    return CircleOut3;
  })();
  var CircleInOut2 = /* @__PURE__ */ (function() {
    function CircleInOut3() {
    }
    ;
    CircleInOut3.value = new CircleInOut3();
    return CircleInOut3;
  })();
  var Elastic = /* @__PURE__ */ (function() {
    function Elastic2() {
    }
    ;
    Elastic2.value = new Elastic2();
    return Elastic2;
  })();
  var ElasticIn2 = /* @__PURE__ */ (function() {
    function ElasticIn3() {
    }
    ;
    ElasticIn3.value = new ElasticIn3();
    return ElasticIn3;
  })();
  var ElasticOut2 = /* @__PURE__ */ (function() {
    function ElasticOut3() {
    }
    ;
    ElasticOut3.value = new ElasticOut3();
    return ElasticOut3;
  })();
  var ElasticInOut2 = /* @__PURE__ */ (function() {
    function ElasticInOut3() {
    }
    ;
    ElasticInOut3.value = new ElasticInOut3();
    return ElasticInOut3;
  })();
  var Back = /* @__PURE__ */ (function() {
    function Back2() {
    }
    ;
    Back2.value = new Back2();
    return Back2;
  })();
  var BackIn2 = /* @__PURE__ */ (function() {
    function BackIn3() {
    }
    ;
    BackIn3.value = new BackIn3();
    return BackIn3;
  })();
  var BackOut2 = /* @__PURE__ */ (function() {
    function BackOut3() {
    }
    ;
    BackOut3.value = new BackOut3();
    return BackOut3;
  })();
  var BackInOut2 = /* @__PURE__ */ (function() {
    function BackInOut3() {
    }
    ;
    BackInOut3.value = new BackInOut3();
    return BackInOut3;
  })();
  var Bounce = /* @__PURE__ */ (function() {
    function Bounce2() {
    }
    ;
    Bounce2.value = new Bounce2();
    return Bounce2;
  })();
  var BounceIn2 = /* @__PURE__ */ (function() {
    function BounceIn3() {
    }
    ;
    BounceIn3.value = new BounceIn3();
    return BounceIn3;
  })();
  var BounceOut2 = /* @__PURE__ */ (function() {
    function BounceOut3() {
    }
    ;
    BounceOut3.value = new BounceOut3();
    return BounceOut3;
  })();
  var BounceInOut2 = /* @__PURE__ */ (function() {
    function BounceInOut3() {
    }
    ;
    BounceInOut3.value = new BounceInOut3();
    return BounceInOut3;
  })();
  var showEasing = {
    show: function(v) {
      if (v instanceof Linear2) {
        return "linear";
      }
      ;
      if (v instanceof Cubic) {
        return "cubic";
      }
      ;
      if (v instanceof CubicIn2) {
        return "cubicIn";
      }
      ;
      if (v instanceof CubicOut2) {
        return "cubicOut";
      }
      ;
      if (v instanceof CubicInOut2) {
        return "cubicInOut";
      }
      ;
      if (v instanceof Quad) {
        return "quad";
      }
      ;
      if (v instanceof QuadIn2) {
        return "quadIn";
      }
      ;
      if (v instanceof QuadOut2) {
        return "quadOut";
      }
      ;
      if (v instanceof QuadInOut2) {
        return "quadInOut";
      }
      ;
      if (v instanceof Sin) {
        return "sin";
      }
      ;
      if (v instanceof SinIn2) {
        return "sinIn";
      }
      ;
      if (v instanceof SinOut2) {
        return "sinOut";
      }
      ;
      if (v instanceof SinInOut2) {
        return "sinInOut";
      }
      ;
      if (v instanceof Exp) {
        return "exp";
      }
      ;
      if (v instanceof ExpIn2) {
        return "expIn";
      }
      ;
      if (v instanceof ExpOut2) {
        return "expOut";
      }
      ;
      if (v instanceof ExpInOut2) {
        return "expInOut";
      }
      ;
      if (v instanceof Circle2) {
        return "circle";
      }
      ;
      if (v instanceof CircleIn2) {
        return "circleIn";
      }
      ;
      if (v instanceof CircleOut2) {
        return "circleOut";
      }
      ;
      if (v instanceof CircleInOut2) {
        return "circleInOut";
      }
      ;
      if (v instanceof Elastic) {
        return "elastic";
      }
      ;
      if (v instanceof ElasticIn2) {
        return "elasticIn";
      }
      ;
      if (v instanceof ElasticOut2) {
        return "elasticOut";
      }
      ;
      if (v instanceof ElasticInOut2) {
        return "elasticInOut";
      }
      ;
      if (v instanceof Back) {
        return "back";
      }
      ;
      if (v instanceof BackIn2) {
        return "backIn";
      }
      ;
      if (v instanceof BackOut2) {
        return "backOut";
      }
      ;
      if (v instanceof BackInOut2) {
        return "backInOut";
      }
      ;
      if (v instanceof Bounce) {
        return "bounce";
      }
      ;
      if (v instanceof BounceIn2) {
        return "bounceIn";
      }
      ;
      if (v instanceof BounceOut2) {
        return "bounceOut";
      }
      ;
      if (v instanceof BounceInOut2) {
        return "bounceInOut";
      }
      ;
      throw new Error("Failed pattern match at PSD3.Internal.Transition.Types (line 91, column 1 - line 124, column 35): " + [v.constructor.name]);
    }
  };

  // output/PSD3.Internal.Selection.Operations.Conversions/index.js
  var show3 = /* @__PURE__ */ show(showNumber);
  var show1 = /* @__PURE__ */ show(showBoolean);
  var transitionEasingToAnimEasing = function(v) {
    if (v instanceof Linear2) {
      return Linear.value;
    }
    ;
    if (v instanceof QuadIn2) {
      return QuadIn.value;
    }
    ;
    if (v instanceof QuadOut2) {
      return QuadOut.value;
    }
    ;
    if (v instanceof QuadInOut2) {
      return QuadInOut.value;
    }
    ;
    if (v instanceof CubicIn2) {
      return CubicIn.value;
    }
    ;
    if (v instanceof CubicOut2) {
      return CubicOut.value;
    }
    ;
    if (v instanceof CubicInOut2) {
      return CubicInOut.value;
    }
    ;
    if (v instanceof SinIn2) {
      return SinIn.value;
    }
    ;
    if (v instanceof SinOut2) {
      return SinOut.value;
    }
    ;
    if (v instanceof SinInOut2) {
      return SinInOut.value;
    }
    ;
    if (v instanceof ExpIn2) {
      return ExpIn.value;
    }
    ;
    if (v instanceof ExpOut2) {
      return ExpOut.value;
    }
    ;
    if (v instanceof ExpInOut2) {
      return ExpInOut.value;
    }
    ;
    if (v instanceof ElasticIn2) {
      return ElasticIn.value;
    }
    ;
    if (v instanceof ElasticOut2) {
      return ElasticOut.value;
    }
    ;
    if (v instanceof ElasticInOut2) {
      return ElasticInOut.value;
    }
    ;
    if (v instanceof BounceIn2) {
      return BounceIn.value;
    }
    ;
    if (v instanceof BounceOut2) {
      return BounceOut.value;
    }
    ;
    if (v instanceof BounceInOut2) {
      return BounceInOut.value;
    }
    ;
    if (v instanceof BackIn2) {
      return BackIn.value;
    }
    ;
    if (v instanceof BackOut2) {
      return BackOut.value;
    }
    ;
    if (v instanceof BackInOut2) {
      return BackInOut.value;
    }
    ;
    if (v instanceof CircleIn2) {
      return CircleIn.value;
    }
    ;
    if (v instanceof CircleOut2) {
      return CircleOut.value;
    }
    ;
    if (v instanceof CircleInOut2) {
      return CircleInOut.value;
    }
    ;
    return Linear.value;
  };
  var tooltipTriggerToInt = function(v) {
    if (v instanceof OnHover) {
      return 0;
    }
    ;
    if (v instanceof WhenPrimary) {
      return 1;
    }
    ;
    if (v instanceof WhenRelated) {
      return 2;
    }
    ;
    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations.Conversions (line 158, column 1 - line 158, column 45): " + [v.constructor.name]);
  };
  var stringToElementType = function(v) {
    if (v === "circle") {
      return Circle.value;
    }
    ;
    if (v === "rect") {
      return Rect.value;
    }
    ;
    if (v === "path") {
      return Path.value;
    }
    ;
    if (v === "line") {
      return Line.value;
    }
    ;
    if (v === "text") {
      return Text.value;
    }
    ;
    if (v === "g") {
      return Group.value;
    }
    ;
    if (v === "svg") {
      return SVG.value;
    }
    ;
    if (v === "defs") {
      return Defs.value;
    }
    ;
    if (v === "linearGradient") {
      return LinearGradient.value;
    }
    ;
    if (v === "stop") {
      return Stop.value;
    }
    ;
    if (v === "pattern") {
      return PatternFill.value;
    }
    ;
    if (v === "div") {
      return Div.value;
    }
    ;
    if (v === "span") {
      return Span.value;
    }
    ;
    if (v === "table") {
      return Table.value;
    }
    ;
    if (v === "tr") {
      return Tr.value;
    }
    ;
    if (v === "td") {
      return Td.value;
    }
    ;
    if (v === "th") {
      return Th.value;
    }
    ;
    if (v === "tbody") {
      return Tbody.value;
    }
    ;
    if (v === "thead") {
      return Thead.value;
    }
    ;
    return Group.value;
  };
  var isNumericAttributeValue = function(v) {
    if (v instanceof NumberValue) {
      return true;
    }
    ;
    if (v instanceof StringValue) {
      return isNumericString(v.value0);
    }
    ;
    if (v instanceof BooleanValue) {
      return false;
    }
    ;
    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations.Conversions (line 90, column 1 - line 90, column 53): " + [v.constructor.name]);
  };
  var highlightClassToInt = function(v) {
    if (v instanceof Primary) {
      return 0;
    }
    ;
    if (v instanceof Related) {
      return 1;
    }
    ;
    if (v instanceof Dimmed) {
      return 2;
    }
    ;
    if (v instanceof Neutral) {
      return 3;
    }
    ;
    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations.Conversions (line 150, column 1 - line 150, column 45): " + [v.constructor.name]);
  };
  var elementTypeToString = function(v) {
    if (v instanceof Circle) {
      return "circle";
    }
    ;
    if (v instanceof Rect) {
      return "rect";
    }
    ;
    if (v instanceof Path) {
      return "path";
    }
    ;
    if (v instanceof Line) {
      return "line";
    }
    ;
    if (v instanceof Text) {
      return "text";
    }
    ;
    if (v instanceof Group) {
      return "g";
    }
    ;
    if (v instanceof SVG) {
      return "svg";
    }
    ;
    if (v instanceof Defs) {
      return "defs";
    }
    ;
    if (v instanceof LinearGradient) {
      return "linearGradient";
    }
    ;
    if (v instanceof Stop) {
      return "stop";
    }
    ;
    if (v instanceof PatternFill) {
      return "pattern";
    }
    ;
    if (v instanceof Div) {
      return "div";
    }
    ;
    if (v instanceof Span) {
      return "span";
    }
    ;
    if (v instanceof Table) {
      return "table";
    }
    ;
    if (v instanceof Tr) {
      return "tr";
    }
    ;
    if (v instanceof Td) {
      return "td";
    }
    ;
    if (v instanceof Th) {
      return "th";
    }
    ;
    if (v instanceof Tbody) {
      return "tbody";
    }
    ;
    if (v instanceof Thead) {
      return "thead";
    }
    ;
    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations.Conversions (line 100, column 1 - line 100, column 45): " + [v.constructor.name]);
  };
  var attributeValueToString = function(v) {
    if (v instanceof StringValue) {
      return v.value0;
    }
    ;
    if (v instanceof NumberValue) {
      return show3(v.value0);
    }
    ;
    if (v instanceof BooleanValue) {
      return show1(v.value0);
    }
    ;
    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations.Conversions (line 80, column 1 - line 80, column 51): " + [v.constructor.name]);
  };
  var attributeValueToNumber = function(v) {
    if (v instanceof NumberValue) {
      return v.value0;
    }
    ;
    if (v instanceof StringValue) {
      return parseNumberOrZero(v.value0);
    }
    ;
    if (v instanceof BooleanValue && v.value0) {
      return 1;
    }
    ;
    if (v instanceof BooleanValue && !v.value0) {
      return 0;
    }
    ;
    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations.Conversions (line 73, column 1 - line 73, column 51): " + [v.constructor.name]);
  };

  // output/Web.DOM.Document/foreign.js
  var getEffProp = function(name15) {
    return function(doc) {
      return function() {
        return doc[name15];
      };
    };
  };
  var url = getEffProp("URL");
  var documentURI = getEffProp("documentURI");
  var origin = getEffProp("origin");
  var compatMode = getEffProp("compatMode");
  var characterSet = getEffProp("characterSet");
  var contentType = getEffProp("contentType");
  var _documentElement = getEffProp("documentElement");
  function createElement(localName2) {
    return function(doc) {
      return function() {
        return doc.createElement(localName2);
      };
    };
  }
  function _createElementNS(ns) {
    return function(qualifiedName) {
      return function(doc) {
        return function() {
          return doc.createElementNS(ns, qualifiedName);
        };
      };
    };
  }

  // output/Web.Internal.FFI/foreign.js
  function _unsafeReadProtoTagged(nothing, just, name15, value12) {
    if (typeof window !== "undefined") {
      var ty = window[name15];
      if (ty != null && value12 instanceof ty) {
        return just(value12);
      }
    }
    var obj = value12;
    while (obj != null) {
      var proto = Object.getPrototypeOf(obj);
      var constructorName = proto.constructor.name;
      if (constructorName === name15) {
        return just(value12);
      } else if (constructorName === "Object") {
        return nothing;
      }
      obj = proto;
    }
    return nothing;
  }

  // output/Web.Internal.FFI/index.js
  var unsafeReadProtoTagged = function(name15) {
    return function(value12) {
      return _unsafeReadProtoTagged(Nothing.value, Just.create, name15, value12);
    };
  };

  // output/Web.DOM.Document/index.js
  var createElementNS = function($6) {
    return _createElementNS(toNullable($6));
  };

  // output/Web.DOM.Element/foreign.js
  var getProp = function(name15) {
    return function(doctype) {
      return doctype[name15];
    };
  };
  var _namespaceURI = getProp("namespaceURI");
  var _prefix = getProp("prefix");
  var localName = getProp("localName");
  var tagName = getProp("tagName");
  function setAttribute(name15) {
    return function(value12) {
      return function(element) {
        return function() {
          element.setAttribute(name15, value12);
        };
      };
    };
  }

  // output/Web.DOM.ParentNode/foreign.js
  var getEffProp2 = function(name15) {
    return function(node) {
      return function() {
        return node[name15];
      };
    };
  };
  var children = getEffProp2("children");
  var _firstElementChild = getEffProp2("firstElementChild");
  var _lastElementChild = getEffProp2("lastElementChild");
  var childElementCount = getEffProp2("childElementCount");
  function _querySelector(selector) {
    return function(node) {
      return function() {
        return node.querySelector(selector);
      };
    };
  }
  function querySelectorAll(selector) {
    return function(node) {
      return function() {
        return node.querySelectorAll(selector);
      };
    };
  }

  // output/Web.DOM.ParentNode/index.js
  var map5 = /* @__PURE__ */ map(functorEffect);
  var querySelector = function(qs) {
    var $2 = map5(toMaybe);
    var $3 = _querySelector(qs);
    return function($4) {
      return $2($3($4));
    };
  };

  // output/Web.DOM.Element/index.js
  var toParentNode = unsafeCoerce2;
  var toNode = unsafeCoerce2;
  var fromNode = /* @__PURE__ */ unsafeReadProtoTagged("Element");

  // output/Web.DOM.NodeList/foreign.js
  function toArray(list) {
    return function() {
      return [].slice.call(list);
    };
  }

  // output/PSD3.Internal.Selection.Operations.Helpers/index.js
  var traverse2 = /* @__PURE__ */ traverse(traversableArray)(applicativeEffect);
  var pure3 = /* @__PURE__ */ pure(applicativeEffect);
  var querySelectorAllElements = function(selector) {
    return function(parents) {
      return function __do2() {
        var nodeArrays = traverse2(function(parent2) {
          var parentNode2 = toParentNode(parent2);
          return function __do3() {
            var nodeList = querySelectorAll(selector)(parentNode2)();
            var nodes = toArray(nodeList)();
            return mapMaybe(fromNode)(nodes);
          };
        })(parents)();
        return concat(nodeArrays);
      };
    };
  };
  var queryFirstChild = function(selector) {
    return function(parent2) {
      var parentNode2 = toParentNode(parent2);
      return querySelector(selector)(parentNode2);
    };
  };
  var getDocument = function(v) {
    if (v instanceof EmptySelection) {
      return pure3(v.value0.document);
    }
    ;
    if (v instanceof BoundSelection) {
      return pure3(v.value0.document);
    }
    ;
    if (v instanceof PendingSelection) {
      return pure3(v.value0.document);
    }
    ;
    if (v instanceof ExitingSelection) {
      return pure3(v.value0.document);
    }
    ;
    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations.Helpers (line 34, column 1 - line 34, column 82): " + [v.constructor.name]);
  };
  var createElementWithNS = function(elemType) {
    return function(doc) {
      var v = elementContext(elemType);
      if (v instanceof SVGContext) {
        return createElementNS(new Just("http://www.w3.org/2000/svg"))(elementTypeToString(elemType))(doc);
      }
      ;
      if (v instanceof HTMLContext) {
        return createElement(elementTypeToString(elemType))(doc);
      }
      ;
      throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations.Helpers (line 48, column 3 - line 54, column 64): " + [v.constructor.name]);
    };
  };

  // output/PSD3.Internal.Selection.Operations.Selection/foreign.js
  var getElementData_2 = (element) => () => {
    return element.__data__ !== void 0 ? element.__data__ : null;
  };

  // output/Web.HTML/foreign.js
  var windowImpl = function() {
    return window;
  };

  // output/Web.HTML.HTMLDocument/index.js
  var toParentNode2 = unsafeCoerce2;
  var toDocument = unsafeCoerce2;

  // output/Web.HTML.Window/foreign.js
  function document2(window2) {
    return function() {
      return window2.document;
    };
  }

  // output/PSD3.Internal.Selection.Operations.Selection/index.js
  var bind2 = /* @__PURE__ */ bind(bindEffect);
  var traverse3 = /* @__PURE__ */ traverse(traversableArray)(applicativeEffect);
  var selectElement = function(dictMonadEffect) {
    var liftEffect3 = liftEffect(dictMonadEffect);
    return function(element) {
      return liftEffect3(function __do2() {
        var htmlDoc = bind2(windowImpl)(document2)();
        var doc = toDocument(htmlDoc);
        return new EmptySelection({
          parentElements: [element],
          document: doc
        });
      });
    };
  };
  var selectAllWithData = function(dictMonadEffect) {
    var liftEffect3 = liftEffect(dictMonadEffect);
    return function(selector) {
      return function(v) {
        return liftEffect3(function __do2() {
          var doc = getDocument(v)();
          var elements = (function() {
            if (v instanceof EmptySelection) {
              return querySelectorAllElements(selector)(v.value0.parentElements)();
            }
            ;
            if (v instanceof BoundSelection) {
              return querySelectorAllElements(selector)(v.value0.elements)();
            }
            ;
            if (v instanceof PendingSelection) {
              return querySelectorAllElements(selector)(v.value0.parentElements)();
            }
            ;
            if (v instanceof ExitingSelection) {
              return querySelectorAllElements(selector)(v.value0.elements)();
            }
            ;
            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations.Selection (line 148, column 15 - line 156, column 50): " + [v.constructor.name]);
          })();
          var dataArray = traverse3(function(el) {
            return function __do3() {
              var nullableDatum = getElementData_2(el)();
              var v1 = toMaybe(nullableDatum);
              if (v1 instanceof Just) {
                return v1.value0;
              }
              ;
              if (v1 instanceof Nothing) {
                return unit;
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations.Selection (line 162, column 16 - line 164, column 39): " + [v1.constructor.name]);
            };
          })(elements)();
          return mkBoundSelection(elements)(dataArray)(Nothing.value)(doc);
        });
      };
    };
  };
  var selectAll = function(dictMonadEffect) {
    var liftEffect3 = liftEffect(dictMonadEffect);
    return function(v) {
      return function(v1) {
        return liftEffect3(function __do2() {
          var doc = getDocument(v1)();
          var parentElems = (function() {
            if (v1 instanceof EmptySelection) {
              return v1.value0.parentElements;
            }
            ;
            if (v1 instanceof BoundSelection) {
              return v1.value0.elements;
            }
            ;
            if (v1 instanceof PendingSelection) {
              return v1.value0.parentElements;
            }
            ;
            if (v1 instanceof ExitingSelection) {
              return v1.value0.elements;
            }
            ;
            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations.Selection (line 116, column 19 - line 120, column 48): " + [v1.constructor.name]);
          })();
          return new EmptySelection({
            parentElements: parentElems,
            document: doc
          });
        });
      };
    };
  };
  var select4 = function(dictMonadEffect) {
    var liftEffect3 = liftEffect(dictMonadEffect);
    return function(selector) {
      return liftEffect3(function __do2() {
        var htmlDoc = bind2(windowImpl)(document2)();
        var doc = toDocument(htmlDoc);
        var parentNode2 = toParentNode2(htmlDoc);
        var maybeElement = querySelector(selector)(parentNode2)();
        if (maybeElement instanceof Nothing) {
          return new EmptySelection({
            parentElements: [],
            document: doc
          });
        }
        ;
        if (maybeElement instanceof Just) {
          return new EmptySelection({
            parentElements: [maybeElement.value0],
            document: doc
          });
        }
        ;
        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations.Selection (line 62, column 3 - line 70, column 8): " + [maybeElement.constructor.name]);
      });
    };
  };

  // output/PSD3.Internal.Transition.FFI/foreign.js
  function createTransition_(duration2) {
    return function(delay) {
      return function(easingName) {
        return function(element) {
          return function() {
            const handle = {
              element,
              duration: duration2,
              delay: delay ?? 0,
              easing: mapEasingToCss(easingName),
              attrs: [],
              // [{name, value}] collected via transitionSetAttribute_
              removeOnEnd: false,
              // set by transitionRemove_
              committed: false,
              animation: null
            };
            queueMicrotask(() => commitTransition(handle));
            return handle;
          };
        };
      };
    };
  }
  function transitionSetAttribute_(name15) {
    return function(value12) {
      return function(handle) {
        return function() {
          if (handle.committed) {
            handle.element.setAttribute(name15, value12);
            return;
          }
          handle.attrs.push({ name: name15, value: value12 });
        };
      };
    };
  }
  function transitionRemove_(handle) {
    return function() {
      handle.removeOnEnd = true;
    };
  }
  function commitTransition(handle) {
    if (handle.committed) return;
    handle.committed = true;
    const { element, duration: duration2, delay, easing, attrs, removeOnEnd } = handle;
    if (attrs.length === 0) {
      if (removeOnEnd) {
        setTimeout(() => element.remove(), delay);
      }
      return;
    }
    const fromFrame = {};
    const toFrame = {};
    for (const { name: name15, value: value12 } of attrs) {
      const currentValue = element.getAttribute(name15) ?? getDefaultAttrValue(name15);
      const cssName = attrToCssProp(name15);
      fromFrame[cssName] = currentValue;
      toFrame[cssName] = value12;
    }
    try {
      const animation = element.animate(
        [fromFrame, toFrame],
        {
          duration: duration2,
          delay,
          easing,
          fill: "forwards"
          // Keep final values
        }
      );
      handle.animation = animation;
      animation.onfinish = () => {
        for (const { name: name15, value: value12 } of attrs) {
          element.setAttribute(name15, value12);
        }
        if (removeOnEnd) {
          element.remove();
        }
      };
    } catch (e) {
      for (const { name: name15, value: value12 } of attrs) {
        element.setAttribute(name15, value12);
      }
      if (removeOnEnd) {
        setTimeout(() => element.remove(), delay + duration2);
      }
    }
  }
  function mapEasingToCss(name15) {
    if (!name15) return "ease-out";
    const easingMap = {
      // Linear
      "linear": "linear",
      // Polynomial (Quad) - CSS ease equivalents
      "quad": "ease-out",
      "quadIn": "ease-in",
      "quadOut": "ease-out",
      "quadInOut": "ease-in-out",
      // Cubic - CSS ease equivalents (very close)
      "cubic": "cubic-bezier(0.215, 0.61, 0.355, 1)",
      "cubicIn": "cubic-bezier(0.55, 0.055, 0.675, 0.19)",
      "cubicOut": "cubic-bezier(0.215, 0.61, 0.355, 1)",
      "cubicInOut": "cubic-bezier(0.645, 0.045, 0.355, 1)",
      // Sinusoidal
      "sin": "cubic-bezier(0.39, 0.575, 0.565, 1)",
      "sinIn": "cubic-bezier(0.47, 0, 0.745, 0.715)",
      "sinOut": "cubic-bezier(0.39, 0.575, 0.565, 1)",
      "sinInOut": "cubic-bezier(0.445, 0.05, 0.55, 0.95)",
      // Exponential
      "exp": "cubic-bezier(0.19, 1, 0.22, 1)",
      "expIn": "cubic-bezier(0.95, 0.05, 0.795, 0.035)",
      "expOut": "cubic-bezier(0.19, 1, 0.22, 1)",
      "expInOut": "cubic-bezier(1, 0, 0, 1)",
      // Circular
      "circle": "cubic-bezier(0.075, 0.82, 0.165, 1)",
      "circleIn": "cubic-bezier(0.6, 0.04, 0.98, 0.335)",
      "circleOut": "cubic-bezier(0.075, 0.82, 0.165, 1)",
      "circleInOut": "cubic-bezier(0.785, 0.135, 0.15, 0.86)",
      // These don't have CSS equivalents - use approximations
      "elastic": "cubic-bezier(0.68, -0.55, 0.265, 1.55)",
      "elasticIn": "cubic-bezier(0.6, -0.28, 0.735, 0.045)",
      "elasticOut": "cubic-bezier(0.175, 0.885, 0.32, 1.275)",
      "elasticInOut": "cubic-bezier(0.68, -0.55, 0.265, 1.55)",
      "back": "cubic-bezier(0.175, 0.885, 0.32, 1.275)",
      "backIn": "cubic-bezier(0.6, -0.28, 0.735, 0.045)",
      "backOut": "cubic-bezier(0.175, 0.885, 0.32, 1.275)",
      "backInOut": "cubic-bezier(0.68, -0.55, 0.265, 1.55)",
      "bounce": "ease-out",
      "bounceIn": "ease-in",
      "bounceOut": "ease-out",
      "bounceInOut": "ease-in-out"
    };
    return easingMap[name15] || "ease-out";
  }
  function attrToCssProp(name15) {
    const mapping = {
      "fill": "fill",
      "stroke": "stroke",
      "opacity": "opacity",
      "fill-opacity": "fillOpacity",
      "stroke-opacity": "strokeOpacity",
      "stroke-width": "strokeWidth",
      "transform": "transform",
      // Positional attributes are camelCased in Web Animations
      "cx": "cx",
      "cy": "cy",
      "r": "r",
      "x": "x",
      "y": "y",
      "x1": "x1",
      "y1": "y1",
      "x2": "x2",
      "y2": "y2",
      "width": "width",
      "height": "height",
      "rx": "rx",
      "ry": "ry",
      "d": "d"
    };
    return mapping[name15] || name15;
  }
  function getDefaultAttrValue(name15) {
    const defaults = {
      "opacity": "1",
      "fill-opacity": "1",
      "stroke-opacity": "1",
      "stroke-width": "1",
      "r": "0",
      "cx": "0",
      "cy": "0",
      "x": "0",
      "y": "0",
      "width": "0",
      "height": "0"
    };
    return defaults[name15] || "0";
  }

  // output/PSD3.Internal.Transition.FFI/index.js
  var map6 = /* @__PURE__ */ map(functorMaybe);
  var maybeEasingToNullable = /* @__PURE__ */ (function() {
    var $6 = map6(show(showEasing));
    return function($7) {
      return toNullable($6($7));
    };
  })();

  // output/PSD3.Internal.Transition.Manager/foreign.js
  var pow3 = (x) => (y) => Math.pow(x, y);
  var sin2 = (x) => Math.sin(x);
  var cos2 = (x) => Math.cos(x);
  var sqrt2 = (x) => Math.sqrt(x);
  var setAttribute2 = (element) => (name15) => (value12) => () => {
    element.setAttribute(name15, value12);
  };
  var readAttributeNumber = (element) => (name15) => () => {
    const raw = element.getAttribute(name15);
    if (raw === null) return 0;
    const parsed = parseFloat(raw);
    return isNaN(parsed) ? 0 : parsed;
  };
  var elementIdMap = /* @__PURE__ */ new WeakMap();
  var nextElementId = 0;
  var unsafeElementRef = (element) => {
    let id2 = elementIdMap.get(element);
    if (id2 === void 0) {
      id2 = `__elem_${nextElementId++}`;
      elementIdMap.set(element, id2);
    }
    return id2;
  };

  // output/PSD3.Transition.RAF/foreign.js
  var requestAnimationFrame_ = function(callback) {
    return function() {
      return window.requestAnimationFrame(function(timestamp) {
        callback(timestamp)();
      });
    };
  };
  var performanceNow_ = function() {
    return performance.now();
  };

  // output/PSD3.Transition.RAF/index.js
  var requestAnimationFrame2 = requestAnimationFrame_;
  var performanceNow = performanceNow_;

  // output/PSD3.Transition.Coordinator/index.js
  var when2 = /* @__PURE__ */ when(applicativeEffect);
  var for_2 = /* @__PURE__ */ for_(applicativeEffect);
  var append4 = /* @__PURE__ */ append(semigroupArray);
  var $$for2 = /* @__PURE__ */ $$for(applicativeEffect)(traversableArray);
  var for_22 = /* @__PURE__ */ for_2(foldableArray);
  var unless2 = /* @__PURE__ */ unless(applicativeEffect);
  var StillRunning = /* @__PURE__ */ (function() {
    function StillRunning2() {
    }
    ;
    StillRunning2.value = new StillRunning2();
    return StillRunning2;
  })();
  var Completed = /* @__PURE__ */ (function() {
    function Completed2() {
    }
    ;
    Completed2.value = new Completed2();
    return Completed2;
  })();
  var eqConsumerId = {
    eq: function(x) {
      return function(y) {
        return x === y;
      };
    }
  };
  var notEq3 = /* @__PURE__ */ notEq(eqConsumerId);
  var unregister = function(v) {
    return function(consumerId) {
      return modify_(function(s) {
        return {
          frameId: s.frameId,
          lastTimestamp: s.lastTimestamp,
          nextId: s.nextId,
          running: s.running,
          consumers: filter(function(c) {
            return notEq3(c.id)(consumerId);
          })(s.consumers)
        };
      })(v);
    };
  };
  var register = function(v) {
    return function(spec) {
      return function __do2() {
        var state3 = read(v)();
        var consumer = {
          id: state3.nextId,
          tick: spec.tick,
          onComplete: spec.onComplete
        };
        write({
          frameId: state3.frameId,
          lastTimestamp: state3.lastTimestamp,
          running: state3.running,
          consumers: append4(state3.consumers)([consumer]),
          nextId: state3.nextId + 1 | 0
        })(v)();
        return state3.nextId;
      };
    };
  };
  var isCompleted = function(v) {
    if (v instanceof Completed) {
      return true;
    }
    ;
    return false;
  };
  var scheduleFrame = function(v) {
    return function __do2() {
      var frameId = requestAnimationFrame2(runFrame(v))();
      return modify_(function(v1) {
        return {
          consumers: v1.consumers,
          lastTimestamp: v1.lastTimestamp,
          nextId: v1.nextId,
          running: v1.running,
          frameId: new Just(frameId)
        };
      })(v)();
    };
  };
  var runFrame = function(v) {
    return function(timestamp) {
      return function __do2() {
        var state3 = read(v)();
        return when2(state3.running)((function() {
          var deltaMs = timestamp - state3.lastTimestamp;
          return function __do3() {
            modify_(function(v1) {
              return {
                consumers: v1.consumers,
                frameId: v1.frameId,
                nextId: v1.nextId,
                running: v1.running,
                lastTimestamp: timestamp
              };
            })(v)();
            var results = $$for2(state3.consumers)(function(consumer) {
              return function __do4() {
                var result = consumer.tick(deltaMs)();
                return {
                  consumer,
                  result
                };
              };
            })();
            var completed = filter(function(r) {
              return isCompleted(r.result);
            })(results);
            for_22(completed)(function(r) {
              return function __do4() {
                r.consumer.onComplete();
                return unregister(v)(r.consumer.id)();
              };
            })();
            var newState = read(v)();
            var $47 = $$null2(newState.consumers);
            if ($47) {
              return scheduleFrame(v)();
            }
            ;
            return scheduleFrame(v)();
          };
        })())();
      };
    };
  };
  var start2 = function(v) {
    return function __do2() {
      var state3 = read(v)();
      return unless2(state3.running)(function __do3() {
        var now = performanceNow();
        modify_(function(v1) {
          return {
            consumers: v1.consumers,
            frameId: v1.frameId,
            nextId: v1.nextId,
            running: true,
            lastTimestamp: now
          };
        })(v)();
        return scheduleFrame(v)();
      })();
    };
  };

  // output/PSD3.Internal.Transition.Manager/index.js
  var show4 = /* @__PURE__ */ show(showInt);
  var lookup2 = /* @__PURE__ */ lookup(ordString);
  var insert2 = /* @__PURE__ */ insert(ordString);
  var ordRecord2 = /* @__PURE__ */ ordRecord()(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(ordRecordNil)()({
    reflectSymbol: function() {
      return "elementId";
    }
  })(ordString))()({
    reflectSymbol: function() {
      return "attrName";
    }
  })(ordString));
  var insert1 = /* @__PURE__ */ insert(ordRecord2);
  var map7 = /* @__PURE__ */ map(functorArray);
  var toUnfoldable4 = /* @__PURE__ */ toUnfoldable2(unfoldableArray);
  var for_3 = /* @__PURE__ */ for_(applicativeEffect)(foldableArray);
  var max6 = /* @__PURE__ */ max(ordNumber);
  var min5 = /* @__PURE__ */ min(ordNumber);
  var show12 = /* @__PURE__ */ show(showNumber);
  var append1 = /* @__PURE__ */ append(semigroupArray);
  var $$delete2 = /* @__PURE__ */ $$delete(ordRecord2);
  var update2 = /* @__PURE__ */ update(ordRecord2);
  var SingleTransition = /* @__PURE__ */ (function() {
    function SingleTransition2(value0) {
      this.value0 = value0;
    }
    ;
    SingleTransition2.create = function(value0) {
      return new SingleTransition2(value0);
    };
    return SingleTransition2;
  })();
  var CompoundTransition = /* @__PURE__ */ (function() {
    function CompoundTransition2(value0) {
      this.value0 = value0;
    }
    ;
    CompoundTransition2.create = function(value0) {
      return new CompoundTransition2(value0);
    };
    return CompoundTransition2;
  })();
  var registerTransitionInternal = function(v) {
    return function(element) {
      return function(attrName) {
        return function(transitionType) {
          return function(onComplete) {
            return function __do2() {
              var state3 = read(v)();
              var elemRef = unsafeElementRef(element);
              var v1 = (function() {
                var v12 = lookup2(elemRef)(state3.elementIds);
                if (v12 instanceof Just) {
                  return new Tuple(v12.value0, state3);
                }
                ;
                if (v12 instanceof Nothing) {
                  var eid = "elem-" + show4(state3.nextElementId);
                  var newIds = insert2(elemRef)(eid)(state3.elementIds);
                  return new Tuple(eid, {
                    nextId: state3.nextId,
                    transitions: state3.transitions,
                    elementIds: newIds,
                    nextElementId: state3.nextElementId + 1 | 0
                  });
                }
                ;
                throw new Error("Failed pattern match at PSD3.Internal.Transition.Manager (line 194, column 31 - line 199, column 96): " + [v12.constructor.name]);
              })();
              var key = {
                elementId: v1.value0,
                attrName
              };
              var transition = {
                id: v1.value1.nextId,
                element,
                attrName,
                transitionType,
                elapsed: 0,
                onComplete
              };
              var newTransitions = insert1(key)(transition)(v1.value1.transitions);
              write({
                elementIds: v1.value1.elementIds,
                nextElementId: v1.value1.nextElementId,
                transitions: newTransitions,
                nextId: v1.value1.nextId + 1 | 0
              })(v)();
              return v1.value1.nextId;
            };
          };
        };
      };
    };
  };
  var registerTransitionWithCallback = function(manager) {
    return function(element) {
      return function(attrName) {
        return function(spec) {
          return function(onComplete) {
            return registerTransitionInternal(manager)(element)(attrName)(new SingleTransition(spec))(onComplete);
          };
        };
      };
    };
  };
  var pi = 3.141592653589793;
  var lerp = function(from2) {
    return function(to) {
      return function(t) {
        return from2 + (to - from2) * t;
      };
    };
  };
  var evalAnimatedValue = function(v) {
    return function(v1) {
      return function(v2) {
        if (v instanceof StaticAnimValue) {
          return v.value0;
        }
        ;
        if (v instanceof DataAnimValue) {
          return v.value0(v1);
        }
        ;
        if (v instanceof IndexedAnimValue) {
          return v.value0(v1)(v2);
        }
        ;
        throw new Error("Failed pattern match at PSD3.Internal.Transition.Manager (line 296, column 1 - line 296, column 81): " + [v.constructor.name, v1.constructor.name, v2.constructor.name]);
      };
    };
  };
  var registerAnimatedAttr = function(manager) {
    return function(element) {
      return function(datum) {
        return function(index3) {
          return function(attrName) {
            return function(maybeFrom) {
              return function(toValue) {
                return function(config) {
                  return function(onComplete) {
                    var to = evalAnimatedValue(toValue)(datum)(index3);
                    return function __do2() {
                      var from2 = (function() {
                        if (maybeFrom instanceof Just) {
                          return evalAnimatedValue(maybeFrom.value0)(datum)(index3);
                        }
                        ;
                        if (maybeFrom instanceof Nothing) {
                          return readAttributeNumber(element)(attrName)();
                        }
                        ;
                        throw new Error("Failed pattern match at PSD3.Internal.Transition.Manager (line 245, column 11 - line 247, column 52): " + [maybeFrom.constructor.name]);
                      })();
                      var spec = {
                        from: from2,
                        to,
                        duration: config.duration,
                        easing: config.easing,
                        delay: config.delay
                      };
                      return registerTransitionWithCallback(manager)(element)(attrName)(spec)(onComplete)();
                    };
                  };
                };
              };
            };
          };
        };
      };
    };
  };
  var registerAnimatedCompound = function(manager) {
    return function(element) {
      return function(datum) {
        return function(index3) {
          return function(attrName) {
            return function(fromValues) {
              return function(toValues) {
                return function(generator) {
                  return function(config) {
                    return function(onComplete) {
                      var evaluatedFroms = map7(function(av) {
                        return evalAnimatedValue(av)(datum)(index3);
                      })(fromValues);
                      var evaluatedTos = map7(function(av) {
                        return evalAnimatedValue(av)(datum)(index3);
                      })(toValues);
                      var compoundSpec = {
                        fromValues: evaluatedFroms,
                        toValues: evaluatedTos,
                        generator,
                        duration: config.duration,
                        easing: config.easing,
                        delay: config.delay
                      };
                      return registerTransitionInternal(manager)(element)(attrName)(new CompoundTransition(compoundSpec))(onComplete);
                    };
                  };
                };
              };
            };
          };
        };
      };
    };
  };
  var bounceOut = function(t) {
    var $97 = t < 1 / 2.75;
    if ($97) {
      return 7.5625 * t * t;
    }
    ;
    var $98 = t < 2 / 2.75;
    if ($98) {
      var t$prime = t - 1.5 / 2.75;
      return 7.5625 * t$prime * t$prime + 0.75;
    }
    ;
    var $99 = t < 2.5 / 2.75;
    if ($99) {
      var t$prime = t - 2.25 / 2.75;
      return 7.5625 * t$prime * t$prime + 0.9375;
    }
    ;
    var t$prime = t - 2.625 / 2.75;
    return 7.5625 * t$prime * t$prime + 0.984375;
  };
  var applyEasing = function(v) {
    return function(v1) {
      if (v instanceof Linear) {
        return v1;
      }
      ;
      if (v instanceof QuadIn) {
        return v1 * v1;
      }
      ;
      if (v instanceof QuadOut) {
        return v1 * (2 - v1);
      }
      ;
      if (v instanceof QuadInOut) {
        var $102 = v1 < 0.5;
        if ($102) {
          return 2 * v1 * v1;
        }
        ;
        return -1 + (4 - 2 * v1) * v1;
      }
      ;
      if (v instanceof CubicIn) {
        return v1 * v1 * v1;
      }
      ;
      if (v instanceof CubicOut) {
        var t$prime = v1 - 1;
        return t$prime * t$prime * t$prime + 1;
      }
      ;
      if (v instanceof CubicInOut) {
        var $103 = v1 < 0.5;
        if ($103) {
          return 4 * v1 * v1 * v1;
        }
        ;
        return (v1 - 1) * (2 * v1 - 2) * (2 * v1 - 2) + 1;
      }
      ;
      if (v instanceof SinIn) {
        return 1 - cos2(v1 * pi / 2);
      }
      ;
      if (v instanceof SinOut) {
        return sin2(v1 * pi / 2);
      }
      ;
      if (v instanceof SinInOut) {
        return -(cos2(pi * v1) - 1) / 2;
      }
      ;
      if (v instanceof ExpIn) {
        var $104 = v1 === 0;
        if ($104) {
          return 0;
        }
        ;
        return pow3(2)(10 * (v1 - 1));
      }
      ;
      if (v instanceof ExpOut) {
        var $105 = v1 === 1;
        if ($105) {
          return 1;
        }
        ;
        return 1 - pow3(2)(-10 * v1);
      }
      ;
      if (v instanceof ExpInOut) {
        var $106 = v1 === 0;
        if ($106) {
          return 0;
        }
        ;
        var $107 = v1 === 1;
        if ($107) {
          return 1;
        }
        ;
        var $108 = v1 < 0.5;
        if ($108) {
          return pow3(2)(20 * v1 - 10) / 2;
        }
        ;
        return (2 - pow3(2)(-20 * v1 + 10)) / 2;
      }
      ;
      if (v instanceof CircleIn) {
        return 1 - sqrt2(1 - v1 * v1);
      }
      ;
      if (v instanceof CircleOut) {
        return sqrt2(1 - pow3(v1 - 1)(2));
      }
      ;
      if (v instanceof CircleInOut) {
        var $109 = v1 < 0.5;
        if ($109) {
          return (1 - sqrt2(1 - pow3(2 * v1)(2))) / 2;
        }
        ;
        return (sqrt2(1 - pow3(-2 * v1 + 2)(2)) + 1) / 2;
      }
      ;
      if (v instanceof BackIn) {
        var c3 = 1.70158 + 1;
        return c3 * v1 * v1 * v1 - 1.70158 * v1 * v1;
      }
      ;
      if (v instanceof BackOut) {
        var t$prime = v1 - 1;
        var c3 = 1.70158 + 1;
        return 1 + c3 * t$prime * t$prime * t$prime + 1.70158 * t$prime * t$prime;
      }
      ;
      if (v instanceof BackInOut) {
        var c2 = 1.70158 * 1.525;
        var $110 = v1 < 0.5;
        if ($110) {
          return pow3(2 * v1)(2) * ((c2 + 1) * 2 * v1 - c2) / 2;
        }
        ;
        return (pow3(2 * v1 - 2)(2) * ((c2 + 1) * (v1 * 2 - 2) + c2) + 2) / 2;
      }
      ;
      if (v instanceof ElasticIn) {
        var $111 = v1 === 0;
        if ($111) {
          return 0;
        }
        ;
        var $112 = v1 === 1;
        if ($112) {
          return 1;
        }
        ;
        var c4 = 2 * pi / 3;
        return -pow3(2)(10 * v1 - 10) * sin2((v1 * 10 - 10.75) * c4);
      }
      ;
      if (v instanceof ElasticOut) {
        var $113 = v1 === 0;
        if ($113) {
          return 0;
        }
        ;
        var $114 = v1 === 1;
        if ($114) {
          return 1;
        }
        ;
        var c4 = 2 * pi / 3;
        return pow3(2)(-10 * v1) * sin2((v1 * 10 - 0.75) * c4) + 1;
      }
      ;
      if (v instanceof ElasticInOut) {
        var $115 = v1 === 0;
        if ($115) {
          return 0;
        }
        ;
        var $116 = v1 === 1;
        if ($116) {
          return 1;
        }
        ;
        var c5 = 2 * pi / 4.5;
        var $117 = v1 < 0.5;
        if ($117) {
          return -(pow3(2)(20 * v1 - 10) * sin2((20 * v1 - 11.125) * c5)) / 2;
        }
        ;
        return pow3(2)(-20 * v1 + 10) * sin2((20 * v1 - 11.125) * c5) / 2 + 1;
      }
      ;
      if (v instanceof BounceIn) {
        return 1 - bounceOut(1 - v1);
      }
      ;
      if (v instanceof BounceOut) {
        return bounceOut(v1);
      }
      ;
      if (v instanceof BounceInOut) {
        var $118 = v1 < 0.5;
        if ($118) {
          return (1 - bounceOut(1 - 2 * v1)) / 2;
        }
        ;
        return (1 + bounceOut(2 * v1 - 1)) / 2;
      }
      ;
      throw new Error("Failed pattern match at PSD3.Internal.Transition.Manager (line 395, column 1 - line 395, column 46): " + [v.constructor.name, v1.constructor.name]);
    };
  };
  var tick = function(v) {
    return function(deltaMs) {
      return function __do2() {
        var state3 = read(v)();
        var transitions = toUnfoldable4(state3.transitions);
        var completedIds = $$new([])();
        for_3(transitions)(function(v1) {
          var newElapsed = v1.value1.elapsed + deltaMs;
          var v2 = (function() {
            if (v1.value1.transitionType instanceof SingleTransition) {
              return {
                duration: v1.value1.transitionType.value0.duration,
                delay: v1.value1.transitionType.value0.delay,
                easing: v1.value1.transitionType.value0.easing
              };
            }
            ;
            if (v1.value1.transitionType instanceof CompoundTransition) {
              return {
                duration: v1.value1.transitionType.value0.duration,
                delay: v1.value1.transitionType.value0.delay,
                easing: v1.value1.transitionType.value0.easing
              };
            }
            ;
            throw new Error("Failed pattern match at PSD3.Internal.Transition.Manager (line 322, column 39 - line 324, column 105): " + [v1.value1.transitionType.constructor.name]);
          })();
          var effectiveElapsed = max6(0)(newElapsed - v2.delay);
          var rawProgress = effectiveElapsed / v2.duration;
          var clampedProgress = min5(1)(max6(0)(rawProgress));
          var easedProgress = applyEasing(v2.easing)(clampedProgress);
          return function __do3() {
            (function() {
              if (v1.value1.transitionType instanceof SingleTransition) {
                var currentValue = lerp(v1.value1.transitionType.value0.from)(v1.value1.transitionType.value0.to)(easedProgress);
                return setAttribute2(v1.value1.element)(v1.value1.attrName)(show12(currentValue))();
              }
              ;
              if (v1.value1.transitionType instanceof CompoundTransition) {
                var interpolatedValues = zipWith(function(from2) {
                  return function(to) {
                    return lerp(from2)(to)(easedProgress);
                  };
                })(v1.value1.transitionType.value0.fromValues)(v1.value1.transitionType.value0.toValues);
                var generatedValue = v1.value1.transitionType.value0.generator(interpolatedValues);
                return setAttribute2(v1.value1.element)(v1.value1.attrName)(generatedValue)();
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Transition.Manager (line 337, column 5 - line 350, column 65): " + [v1.value1.transitionType.constructor.name]);
            })();
            var isComplete = newElapsed >= v2.duration + v2.delay;
            if (isComplete) {
              v1.value1.onComplete();
              modify_(function(ids) {
                return append1(ids)([v1.value1.id]);
              })(completedIds)();
              return modify_(function(s) {
                return {
                  elementIds: s.elementIds,
                  nextElementId: s.nextElementId,
                  nextId: s.nextId,
                  transitions: $$delete2(v1.value0)(s.transitions)
                };
              })(v)();
            }
            ;
            return modify_(function(s) {
              return {
                elementIds: s.elementIds,
                nextElementId: s.nextElementId,
                nextId: s.nextId,
                transitions: update2(function(t) {
                  return new Just({
                    attrName: t.attrName,
                    element: t.element,
                    id: t.id,
                    onComplete: t.onComplete,
                    transitionType: t.transitionType,
                    elapsed: newElapsed
                  });
                })(v1.value0)(s.transitions)
              };
            })(v)();
          };
        })();
        return read(completedIds)();
      };
    };
  };
  var activeCount = function(v) {
    return function __do2() {
      var state3 = read(v)();
      return size(state3.transitions);
    };
  };
  var toCoordinatorConsumer = function(manager) {
    return function(deltaMs) {
      return function __do2() {
        tick(manager)(deltaMs)();
        var count = activeCount(manager)();
        var $136 = count === 0;
        if ($136) {
          return Completed.value;
        }
        ;
        return StillRunning.value;
      };
    };
  };

  // output/Web.DOM.Node/foreign.js
  var getEffProp3 = function(name15) {
    return function(node) {
      return function() {
        return node[name15];
      };
    };
  };
  var baseURI = getEffProp3("baseURI");
  var _ownerDocument = getEffProp3("ownerDocument");
  var _parentNode = getEffProp3("parentNode");
  var _parentElement = getEffProp3("parentElement");
  var childNodes = getEffProp3("childNodes");
  var _firstChild = getEffProp3("firstChild");
  var _lastChild = getEffProp3("lastChild");
  var _previousSibling = getEffProp3("previousSibling");
  var _nextSibling = getEffProp3("nextSibling");
  var _nodeValue = getEffProp3("nodeValue");
  var textContent = getEffProp3("textContent");
  function appendChild(node) {
    return function(parent2) {
      return function() {
        parent2.appendChild(node);
      };
    };
  }
  function removeChild(node) {
    return function(parent2) {
      return function() {
        parent2.removeChild(node);
      };
    };
  }

  // output/Web.DOM.Node/index.js
  var map8 = /* @__PURE__ */ map(functorEffect);
  var parentNode = /* @__PURE__ */ (function() {
    var $6 = map8(toMaybe);
    return function($7) {
      return $6(_parentNode($7));
    };
  })();

  // output/Web.UIEvent.MouseEvent/foreign.js
  function clientX(e) {
    return e.clientX;
  }
  function clientY(e) {
    return e.clientY;
  }
  function pageX(e) {
    return e.pageX;
  }
  function pageY(e) {
    return e.pageY;
  }

  // output/PSD3.Internal.Selection.Operations/index.js
  var traverse4 = /* @__PURE__ */ traverse(traversableArray)(applicativeEffect);
  var pure4 = /* @__PURE__ */ pure(applicativeEffect);
  var discard2 = /* @__PURE__ */ discard(discardUnit);
  var map9 = /* @__PURE__ */ map(functorArray);
  var traverse_2 = /* @__PURE__ */ traverse_(applicativeEffect)(foldableArray);
  var append12 = /* @__PURE__ */ append(semigroupArray);
  var mapFlipped1 = /* @__PURE__ */ mapFlipped(functorMaybe);
  var compare2 = /* @__PURE__ */ compare(ordInt);
  var mapFlipped2 = /* @__PURE__ */ mapFlipped(functorArray);
  var unless3 = /* @__PURE__ */ unless(applicativeEffect);
  var unwrap2 = /* @__PURE__ */ unwrap();
  var map1 = /* @__PURE__ */ map(functorMaybe);
  var traverseWithIndex_2 = /* @__PURE__ */ traverseWithIndex_(applicativeEffect)(foldableWithIndexArray);
  var $$void3 = /* @__PURE__ */ $$void(functorEffect);
  var when3 = /* @__PURE__ */ when(applicativeEffect);
  var log4 = /* @__PURE__ */ log2(monadEffectEffect);
  var show5 = /* @__PURE__ */ show(showInt);
  var show13 = /* @__PURE__ */ show(showNumber);
  var unsafeIndex3 = /* @__PURE__ */ unsafeIndex();
  var traverseWithIndex2 = /* @__PURE__ */ traverseWithIndex(traversableWithIndexArray)(applicativeEffect);
  var liftEffect2 = /* @__PURE__ */ liftEffect(monadEffectEffect);
  var union2 = /* @__PURE__ */ union(ordString);
  var insert3 = /* @__PURE__ */ insert(ordString);
  var join2 = /* @__PURE__ */ join(bindArray);
  var mod2 = /* @__PURE__ */ mod(euclideanRingInt);
  var for_4 = /* @__PURE__ */ for_(applicativeEffect)(foldableArray);
  var selectChildInheriting = function(dictMonadEffect) {
    var liftEffect1 = liftEffect(dictMonadEffect);
    return function(selector) {
      return function(v) {
        return liftEffect1((function() {
          var v1 = (function() {
            if (v instanceof BoundSelection) {
              return v.value0;
            }
            ;
            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 460, column 82 - line 461, column 28): " + [v.constructor.name]);
          })();
          return function __do2() {
            var results = traverse4(function(v2) {
              return function __do3() {
                var maybeChild = queryFirstChild(selector)(v2.value0)();
                if (maybeChild instanceof Nothing) {
                  return Nothing.value;
                }
                ;
                if (maybeChild instanceof Just) {
                  setElementData_(v2.value1)(maybeChild.value0)();
                  return new Just({
                    child: maybeChild.value0,
                    datum: v2.value1
                  });
                }
                ;
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 467, column 5 - line 472, column 37): " + [maybeChild.constructor.name]);
              };
            })(zipWith(Tuple.create)(v1.elements)(v1.data))();
            var paired = catMaybes(results);
            var childElements = map9(function(v2) {
              return v2.child;
            })(paired);
            var childData = map9(function(v2) {
              return v2.datum;
            })(paired);
            return mkBoundSelection(childElements)(childData)(Nothing.value)(v1.document);
          };
        })());
      };
    };
  };
  var remove = function(dictMonadEffect) {
    var liftEffect1 = liftEffect(dictMonadEffect);
    return function(v) {
      return liftEffect1((function() {
        var v1 = (function() {
          if (v instanceof ExitingSelection) {
            return v.value0;
          }
          ;
          throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 237, column 34 - line 238, column 30): " + [v.constructor.name]);
        })();
        return traverse_2(function(element) {
          var node = toNode(element);
          return function __do2() {
            var maybeParent = parentNode(node)();
            if (maybeParent instanceof Just) {
              return removeChild(node)(maybeParent.value0)();
            }
            ;
            if (maybeParent instanceof Nothing) {
              return unit;
            }
            ;
            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 242, column 5 - line 244, column 27): " + [maybeParent.constructor.name]);
          };
        })(v1.elements);
      })());
    };
  };
  var remove1 = /* @__PURE__ */ remove(monadEffectEffect);
  var merge = function(dictMonadEffect) {
    var pure1 = pure(dictMonadEffect.Monad0().Applicative0());
    return function(v) {
      return function(v1) {
        var v2 = (function() {
          if (v instanceof BoundSelection) {
            return v.value0;
          }
          ;
          throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 498, column 68 - line 499, column 28): " + [v.constructor.name]);
        })();
        var v3 = (function() {
          if (v1 instanceof BoundSelection) {
            return v1.value0;
          }
          ;
          throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 501, column 53 - line 502, column 28): " + [v1.constructor.name]);
        })();
        return pure1(mkBoundSelection(append12(v2.elements)(v3.elements))(append12(v2.data)(v3.data))(Nothing.value)(v2.document));
      };
    };
  };
  var joinDataWithKey = function(dictMonadEffect) {
    var liftEffect1 = liftEffect(dictMonadEffect);
    return function(dictFoldable) {
      var fromFoldable4 = fromFoldable(dictFoldable);
      return function(dictEq) {
        var computeJoinWithKey2 = computeJoinWithKey(dictEq);
        return function(foldableData) {
          return function(keyFn) {
            return function(selector) {
              return function(v) {
                return liftEffect1((function() {
                  var v1 = (function() {
                    if (v instanceof EmptySelection) {
                      return v.value0;
                    }
                    ;
                    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 613, column 55 - line 614, column 28): " + [v.constructor.name]);
                  })();
                  return function __do2() {
                    var existingElements = querySelectorAllElements(selector)(v1.parentElements)();
                    var oldBindings = traverse4(function(element) {
                      return function __do3() {
                        var nullableDatum = getElementData_(element)();
                        var maybeDatum = toMaybe(nullableDatum);
                        return {
                          element,
                          datum: maybeDatum
                        };
                      };
                    })(existingElements)();
                    var validOldBindings = mapMaybe(function(v2) {
                      return mapFlipped1(v2.datum)(function(d) {
                        return {
                          element: v2.element,
                          datum: d
                        };
                      });
                    })(oldBindings);
                    var newDataArray = fromFoldable4(foldableData);
                    var joinSets = computeJoinWithKey2(newDataArray)(validOldBindings)(keyFn);
                    var sortedEnter = sortBy(function(a) {
                      return function(b) {
                        return compare2(a.newIndex)(b.newIndex);
                      };
                    })(joinSets.enter);
                    var enterSelection = new PendingSelection({
                      parentElements: v1.parentElements,
                      pendingData: mapFlipped2(sortedEnter)(function(v2) {
                        return v2.datum;
                      }),
                      indices: new Just(mapFlipped2(sortedEnter)(function(v2) {
                        return v2.newIndex;
                      })),
                      document: v1.document
                    });
                    var sortedUpdate = sortBy(function(a) {
                      return function(b) {
                        return compare2(a.newIndex)(b.newIndex);
                      };
                    })(joinSets.update);
                    var updateSelection = mkBoundSelection(mapFlipped2(sortedUpdate)(function(v2) {
                      return v2.element;
                    }))(mapFlipped2(sortedUpdate)(function(v2) {
                      return v2.newDatum;
                    }))(new Just(mapFlipped2(sortedUpdate)(function(v2) {
                      return v2.newIndex;
                    })))(v1.document);
                    var exitSelection = mkExitingSelection(mapFlipped2(joinSets.exit)(function(v2) {
                      return v2.element;
                    }))(mapFlipped2(joinSets.exit)(function(v2) {
                      return v2.datum;
                    }))(v1.document);
                    return new JoinResult({
                      enter: enterSelection,
                      update: updateSelection,
                      exit: exitSelection
                    });
                  };
                })());
              };
            };
          };
        };
      };
    };
  };
  var joinDataWithKey1 = /* @__PURE__ */ joinDataWithKey(monadEffectEffect)(foldableArray)(eqString);
  var joinData = function(dictMonadEffect) {
    var liftEffect1 = liftEffect(dictMonadEffect);
    return function(dictFoldable) {
      var fromFoldable4 = fromFoldable(dictFoldable);
      return function(dictOrd) {
        var computeJoin2 = computeJoin(dictOrd.Eq0());
        return function(foldableData) {
          return function(selector) {
            return function(v) {
              return liftEffect1((function() {
                var v1 = (function() {
                  if (v instanceof EmptySelection) {
                    return v.value0;
                  }
                  ;
                  throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 528, column 55 - line 529, column 28): " + [v.constructor.name]);
                })();
                return function __do2() {
                  var existingElements = querySelectorAllElements(selector)(v1.parentElements)();
                  var oldBindings = traverse4(function(element) {
                    return function __do3() {
                      var nullableDatum = getElementData_(element)();
                      var maybeDatum = toMaybe(nullableDatum);
                      return {
                        element,
                        datum: maybeDatum
                      };
                    };
                  })(existingElements)();
                  var validOldBindings = mapMaybe(function(v2) {
                    return mapFlipped1(v2.datum)(function(d) {
                      return {
                        element: v2.element,
                        datum: d
                      };
                    });
                  })(oldBindings);
                  var newDataArray = fromFoldable4(foldableData);
                  var joinSets = computeJoin2(newDataArray)(validOldBindings);
                  var sortedEnter = sortBy(function(a) {
                    return function(b) {
                      return compare2(a.newIndex)(b.newIndex);
                    };
                  })(joinSets.enter);
                  var enterSelection = new PendingSelection({
                    parentElements: v1.parentElements,
                    pendingData: mapFlipped2(sortedEnter)(function(v2) {
                      return v2.datum;
                    }),
                    indices: new Just(mapFlipped2(sortedEnter)(function(v2) {
                      return v2.newIndex;
                    })),
                    document: v1.document
                  });
                  var sortedUpdate = sortBy(function(a) {
                    return function(b) {
                      return compare2(a.newIndex)(b.newIndex);
                    };
                  })(joinSets.update);
                  var updateSelection = mkBoundSelection(mapFlipped2(sortedUpdate)(function(v2) {
                    return v2.element;
                  }))(mapFlipped2(sortedUpdate)(function(v2) {
                    return v2.newDatum;
                  }))(new Just(mapFlipped2(sortedUpdate)(function(v2) {
                    return v2.newIndex;
                  })))(v1.document);
                  var exitSelection = mkExitingSelection(mapFlipped2(joinSets.exit)(function(v2) {
                    return v2.element;
                  }))(mapFlipped2(joinSets.exit)(function(v2) {
                    return v2.datum;
                  }))(v1.document);
                  return new JoinResult({
                    enter: enterSelection,
                    update: updateSelection,
                    exit: exitSelection
                  });
                };
              })());
            };
          };
        };
      };
    };
  };
  var joinData1 = /* @__PURE__ */ joinData(monadEffectEffect)(foldableArray);
  var hasAnimatedAttr = /* @__PURE__ */ (function() {
    var isAnimated = function(v) {
      if (v instanceof AnimatedAttr) {
        return true;
      }
      ;
      if (v instanceof AnimatedCompound) {
        return true;
      }
      ;
      return false;
    };
    return any2(isAnimated);
  })();
  var getExitingElementDatumPairs = function(v) {
    var v1 = (function() {
      if (v instanceof ExitingSelection) {
        return v.value0;
      }
      ;
      throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1524, column 52 - line 1525, column 30): " + [v.constructor.name]);
    })();
    return zipWith(Tuple.create)(v1.elements)(v1.data);
  };
  var getElementsFromBoundSelection = function(v) {
    if (v instanceof BoundSelection) {
      return v.value0.elements;
    }
    ;
    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1547, column 17 - line 1548, column 35): " + [v.constructor.name]);
  };
  var getBoundElementDatumPairs = function(v) {
    var v1 = (function() {
      if (v instanceof BoundSelection) {
        return v.value0;
      }
      ;
      throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1536, column 52 - line 1537, column 28): " + [v.constructor.name]);
    })();
    return zipWith(Tuple.create)(v1.elements)(v1.data);
  };
  var evalAnimatedValue2 = function(v) {
    return function(v1) {
      return function(v2) {
        if (v instanceof StaticAnimValue) {
          return v.value0;
        }
        ;
        if (v instanceof DataAnimValue) {
          return v.value0(v1);
        }
        ;
        if (v instanceof IndexedAnimValue) {
          return v.value0(v1)(v2);
        }
        ;
        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1185, column 1 - line 1185, column 81): " + [v.constructor.name, v1.constructor.name, v2.constructor.name]);
      };
    };
  };
  var ensureManagerRegistered = function(ctx) {
    return function __do2() {
      var alreadyRegistered = read(ctx.registeredRef)();
      return unless3(alreadyRegistered)(function __do3() {
        register(ctx.coordinator)({
          tick: toCoordinatorConsumer(ctx.manager),
          onComplete: pure4(unit)
        })();
        start2(ctx.coordinator)();
        return write(true)(ctx.registeredRef)();
      })();
    };
  };
  var currentTransitionContext = /* @__PURE__ */ (function() {
    return unsafePerformEffect($$new(Nothing.value));
  })();
  var getTransitionContext = /* @__PURE__ */ read(currentTransitionContext);
  var clear2 = function(dictMonadEffect) {
    var liftEffect1 = liftEffect(dictMonadEffect);
    return function(selector) {
      return liftEffect1(clearElement_(selector));
    };
  };
  var applyTransitionToSingleElementPure = function(manager) {
    return function(config) {
      return function(index3) {
        return function(element) {
          return function(datum) {
            return function(attrs) {
              return function(onAllComplete) {
                var baseDelay = maybe(0)(unwrap2)(config.delay);
                var stagger = fromMaybe(0)(config.staggerDelay);
                var effectiveDelay = baseDelay + toNumber(index3) * stagger;
                var easing = fromMaybe(Linear.value)(map1(transitionEasingToAnimEasing)(config.easing));
                return traverse_2(function(attr) {
                  if (attr instanceof StaticAttr) {
                    var $397 = isNumericAttributeValue(attr.value1);
                    if ($397) {
                      var targetValue = attributeValueToNumber(attr.value1);
                      var animConfig = {
                        duration: config.duration,
                        delay: effectiveDelay,
                        easing
                      };
                      return function __do2() {
                        registerAnimatedAttr(manager)(element)(datum)(index3)(attr.value0)(Nothing.value)(new StaticAnimValue(targetValue))(animConfig)(onAllComplete)();
                        return unit;
                      };
                    }
                    ;
                    var totalDelay = effectiveDelay + config.duration;
                    return setTimeout_(totalDelay)((function() {
                      var $398 = attr.value0 === "textContent";
                      if ($398) {
                        return setTextContent_(attributeValueToString(attr.value1))(element);
                      }
                      ;
                      return setAttribute(attr.value0)(attributeValueToString(attr.value1))(element);
                    })());
                  }
                  ;
                  if (attr instanceof DataAttr) {
                    var value12 = attr.value2(datum);
                    var $401 = isNumericAttributeValue(value12);
                    if ($401) {
                      var targetValue = attributeValueToNumber(value12);
                      var animConfig = {
                        duration: config.duration,
                        delay: effectiveDelay,
                        easing
                      };
                      return function __do2() {
                        registerAnimatedAttr(manager)(element)(datum)(index3)(attr.value0)(Nothing.value)(new StaticAnimValue(targetValue))(animConfig)(onAllComplete)();
                        return unit;
                      };
                    }
                    ;
                    var totalDelay = effectiveDelay + config.duration;
                    return setTimeout_(totalDelay)((function() {
                      var $402 = attr.value0 === "textContent";
                      if ($402) {
                        return setTextContent_(attributeValueToString(value12))(element);
                      }
                      ;
                      return setAttribute(attr.value0)(attributeValueToString(value12))(element);
                    })());
                  }
                  ;
                  if (attr instanceof IndexedAttr) {
                    var value12 = attr.value2(datum)(index3);
                    var $406 = isNumericAttributeValue(value12);
                    if ($406) {
                      var targetValue = attributeValueToNumber(value12);
                      var animConfig = {
                        duration: config.duration,
                        delay: effectiveDelay,
                        easing
                      };
                      return function __do2() {
                        registerAnimatedAttr(manager)(element)(datum)(index3)(attr.value0)(Nothing.value)(new StaticAnimValue(targetValue))(animConfig)(onAllComplete)();
                        return unit;
                      };
                    }
                    ;
                    var totalDelay = effectiveDelay + config.duration;
                    return setTimeout_(totalDelay)((function() {
                      var $407 = attr.value0 === "textContent";
                      if ($407) {
                        return setTextContent_(attributeValueToString(value12))(element);
                      }
                      ;
                      return setAttribute(attr.value0)(attributeValueToString(value12))(element);
                    })());
                  }
                  ;
                  if (attr instanceof AnimatedAttr) {
                    var animConfig = {
                      duration: attr.value0.config.duration,
                      easing: attr.value0.config.easing,
                      delay: attr.value0.config.delay + effectiveDelay
                    };
                    return function __do2() {
                      registerAnimatedAttr(manager)(element)(datum)(index3)(attr.value0.name)(attr.value0.fromValue)(attr.value0.toValue)(animConfig)(onAllComplete)();
                      return unit;
                    };
                  }
                  ;
                  if (attr instanceof AnimatedCompound) {
                    var animConfig = {
                      duration: attr.value0.config.duration,
                      easing: attr.value0.config.easing,
                      delay: attr.value0.config.delay + effectiveDelay
                    };
                    return function __do2() {
                      registerAnimatedCompound(manager)(element)(datum)(index3)(attr.value0.name)(attr.value0.fromValues)(attr.value0.toValues)(attr.value0.generator)(animConfig)(onAllComplete)();
                      return unit;
                    };
                  }
                  ;
                  throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1093, column 30 - line 1170, column 16): " + [attr.constructor.name]);
                })(attrs);
              };
            };
          };
        };
      };
    };
  };
  var applyTransitionToSingleElement = function(config) {
    return function(index3) {
      return function(element) {
        return function(datum) {
          return function(attrs) {
            var baseDelay = maybe(0)(unwrap2)(config.delay);
            var stagger = fromMaybe(0)(config.staggerDelay);
            var effectiveDelay = baseDelay + toNumber(index3) * stagger;
            var delayNullable = toNullable(new Just(effectiveDelay));
            var easingNullable = maybeEasingToNullable(config.easing);
            return function __do2() {
              var transition = createTransition_(config.duration)(delayNullable)(easingNullable)(element)();
              return traverse_2(function(attr) {
                if (attr instanceof StaticAttr) {
                  return transitionSetAttribute_(attr.value0)(attributeValueToString(attr.value1))(transition);
                }
                ;
                if (attr instanceof DataAttr) {
                  return transitionSetAttribute_(attr.value0)(attributeValueToString(attr.value2(datum)))(transition);
                }
                ;
                if (attr instanceof IndexedAttr) {
                  return transitionSetAttribute_(attr.value0)(attributeValueToString(attr.value2(datum)(index3)))(transition);
                }
                ;
                if (attr instanceof AnimatedAttr) {
                  return unsafeCrashWith("AnimatedAttr in D3 transition path - use applyTransitionToSingleElementPure instead");
                }
                ;
                if (attr instanceof AnimatedCompound) {
                  return unsafeCrashWith("AnimatedCompound in D3 transition path - use applyTransitionToSingleElementPure instead");
                }
                ;
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1045, column 30 - line 1061, column 112): " + [attr.constructor.name]);
              })(attrs)();
            };
          };
        };
      };
    };
  };
  var applyTransitionAuto = function(config) {
    return function(index3) {
      return function(element) {
        return function(datum) {
          return function(attrs) {
            return function __do2() {
              var maybeCtx = getTransitionContext();
              if (maybeCtx instanceof Just) {
                applyTransitionToSingleElementPure(maybeCtx.value0.manager)(config)(index3)(element)(datum)(attrs)(pure4(unit))();
                return ensureManagerRegistered(maybeCtx.value0)();
              }
              ;
              if (maybeCtx instanceof Nothing && hasAnimatedAttr(attrs)) {
                return unsafeCrashWith("AnimatedAttr used without TransitionContext. Use renderTreeWithAnimations instead of renderTree.")();
              }
              ;
              if (maybeCtx instanceof Nothing) {
                return applyTransitionToSingleElement(config)(index3)(element)(datum)(attrs)();
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1319, column 3 - line 1332, column 70): " + [maybeCtx.constructor.name]);
            };
          };
        };
      };
    };
  };
  var applyExitTransitionToElements = function(config) {
    return function(elementDatumPairs) {
      return function(attrs) {
        var baseDelay = maybe(0)(unwrap2)(config.delay);
        var stagger = fromMaybe(0)(config.staggerDelay);
        var easingNullable = maybeEasingToNullable(config.easing);
        return traverseWithIndex_2(function(index3) {
          return function(v) {
            var effectiveDelay = baseDelay + toNumber(index3) * stagger;
            var delayNullable = toNullable(new Just(effectiveDelay));
            return function __do2() {
              var transition = createTransition_(config.duration)(delayNullable)(easingNullable)(v.value0)();
              traverse_2(function(attr) {
                if (attr instanceof StaticAttr) {
                  return transitionSetAttribute_(attr.value0)(attributeValueToString(attr.value1))(transition);
                }
                ;
                if (attr instanceof DataAttr) {
                  return transitionSetAttribute_(attr.value0)(attributeValueToString(attr.value2(v.value1)))(transition);
                }
                ;
                if (attr instanceof IndexedAttr) {
                  return transitionSetAttribute_(attr.value0)(attributeValueToString(attr.value2(v.value1)(index3)))(transition);
                }
                ;
                if (attr instanceof AnimatedAttr) {
                  return unsafeCrashWith("AnimatedAttr in D3 exit transition path - use pure transition path instead");
                }
                ;
                if (attr instanceof AnimatedCompound) {
                  return unsafeCrashWith("AnimatedCompound in D3 exit transition path - use pure transition path instead");
                }
                ;
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1496, column 32 - line 1512, column 105): " + [attr.constructor.name]);
              })(attrs)();
              return transitionRemove_(transition)();
            };
          };
        })(elementDatumPairs);
      };
    };
  };
  var applyExitTransitionPure = function(manager) {
    return function(config) {
      return function(elementDatumPairs) {
        return function(attrs) {
          var baseDelay = maybe(0)(unwrap2)(config.delay);
          var stagger = fromMaybe(0)(config.staggerDelay);
          var easing = fromMaybe(Linear.value)(map1(transitionEasingToAnimEasing)(config.easing));
          return traverseWithIndex_2(function(index3) {
            return function(v) {
              var effectiveDelay = baseDelay + toNumber(index3) * stagger;
              var attrCount = length3(attrs);
              return function __do2() {
                var completedRef = $$new(0)();
                var removeElement = function __do3() {
                  var maybeParent = parentNode(toNode(v.value0))();
                  if (maybeParent instanceof Just) {
                    return $$void3(removeChild(toNode(v.value0))(maybeParent.value0))();
                  }
                  ;
                  if (maybeParent instanceof Nothing) {
                    return unit;
                  }
                  ;
                  throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1389, column 11 - line 1391, column 33): " + [maybeParent.constructor.name]);
                };
                var onAttrComplete = function __do3() {
                  var completed = modify(function(v1) {
                    return v1 + 1 | 0;
                  })(completedRef)();
                  return when3(completed >= attrCount)(removeElement)();
                };
                when3(attrCount === 0)(removeElement)();
                return traverse_2(function(attr) {
                  if (attr instanceof StaticAttr) {
                    var $464 = isNumericAttributeValue(attr.value1);
                    if ($464) {
                      var targetValue = attributeValueToNumber(attr.value1);
                      var animConfig = {
                        duration: config.duration,
                        delay: effectiveDelay,
                        easing
                      };
                      return function __do3() {
                        registerAnimatedAttr(manager)(v.value0)(v.value1)(index3)(attr.value0)(Nothing.value)(new StaticAnimValue(targetValue))(animConfig)(onAttrComplete)();
                        return unit;
                      };
                    }
                    ;
                    return function __do3() {
                      (function() {
                        var $465 = attr.value0 === "textContent";
                        if ($465) {
                          return setTextContent_(attributeValueToString(attr.value1))(v.value0)();
                        }
                        ;
                        return setAttribute(attr.value0)(attributeValueToString(attr.value1))(v.value0)();
                      })();
                      return onAttrComplete();
                    };
                  }
                  ;
                  if (attr instanceof DataAttr) {
                    var value12 = attr.value2(v.value1);
                    var $468 = isNumericAttributeValue(value12);
                    if ($468) {
                      var targetValue = attributeValueToNumber(value12);
                      var animConfig = {
                        duration: config.duration,
                        delay: effectiveDelay,
                        easing
                      };
                      return function __do3() {
                        registerAnimatedAttr(manager)(v.value0)(v.value1)(index3)(attr.value0)(Nothing.value)(new StaticAnimValue(targetValue))(animConfig)(onAttrComplete)();
                        return unit;
                      };
                    }
                    ;
                    return function __do3() {
                      (function() {
                        var $469 = attr.value0 === "textContent";
                        if ($469) {
                          return setTextContent_(attributeValueToString(value12))(v.value0)();
                        }
                        ;
                        return setAttribute(attr.value0)(attributeValueToString(value12))(v.value0)();
                      })();
                      return onAttrComplete();
                    };
                  }
                  ;
                  if (attr instanceof IndexedAttr) {
                    var value12 = attr.value2(v.value1)(index3);
                    var $473 = isNumericAttributeValue(value12);
                    if ($473) {
                      var targetValue = attributeValueToNumber(value12);
                      var animConfig = {
                        duration: config.duration,
                        delay: effectiveDelay,
                        easing
                      };
                      return function __do3() {
                        registerAnimatedAttr(manager)(v.value0)(v.value1)(index3)(attr.value0)(Nothing.value)(new StaticAnimValue(targetValue))(animConfig)(onAttrComplete)();
                        return unit;
                      };
                    }
                    ;
                    return function __do3() {
                      (function() {
                        var $474 = attr.value0 === "textContent";
                        if ($474) {
                          return setTextContent_(attributeValueToString(value12))(v.value0)();
                        }
                        ;
                        return setAttribute(attr.value0)(attributeValueToString(value12))(v.value0)();
                      })();
                      return onAttrComplete();
                    };
                  }
                  ;
                  if (attr instanceof AnimatedAttr) {
                    var animConfig = {
                      duration: attr.value0.config.duration,
                      easing: attr.value0.config.easing,
                      delay: attr.value0.config.delay + effectiveDelay
                    };
                    return function __do3() {
                      registerAnimatedAttr(manager)(v.value0)(v.value1)(index3)(attr.value0.name)(attr.value0.fromValue)(attr.value0.toValue)(animConfig)(onAttrComplete)();
                      return unit;
                    };
                  }
                  ;
                  if (attr instanceof AnimatedCompound) {
                    var animConfig = {
                      duration: attr.value0.config.duration,
                      easing: attr.value0.config.easing,
                      delay: attr.value0.config.delay + effectiveDelay
                    };
                    return function __do3() {
                      registerAnimatedCompound(manager)(v.value0)(v.value1)(index3)(attr.value0.name)(attr.value0.fromValues)(attr.value0.toValues)(attr.value0.generator)(animConfig)(onAttrComplete)();
                      return unit;
                    };
                  }
                  ;
                  throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1402, column 32 - line 1468, column 18): " + [attr.constructor.name]);
                })(attrs)();
              };
            };
          })(elementDatumPairs);
        };
      };
    };
  };
  var applyExitTransitionAuto = function(config) {
    return function(elementDatumPairs) {
      return function(attrs) {
        return function __do2() {
          var maybeCtx = getTransitionContext();
          if (maybeCtx instanceof Just) {
            applyExitTransitionPure(maybeCtx.value0.manager)(config)(elementDatumPairs)(attrs)();
            return ensureManagerRegistered(maybeCtx.value0)();
          }
          ;
          if (maybeCtx instanceof Nothing && hasAnimatedAttr(attrs)) {
            return unsafeCrashWith("AnimatedAttr in exit transition requires TransitionContext. Use renderTreeWithAnimations instead of renderTree.")();
          }
          ;
          if (maybeCtx instanceof Nothing) {
            return applyExitTransitionToElements(config)(elementDatumPairs)(attrs)();
          }
          ;
          throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1347, column 3 - line 1359, column 67): " + [maybeCtx.constructor.name]);
        };
      };
    };
  };
  var applyBehaviorToElement = function(v) {
    return function(v1) {
      if (v instanceof Zoom) {
        return $$void3(attachZoomNative(v1)(v.value0.scaleExtent.value0)(v.value0.scaleExtent.value1)(v.value0.targetSelector));
      }
      ;
      if (v instanceof Drag && v.value0 instanceof SimpleDrag) {
        return $$void3(attachSimpleDrag(v1)(unit));
      }
      ;
      if (v instanceof Drag && v.value0 instanceof SimulationDrag) {
        return $$void3(attachSimulationDragById(v1)(v.value0.value0));
      }
      ;
      if (v instanceof Drag && v.value0 instanceof SimulationDragNested) {
        return $$void3(attachSimulationDragNestedById(v1)(v.value0.value0));
      }
      ;
      if (v instanceof Click) {
        return $$void3(attachClick_(v1)(v.value0));
      }
      ;
      if (v instanceof ClickWithDatum) {
        return $$void3(attachClickWithDatum_(v1)(v.value0));
      }
      ;
      if (v instanceof MouseEnter) {
        return $$void3(attachMouseEnter_(v1)(v.value0));
      }
      ;
      if (v instanceof MouseLeave) {
        return $$void3(attachMouseLeave_(v1)(v.value0));
      }
      ;
      if (v instanceof Highlight) {
        return $$void3(attachHighlight_(v1)(v.value0.enter)(v.value0.leave));
      }
      ;
      if (v instanceof MouseMoveWithInfo) {
        return $$void3(attachMouseMoveWithEvent_(v1)(function(d, evt) {
          return v.value0({
            datum: d,
            clientX: toNumber(clientX(evt)),
            clientY: toNumber(clientY(evt)),
            pageX: toNumber(pageX(evt)),
            pageY: toNumber(pageY(evt)),
            offsetX: offsetX(evt),
            offsetY: offsetY(evt)
          })();
        }));
      }
      ;
      if (v instanceof MouseEnterWithInfo) {
        return $$void3(attachMouseEnterWithEvent_(v1)(function(d, evt) {
          return v.value0({
            datum: d,
            clientX: toNumber(clientX(evt)),
            clientY: toNumber(clientY(evt)),
            pageX: toNumber(pageX(evt)),
            pageY: toNumber(pageY(evt)),
            offsetX: offsetX(evt),
            offsetY: offsetY(evt)
          })();
        }));
      }
      ;
      if (v instanceof MouseLeaveWithInfo) {
        return $$void3(attachMouseLeaveWithEvent_(v1)(function(d, evt) {
          return v.value0({
            datum: d,
            clientX: toNumber(clientX(evt)),
            clientY: toNumber(clientY(evt)),
            pageX: toNumber(pageX(evt)),
            pageY: toNumber(pageY(evt)),
            offsetX: offsetX(evt),
            offsetY: offsetY(evt)
          })();
        }));
      }
      ;
      if (v instanceof MouseDown) {
        return $$void3(attachMouseDown_(v1)(v.value0));
      }
      ;
      if (v instanceof MouseDownWithInfo) {
        return $$void3(attachMouseDownWithEvent_(v1)(function(d, evt) {
          return v.value0({
            datum: d,
            clientX: toNumber(clientX(evt)),
            clientY: toNumber(clientY(evt)),
            pageX: toNumber(pageX(evt)),
            pageY: toNumber(pageY(evt)),
            offsetX: offsetX(evt),
            offsetY: offsetY(evt)
          })();
        }));
      }
      ;
      if (v instanceof CoordinatedHighlight) {
        var tooltipTrigger = (function() {
          if (v.value0.tooltip instanceof Just) {
            return tooltipTriggerToInt(v.value0.tooltip.value0.showWhen);
          }
          ;
          if (v.value0.tooltip instanceof Nothing) {
            return 0;
          }
          ;
          throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 879, column 22 - line 881, column 19): " + [v.value0.tooltip.constructor.name]);
        })();
        var tooltipContentFn = mapFlipped1(v.value0.tooltip)(function(v2) {
          return v2.content;
        });
        var classifyAsInt = function(hoveredId) {
          return function(datum) {
            return highlightClassToInt(v.value0.classify(hoveredId)(datum));
          };
        };
        return $$void3(attachCoordinatedHighlight_(v1)(v.value0.identify)(classifyAsInt)(toNullable(v.value0.group))(toNullable(tooltipContentFn))(tooltipTrigger));
      }
      ;
      throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 802, column 1 - line 802, column 81): " + [v.constructor.name, v1.constructor.name]);
    };
  };
  var on2 = function(behavior) {
    return function(v) {
      var getElements = function(v1) {
        if (v1 instanceof EmptySelection) {
          return v1.value0.parentElements;
        }
        ;
        if (v1 instanceof BoundSelection) {
          return v1.value0.elements;
        }
        ;
        if (v1 instanceof PendingSelection) {
          return v1.value0.parentElements;
        }
        ;
        if (v1 instanceof ExitingSelection) {
          return v1.value0.elements;
        }
        ;
        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 915, column 3 - line 915, column 59): " + [v1.constructor.name]);
      };
      var elements = getElements(v);
      return function __do2() {
        traverse_2(applyBehaviorToElement(behavior))(elements)();
        return v;
      };
    };
  };
  var applyAttributes = function(element) {
    return function(datum) {
      return function(index3) {
        return function(attrs) {
          return function __do2() {
            when3(index3 === 0)(log4("[applyAttributes] Element 0, applying " + (show5(length3(attrs)) + " attrs")))();
            return traverse_2(function(attr) {
              if (attr instanceof StaticAttr) {
                var $525 = attr.value0 === "textContent";
                if ($525) {
                  return setTextContent_(attributeValueToString(attr.value1))(element);
                }
                ;
                return setAttribute(attr.value0)(attributeValueToString(attr.value1))(element);
              }
              ;
              if (attr instanceof DataAttr) {
                var val = attributeValueToString(attr.value2(datum));
                return function __do3() {
                  when3(index3 === 0 && attr.value0 === "transform")(log4("[applyAttributes] Setting transform to: " + val))();
                  var $528 = attr.value0 === "textContent";
                  if ($528) {
                    return setTextContent_(val)(element)();
                  }
                  ;
                  return setAttribute(attr.value0)(val)(element)();
                };
              }
              ;
              if (attr instanceof IndexedAttr) {
                var val = attributeValueToString(attr.value2(datum)(index3));
                var $532 = attr.value0 === "textContent";
                if ($532) {
                  return setTextContent_(val)(element);
                }
                ;
                return setAttribute(attr.value0)(val)(element);
              }
              ;
              if (attr instanceof AnimatedAttr) {
                var val = show13(evalAnimatedValue2(attr.value0.toValue)(datum)(index3));
                var $537 = attr.value0.name === "textContent";
                if ($537) {
                  return setTextContent_(val)(element);
                }
                ;
                return setAttribute(attr.value0.name)(val)(element);
              }
              ;
              if (attr instanceof AnimatedCompound) {
                var vals = map9(function(av) {
                  return evalAnimatedValue2(av)(datum)(index3);
                })(attr.value0.toValues);
                var val = attr.value0.generator(vals);
                var $540 = attr.value0.name === "textContent";
                if ($540) {
                  return setTextContent_(val)(element);
                }
                ;
                return setAttribute(attr.value0.name)(val)(element);
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 929, column 30 - line 967, column 51): " + [attr.constructor.name]);
            })(attrs)();
          };
        };
      };
    };
  };
  var applyPerDatumAttrs = function(dictMonadEffect) {
    var liftEffect1 = liftEffect(dictMonadEffect);
    return function(mkAttrs) {
      return function(v) {
        return liftEffect1((function() {
          if (v instanceof BoundSelection) {
            var paired = zipWith(Tuple.create)(v.value0.data)(v.value0.elements);
            return function __do2() {
              traverseWithIndex_2(function(index3) {
                return function(v1) {
                  var attrs = mkAttrs(v1.value0);
                  return applyAttributes(v1.value1)(v1.value0)(index3)(attrs);
                };
              })(paired)();
              return v;
            };
          }
          ;
          return pure4(v);
        })());
      };
    };
  };
  var setAttrs = function(dictMonadEffect) {
    var liftEffect1 = liftEffect(dictMonadEffect);
    return function(attrs) {
      return function(v) {
        return liftEffect1((function() {
          var v1 = (function() {
            if (v instanceof BoundSelection) {
              return v.value0;
            }
            ;
            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 182, column 76 - line 183, column 28): " + [v.constructor.name]);
          })();
          var paired = zipWith(Tuple.create)(v1.data)(v1.elements);
          return function __do2() {
            traverseWithIndex_2(function(arrayIndex) {
              return function(v2) {
                var logicalIndex = (function() {
                  if (v1.indices instanceof Just) {
                    return unsafeIndex3(v1.indices.value0)(arrayIndex);
                  }
                  ;
                  if (v1.indices instanceof Nothing) {
                    return arrayIndex;
                  }
                  ;
                  throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 188, column 22 - line 190, column 30): " + [v1.indices.constructor.name]);
                })();
                return applyAttributes(v2.value1)(v2.value0)(logicalIndex)(attrs);
              };
            })(paired)();
            return mkBoundSelection(v1.elements)(v1.data)(v1.indices)(v1.document);
          };
        })());
      };
    };
  };
  var setAttrs1 = /* @__PURE__ */ setAttrs(monadEffectEffect);
  var setAttrsExit = function(dictMonadEffect) {
    var liftEffect1 = liftEffect(dictMonadEffect);
    return function(attrs) {
      return function(v) {
        return liftEffect1((function() {
          var v1 = (function() {
            if (v instanceof ExitingSelection) {
              return v.value0;
            }
            ;
            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 212, column 67 - line 213, column 30): " + [v.constructor.name]);
          })();
          var paired = zipWith(Tuple.create)(v1.data)(v1.elements);
          return function __do2() {
            traverseWithIndex_2(function(index3) {
              return function(v2) {
                return applyAttributes(v2.value1)(v2.value0)(index3)(attrs);
              };
            })(paired)();
            return mkExitingSelection(v1.elements)(v1.data)(v1.document);
          };
        })());
      };
    };
  };
  var setAttrsExit1 = /* @__PURE__ */ setAttrsExit(monadEffectEffect);
  var updateElementFromTree = function(element) {
    return function(datum) {
      return function(index3) {
        return function(tree) {
          return function(doc) {
            return function __do2() {
              setElementData_(datum)(element)();
              if (tree instanceof Node2) {
                when3(index3 === 0)(log4("[updateElementFromTree] Updating element 0, attrs count: " + show5(length3(tree.value0.attrs))))();
                return applyAttributes(element)(datum)(index3)(tree.value0.attrs)();
              }
              ;
              when3(index3 === 0)(log4("[updateElementFromTree] Tree is NOT a Node - skipping attr update"))();
              return unit;
            };
          };
        };
      };
    };
  };
  var renderTemplatesForBoundSelection = function(dictOrd) {
    return function(templateFn) {
      return function(boundSel) {
        var v = (function() {
          if (boundSel instanceof BoundSelection) {
            return boundSel.value0;
          }
          ;
          throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2415, column 66 - line 2416, column 32): " + [boundSel.constructor.name]);
        })();
        return traverseWithIndex2(function(idx) {
          return function(datum) {
            var v1 = index(v.elements)(idx);
            if (v1 instanceof Nothing) {
              return unsafeCrashWith("renderTemplatesForBoundSelection: index out of bounds");
            }
            ;
            if (v1 instanceof Just) {
              var tree = templateFn(datum);
              return function __do2() {
                updateElementFromTree(v1.value0)(datum)(idx)(tree)(v.document)();
                return v1.value0;
              };
            }
            ;
            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2421, column 9 - line 2430, column 25): " + [v1.constructor.name]);
          };
        })(v.data);
      };
    };
  };
  var renderTemplatesForBoundSelectionKeyed = function(templateFn) {
    return function(boundSel) {
      var v = (function() {
        if (boundSel instanceof BoundSelection) {
          return boundSel.value0;
        }
        ;
        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2447, column 66 - line 2448, column 32): " + [boundSel.constructor.name]);
      })();
      return function __do2() {
        when3(length3(v.data) > 0)(log4("[renderTemplatesForBoundSelectionKeyed] Updating " + (show5(length3(v.data)) + " elements")))();
        return traverseWithIndex2(function(idx) {
          return function(datum) {
            var v1 = index(v.elements)(idx);
            if (v1 instanceof Nothing) {
              return unsafeCrashWith("renderTemplatesForBoundSelectionKeyed: index out of bounds");
            }
            ;
            if (v1 instanceof Just) {
              var tree = templateFn(datum);
              return function __do3() {
                updateElementFromTree(v1.value0)(datum)(idx)(tree)(v.document)();
                return v1.value0;
              };
            }
            ;
            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2457, column 9 - line 2466, column 25): " + [v1.constructor.name]);
          };
        })(v.data)();
      };
    };
  };
  var appendChildWithDatum = function(dictMonadEffect) {
    var liftEffect1 = liftEffect(dictMonadEffect);
    return function(elemType) {
      return function(attrs) {
        return function(datumOpt) {
          return function(logicalIndex) {
            return function(v) {
              return liftEffect1((function() {
                var v1 = (function() {
                  if (v instanceof EmptySelection) {
                    return v.value0;
                  }
                  ;
                  throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 347, column 55 - line 348, column 28): " + [v.constructor.name]);
                })();
                return function __do2() {
                  var elements = traverse4(function(parent2) {
                    return function __do3() {
                      var element = createElementWithNS(elemType)(v1.document)();
                      var datum = (function() {
                        if (datumOpt instanceof Just) {
                          return datumOpt.value0;
                        }
                        ;
                        if (datumOpt instanceof Nothing) {
                          return unit;
                        }
                        ;
                        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 355, column 15 - line 357, column 49): " + [datumOpt.constructor.name]);
                      })();
                      applyAttributes(element)(datum)(logicalIndex)(attrs)();
                      var elementNode = toNode(element);
                      var parentNode2 = toNode(parent2);
                      appendChild(elementNode)(parentNode2)();
                      return element;
                    };
                  })(v1.parentElements)();
                  return new EmptySelection({
                    parentElements: elements,
                    document: v1.document
                  });
                };
              })());
            };
          };
        };
      };
    };
  };
  var appendChildWithDatum1 = /* @__PURE__ */ appendChildWithDatum(monadEffectEffect);
  var renderTemplatesForPendingSelectionKeyed = function(templateFn) {
    return function(pendingSel) {
      if (pendingSel instanceof PendingSelection) {
        return traverseWithIndex2(function(idx) {
          return function(datum) {
            var tree = templateFn(datum);
            var singleParentSel = new EmptySelection({
              parentElements: pendingSel.value0.parentElements,
              document: pendingSel.value0.document
            });
            return function __do2() {
              var v = renderNodeHelperWithDatumKeyed(singleParentSel)(tree)(new Just(datum))(idx)();
              liftEffect2(setElementData_(datum)(v.value0))();
              return new Tuple(v.value0, v.value1);
            };
          };
        })(pendingSel.value0.pendingData);
      }
      ;
      return pure4([]);
    };
  };
  var renderNodeHelperWithDatumKeyed = function(v) {
    return function(v1) {
      return function(v2) {
        return function(v3) {
          if (v1 instanceof Node2) {
            return function __do2() {
              var childSel = appendChildWithDatum1(v1.value0.elemType)(v1.value0.attrs)(v2)(v3)(v)();
              var element = (function() {
                if (childSel instanceof EmptySelection) {
                  var v42 = head2(childSel.value0.parentElements);
                  if (v42 instanceof Just) {
                    return v42.value0;
                  }
                  ;
                  if (v42 instanceof Nothing) {
                    return unsafeCrashWith("renderNodeHelperWithDatumKeyed: appendChild returned empty selection");
                  }
                  ;
                  throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2997, column 33 - line 2999, column 110): " + [v42.constructor.name]);
                }
                ;
                return unsafeCrashWith("renderNodeHelperWithDatumKeyed: appendChild should return EmptySelection");
              })();
              traverse_2(function(behavior) {
                return applyBehaviorToElement(behavior)(element);
              })(v1.value0.behaviors)();
              var childMaps = traverse4(function(child) {
                return renderNodeHelperWithDatumKeyed(childSel)(child)(v2)(v3);
              })(v1.value0.children)();
              var combinedChildMap = foldl2(union2)(empty4)(map9(snd)(childMaps));
              var selectionsMap = (function() {
                if (v1.value0.name instanceof Just) {
                  return insert3(v1.value0.name.value0)(childSel)(combinedChildMap);
                }
                ;
                if (v1.value0.name instanceof Nothing) {
                  return combinedChildMap;
                }
                ;
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 3010, column 23 - line 3012, column 36): " + [v1.value0.name.constructor.name]);
              })();
              return new Tuple(element, selectionsMap);
            };
          }
          ;
          if (v1 instanceof Join) {
            return renderNodeHelperKeyed(v)(v1);
          }
          ;
          if (v1 instanceof NestedJoin) {
            return renderNodeHelperKeyed(v)(v1);
          }
          ;
          if (v1 instanceof UpdateJoin) {
            return renderNodeHelperKeyed(v)(v1);
          }
          ;
          if (v1 instanceof UpdateNestedJoin) {
            return renderNodeHelperKeyed(v)(v1);
          }
          ;
          if (v1 instanceof LocalCoordSpace) {
            return renderNodeHelperKeyed(v)(v1);
          }
          ;
          if (v1 instanceof HierarchicalJoin) {
            return renderNodeHelperKeyed(v)(v1);
          }
          ;
          if (v1 instanceof RecursiveJoin) {
            return renderNodeHelperKeyed(v)(v1);
          }
          ;
          if (v1 instanceof ConditionalRender && v2 instanceof Just) {
            var v4 = find2(function(c) {
              return c.predicate(v2.value0);
            })(v1.value0.cases);
            if (v4 instanceof Just) {
              var chosenTree = v4.value0.spec(v2.value0);
              return renderNodeHelperWithDatumKeyed(v)(chosenTree)(new Just(v2.value0))(v3);
            }
            ;
            if (v4 instanceof Nothing) {
              var dummyElement = (function() {
                if (v instanceof EmptySelection) {
                  var v5 = head2(v.value0.parentElements);
                  if (v5 instanceof Just) {
                    return v5.value0;
                  }
                  ;
                  if (v5 instanceof Nothing) {
                    return unsafeCrashWith("renderNodeHelperWithDatumKeyed ConditionalRender: no parent elements");
                  }
                  ;
                  throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 3034, column 35 - line 3036, column 112): " + [v5.constructor.name]);
                }
                ;
                return unsafeCrashWith("renderNodeHelperWithDatumKeyed ConditionalRender: unexpected selection type");
              })();
              return pure4(new Tuple(dummyElement, empty4));
            }
            ;
            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 3027, column 3 - line 3038, column 42): " + [v4.constructor.name]);
          }
          ;
          if (v1 instanceof ConditionalRender && v2 instanceof Nothing) {
            return renderNodeHelperKeyed(v)(new ConditionalRender({
              cases: []
            }));
          }
          ;
          throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2983, column 1 - line 2989, column 74): " + [v.constructor.name, v1.constructor.name, v2.constructor.name, v3.constructor.name]);
        };
      };
    };
  };
  var renderNodeHelperKeyed = function($copy_v) {
    return function($copy_v1) {
      var $tco_var_v = $copy_v;
      var $tco_done = false;
      var $tco_result;
      function $tco_loop(v, v1) {
        if (v1 instanceof Node2) {
          $tco_done = true;
          return renderNodeHelperWithDatumKeyed(v)(new Node2(v1.value0))(Nothing.value)(0);
        }
        ;
        if (v1 instanceof Join) {
          $tco_done = true;
          return unsafeCrashWith("renderTreeKeyed: Join '" + (v1.value0.name + "' requires Ord-based identity matching. Use renderTreeOrd instead, or convert to UpdateJoin with a keyFn."));
        }
        ;
        if (v1 instanceof NestedJoin) {
          $tco_done = true;
          return unsafeCrashWith("renderTreeKeyed: NestedJoin '" + (v1.value0.name + "' requires Ord-based identity matching. Use renderTreeOrd instead, or convert to UpdateNestedJoin."));
        }
        ;
        if (v1 instanceof UpdateJoin) {
          if (v1.value0.keyFn instanceof Nothing) {
            $tco_done = true;
            return unsafeCrashWith("renderTreeKeyed: UpdateJoin '" + (v1.value0.name + "' has keyFn: Nothing. Provide a keyFn or use renderTreeOrd for Eq-based matching."));
          }
          ;
          if (v1.value0.keyFn instanceof Just) {
            $tco_done = true;
            return function __do2() {
              var v2 = joinDataWithKey1(v1.value0.joinData)(v1.value0.keyFn.value0)(v1.value0.key)(v)();
              liftEffect2((function() {
                var enterCount = (function() {
                  if (v2.value0.enter instanceof PendingSelection) {
                    return length3(v2.value0.enter.value0.pendingData);
                  }
                  ;
                  return 0;
                })();
                var updateCount = (function() {
                  if (v2.value0.update instanceof BoundSelection) {
                    return length3(v2.value0.update.value0.data);
                  }
                  ;
                  return 0;
                })();
                var exitCount = (function() {
                  if (v2.value0.exit instanceof BoundSelection) {
                    return length3(v2.value0.exit.value0.data);
                  }
                  ;
                  if (v2.value0.exit instanceof ExitingSelection) {
                    return length3(v2.value0.exit.value0.data);
                  }
                  ;
                  return 0;
                })();
                return log4("Tree API UpdateJoin (keyed) '" + (v1.value0.name + ("': enter=" + (show5(enterCount) + (", update=" + (show5(updateCount) + (", exit=" + show5(exitCount))))))));
              })())();
              (function() {
                if (v1.value0.behaviors.exit instanceof Just) {
                  if (v1.value0.behaviors.exit.value0.transition instanceof Just) {
                    var pairs = getExitingElementDatumPairs(v2.value0.exit);
                    return liftEffect2(applyExitTransitionAuto(v1.value0.behaviors.exit.value0.transition.value0)(pairs)(v1.value0.behaviors.exit.value0.attrs))();
                  }
                  ;
                  if (v1.value0.behaviors.exit.value0.transition instanceof Nothing) {
                    setAttrsExit1(v1.value0.behaviors.exit.value0.attrs)(v2.value0.exit)();
                    remove1(v2.value0.exit)();
                    return unit;
                  }
                  ;
                  throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2751, column 11 - line 2758, column 24): " + [v1.value0.behaviors.exit.value0.transition.constructor.name]);
                }
                ;
                if (v1.value0.behaviors.exit instanceof Nothing) {
                  remove1(v2.value0.exit)();
                  return unit;
                }
                ;
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2749, column 7 - line 2761, column 20): " + [v1.value0.behaviors.exit.constructor.name]);
              })();
              var enterElementsAndMaps = (function() {
                if (v1.value0.behaviors.enter instanceof Just) {
                  var modifiedTemplate = function(d) {
                    var v3 = v1.value0.template(d);
                    if (v3 instanceof Node2) {
                      return new Node2({
                        name: v3.value0.name,
                        elemType: v3.value0.elemType,
                        behaviors: v3.value0.behaviors,
                        children: v3.value0.children,
                        attrs: append12(v3.value0.attrs)(v1.value0.behaviors.enter.value0.attrs)
                      });
                    }
                    ;
                    return v3;
                  };
                  var rendered = renderTemplatesForPendingSelectionKeyed(modifiedTemplate)(v2.value0.enter)();
                  (function() {
                    if (v1.value0.behaviors.enter.value0.transition instanceof Just) {
                      var enterElements2 = map9(fst)(rendered);
                      var pendingData = (function() {
                        if (v2.value0.enter instanceof PendingSelection) {
                          return v2.value0.enter.value0.pendingData;
                        }
                        ;
                        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2777, column 47 - line 2778, column 60): " + [v2.value0.enter.constructor.name]);
                      })();
                      var pairs = zipWith(Tuple.create)(enterElements2)(pendingData);
                      return liftEffect2(traverseWithIndex_2(function(index3) {
                        return function(v3) {
                          var finalAttrs = (function() {
                            var v4 = v1.value0.template(v3.value1);
                            if (v4 instanceof Node2) {
                              return v4.value0.attrs;
                            }
                            ;
                            return [];
                          })();
                          return applyTransitionAuto(v1.value0.behaviors.enter.value0.transition.value0)(index3)(v3.value0)(v3.value1)(finalAttrs);
                        };
                      })(pairs))();
                    }
                    ;
                    if (v1.value0.behaviors.enter.value0.transition instanceof Nothing) {
                      return unit;
                    }
                    ;
                    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2773, column 11 - line 2785, column 33): " + [v1.value0.behaviors.enter.value0.transition.constructor.name]);
                  })();
                  return rendered;
                }
                ;
                if (v1.value0.behaviors.enter instanceof Nothing) {
                  return renderTemplatesForPendingSelectionKeyed(v1.value0.template)(v2.value0.enter)();
                }
                ;
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2764, column 31 - line 2788, column 77): " + [v1.value0.behaviors.enter.constructor.name]);
              })();
              var updateElements = (function() {
                if (v1.value0.behaviors.update instanceof Just) {
                  if (v1.value0.behaviors.update.value0.transition instanceof Just) {
                    var pairs = getBoundElementDatumPairs(v2.value0.update);
                    liftEffect2(traverseWithIndex_2(function(index3) {
                      return function(v3) {
                        return applyTransitionAuto(v1.value0.behaviors.update.value0.transition.value0)(index3)(v3.value0)(v3.value1)(v1.value0.behaviors.update.value0.attrs);
                      };
                    })(pairs))();
                    return getElementsFromBoundSelection(v2.value0.update);
                  }
                  ;
                  if (v1.value0.behaviors.update.value0.transition instanceof Nothing) {
                    setAttrs1(v1.value0.behaviors.update.value0.attrs)(v2.value0.update)();
                    return renderTemplatesForBoundSelectionKeyed(v1.value0.template)(v2.value0.update)();
                  }
                  ;
                  throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2793, column 11 - line 2803, column 80): " + [v1.value0.behaviors.update.value0.transition.constructor.name]);
                }
                ;
                if (v1.value0.behaviors.update instanceof Nothing) {
                  return renderTemplatesForBoundSelectionKeyed(v1.value0.template)(v2.value0.update)();
                }
                ;
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2791, column 25 - line 2805, column 76): " + [v1.value0.behaviors.update.constructor.name]);
              })();
              var enterElements = map9(fst)(enterElementsAndMaps);
              var enterMaps = map9(snd)(enterElementsAndMaps);
              var allElements = append12(enterElements)(updateElements);
              var combinedChildMap = foldl2(union2)(empty4)(enterMaps);
              var doc = (function() {
                if (v2.value0.enter instanceof PendingSelection) {
                  return v2.value0.enter.value0.document;
                }
                ;
                if (v2.value0.update instanceof BoundSelection) {
                  return v2.value0.update.value0.document;
                }
                ;
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2817, column 16 - line 2818, column 47): " + [v2.value0.update.constructor.name]);
              })();
              var allData = (function() {
                if (v2.value0.enter instanceof PendingSelection) {
                  return v2.value0.enter.value0.pendingData;
                }
                ;
                return [];
              })();
              var updateData = (function() {
                if (v2.value0.update instanceof BoundSelection) {
                  return v2.value0.update.value0.data;
                }
                ;
                return [];
              })();
              var boundSel = mkBoundSelection(allElements)(append12(allData)(updateData))(new Just(range2(0)(length3(allElements) - 1 | 0)))(doc);
              var selectionsMap = insert3(v1.value0.name)(boundSel)(combinedChildMap);
              var firstElement = (function() {
                var v3 = head2(allElements);
                if (v3 instanceof Just) {
                  return v3.value0;
                }
                ;
                if (v3 instanceof Nothing) {
                  return createElementWithNS(Group.value)(doc)();
                }
                ;
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2840, column 23 - line 2842, column 49): " + [v3.constructor.name]);
              })();
              return new Tuple(firstElement, selectionsMap);
            };
          }
          ;
          throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2723, column 3 - line 2844, column 46): " + [v1.value0.keyFn.constructor.name]);
        }
        ;
        if (v1 instanceof UpdateNestedJoin) {
          var innerData = join2(map9(v1.value0.decompose)(v1.value0.joinData));
          $tco_done = true;
          return function __do2() {
            var v2 = joinDataWithKey1(innerData)(jsonStringify_)(v1.value0.key)(v)();
            (function() {
              if (v1.value0.behaviors.exit instanceof Just) {
                if (v1.value0.behaviors.exit.value0.transition instanceof Just) {
                  var pairs = getExitingElementDatumPairs(v2.value0.exit);
                  return liftEffect2(applyExitTransitionAuto(v1.value0.behaviors.exit.value0.transition.value0)(pairs)(v1.value0.behaviors.exit.value0.attrs))();
                }
                ;
                if (v1.value0.behaviors.exit.value0.transition instanceof Nothing) {
                  setAttrsExit1(v1.value0.behaviors.exit.value0.attrs)(v2.value0.exit)();
                  remove1(v2.value0.exit)();
                  return unit;
                }
                ;
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2862, column 7 - line 2869, column 20): " + [v1.value0.behaviors.exit.value0.transition.constructor.name]);
              }
              ;
              if (v1.value0.behaviors.exit instanceof Nothing) {
                remove1(v2.value0.exit)();
                return unit;
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2860, column 3 - line 2872, column 16): " + [v1.value0.behaviors.exit.constructor.name]);
            })();
            var enterElementsAndMaps = (function() {
              if (v1.value0.behaviors.enter instanceof Just) {
                var modifiedTemplate = function(d) {
                  var v3 = v1.value0.template(d);
                  if (v3 instanceof Node2) {
                    return new Node2({
                      name: v3.value0.name,
                      elemType: v3.value0.elemType,
                      behaviors: v3.value0.behaviors,
                      children: v3.value0.children,
                      attrs: append12(v3.value0.attrs)(v1.value0.behaviors.enter.value0.attrs)
                    });
                  }
                  ;
                  return v3;
                };
                var rendered = renderTemplatesForPendingSelectionKeyed(modifiedTemplate)(v2.value0.enter)();
                (function() {
                  if (v1.value0.behaviors.enter.value0.transition instanceof Just) {
                    var enterElements2 = map9(fst)(rendered);
                    var pendingData = (function() {
                      if (v2.value0.enter instanceof PendingSelection) {
                        return v2.value0.enter.value0.pendingData;
                      }
                      ;
                      throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2888, column 43 - line 2889, column 56): " + [v2.value0.enter.constructor.name]);
                    })();
                    var pairs = zipWith(Tuple.create)(enterElements2)(pendingData);
                    return liftEffect2(traverseWithIndex_2(function(index3) {
                      return function(v4) {
                        var finalAttrs = (function() {
                          var v5 = v1.value0.template(v4.value1);
                          if (v5 instanceof Node2) {
                            return v5.value0.attrs;
                          }
                          ;
                          return [];
                        })();
                        return applyTransitionAuto(v1.value0.behaviors.enter.value0.transition.value0)(index3)(v4.value0)(v4.value1)(finalAttrs);
                      };
                    })(pairs))();
                  }
                  ;
                  if (v1.value0.behaviors.enter.value0.transition instanceof Nothing) {
                    return unit;
                  }
                  ;
                  throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2884, column 7 - line 2896, column 29): " + [v1.value0.behaviors.enter.value0.transition.constructor.name]);
                })();
                return rendered;
              }
              ;
              if (v1.value0.behaviors.enter instanceof Nothing) {
                return renderTemplatesForPendingSelectionKeyed(v1.value0.template)(v2.value0.enter)();
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2875, column 27 - line 2899, column 88): " + [v1.value0.behaviors.enter.constructor.name]);
            })();
            var updateElements = (function() {
              if (v1.value0.behaviors.update instanceof Just) {
                if (v1.value0.behaviors.update.value0.transition instanceof Just) {
                  var pairs = getBoundElementDatumPairs(v2.value0.update);
                  liftEffect2(traverseWithIndex_2(function(index3) {
                    return function(v4) {
                      return applyTransitionAuto(v1.value0.behaviors.update.value0.transition.value0)(index3)(v4.value0)(v4.value1)(v1.value0.behaviors.update.value0.attrs);
                    };
                  })(pairs))();
                  return getElementsFromBoundSelection(v2.value0.update);
                }
                ;
                if (v1.value0.behaviors.update.value0.transition instanceof Nothing) {
                  setAttrs1(v1.value0.behaviors.update.value0.attrs)(v2.value0.update)();
                  return renderTemplatesForBoundSelectionKeyed(v1.value0.template)(v2.value0.update)();
                }
                ;
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2904, column 7 - line 2914, column 91): " + [v1.value0.behaviors.update.value0.transition.constructor.name]);
              }
              ;
              if (v1.value0.behaviors.update instanceof Nothing) {
                return renderTemplatesForBoundSelectionKeyed(v1.value0.template)(v2.value0.update)();
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2902, column 21 - line 2916, column 87): " + [v1.value0.behaviors.update.constructor.name]);
            })();
            var enterElements = map9(fst)(enterElementsAndMaps);
            var enterMaps = map9(snd)(enterElementsAndMaps);
            var allElements = append12(enterElements)(updateElements);
            var combinedChildMap = foldl2(union2)(empty4)(enterMaps);
            var doc = (function() {
              if (v2.value0.enter instanceof PendingSelection) {
                return v2.value0.enter.value0.document;
              }
              ;
              if (v2.value0.update instanceof BoundSelection) {
                return v2.value0.update.value0.document;
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2928, column 12 - line 2929, column 43): " + [v2.value0.update.constructor.name]);
            })();
            var allData = (function() {
              if (v2.value0.enter instanceof PendingSelection) {
                return v2.value0.enter.value0.pendingData;
              }
              ;
              return [];
            })();
            var updateData = (function() {
              if (v2.value0.update instanceof BoundSelection) {
                return v2.value0.update.value0.data;
              }
              ;
              return [];
            })();
            var boundSel = mkBoundSelection(allElements)(append12(allData)(updateData))(new Just(range2(0)(length3(allElements) - 1 | 0)))(doc);
            var selectionsMap = insert3(v1.value0.name)(boundSel)(combinedChildMap);
            var firstElement = (function() {
              var v3 = head2(allElements);
              if (v3 instanceof Just) {
                return v3.value0;
              }
              ;
              if (v3 instanceof Nothing) {
                return createElementWithNS(Group.value)(doc)();
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2951, column 19 - line 2953, column 45): " + [v3.constructor.name]);
            })();
            return new Tuple(firstElement, selectionsMap);
          };
        }
        ;
        if (v1 instanceof LocalCoordSpace) {
          $tco_var_v = v;
          $copy_v1 = v1.value0.child;
          return;
        }
        ;
        if (v1 instanceof HierarchicalJoin) {
          $tco_done = true;
          return unsafeCrashWith("renderTreeKeyed: HierarchicalJoin '" + (v1.value0.parentName + ("/" + (v1.value0.childName + "' not yet supported in keyed rendering. Use renderTree instead."))));
        }
        ;
        if (v1 instanceof RecursiveJoin) {
          $tco_done = true;
          return unsafeCrashWith("renderTreeKeyed: RecursiveJoin '" + (v1.value0.name + "' not yet supported in keyed rendering. Use renderTree instead."));
        }
        ;
        if (v1 instanceof ConditionalRender) {
          var dummyElement = (function() {
            if (v instanceof EmptySelection) {
              var v2 = head2(v.value0.parentElements);
              if (v2 instanceof Just) {
                return v2.value0;
              }
              ;
              if (v2 instanceof Nothing) {
                return unsafeCrashWith("renderNodeHelperKeyed ConditionalRender: no parent elements");
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2976, column 31 - line 2978, column 99): " + [v2.constructor.name]);
            }
            ;
            return unsafeCrashWith("renderNodeHelperKeyed ConditionalRender: unexpected selection type");
          })();
          $tco_done = true;
          return pure4(new Tuple(dummyElement, empty4));
        }
        ;
        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2705, column 1 - line 2709, column 74): " + [v.constructor.name, v1.constructor.name]);
      }
      ;
      while (!$tco_done) {
        $tco_result = $tco_loop($tco_var_v, $copy_v1);
      }
      ;
      return $tco_result;
    };
  };
  var renderTemplatesForPendingSelection = function(dictOrd) {
    return function(templateFn) {
      return function(pendingSel) {
        var v = (function() {
          if (pendingSel instanceof PendingSelection) {
            return pendingSel.value0;
          }
          ;
          throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2358, column 68 - line 2359, column 34): " + [pendingSel.constructor.name]);
        })();
        var $772 = $$null2(v.parentElements);
        if ($772) {
          return pure4([]);
        }
        ;
        return traverseWithIndex2(function(idx) {
          return function(datum) {
            var parentIdx = mod2(idx)(length3(v.parentElements));
            var v1 = index(v.parentElements)(parentIdx);
            if (v1 instanceof Nothing) {
              return unsafeCrashWith("renderTemplatesForPendingSelection: no parent elements");
            }
            ;
            if (v1 instanceof Just) {
              var tree = templateFn(datum);
              var singleParentSel = new EmptySelection({
                parentElements: [v1.value0],
                document: v.document
              });
              return function __do2() {
                var v2 = renderNodeHelperWithDatum(dictOrd)(singleParentSel)(tree)(new Just(datum))(idx)();
                setElementData_(datum)(v2.value0)();
                return new Tuple(v2.value0, v2.value1);
              };
            }
            ;
            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2371, column 11 - line 2391, column 51): " + [v1.constructor.name]);
          };
        })(v.pendingData);
      };
    };
  };
  var renderNodeHelperWithDatum = function(dictOrd) {
    return function(v) {
      return function(v1) {
        return function(v2) {
          return function(v3) {
            if (v1 instanceof Node2) {
              return function __do2() {
                var childSel = appendChildWithDatum1(v1.value0.elemType)(v1.value0.attrs)(v2)(v3)(v)();
                var element = (function() {
                  if (childSel instanceof EmptySelection) {
                    var v42 = head2(childSel.value0.parentElements);
                    if (v42 instanceof Just) {
                      return v42.value0;
                    }
                    ;
                    if (v42 instanceof Nothing) {
                      return unsafeCrashWith("renderTree: appendChild returned empty selection");
                    }
                    ;
                    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1573, column 29 - line 1575, column 102): " + [v42.constructor.name]);
                  }
                  ;
                  return unsafeCrashWith("renderTree: appendChild should return EmptySelection");
                })();
                traverse_2(function(behavior) {
                  return applyBehaviorToElement(behavior)(element);
                })(v1.value0.behaviors)();
                var childMaps = traverse4(function(child) {
                  return renderNodeHelperWithDatum(dictOrd)(childSel)(child)(v2)(v3);
                })(v1.value0.children)();
                var combinedChildMap = foldl2(union2)(empty4)(map9(snd)(childMaps));
                var selectionsMap = (function() {
                  if (v1.value0.name instanceof Just) {
                    return insert3(v1.value0.name.value0)(childSel)(combinedChildMap);
                  }
                  ;
                  if (v1.value0.name instanceof Nothing) {
                    return combinedChildMap;
                  }
                  ;
                  throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1588, column 21 - line 1590, column 34): " + [v1.value0.name.constructor.name]);
                })();
                return new Tuple(element, selectionsMap);
              };
            }
            ;
            if (v1 instanceof Join) {
              return renderNodeHelper(dictOrd)(v)(v1);
            }
            ;
            if (v1 instanceof NestedJoin) {
              return renderNodeHelper(dictOrd)(v)(v1);
            }
            ;
            if (v1 instanceof UpdateJoin) {
              return renderNodeHelper(dictOrd)(v)(v1);
            }
            ;
            if (v1 instanceof UpdateNestedJoin) {
              return renderNodeHelper(dictOrd)(v)(v1);
            }
            ;
            if (v1 instanceof LocalCoordSpace) {
              return renderNodeHelper(dictOrd)(v)(v1);
            }
            ;
            if (v1 instanceof HierarchicalJoin) {
              return renderNodeHelper(dictOrd)(v)(v1);
            }
            ;
            if (v1 instanceof RecursiveJoin) {
              return renderNodeHelper(dictOrd)(v)(v1);
            }
            ;
            if (v1 instanceof ConditionalRender && v2 instanceof Just) {
              var v4 = find2(function(c) {
                return c.predicate(v2.value0);
              })(v1.value0.cases);
              if (v4 instanceof Just) {
                var chosenTree = v4.value0.spec(v2.value0);
                return renderNodeHelperWithDatum(dictOrd)(v)(chosenTree)(new Just(v2.value0))(v3);
              }
              ;
              if (v4 instanceof Nothing) {
                var doc = (function() {
                  if (v instanceof EmptySelection) {
                    return v.value0.document;
                  }
                  ;
                  if (v instanceof EmptySelection) {
                    return v.value0.document;
                  }
                  ;
                  throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1617, column 33 - line 1617, column 80): " + [v.constructor.name]);
                })();
                return function __do2() {
                  var dummyElement = createElementWithNS(Group.value)(doc)();
                  return new Tuple(dummyElement, empty4);
                };
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1607, column 3 - line 1619, column 42): " + [v4.constructor.name]);
            }
            ;
            if (v1 instanceof ConditionalRender && v2 instanceof Nothing) {
              return renderNodeHelper(dictOrd)(v)(new ConditionalRender({
                cases: []
              }));
            }
            ;
            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1557, column 1 - line 1564, column 74): " + [v.constructor.name, v1.constructor.name, v2.constructor.name, v3.constructor.name]);
          };
        };
      };
    };
  };
  var renderNodeHelper = function(dictOrd) {
    var joinData22 = joinData1(dictOrd);
    var renderTemplatesForBoundSelection1 = renderTemplatesForBoundSelection(dictOrd);
    return function(v) {
      return function(v1) {
        if (v1 instanceof Node2) {
          return renderNodeHelperWithDatum(dictOrd)(v)(new Node2(v1.value0))(Nothing.value)(0);
        }
        ;
        if (v1 instanceof Join) {
          return function __do2() {
            var v22 = joinData22(v1.value0.joinData)(v1.value0.key)(v)();
            remove1(v22.value0.exit)();
            var enterElementsAndMaps = renderTemplatesForPendingSelection(dictOrd)(v1.value0.template)(v22.value0.enter)();
            var enterElements = map9(fst)(enterElementsAndMaps);
            var enterChildMaps = map9(snd)(enterElementsAndMaps);
            var updateElements = renderTemplatesForBoundSelection1(v1.value0.template)(v22.value0.update)();
            var allElements = append12(enterElements)(updateElements);
            var combinedChildMap = foldl2(union2)(empty4)(enterChildMaps);
            var doc2 = (function() {
              if (v22.value0.enter instanceof PendingSelection) {
                return v22.value0.enter.value0.document;
              }
              ;
              if (v22.value0.update instanceof BoundSelection) {
                return v22.value0.update.value0.document;
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1688, column 12 - line 1689, column 43): " + [v22.value0.update.constructor.name]);
            })();
            var allData = (function() {
              if (v22.value0.enter instanceof PendingSelection) {
                return v22.value0.enter.value0.pendingData;
              }
              ;
              return [];
            })();
            var updateData = (function() {
              if (v22.value0.update instanceof BoundSelection) {
                return v22.value0.update.value0.data;
              }
              ;
              return [];
            })();
            var boundSel = mkBoundSelection(allElements)(append12(allData)(updateData))(new Just(range2(0)(length3(allElements) - 1 | 0)))(doc2);
            var selectionsMap = insert3(v1.value0.name)(boundSel)(combinedChildMap);
            var firstElement = (function() {
              var v3 = head2(allElements);
              if (v3 instanceof Just) {
                return v3.value0;
              }
              ;
              if (v3 instanceof Nothing) {
                return createElementWithNS(Group.value)(doc2)();
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1712, column 19 - line 1714, column 45): " + [v3.constructor.name]);
            })();
            return new Tuple(firstElement, selectionsMap);
          };
        }
        ;
        if (v1 instanceof NestedJoin) {
          return function __do2() {
            var v22 = joinData22(v1.value0.joinData)(v1.value0.key)(v)();
            var elementsAndMaps = renderNestedTemplatesForPendingSelection(dictOrd)(v1.value0.decompose)(v1.value0.template)(stringToElementType(v1.value0.key))(v22.value0.enter)();
            var elements = map9(fst)(elementsAndMaps);
            var childMaps = map9(snd)(elementsAndMaps);
            var combinedChildMap = foldl2(union2)(empty4)(childMaps);
            var v3 = (function() {
              if (v22.value0.enter instanceof PendingSelection) {
                return v22.value0.enter.value0;
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1738, column 52 - line 1739, column 34): " + [v22.value0.enter.constructor.name]);
            })();
            var boundSel = mkBoundSelection(elements)(v3.pendingData)(new Just(range2(0)(length3(elements) - 1 | 0)))(v3.document);
            var selectionsMap = insert3(v1.value0.name)(boundSel)(combinedChildMap);
            var firstElement = (function() {
              var v4 = head2(elements);
              if (v4 instanceof Just) {
                return v4.value0;
              }
              ;
              if (v4 instanceof Nothing) {
                return createElementWithNS(Group.value)(v3.document)();
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1752, column 19 - line 1754, column 45): " + [v4.constructor.name]);
            })();
            return new Tuple(firstElement, selectionsMap);
          };
        }
        ;
        if (v1 instanceof UpdateJoin) {
          return function __do2() {
            var v22 = (function() {
              if (v1.value0.keyFn instanceof Just) {
                return joinDataWithKey1(v1.value0.joinData)(v1.value0.keyFn.value0)(v1.value0.key)(v)();
              }
              ;
              if (v1.value0.keyFn instanceof Nothing) {
                return joinData22(v1.value0.joinData)(v1.value0.key)(v)();
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1764, column 5 - line 1766, column 67): " + [v1.value0.keyFn.constructor.name]);
            })();
            liftEffect2((function() {
              var enterCount = (function() {
                if (v22.value0.enter instanceof PendingSelection) {
                  return length3(v22.value0.enter.value0.pendingData);
                }
                ;
                return 0;
              })();
              var updateCount = (function() {
                if (v22.value0.update instanceof BoundSelection) {
                  return length3(v22.value0.update.value0.data);
                }
                ;
                return 0;
              })();
              var exitCount = (function() {
                if (v22.value0.exit instanceof BoundSelection) {
                  return length3(v22.value0.exit.value0.data);
                }
                ;
                if (v22.value0.exit instanceof ExitingSelection) {
                  return length3(v22.value0.exit.value0.data);
                }
                ;
                return 0;
              })();
              return log4("Tree API UpdateJoin '" + (v1.value0.name + ("': enter=" + (show5(enterCount) + (", update=" + (show5(updateCount) + (", exit=" + show5(exitCount))))))));
            })())();
            (function() {
              if (v1.value0.behaviors.exit instanceof Just) {
                if (v1.value0.behaviors.exit.value0.transition instanceof Just) {
                  var pairs = getExitingElementDatumPairs(v22.value0.exit);
                  return liftEffect2(applyExitTransitionAuto(v1.value0.behaviors.exit.value0.transition.value0)(pairs)(v1.value0.behaviors.exit.value0.attrs))();
                }
                ;
                if (v1.value0.behaviors.exit.value0.transition instanceof Nothing) {
                  setAttrsExit1(v1.value0.behaviors.exit.value0.attrs)(v22.value0.exit)();
                  remove1(v22.value0.exit)();
                  return unit;
                }
                ;
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1798, column 7 - line 1806, column 20): " + [v1.value0.behaviors.exit.value0.transition.constructor.name]);
              }
              ;
              if (v1.value0.behaviors.exit instanceof Nothing) {
                remove1(v22.value0.exit)();
                return unit;
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1796, column 3 - line 1810, column 16): " + [v1.value0.behaviors.exit.constructor.name]);
            })();
            var enterElementsAndMaps = (function() {
              if (v1.value0.behaviors.enter instanceof Just) {
                var modifiedTemplate = function(datum) {
                  var v3 = v1.value0.template(datum);
                  if (v3 instanceof Node2) {
                    return new Node2({
                      name: v3.value0.name,
                      elemType: v3.value0.elemType,
                      behaviors: v3.value0.behaviors,
                      children: v3.value0.children,
                      attrs: append12(v3.value0.attrs)(v1.value0.behaviors.enter.value0.attrs)
                    });
                  }
                  ;
                  return v3;
                };
                var rendered = renderTemplatesForPendingSelection(dictOrd)(modifiedTemplate)(v22.value0.enter)();
                (function() {
                  if (v1.value0.behaviors.enter.value0.transition instanceof Just) {
                    var enterElements2 = map9(fst)(rendered);
                    var pendingData = (function() {
                      if (v22.value0.enter instanceof PendingSelection) {
                        return v22.value0.enter.value0.pendingData;
                      }
                      ;
                      throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1839, column 41 - line 1840, column 54): " + [v22.value0.enter.constructor.name]);
                    })();
                    var pairs = zipWith(Tuple.create)(enterElements2)(pendingData);
                    return liftEffect2(traverseWithIndex_2(function(index3) {
                      return function(v3) {
                        var finalAttrs = (function() {
                          var v4 = v1.value0.template(v3.value1);
                          if (v4 instanceof Node2) {
                            return v4.value0.attrs;
                          }
                          ;
                          return [];
                        })();
                        return applyTransitionAuto(v1.value0.behaviors.enter.value0.transition.value0)(index3)(v3.value0)(v3.value1)(finalAttrs);
                      };
                    })(pairs))();
                  }
                  ;
                  if (v1.value0.behaviors.enter.value0.transition instanceof Nothing) {
                    return unit;
                  }
                  ;
                  throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1834, column 7 - line 1850, column 29): " + [v1.value0.behaviors.enter.value0.transition.constructor.name]);
                })();
                return rendered;
              }
              ;
              if (v1.value0.behaviors.enter instanceof Nothing) {
                return renderTemplatesForPendingSelection(dictOrd)(v1.value0.template)(v22.value0.enter)();
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1821, column 27 - line 1855, column 68): " + [v1.value0.behaviors.enter.constructor.name]);
            })();
            var enterElements = map9(fst)(enterElementsAndMaps);
            var enterChildMaps = map9(snd)(enterElementsAndMaps);
            var updateElements = (function() {
              if (v1.value0.behaviors.update instanceof Just) {
                if (v1.value0.behaviors.update.value0.transition instanceof Just) {
                  var pairs = getBoundElementDatumPairs(v22.value0.update);
                  liftEffect2(traverseWithIndex_2(function(index3) {
                    return function(v3) {
                      return applyTransitionAuto(v1.value0.behaviors.update.value0.transition.value0)(index3)(v3.value0)(v3.value1)(v1.value0.behaviors.update.value0.attrs);
                    };
                  })(pairs))();
                  return getElementsFromBoundSelection(v22.value0.update);
                }
                ;
                if (v1.value0.behaviors.update.value0.transition instanceof Nothing) {
                  setAttrs1(v1.value0.behaviors.update.value0.attrs)(v22.value0.update)();
                  return renderTemplatesForBoundSelection1(v1.value0.template)(v22.value0.update)();
                }
                ;
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1864, column 7 - line 1880, column 71): " + [v1.value0.behaviors.update.value0.transition.constructor.name]);
              }
              ;
              if (v1.value0.behaviors.update instanceof Nothing) {
                return renderTemplatesForBoundSelection1(v1.value0.template)(v22.value0.update)();
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1861, column 21 - line 1883, column 67): " + [v1.value0.behaviors.update.constructor.name]);
            })();
            var allElements = append12(enterElements)(updateElements);
            var combinedChildMap = foldl2(union2)(empty4)(enterChildMaps);
            var doc2 = (function() {
              if (v22.value0.enter instanceof PendingSelection) {
                return v22.value0.enter.value0.document;
              }
              ;
              if (v22.value0.update instanceof BoundSelection) {
                return v22.value0.update.value0.document;
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1897, column 12 - line 1898, column 43): " + [v22.value0.update.constructor.name]);
            })();
            var allData = (function() {
              if (v22.value0.enter instanceof PendingSelection) {
                return v22.value0.enter.value0.pendingData;
              }
              ;
              return [];
            })();
            var updateData = (function() {
              if (v22.value0.update instanceof BoundSelection) {
                return v22.value0.update.value0.data;
              }
              ;
              return [];
            })();
            var boundSel = mkBoundSelection(allElements)(append12(allData)(updateData))(new Just(range2(0)(length3(allElements) - 1 | 0)))(doc2);
            var selectionsMap = insert3(v1.value0.name)(boundSel)(combinedChildMap);
            var firstElement = (function() {
              var v3 = head2(allElements);
              if (v3 instanceof Just) {
                return v3.value0;
              }
              ;
              if (v3 instanceof Nothing) {
                return createElementWithNS(Group.value)(doc2)();
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1920, column 19 - line 1922, column 45): " + [v3.constructor.name]);
            })();
            return new Tuple(firstElement, selectionsMap);
          };
        }
        ;
        if (v1 instanceof UpdateNestedJoin) {
          var innerData = join2(map9(v1.value0.decompose)(v1.value0.joinData));
          return function __do2() {
            var v22 = joinDataWithKey1(innerData)(jsonStringify_)(v1.value0.key)(v)();
            (function() {
              if (v1.value0.behaviors.exit instanceof Just) {
                if (v1.value0.behaviors.exit.value0.transition instanceof Just) {
                  var pairs = getExitingElementDatumPairs(v22.value0.exit);
                  return liftEffect2(applyExitTransitionAuto(v1.value0.behaviors.exit.value0.transition.value0)(pairs)(v1.value0.behaviors.exit.value0.attrs))();
                }
                ;
                if (v1.value0.behaviors.exit.value0.transition instanceof Nothing) {
                  setAttrsExit1(v1.value0.behaviors.exit.value0.attrs)(v22.value0.exit)();
                  remove1(v22.value0.exit)();
                  return unit;
                }
                ;
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1973, column 7 - line 1981, column 20): " + [v1.value0.behaviors.exit.value0.transition.constructor.name]);
              }
              ;
              if (v1.value0.behaviors.exit instanceof Nothing) {
                remove1(v22.value0.exit)();
                return unit;
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1971, column 3 - line 1984, column 16): " + [v1.value0.behaviors.exit.constructor.name]);
            })();
            var enterElementsAndMaps = (function() {
              if (v1.value0.behaviors.enter instanceof Just) {
                var modifiedTemplate = function(datum) {
                  var v3 = v1.value0.template(datum);
                  if (v3 instanceof Node2) {
                    return new Node2({
                      name: v3.value0.name,
                      elemType: v3.value0.elemType,
                      behaviors: v3.value0.behaviors,
                      children: v3.value0.children,
                      attrs: append12(v3.value0.attrs)(v1.value0.behaviors.enter.value0.attrs)
                    });
                  }
                  ;
                  return v3;
                };
                var rendered = renderTemplatesForPendingSelection(dictOrd)(modifiedTemplate)(v22.value0.enter)();
                (function() {
                  if (v1.value0.behaviors.enter.value0.transition instanceof Just) {
                    var enterElements2 = map9(fst)(rendered);
                    var pendingData = (function() {
                      if (v22.value0.enter instanceof PendingSelection) {
                        return v22.value0.enter.value0.pendingData;
                      }
                      ;
                      throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2017, column 41 - line 2018, column 54): " + [v22.value0.enter.constructor.name]);
                    })();
                    var pairs = zipWith(Tuple.create)(enterElements2)(pendingData);
                    return liftEffect2(traverseWithIndex_2(function(index3) {
                      return function(v4) {
                        var finalAttrs = (function() {
                          var v5 = v1.value0.template(v4.value1);
                          if (v5 instanceof Node2) {
                            return v5.value0.attrs;
                          }
                          ;
                          return [];
                        })();
                        return applyTransitionAuto(v1.value0.behaviors.enter.value0.transition.value0)(index3)(v4.value0)(v4.value1)(finalAttrs);
                      };
                    })(pairs))();
                  }
                  ;
                  if (v1.value0.behaviors.enter.value0.transition instanceof Nothing) {
                    return unit;
                  }
                  ;
                  throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2012, column 7 - line 2028, column 29): " + [v1.value0.behaviors.enter.value0.transition.constructor.name]);
                })();
                return rendered;
              }
              ;
              if (v1.value0.behaviors.enter instanceof Nothing) {
                return renderTemplatesForPendingSelection(dictOrd)(v1.value0.template)(v22.value0.enter)();
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2001, column 27 - line 2031, column 92): " + [v1.value0.behaviors.enter.constructor.name]);
            })();
            var updateElements = (function() {
              if (v1.value0.behaviors.update instanceof Just) {
                if (v1.value0.behaviors.update.value0.transition instanceof Just) {
                  var pairs = getBoundElementDatumPairs(v22.value0.update);
                  liftEffect2(traverseWithIndex_2(function(index3) {
                    return function(v4) {
                      return applyTransitionAuto(v1.value0.behaviors.update.value0.transition.value0)(index3)(v4.value0)(v4.value1)(v1.value0.behaviors.update.value0.attrs);
                    };
                  })(pairs))();
                  return getElementsFromBoundSelection(v22.value0.update);
                }
                ;
                if (v1.value0.behaviors.update.value0.transition instanceof Nothing) {
                  setAttrs1(v1.value0.behaviors.update.value0.attrs)(v22.value0.update)();
                  return renderTemplatesForBoundSelection1(v1.value0.template)(v22.value0.update)();
                }
                ;
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2037, column 7 - line 2050, column 86): " + [v1.value0.behaviors.update.value0.transition.constructor.name]);
              }
              ;
              if (v1.value0.behaviors.update instanceof Nothing) {
                return renderTemplatesForBoundSelection1(v1.value0.template)(v22.value0.update)();
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2034, column 21 - line 2051, column 91): " + [v1.value0.behaviors.update.constructor.name]);
            })();
            var enterElements = map9(fst)(enterElementsAndMaps);
            var allElements = append12(enterElements)(updateElements);
            var enterChildMaps = map9(snd)(enterElementsAndMaps);
            var combinedChildMap = foldl2(union2)(empty4)(enterChildMaps);
            var doc2 = (function() {
              if (v22.value0.enter instanceof PendingSelection) {
                return v22.value0.enter.value0.document;
              }
              ;
              if (v22.value0.update instanceof BoundSelection) {
                return v22.value0.update.value0.document;
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2070, column 12 - line 2071, column 43): " + [v22.value0.update.constructor.name]);
            })();
            var boundSel = mkBoundSelection(allElements)(innerData)(new Just(range2(0)(length3(allElements) - 1 | 0)))(doc2);
            var selectionsMap = insert3(v1.value0.name)(boundSel)(combinedChildMap);
            var firstElement = (function() {
              var v5 = head2(allElements);
              if (v5 instanceof Just) {
                return v5.value0;
              }
              ;
              if (v5 instanceof Nothing) {
                return createElementWithNS(Group.value)(doc2)();
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2083, column 19 - line 2085, column 45): " + [v5.constructor.name]);
            })();
            return new Tuple(firstElement, selectionsMap);
          };
        }
        ;
        if (v1 instanceof ConditionalRender) {
          var doc = (function() {
            if (v instanceof EmptySelection) {
              return v.value0.document;
            }
            ;
            if (v instanceof EmptySelection) {
              return v.value0.document;
            }
            ;
            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2099, column 29 - line 2099, column 76): " + [v.constructor.name]);
          })();
          return function __do2() {
            var dummyElement = createElementWithNS(Group.value)(doc)();
            return new Tuple(dummyElement, empty4);
          };
        }
        ;
        if (v1 instanceof LocalCoordSpace) {
          return renderNodeHelper(dictOrd)(v)(v1.value0.child);
        }
        ;
        if (v1 instanceof HierarchicalJoin) {
          return function __do2() {
            var v22 = joinData22(v1.value0.parentData)(v1.value0.parentKey)(v)();
            var v3 = (function() {
              if (v22.value0.enter instanceof PendingSelection) {
                return v22.value0.enter.value0;
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2123, column 68 - line 2124, column 34): " + [v22.value0.enter.constructor.name]);
            })();
            var $957 = $$null2(v3.parentElements);
            if ($957) {
              var dummyElement = createElementWithNS(Group.value)(v3.document)();
              return new Tuple(dummyElement, empty4);
            }
            ;
            var parentResults = traverseWithIndex2(function(idx) {
              return function(parentDatum) {
                var parentIdx = mod2(idx)(length3(v3.parentElements));
                var v4 = index(v3.parentElements)(parentIdx);
                if (v4 instanceof Nothing) {
                  return unsafeCrashWith("renderNodeHelper HierarchicalJoin: no parent elements");
                }
                ;
                if (v4 instanceof Just) {
                  return function __do3() {
                    var wrapperElement = createElementWithNS(stringToElementType(v1.value0.parentKey))(v3.document)();
                    var wrapperNode = toNode(wrapperElement);
                    var parentNode2 = toNode(v4.value0);
                    appendChild(wrapperNode)(parentNode2)();
                    setElementData_(parentDatum)(wrapperElement)();
                    var childData = v1.value0.getChildren(parentDatum);
                    var wrapperSel = new EmptySelection({
                      parentElements: [wrapperElement],
                      document: v3.document
                    });
                    var childResults = traverseWithIndex2(function(childIdx) {
                      return function(childDatum) {
                        var tree = v1.value0.template(parentDatum)(childDatum);
                        return function __do4() {
                          var v5 = renderNodeHelperWithDatum(dictOrd)(wrapperSel)(tree)(new Just(childDatum))(childIdx)();
                          setElementData_(childDatum)(v5.value0)();
                          return {
                            element: v5.value0,
                            datum: childDatum,
                            selections: v5.value1
                          };
                        };
                      };
                    })(childData)();
                    var childElements = map9(function(v5) {
                      return v5.element;
                    })(childResults);
                    var childSelections = foldl2(union2)(empty4)(map9(function(v5) {
                      return v5.selections;
                    })(childResults));
                    return {
                      wrapper: wrapperElement,
                      children: childElements,
                      childData,
                      childSelections
                    };
                  };
                }
                ;
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2135, column 11 - line 2175, column 100): " + [v4.constructor.name]);
              };
            })(v3.pendingData)();
            var wrapperElements = map9(function(v4) {
              return v4.wrapper;
            })(parentResults);
            var allChildElements = concatMap(function(v4) {
              return v4.children;
            })(parentResults);
            var allChildData = concatMap(function(v4) {
              return v4.childData;
            })(parentResults);
            var allChildSelections = foldl2(union2)(empty4)(map9(function(v4) {
              return v4.childSelections;
            })(parentResults));
            var parentBoundSel = mkBoundSelection(wrapperElements)(v3.pendingData)(new Just(range2(0)(length3(wrapperElements) - 1 | 0)))(v3.document);
            var childBoundSel = mkBoundSelection(allChildElements)(allChildData)(new Just(range2(0)(length3(allChildElements) - 1 | 0)))(v3.document);
            var selectionsMap = insert3(v1.value0.parentName)(parentBoundSel)(insert3(v1.value0.childName)(childBoundSel)(allChildSelections));
            var firstElement = (function() {
              var v4 = head2(wrapperElements);
              if (v4 instanceof Just) {
                return v4.value0;
              }
              ;
              if (v4 instanceof Nothing) {
                return createElementWithNS(Group.value)(v3.document)();
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2207, column 21 - line 2209, column 47): " + [v4.constructor.name]);
            })();
            return new Tuple(firstElement, selectionsMap);
          };
        }
        ;
        if (v1 instanceof RecursiveJoin) {
          var v2 = (function() {
            if (v instanceof EmptySelection) {
              return {
                parentElements: v.value0.parentElements,
                document: v.value0.document
              };
            }
            ;
            if (v instanceof EmptySelection) {
              return {
                parentElements: v.value0.parentElements,
                document: v.value0.document
              };
            }
            ;
            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2219, column 29 - line 2219, column 126): " + [v.constructor.name]);
          })();
          return function __do2() {
            var parentEl = (function() {
              var v3 = head2(v2.parentElements);
              if (v3 instanceof Just) {
                return v3.value0;
              }
              ;
              if (v3 instanceof Nothing) {
                return createElementWithNS(Group.value)(v2.document)();
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2222, column 15 - line 2224, column 45): " + [v3.constructor.name]);
            })();
            var nodesRef = $$new([])();
            var renderNode = function(currentParent) {
              return function(depth) {
                return function(datum) {
                  var tree = v1.value0.template(datum);
                  var nodeSel = new EmptySelection({
                    parentElements: [currentParent],
                    document: v2.document
                  });
                  return function __do3() {
                    var v3 = renderNodeHelperKeyed(nodeSel)(tree)();
                    setElementData_(datum)(v3.value0)();
                    modify_(function(nodes) {
                      return append12(nodes)([{
                        element: v3.value0,
                        depth
                      }]);
                    })(nodesRef)();
                    var children2 = v1.value0.getChildren(datum);
                    for_4(children2)(function(child) {
                      return renderNode(v3.value0)(depth + 1 | 0)(child);
                    })();
                    return v3.value0;
                  };
                };
              };
            };
            renderNode(parentEl)(0)(v1.value0.rootData)();
            var allNodes = read(nodesRef)();
            var allElements = map9(function(v3) {
              return v3.element;
            })(allNodes);
            var boundSel = mkBoundSelection(allElements)(replicate(length3(allElements))(v1.value0.rootData))(new Just(range2(0)(length3(allElements) - 1 | 0)))(v2.document);
            var selectionsMap = insert3(v1.value0.name)(boundSel)(empty4);
            var firstElement = (function() {
              var v3 = head2(allElements);
              if (v3 instanceof Just) {
                return v3.value0;
              }
              ;
              if (v3 instanceof Nothing) {
                return createElementWithNS(Group.value)(v2.document)();
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2277, column 19 - line 2279, column 45): " + [v3.constructor.name]);
            })();
            return new Tuple(firstElement, selectionsMap);
          };
        }
        ;
        throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 1627, column 1 - line 1632, column 74): " + [v.constructor.name, v1.constructor.name]);
      };
    };
  };
  var renderNestedTemplatesForPendingSelection = function(dictOrd) {
    return function(decomposer) {
      return function(templateFn) {
        return function(wrapperType) {
          return function(pendingSel) {
            var v = (function() {
              if (pendingSel instanceof PendingSelection) {
                return pendingSel.value0;
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2300, column 68 - line 2301, column 34): " + [pendingSel.constructor.name]);
            })();
            return traverseWithIndex2(function(idx) {
              return function(outerDatum) {
                var parentIdx = mod2(idx)(length3(v.parentElements));
                var v1 = index(v.parentElements)(parentIdx);
                if (v1 instanceof Nothing) {
                  return unsafeCrashWith("renderNestedTemplatesForPendingSelection: no parent elements");
                }
                ;
                if (v1 instanceof Just) {
                  return function __do2() {
                    var wrapperElement = createElementWithNS(wrapperType)(v.document)();
                    var wrapperNode = toNode(wrapperElement);
                    var parentNode2 = toNode(v1.value0);
                    appendChild(wrapperNode)(parentNode2)();
                    var innerDataArray = decomposer(outerDatum);
                    var innerMaps = traverseWithIndex2(function(innerIdx) {
                      return function(innerDatumErased) {
                        var tree = templateFn(innerDatumErased);
                        var singleParentSel = new EmptySelection({
                          parentElements: [wrapperElement],
                          document: v.document
                        });
                        return function __do3() {
                          var v2 = renderNodeHelperWithDatum(dictOrd)(singleParentSel)(tree)(new Just(innerDatumErased))(innerIdx)();
                          return v2.value1;
                        };
                      };
                    })(innerDataArray)();
                    var combinedInnerMap = foldl2(union2)(empty4)(innerMaps);
                    return new Tuple(wrapperElement, combinedInnerMap);
                  };
                }
                ;
                throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 2306, column 9 - line 2338, column 57): " + [v1.constructor.name]);
              };
            })(v.pendingData);
          };
        };
      };
    };
  };
  var renderTreeOrd = function(dictOrd) {
    var renderNodeHelper1 = renderNodeHelper(dictOrd);
    return function(parent2) {
      return function(tree) {
        return function __do2() {
          var v = renderNodeHelper1(parent2)(tree)();
          return v.value1;
        };
      };
    };
  };
  var renderTree2 = function(dictOrd) {
    return renderTreeOrd(dictOrd);
  };
  var appendChildInheriting = function(dictMonadEffect) {
    var liftEffect1 = liftEffect(dictMonadEffect);
    return function(elemType) {
      return function(attrs) {
        return function(v) {
          return liftEffect1((function() {
            var v1 = (function() {
              if (v instanceof BoundSelection) {
                return v.value0;
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 405, column 82 - line 406, column 28): " + [v.constructor.name]);
            })();
            return function __do2() {
              var childElements = traverseWithIndex2(function(idx) {
                return function(v2) {
                  return function __do3() {
                    var child = createElementWithNS(elemType)(v1.document)();
                    setElementData_(v2.value1)(child)();
                    applyAttributes(child)(v2.value1)(idx)(attrs)();
                    var childNode = toNode(child);
                    var parentNode2 = toNode(v2.value0);
                    appendChild(childNode)(parentNode2)();
                    return child;
                  };
                };
              })(zipWith(Tuple.create)(v1.elements)(v1.data))();
              return mkBoundSelection(childElements)(v1.data)(Nothing.value)(v1.document);
            };
          })());
        };
      };
    };
  };
  var appendChild2 = function(dictMonadEffect) {
    var liftEffect1 = liftEffect(dictMonadEffect);
    return function(elemType) {
      return function(attrs) {
        return function(v) {
          return liftEffect1((function() {
            var v1 = (function() {
              if (v instanceof EmptySelection) {
                return v.value0;
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 312, column 55 - line 313, column 28): " + [v.constructor.name]);
            })();
            return function __do2() {
              var elements = traverse4(function(parent2) {
                return function __do3() {
                  var element = createElementWithNS(elemType)(v1.document)();
                  applyAttributes(element)(unit)(0)(attrs)();
                  var elementNode = toNode(element);
                  var parentNode2 = toNode(parent2);
                  appendChild(elementNode)(parentNode2)();
                  return element;
                };
              })(v1.parentElements)();
              return new EmptySelection({
                parentElements: elements,
                document: v1.document
              });
            };
          })());
        };
      };
    };
  };
  var append5 = function(dictMonadEffect) {
    var liftEffect1 = liftEffect(dictMonadEffect);
    return function(elemType) {
      return function(attrs) {
        return function(v) {
          return liftEffect1((function() {
            var v1 = (function() {
              if (v instanceof PendingSelection) {
                return v.value0;
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 131, column 77 - line 132, column 30): " + [v.constructor.name]);
            })();
            var parent2 = (function() {
              var v2 = head2(v1.parentElements);
              if (v2 instanceof Just) {
                return v2.value0;
              }
              ;
              if (v2 instanceof Nothing) {
                return unsafeIndex3(v1.parentElements)(0);
              }
              ;
              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 137, column 14 - line 139, column 68): " + [v2.constructor.name]);
            })();
            return function __do2() {
              var elements = traverseWithIndex2(function(arrayIndex) {
                return function(datum) {
                  var logicalIndex = (function() {
                    if (v1.indices instanceof Just) {
                      return unsafeIndex3(v1.indices.value0)(arrayIndex);
                    }
                    ;
                    if (v1.indices instanceof Nothing) {
                      return arrayIndex;
                    }
                    ;
                    throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 144, column 22 - line 146, column 30): " + [v1.indices.constructor.name]);
                  })();
                  return function __do3() {
                    var element = createElementWithNS(elemType)(v1.document)();
                    applyAttributes(element)(datum)(logicalIndex)(attrs)();
                    setElementData_(datum)(element)();
                    var elementNode = toNode(element);
                    var parentNode2 = toNode(parent2);
                    appendChild(elementNode)(parentNode2)();
                    return element;
                  };
                };
              })(v1.pendingData)();
              return mkBoundSelection(elements)(v1.pendingData)(v1.indices)(v1.document);
            };
          })());
        };
      };
    };
  };
  var append32 = /* @__PURE__ */ append5(monadEffectEffect);
  var appendData = function(dictMonadEffect) {
    var liftEffect1 = liftEffect(dictMonadEffect);
    return function(dictFoldable) {
      var fromFoldable4 = fromFoldable(dictFoldable);
      return function(elemType) {
        return function(foldableData) {
          return function(attrs) {
            return function(emptySelection) {
              return liftEffect1((function() {
                var v = (function() {
                  if (emptySelection instanceof EmptySelection) {
                    return emptySelection.value0;
                  }
                  ;
                  throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 754, column 55 - line 755, column 28): " + [emptySelection.constructor.name]);
                })();
                var dataArray = fromFoldable4(foldableData);
                var pendingSelection = new PendingSelection({
                  parentElements: v.parentElements,
                  pendingData: dataArray,
                  indices: new Just(range2(0)(length3(dataArray) - 1 | 0)),
                  document: v.document
                });
                return append32(elemType)(attrs)(pendingSelection);
              })());
            };
          };
        };
      };
    };
  };
  var renderData = function(dictMonadEffect) {
    var Monad0 = dictMonadEffect.Monad0();
    var Bind1 = Monad0.Bind1();
    var bind12 = bind(Bind1);
    var joinData22 = joinData(dictMonadEffect);
    var append42 = append5(dictMonadEffect);
    var pure1 = pure(Monad0.Applicative0());
    var applyPerDatumAttrs1 = applyPerDatumAttrs(dictMonadEffect);
    var discard22 = discard2(Bind1);
    var remove22 = remove(dictMonadEffect);
    var merge1 = merge(dictMonadEffect);
    return function(dictFoldable) {
      var joinData3 = joinData22(dictFoldable);
      return function(dictOrd) {
        var joinData4 = joinData3(dictOrd);
        return function(elemType) {
          return function(foldableData) {
            return function(selector) {
              return function(emptySelection) {
                return function(enterAttrs) {
                  return function(updateAttrs) {
                    return function(exitAttrs) {
                      return bind12(joinData4(foldableData)(selector)(emptySelection))(function(v) {
                        return bind12(bind12(append42(elemType)([])(v.value0.enter))(function(bound) {
                          if (enterAttrs instanceof Nothing) {
                            return pure1(bound);
                          }
                          ;
                          if (enterAttrs instanceof Just) {
                            return applyPerDatumAttrs1(enterAttrs.value0)(bound);
                          }
                          ;
                          throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 707, column 5 - line 709, column 55): " + [enterAttrs.constructor.name]);
                        }))(function(enterBound) {
                          return bind12((function() {
                            if (updateAttrs instanceof Nothing) {
                              return pure1(v.value0.update);
                            }
                            ;
                            if (updateAttrs instanceof Just) {
                              return applyPerDatumAttrs1(updateAttrs.value0)(v.value0.update);
                            }
                            ;
                            throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 712, column 18 - line 714, column 54): " + [updateAttrs.constructor.name]);
                          })())(function(updateBound) {
                            return discard22((function() {
                              if (exitAttrs instanceof Nothing) {
                                return remove22(v.value0.exit);
                              }
                              ;
                              if (exitAttrs instanceof Just) {
                                return bind12(applyPerDatumAttrs1(exitAttrs.value0)(v.value0.exit))(function() {
                                  return remove22(v.value0.exit);
                                });
                              }
                              ;
                              throw new Error("Failed pattern match at PSD3.Internal.Selection.Operations (line 717, column 3 - line 721, column 18): " + [exitAttrs.constructor.name]);
                            })())(function() {
                              return merge1(enterBound)(updateBound);
                            });
                          });
                        });
                      });
                    };
                  };
                };
              };
            };
          };
        };
      };
    };
  };

  // output/PSD3.Interpreter.D3/index.js
  var select5 = /* @__PURE__ */ select4(monadEffectEffect);
  var selectElement2 = /* @__PURE__ */ selectElement(monadEffectEffect);
  var selectAll2 = /* @__PURE__ */ selectAll(monadEffectEffect);
  var selectAllWithData2 = /* @__PURE__ */ selectAllWithData(monadEffectEffect);
  var selectChildInheriting2 = /* @__PURE__ */ selectChildInheriting(monadEffectEffect);
  var renderData2 = /* @__PURE__ */ renderData(monadEffectEffect);
  var appendData2 = /* @__PURE__ */ appendData(monadEffectEffect);
  var joinData2 = /* @__PURE__ */ joinData(monadEffectEffect);
  var joinDataWithKey2 = /* @__PURE__ */ joinDataWithKey(monadEffectEffect);
  var append6 = /* @__PURE__ */ append5(monadEffectEffect);
  var setAttrs2 = /* @__PURE__ */ setAttrs(monadEffectEffect);
  var setAttrsExit2 = /* @__PURE__ */ setAttrsExit(monadEffectEffect);
  var remove3 = /* @__PURE__ */ remove(monadEffectEffect);
  var clear3 = /* @__PURE__ */ clear2(monadEffectEffect);
  var merge2 = /* @__PURE__ */ merge(monadEffectEffect);
  var appendChild3 = /* @__PURE__ */ appendChild2(monadEffectEffect);
  var appendChildInheriting2 = /* @__PURE__ */ appendChildInheriting(monadEffectEffect);
  var map10 = /* @__PURE__ */ map(functorMap);
  var D3v2Selection_ = function(x) {
    return x;
  };
  var monadD3v2M = monadEffect;
  var selectionMD3v2Selection_D = {
    select: function(selector) {
      return function __do2() {
        var sel = select5(selector)();
        return sel;
      };
    },
    selectElement: function(element) {
      return function __do2() {
        var sel = selectElement2(element)();
        return sel;
      };
    },
    selectAll: function(selector) {
      return function(v) {
        return function __do2() {
          var result = selectAll2(selector)(v)();
          return result;
        };
      };
    },
    openSelection: function(v) {
      return function(selector) {
        return function __do2() {
          var result = selectAll2(selector)(v)();
          return result;
        };
      };
    },
    selectAllWithData: function(selector) {
      return function(v) {
        return function __do2() {
          var result = selectAllWithData2(selector)(v)();
          return result;
        };
      };
    },
    selectChildInheriting: function(selector) {
      return function(v) {
        return function __do2() {
          var result = selectChildInheriting2(selector)(v)();
          return result;
        };
      };
    },
    renderData: function(dictFoldable) {
      var renderData1 = renderData2(dictFoldable);
      return function(dictOrd) {
        var renderData22 = renderData1(dictOrd);
        return function(elemType) {
          return function(foldableData) {
            return function(selector) {
              return function(v) {
                return function(enterAttrs) {
                  return function(updateAttrs) {
                    return function(exitAttrs) {
                      return function __do2() {
                        var result = renderData22(elemType)(foldableData)(selector)(v)(enterAttrs)(updateAttrs)(exitAttrs)();
                        return result;
                      };
                    };
                  };
                };
              };
            };
          };
        };
      };
    },
    appendData: function(dictFoldable) {
      var appendData1 = appendData2(dictFoldable);
      return function(elemType) {
        return function(foldableData) {
          return function(attrs) {
            return function(v) {
              return function __do2() {
                var result = appendData1(elemType)(foldableData)(attrs)(v)();
                return result;
              };
            };
          };
        };
      };
    },
    joinData: function(dictFoldable) {
      var joinData12 = joinData2(dictFoldable);
      return function(dictOrd) {
        var joinData22 = joinData12(dictOrd);
        return function(foldableData) {
          return function(selector) {
            return function(v) {
              return function __do2() {
                var v1 = joinData22(foldableData)(selector)(v)();
                return new JoinResult({
                  enter: v1.value0.enter,
                  update: v1.value0.update,
                  exit: v1.value0.exit
                });
              };
            };
          };
        };
      };
    },
    joinDataWithKey: function(dictFoldable) {
      var joinDataWithKey12 = joinDataWithKey2(dictFoldable);
      return function(dictOrd) {
        var joinDataWithKey22 = joinDataWithKey12(dictOrd.Eq0());
        return function(foldableData) {
          return function(keyFn) {
            return function(selector) {
              return function(v) {
                return function __do2() {
                  var v1 = joinDataWithKey22(foldableData)(keyFn)(selector)(v)();
                  return new JoinResult({
                    enter: v1.value0.enter,
                    update: v1.value0.update,
                    exit: v1.value0.exit
                  });
                };
              };
            };
          };
        };
      };
    },
    updateJoin: function(dictFoldable) {
      var joinDataWithKey12 = joinDataWithKey2(dictFoldable);
      return function(dictOrd) {
        var joinDataWithKey22 = joinDataWithKey12(dictOrd.Eq0());
        return function(v) {
          return function(_elemType) {
            return function(foldableData) {
              return function(keyFn) {
                return function(selector) {
                  return function __do2() {
                    var v1 = joinDataWithKey22(foldableData)(keyFn)(selector)(v)();
                    return new JoinResult({
                      enter: v1.value0.enter,
                      update: v1.value0.update,
                      exit: v1.value0.exit
                    });
                  };
                };
              };
            };
          };
        };
      };
    },
    append: function(elemType) {
      return function(attrs) {
        return function(v) {
          return function __do2() {
            var result = append6(elemType)(attrs)(v)();
            return result;
          };
        };
      };
    },
    setAttrs: function(attrs) {
      return function(v) {
        return function __do2() {
          var result = setAttrs2(attrs)(v)();
          return result;
        };
      };
    },
    setAttrsExit: function(attrs) {
      return function(v) {
        return function __do2() {
          var result = setAttrsExit2(attrs)(v)();
          return result;
        };
      };
    },
    remove: function(v) {
      return remove3(v);
    },
    clear: function(selector) {
      return clear3(selector);
    },
    merge: function(v) {
      return function(v1) {
        return function __do2() {
          var result = merge2(v)(v1)();
          return result;
        };
      };
    },
    appendChild: function(elemType) {
      return function(attrs) {
        return function(v) {
          return function __do2() {
            var result = appendChild3(elemType)(attrs)(v)();
            return result;
          };
        };
      };
    },
    appendChildInheriting: function(elemType) {
      return function(attrs) {
        return function(v) {
          return function __do2() {
            var result = appendChildInheriting2(elemType)(attrs)(v)();
            return result;
          };
        };
      };
    },
    on: function(behavior) {
      return function(v) {
        return function __do2() {
          var result = on2(behavior)(v)();
          return result;
        };
      };
    },
    renderTree: function(dictOrd) {
      var renderTree4 = renderTree2(dictOrd);
      return function(v) {
        return function(tree) {
          return function __do2() {
            var selectionsMap = renderTree4(v)(tree)();
            return map10(D3v2Selection_)(selectionsMap);
          };
        };
      };
    },
    Monad0: function() {
      return monadD3v2M;
    }
  };
  var bindD3v2M = bindEffect;
  var runD3v2M = function(v) {
    return v;
  };

  // output/PSD3.Render/index.js
  var runD3 = runD3v2M;

  // output/Data.String.CodePoints/foreign.js
  var hasArrayFrom = typeof Array.from === "function";
  var hasStringIterator = typeof Symbol !== "undefined" && Symbol != null && typeof Symbol.iterator !== "undefined" && typeof String.prototype[Symbol.iterator] === "function";
  var hasFromCodePoint = typeof String.prototype.fromCodePoint === "function";
  var hasCodePointAt = typeof String.prototype.codePointAt === "function";

  // output/PSD3.Unified.Attribute/index.js
  var attrStatic = function(name15) {
    return function(value12) {
      return new StaticAttr(name15, new StringValue(value12));
    };
  };

  // output/Test.RecursiveJoinDemo/index.js
  var fromFoldable3 = /* @__PURE__ */ fromFoldable(foldableList);
  var show6 = /* @__PURE__ */ show(showNumber);
  var log5 = /* @__PURE__ */ log2(monadEffectEffect);
  var bind1 = /* @__PURE__ */ bind(bindD3v2M);
  var select6 = /* @__PURE__ */ select(selectionMD3v2Selection_D);
  var renderTree3 = /* @__PURE__ */ renderTree(selectionMD3v2Selection_D)(/* @__PURE__ */ ordCofree(ord1List)(/* @__PURE__ */ ordRecord()(/* @__PURE__ */ ordRecordCons(/* @__PURE__ */ ordRecordCons(ordRecordNil)()({
    reflectSymbol: function() {
      return "value";
    }
  })(ordNumber))()({
    reflectSymbol: function() {
      return "name";
    }
  })(ordString))));
  var show14 = /* @__PURE__ */ show(showInt);
  var show22 = /* @__PURE__ */ show(/* @__PURE__ */ showSet(showString));
  var leaf = function(name15) {
    return function(value12) {
      return mkTree({
        name: name15,
        value: value12
      })(Nil.value);
    };
  };
  var isLeaf = function(tree) {
    var v = tail(tree);
    if (v instanceof Nil) {
      return true;
    }
    ;
    return false;
  };
  var getChildrenArray = function(tree) {
    return fromFoldable3(tail(tree));
  };
  var branch = function(name15) {
    return function(children2) {
      return mkTree({
        name: name15,
        value: 0
      })(children2);
    };
  };
  var flareRoot = /* @__PURE__ */ (function() {
    return branch("flare")(new Cons(branch("analytics")(new Cons(leaf("cluster")(100), new Cons(leaf("graph")(80), new Cons(leaf("optimization")(120), Nil.value)))), new Cons(branch("animate")(new Cons(leaf("Easing")(60), new Cons(leaf("interpolate")(90), new Cons(leaf("Transition")(70), Nil.value)))), new Cons(branch("data")(new Cons(leaf("converters")(110), new Cons(leaf("DataSet")(85), new Cons(leaf("DataTable")(95), Nil.value)))), new Cons(branch("display")(new Cons(leaf("DirtySprite")(75), new Cons(leaf("RectSprite")(65), Nil.value))), Nil.value)))));
  })();
  var vizTree = /* @__PURE__ */ (function() {
    var colorForName = function(name15) {
      if (name15 === "cluster") {
        return "#1f77b4";
      }
      ;
      if (name15 === "graph") {
        return "#1f77b4";
      }
      ;
      if (name15 === "optimization") {
        return "#1f77b4";
      }
      ;
      if (name15 === "Easing") {
        return "#ff7f0e";
      }
      ;
      if (name15 === "interpolate") {
        return "#ff7f0e";
      }
      ;
      if (name15 === "Transition") {
        return "#ff7f0e";
      }
      ;
      if (name15 === "converters") {
        return "#2ca02c";
      }
      ;
      if (name15 === "DataSet") {
        return "#2ca02c";
      }
      ;
      if (name15 === "DataTable") {
        return "#2ca02c";
      }
      ;
      if (name15 === "DirtySprite") {
        return "#d62728";
      }
      ;
      if (name15 === "RectSprite") {
        return "#d62728";
      }
      ;
      return "#999999";
    };
    var nodeTemplate = function(tree) {
      var nodeData = head(tree);
      var $36 = isLeaf(tree);
      if ($36) {
        return withBehaviors(elem2(Circle.value)([attrStatic("r")(show6(nodeData.value / 10)), attrStatic("fill")(colorForName(nodeData.name)), attrStatic("fill-opacity")("0.7"), attrStatic("stroke")(colorForName(nodeData.name)), attrStatic("stroke-width")("2"), attrStatic("cursor")("pointer"), attrStatic("cx")("0"), attrStatic("cy")("0")]))([onClickWithDatum(function(v) {
          return log5("Clicked leaf: " + nodeData.name);
        }), onMouseEnter(function(v) {
          return log5("Hover: " + nodeData.name);
        }), onMouseLeave(function(v) {
          return log5("Leave: " + nodeData.name);
        })]);
      }
      ;
      return withBehaviors(elem2(Group.value)([attrStatic("class")("internal-node"), attrStatic("data-name")(nodeData.name)]))([onClickWithDatum(function(v) {
        return log5("Clicked internal: " + nodeData.name);
      })]);
    };
    return withChild(named(SVG.value)("svg")([attrStatic("width")("800"), attrStatic("height")("600"), attrStatic("viewBox")("0 0 800 600"), attrStatic("style")("background: #0f0f23")]))(recursiveJoin({
      name: "nodes",
      key: "g"
    })(flareRoot)(function(t) {
      return head(t).name;
    })(getChildrenArray)(nodeTemplate));
  })();
  var main = function __do() {
    log5("=== RecursiveJoin Test ===")();
    log5("")();
    log5("This test uses recursiveJoin with tree-rose's Tree type.")();
    log5("A SINGLE ROOT NODE is passed in - no array flattening needed!")();
    log5("Children are extracted recursively via getChildren.")();
    log5("")();
    log5("--- Rendering to #viz ---")();
    var selectionsMap = runD3(bind1(select6("#viz"))(function(container) {
      return renderTree3(container)(vizTree);
    }))();
    log5("Render complete. Named selections: " + show14(size(selectionsMap)))();
    log5("Selection names: " + show22(keys2(selectionsMap)))();
    log5("")();
    log5("--- Done ---")();
    return log5("Check the browser console for click/hover events.")();
  };

  // <stdin>
  main();
})();
